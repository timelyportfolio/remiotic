(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("react"),require("process")):typeof define==="function"&&define.amd?define(["exports","react","process"],factory):(global=global||self,factory(global.Semiotic={},global.React,global.process$1))})(this,function(exports,React,process$1){"use strict";var React__default="default"in React?React["default"]:React;var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};function __extends(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0)t[p[i]]=s[p[i]];return t}function __values(o){var m=typeof Symbol==="function"&&o[Symbol.iterator],i=0;if(m)return m.call(o);return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}}}function __read(o,n){var m=typeof Symbol==="function"&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{while((n===void 0||n-- >0)&&!(r=i.next()).done)ar.push(r.value)}catch(error){e={error:error}}finally{try{if(r&&!r.done&&(m=i["return"]))m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function labeler(){var lab=[],anc=[],w=1,h=1,labeler={start:function(x){},width:function(x){},height:function(x){},label:function(x){},anchor:function(x){},alt_energy:function(x){},alt_schedule:function(x){}};var max_move=5,max_angle=.5;var w_len=.2,w_inter=1,w_lab2=30,w_lab_anc=30,w_orient=3;var user_energy=false;var user_defined_energy;var energy=function(index){var m=lab.length,ener=0,dx=lab[index].x-anc[index].x,dy=anc[index].y-lab[index].y,dist=Math.sqrt(dx*dx+dy*dy);if(dist>0)ener+=dist*w_len;dx/=dist;dy/=dist;if(dx>0&&dy>0){ener+=0*w_orient}else if(dx<0&&dy>0){ener+=1*w_orient}else if(dx<0&&dy<0){ener+=2*w_orient}else{ener+=3*w_orient}var x21=lab[index].x,y21=lab[index].y-lab[index].height+2,x22=lab[index].x+lab[index].width,y22=lab[index].y+2;var x11,x12,y11,y12,x_overlap,y_overlap,overlap_area;for(var i=0;i<m;i++){if(i!==index){var overlap_1=intersect(anc[index].x,lab[index].x,anc[i].x,lab[i].x,anc[index].y,lab[index].y,anc[i].y,lab[i].y);if(overlap_1)ener+=w_inter;x11=lab[i].x;y11=lab[i].y-lab[i].height+2;x12=lab[i].x+lab[i].width;y12=lab[i].y+2;x_overlap=Math.max(0,Math.min(x12,x22)-Math.max(x11,x21));y_overlap=Math.max(0,Math.min(y12,y22)-Math.max(y11,y21));overlap_area=x_overlap*y_overlap;ener+=overlap_area*w_lab2}x11=anc[i].x-anc[i].r;y11=anc[i].y-anc[i].r;x12=anc[i].x+anc[i].r;y12=anc[i].y+anc[i].r;x_overlap=Math.max(0,Math.min(x12,x22)-Math.max(x11,x21));y_overlap=Math.max(0,Math.min(y12,y22)-Math.max(y11,y21));overlap_area=x_overlap*y_overlap;ener+=overlap_area*w_lab_anc}return ener};var mcmove=function(currT){var i=Math.floor(Math.random()*lab.length);var x_old=lab[i].x;var y_old=lab[i].y;var old_energy;if(user_energy){old_energy=user_defined_energy(i,lab,anc)}else{old_energy=energy(i)}lab[i].x+=(Math.random()-.5)*max_move;lab[i].y+=(Math.random()-.5)*max_move;if(lab[i].x>w)lab[i].x=x_old;if(lab[i].x<0)lab[i].x=x_old;if(lab[i].y>h)lab[i].y=y_old;if(lab[i].y<0)lab[i].y=y_old;var new_energy;if(user_energy){new_energy=user_defined_energy(i,lab,anc)}else{new_energy=energy(i)}var delta_energy=new_energy-old_energy;if(!(Math.random()<Math.exp(-delta_energy/currT))){lab[i].x=x_old;lab[i].y=y_old}};var mcrotate=function(currT){var i=Math.floor(Math.random()*lab.length);var x_old=lab[i].x;var y_old=lab[i].y;var old_energy;if(user_energy){old_energy=user_defined_energy(i,lab,anc)}else{old_energy=energy(i)}var angle=(Math.random()-.5)*max_angle;var s=Math.sin(angle);var c=Math.cos(angle);lab[i].x-=anc[i].x;lab[i].y-=anc[i].y;var x_new=lab[i].x*c-lab[i].y*s,y_new=lab[i].x*s+lab[i].y*c;lab[i].x=x_new+anc[i].x;lab[i].y=y_new+anc[i].y;if(lab[i].x>w)lab[i].x=x_old;if(lab[i].x<0)lab[i].x=x_old;if(lab[i].y>h)lab[i].y=y_old;if(lab[i].y<0)lab[i].y=y_old;var new_energy;if(user_energy){new_energy=user_defined_energy(i,lab,anc)}else{new_energy=energy(i)}var delta_energy=new_energy-old_energy;if(!(Math.random()<Math.exp(-delta_energy/currT))){lab[i].x=x_old;lab[i].y=y_old}};var intersect=function(x1,x2,x3,x4,y1,y2,y3,y4){var mua,mub;var denom,numera,numerb;denom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);numera=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);numerb=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);mua=numera/denom;mub=numerb/denom;if(!(mua<0||mua>1||mub<0||mub>1)){return true}return false};var cooling_schedule=function(currT,initialT,nsweeps){return currT-initialT/nsweeps};labeler.start=function(nsweeps){var m=lab.length,currT=1,initialT=1;for(var i=0;i<nsweeps;i++){for(var j=0;j<m;j++){if(Math.random()<.5){mcmove(currT)}else{mcrotate(currT)}}currT=cooling_schedule(currT,initialT,nsweeps)}};labeler.width=function(x){if(!arguments.length)return w;w=x;return labeler};labeler.height=function(x){if(!arguments.length)return h;h=x;return labeler};labeler.label=function(x){if(!arguments.length)return lab;lab=x;return labeler};labeler.anchor=function(x){if(!arguments.length)return anc;anc=x;return labeler};labeler.alt_energy=function(x){if(!arguments.length)return energy;user_defined_energy=x;user_energy=true;return labeler};labeler.alt_schedule=function(x){if(!arguments.length)return cooling_schedule;return labeler};return labeler}var basicLabelSizeFunction=function(noteData,characterWidth,lineHeight,padding){var text=noteData.note.label||noteData.note.title;var textLength=text.length;var wrap=noteData.note.wrap||120;var width=Math.min(wrap,textLength*characterWidth)+padding*2;var height=Math.ceil(textLength*characterWidth/120)*lineHeight+padding*2;return[width,height]};function bumpAnnotations(adjustableNotes,processor,size,propsPointSizeFunction,propsLabelSizeFunction){var _a=processor.padding,padding=_a===void 0?1:_a,_b=processor.characterWidth,characterWidth=_b===void 0?8:_b,_c=processor.lineHeight,lineHeight=_c===void 0?20:_c,_d=processor.iterations,iterations=_d===void 0?500:_d,_e=processor.pointSizeFunction,pointSizeFunction=_e===void 0?propsPointSizeFunction:_e,_f=processor.labelSizeFunction,labelSizeFunction=_f===void 0?propsLabelSizeFunction||basicLabelSizeFunction:_f;var labels=adjustableNotes.map(function(d,i){var anchorX=(d.props.noteData.x[0]||d.props.noteData.x)+(d.props.noteData.dx!==undefined?d.props.noteData.dx:(i%3-1)*-10);var anchorY=(d.props.noteData.y[0]||d.props.noteData.y)+(d.props.noteData.dy!==undefined?d.props.noteData.dy:(i%3-1)*10);var _a=__read(labelSizeFunction(d.props.noteData,characterWidth,lineHeight,padding),2),labelWidth=_a[0],labelHeight=_a[1];return{x:anchorX,y:anchorY,above:anchorY<d.props.noteData.y,left:anchorX<d.props.noteData.x,width:labelWidth,height:labelHeight,type:"label",name:"",originalNote:d}});var points=adjustableNotes.map(function(d){return{x:d.props.noteData.x,y:d.props.noteData.y,fx:d.props.noteData.x,fy:d.props.noteData.y,r:pointSizeFunction&&pointSizeFunction(d.props.noteData)||5,type:"point",originalNote:d}});var instantiatedLabeler=labeler();instantiatedLabeler.label(labels);instantiatedLabeler.anchor(points);instantiatedLabeler.width(size[0]);instantiatedLabeler.height(size[1]);instantiatedLabeler.start(iterations);labels.forEach(function(d){if(d.type==="label"){var adjusted=adjustedXY(d.originalNote.props.noteData,d,padding);d.originalNote.props.noteData.nx=adjusted[0];d.originalNote.props.noteData.ny=adjusted[1]}});return adjustableNotes}function adjustedXY(note,calculated,padding){if(note.y>calculated.y){return[calculated.x+calculated.width/2+padding/2,calculated.y-calculated.height+padding/2]}return[calculated.x+calculated.width/2,calculated.y]}var typeHash={fill:function(style){return React.createElement("rect",{style:style,width:20,height:20})},line:function(style){return React.createElement("line",{style:style,x1:0,y1:0,x2:20,y2:20})}};function renderType(item,i,type,styleFn){var renderedType;if(typeof type==="function"){renderedType=type(item)}else{var Type=typeHash[type];var style=styleFn(item,i);renderedType=Type(style)}return renderedType}var Legend=function(_super){__extends(Legend,_super);function Legend(){return _super!==null&&_super.apply(this,arguments)||this}Legend.prototype.renderLegendGroup=function(legendGroup){var _a=legendGroup.type,type=_a===void 0?"fill":_a,styleFn=legendGroup.styleFn,items=legendGroup.items;var renderedItems=[];var itemOffset=0;items.forEach(function(item,i){var renderedType=renderType(item,i,type,styleFn);renderedItems.push(React.createElement("g",{key:"legend-item-"+i,transform:"translate(0,"+itemOffset+")"},renderedType,React.createElement("text",{y:15,x:30},item.label)));itemOffset+=25});return renderedItems};Legend.prototype.renderLegendGroupHorizontal=function(legendGroup){var _a=legendGroup.type,type=_a===void 0?"fill":_a,styleFn=legendGroup.styleFn,items=legendGroup.items;var renderedItems=[];var itemOffset=0;items.forEach(function(item,i){var renderedType=renderType(item,i,type,styleFn);renderedItems.push(React.createElement("g",{key:"legend-item-"+i,transform:"translate("+itemOffset+",0)"},renderedType,React.createElement("text",{y:15,x:25},item.label)));itemOffset+=35;itemOffset+=item.label.length*8});return{items:renderedItems,offset:itemOffset}};Legend.prototype.renderGroup=function(_a){var _this=this;var legendGroups=_a.legendGroups,width=_a.width;var offset=30;var renderedGroups=[];legendGroups.forEach(function(l,i){offset+=5;renderedGroups.push(React.createElement("line",{key:"legend-top-line legend-symbol-"+i,stroke:"gray",x1:0,y1:offset,x2:width,y2:offset}));offset+=10;if(l.label){offset+=20;renderedGroups.push(React.createElement("text",{key:"legend-text-"+i,y:offset,className:"legend-group-label"},l.label));offset+=10}renderedGroups.push(React.createElement("g",{key:"legend-group-"+i,className:"legend-item",transform:"translate(0,"+offset+")"},_this.renderLegendGroup(l)));offset+=l.items.length*25+10});return renderedGroups};Legend.prototype.renderHorizontalGroup=function(_a){var _this=this;var legendGroups=_a.legendGroups,title=_a.title,height=_a.height;var offset=0;var renderedGroups=[];var verticalOffset=title===false?10:40;legendGroups.forEach(function(l,i){if(l.label){renderedGroups.push(React.createElement("text",{key:"legend-text-"+i,transform:"translate("+offset+","+verticalOffset+") rotate(90)",textAnchor:"start",className:"legend-group-label"},l.label));offset+=20}var renderedItems=_this.renderLegendGroupHorizontal(l);renderedGroups.push(React.createElement("g",{key:"legend-group-"+i,className:"legend-item",transform:"translate("+offset+","+verticalOffset+")"},renderedItems.items));offset+=renderedItems.offset+5;if(legendGroups[i+1]){renderedGroups.push(React.createElement("line",{key:"legend-top-line legend-symbol-"+i,stroke:"gray",x1:offset,y1:verticalOffset-10,x2:offset,y2:height+verticalOffset+10}))}offset+=15});return React.createElement("g",null,title!==false&&React.createElement("line",{x1:0,x2:offset+10,y1:verticalOffset-10,y2:verticalOffset-10,stroke:"gray",className:"title-neatline"}),renderedGroups)};Legend.prototype.render=function(){var _a=this.props,legendGroups=_a.legendGroups,_b=_a.title,title=_b===void 0?"Legend":_b,_c=_a.width,width=_c===void 0?100:_c,_d=_a.height,height=_d===void 0?20:_d,_e=_a.orientation,orientation=_e===void 0?"vertical":_e;var renderedGroups=orientation==="vertical"?this.renderGroup({legendGroups:legendGroups,width:width}):this.renderHorizontalGroup({legendGroups:legendGroups,title:title,height:height});return React.createElement("g",null,title!==undefined&&React.createElement("text",{className:"legend-title",y:20,x:orientation==="horizontal"?0:width/2,textAnchor:orientation==="horizontal"?"start":"middle"},title),renderedGroups)};return Legend}(React.Component);var commonjsGlobal=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var classnames=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _default=function _default(){for(var _len=arguments.length,params=new Array(_len),_key=0;_key<_len;_key++){params[_key]=arguments[_key]}return params.filter(function(d){return d}).join(" ").trim()};exports.default=_default});var classnames$1=unwrapExports(classnames);var classnames$2=Object.freeze({default:classnames$1,__moduleExports:classnames});function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj}}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}var global$1=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout;var cachedClearTimeout=defaultClearTimeout;if(typeof global$1.setTimeout==="function"){cachedSetTimeout=setTimeout}if(typeof global$1.clearTimeout==="function"){cachedClearTimeout=clearTimeout}function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}function nextTick(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}}function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser";var platform="browser";var browser=true;var env={};var argv=[];var version="";var versions={};var release={};var config={};function noop(){}var on=noop;var addListener=noop;var once=noop;var off=noop;var removeListener=noop;var removeAllListeners=noop;var emit=noop;function binding(name){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(dir){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance$1=global$1.performance||{};var performanceNow=performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow||function(){return(new Date).getTime()};function hrtime(previousTimestamp){var clocktime=performanceNow.call(performance$1)*.001;var seconds=Math.floor(clocktime);var nanoseconds=Math.floor(clocktime%1*1e9);if(previousTimestamp){seconds=seconds-previousTimestamp[0];nanoseconds=nanoseconds-previousTimestamp[1];if(nanoseconds<0){seconds--;nanoseconds+=1e9}}return[seconds,nanoseconds]}var startTime=new Date;function uptime(){var currentTime=new Date;var dif=currentTime-startTime;return dif/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime};var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(_extends({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}var objectAssign=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to};var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";var ReactPropTypesSecret_1=ReactPropTypesSecret;var ReactPropTypesSecret$1=Object.freeze({default:ReactPropTypesSecret_1,__moduleExports:ReactPropTypesSecret_1});var ReactPropTypesSecret$2=ReactPropTypesSecret$1&&ReactPropTypesSecret_1||ReactPropTypesSecret$1;function emptyFunction(){}var factoryWithThrowingShims=function factoryWithThrowingShims(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret$2){return}var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types");err.name="Invariant Violation";throw err}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};ReactPropTypes.checkPropTypes=emptyFunction;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes};var factoryWithThrowingShims$1=Object.freeze({default:factoryWithThrowingShims,__moduleExports:factoryWithThrowingShims});var require$$1=factoryWithThrowingShims$1&&factoryWithThrowingShims||factoryWithThrowingShims$1;var propTypes=createCommonjsModule(function(module){{module.exports=require$$1()}});var propTypes$1=Object.freeze({default:propTypes,__moduleExports:propTypes});var require$$2=classnames$2&&classnames$1||classnames$2;var require$$3=propTypes$1&&propTypes||propTypes$1;var Annotation_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _classnames=_interopRequireDefault(require$$2);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$1.apply(this,arguments)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Annotation=function(_React$Component){_inherits(Annotation,_React$Component);function Annotation(){_classCallCheck(this,Annotation);return _possibleConstructorReturn(this,_getPrototypeOf(Annotation).apply(this,arguments))}_createClass(Annotation,[{key:"render",value:function render(){var _this=this;var _this$props=this.props,x=_this$props.x,y=_this$props.y,nx=_this$props.nx,ny=_this$props.ny,events=_this$props.events;var cleanedProps=_extends({},this.props);delete cleanedProps.children;var cleanedWithoutEvents=_extends({},cleanedProps);delete cleanedWithoutEvents.events;if(nx!==undefined)cleanedProps.dx=nx-x;if(ny!==undefined)cleanedProps.dy=ny-y;var childrenWithProps=_react.default.Children.toArray(this.props.children).map(function(child){return _react.default.cloneElement(child,_objectSpread({},typeof child.type==="string"?cleanedWithoutEvents:cleanedProps,child.props))});var wrappedEvents={};Object.keys(events).forEach(function(k){wrappedEvents[k]=function(e){events[k](_this.props,_this.state,e)}});return _react.default.createElement("g",_extends$1({className:(0,_classnames.default)("annotation",this.props.className),transform:"translate(".concat(x,", ").concat(y,")")},wrappedEvents),childrenWithProps)}}]);return Annotation}(_react.default.Component);exports.default=Annotation;Annotation.defaultProps={x:0,y:0,dx:0,dy:0,color:"grey",events:{}};Annotation.propTypes={x:_propTypes.default.number,y:_propTypes.default.number,dx:_propTypes.default.number,dy:_propTypes.default.number,color:_propTypes.default.string,editMode:_propTypes.default.bool,events:_propTypes.default.object}});var Annotation=unwrapExports(Annotation_1);var Annotation$1=Object.freeze({default:Annotation,__moduleExports:Annotation_1});var require$$1$1=Annotation$1&&Annotation||Annotation$1;var EditableAnnotation_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _Annotation=_interopRequireDefault(require$$1$1);var _classnames=_interopRequireDefault(require$$2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var EditableAnnotation=function(_React$Component){_inherits(EditableAnnotation,_React$Component);function EditableAnnotation(){var _getPrototypeOf2;var _this;_classCallCheck(this,EditableAnnotation);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(EditableAnnotation)).call.apply(_getPrototypeOf2,[this].concat(args)));_defineProperty(_assertThisInitialized(_assertThisInitialized(_this)),"state",{x:0,y:0,dx:0,dy:0});return _this}_createClass(EditableAnnotation,[{key:"componentWillMount",value:function componentWillMount(){this.setState({x:this.props.x,y:this.props.y,dx:this.props.dx,dy:this.props.dy})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState({x:nextProps.x,y:nextProps.y,dx:nextProps.dx,dy:nextProps.dy})}},{key:"getData",value:function getData(){return _extends({},this.props,this.state)}},{key:"dragEnd",value:function dragEnd(){if(this.props.onDragEnd){this.props.onDragEnd(this.getData())}}},{key:"dragStart",value:function dragStart(){if(this.props.onDragStart){this.props.onDragStart(this.getData())}}},{key:"dragSubject",value:function dragSubject(event,data){var _this2=this;this.setState({x:this.state.x+data.deltaX,y:this.state.y+data.deltaY},function(){if(_this2.props.onDrag)_this2.props.onDrag(_this2.getData())})}},{key:"dragSubjectSettings",value:function dragSubjectSettings(event,data){var _this3=this;this.setState(data,function(){if(_this3.props.onDrag)_this3.props.onDrag(_this3.getData())})}},{key:"dragNote",value:function dragNote(event,data){var _this4=this;this.setState({dx:this.state.dx+data.deltaX,dy:this.state.dy+data.deltaY},function(){if(_this4.props.onDrag)_this4.props.onDrag(_this4.getData())})}},{key:"render",value:function render(){var cleanedProps=_extends({},this.props,_objectSpread({},this.state,{dragSubject:this.dragSubject.bind(this),dragNote:this.dragNote.bind(this),dragSubjectSettings:this.dragSubjectSettings.bind(this),dragEnd:this.dragEnd.bind(this),dragStart:this.dragStart.bind(this),editMode:true,className:(0,_classnames.default)(this.props.className,"editable")}));return _react.default.createElement(_Annotation.default,cleanedProps)}}]);return EditableAnnotation}(_react.default.Component);exports.default=EditableAnnotation});var EditableAnnotation=unwrapExports(EditableAnnotation_1);var EditableAnnotation$1=Object.freeze({default:EditableAnnotation,__moduleExports:EditableAnnotation_1});var pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null;this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function moveTo(x,y){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)},closePath:function closePath(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}},lineTo:function lineTo(x,y){this._+="L"+(this._x1=+x)+","+(this._y1=+y)},quadraticCurveTo:function quadraticCurveTo(x1,y1,x,y){this._+="Q"+ +x1+","+ +y1+","+(this._x1=+x)+","+(this._y1=+y)},bezierCurveTo:function bezierCurveTo(x1,y1,x2,y2,x,y){this._+="C"+ +x1+","+ +y1+","+ +x2+","+ +y2+","+(this._x1=+x)+","+(this._y1=+y)},arcTo:function arcTo(x1,y1,x2,y2,r){x1=+x1,y1=+y1,x2=+x2,y2=+y2,r=+r;var x0=this._x1,y0=this._y1,x21=x2-x1,y21=y2-y1,x01=x0-x1,y01=y0-y1,l01_2=x01*x01+y01*y01;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+(this._x1=x1)+","+(this._y1=y1)}else if(!(l01_2>epsilon));else if(!(Math.abs(y01*x21-y21*x01)>epsilon)||!r){this._+="L"+(this._x1=x1)+","+(this._y1=y1)}else{var x20=x2-x0,y20=y2-y0,l21_2=x21*x21+y21*y21,l20_2=x20*x20+y20*y20,l21=Math.sqrt(l21_2),l01=Math.sqrt(l01_2),l=r*Math.tan((pi-Math.acos((l21_2+l01_2-l20_2)/(2*l21*l01)))/2),t01=l/l01,t21=l/l21;if(Math.abs(t01-1)>epsilon){this._+="L"+(x1+t01*x01)+","+(y1+t01*y01)}this._+="A"+r+","+r+",0,0,"+ +(y01*x20>x01*y20)+","+(this._x1=x1+t21*x21)+","+(this._y1=y1+t21*y21)}},arc:function arc(x,y,r,a0,a1,ccw){x=+x,y=+y,r=+r;var dx=r*Math.cos(a0),dy=r*Math.sin(a0),x0=x+dx,y0=y+dy,cw=1^ccw,da=ccw?a0-a1:a1-a0;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null){this._+="M"+x0+","+y0}else if(Math.abs(this._x1-x0)>epsilon||Math.abs(this._y1-y0)>epsilon){this._+="L"+x0+","+y0}if(!r)return;if(da<0)da=da%tau+tau;if(da>tauEpsilon){this._+="A"+r+","+r+",0,1,"+cw+","+(x-dx)+","+(y-dy)+"A"+r+","+r+",0,1,"+cw+","+(this._x1=x0)+","+(this._y1=y0)}else if(da>epsilon){this._+="A"+r+","+r+",0,"+ +(da>=pi)+","+cw+","+(this._x1=x+r*Math.cos(a1))+","+(this._y1=y+r*Math.sin(a1))}},rect:function rect(x,y,w,h){this._+="M"+(this._x0=this._x1=+x)+","+(this._y0=this._y1=+y)+"h"+ +w+"v"+ +h+"h"+-w+"Z"},toString:function toString(){return this._}};function constant(x){return function constant(){return x}}var abs=Math.abs;var atan2=Math.atan2;var cos=Math.cos;var max=Math.max;var min=Math.min;var sin=Math.sin;var sqrt=Math.sqrt;var epsilon$1=1e-12;var pi$1=Math.PI;var halfPi=pi$1/2;var tau$1=2*pi$1;function acos(x){return x>1?0:x<-1?pi$1:Math.acos(x)}function asin(x){return x>=1?halfPi:x<=-1?-halfPi:Math.asin(x)}function arcInnerRadius(d){return d.innerRadius}function arcOuterRadius(d){return d.outerRadius}function arcStartAngle(d){return d.startAngle}function arcEndAngle(d){return d.endAngle}function arcPadAngle(d){return d&&d.padAngle}function intersect(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=(x32*(y0-y2)-y32*(x0-x2))/(y32*x10-x32*y10);return[x0+t*x10,y0+t*y10]}function cornerTangents(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt(max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function arc(){var innerRadius=arcInnerRadius,outerRadius=arcOuterRadius,cornerRadius=constant(0),padRadius=null,startAngle=arcStartAngle,endAngle=arcEndAngle,padAngle=arcPadAngle,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi,a1=endAngle.apply(this,arguments)-halfPi,da=abs(a1-a0),cw=a1>a0;if(!context)context=buffer=path();if(r1<r0)r=r1,r1=r0,r0=r;if(!(r1>epsilon$1))context.moveTo(0,0);else if(da>tau$1-epsilon$1){context.moveTo(r1*cos(a0),r1*sin(a0));context.arc(0,0,r1,a0,a1,!cw);if(r0>epsilon$1){context.moveTo(r0*cos(a1),r0*sin(a1));context.arc(0,0,r0,a1,a0,cw)}}else{var a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>epsilon$1&&(padRadius?+padRadius.apply(this,arguments):sqrt(r0*r0+r1*r1)),rc=min(abs(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc,t0,t1;if(rp>epsilon$1){var p0=asin(rp/r0*sin(ap)),p1=asin(rp/r1*sin(ap));if((da0-=p0*2)>epsilon$1)p0*=cw?1:-1,a00+=p0,a10-=p0;else da0=0,a00=a10=(a0+a1)/2;if((da1-=p1*2)>epsilon$1)p1*=cw?1:-1,a01+=p1,a11-=p1;else da1=0,a01=a11=(a0+a1)/2}var x01=r1*cos(a01),y01=r1*sin(a01),x10=r0*cos(a10),y10=r0*sin(a10);if(rc>epsilon$1){var x11=r1*cos(a11),y11=r1*sin(a11),x00=r0*cos(a00),y00=r0*sin(a00);if(da<pi$1){var oc=da0>epsilon$1?intersect(x01,y01,x00,y00,x11,y11,x10,y10):[x10,y10],ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin(acos((ax*bx+ay*by)/(sqrt(ax*ax+ay*ay)*sqrt(bx*bx+by*by)))/2),lc=sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min(rc,(r0-lc)/(kc-1));rc1=min(rc,(r1-lc)/(kc+1))}}if(!(da1>epsilon$1))context.moveTo(x01,y01);else if(rc1>epsilon$1){t0=cornerTangents(x00,y00,x01,y01,r1,rc1,cw);t1=cornerTangents(x11,y11,x10,y10,r1,rc1,cw);context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc1<rc)context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc1,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r1,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),!cw);context.arc(t1.cx,t1.cy,rc1,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw);if(!(r0>epsilon$1)||!(da0>epsilon$1))context.lineTo(x10,y10);else if(rc0>epsilon$1){t0=cornerTangents(x10,y10,x11,y11,r0,-rc0,cw);t1=cornerTangents(x01,y01,x00,y00,r0,-rc0,cw);context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc0<rc)context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc0,atan2(t0.y01,t0.x01),atan2(t0.y11,t0.x11),!cw);context.arc(0,0,r0,atan2(t0.cy+t0.y11,t0.cx+t0.x11),atan2(t1.cy+t1.y11,t1.cx+t1.x11),cw);context.arc(t1.cx,t1.cy,rc0,atan2(t1.y11,t1.x11),atan2(t1.y01,t1.x01),!cw)}}else context.arc(0,0,r0,a10,a00,cw)}context.closePath();if(buffer)return context=null,buffer+""||null}arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi$1/2;return[cos(a)*r,sin(a)*r]};arc.innerRadius=function(_){return arguments.length?(innerRadius=typeof _==="function"?_:constant(+_),arc):innerRadius};arc.outerRadius=function(_){return arguments.length?(outerRadius=typeof _==="function"?_:constant(+_),arc):outerRadius};arc.cornerRadius=function(_){return arguments.length?(cornerRadius=typeof _==="function"?_:constant(+_),arc):cornerRadius};arc.padRadius=function(_){return arguments.length?(padRadius=_==null?null:typeof _==="function"?_:constant(+_),arc):padRadius};arc.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant(+_),arc):startAngle};arc.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant(+_),arc):endAngle};arc.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant(+_),arc):padAngle};arc.context=function(_){return arguments.length?(context=_==null?null:_,arc):context};return arc}function Linear(context){this._context=context}Linear.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y);break}}};function curveLinear(context){return new Linear(context)}function x(p){return p[0]}function y(p){return p[1]}function line(){var x$1=x,y$1=y,defined=constant(true),context=null,curve=curveLinear,output=null;function line(data){var i,n=data.length,d,defined0=false,buffer;if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0)output.lineStart();else output.lineEnd()}if(defined0)output.point(+x$1(d,i,data),+y$1(d,i,data))}if(buffer)return output=null,buffer+""||null}line.x=function(_){return arguments.length?(x$1=typeof _==="function"?_:constant(+_),line):x$1};line.y=function(_){return arguments.length?(y$1=typeof _==="function"?_:constant(+_),line):y$1};line.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant(!!_),line):defined};line.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),line):curve};line.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),line):context};return line}function area(){var x0=x,x1=null,y0=constant(0),y1=y,defined=constant(true),context=null,curve=curveLinear,output=null;function area(data){var i,j,k,n=data.length,d,defined0=false,buffer,x0z=new Array(n),y0z=new Array(n);if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0){j=i;output.areaStart();output.lineStart()}else{output.lineEnd();output.lineStart();for(k=i-1;k>=j;--k){output.point(x0z[k],y0z[k])}output.lineEnd();output.areaEnd()}}if(defined0){x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data);output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i])}}if(buffer)return output=null,buffer+""||null}function arealine(){return line().defined(defined).curve(curve).context(context)}area.x=function(_){return arguments.length?(x0=typeof _==="function"?_:constant(+_),x1=null,area):x0};area.x0=function(_){return arguments.length?(x0=typeof _==="function"?_:constant(+_),area):x0};area.x1=function(_){return arguments.length?(x1=_==null?null:typeof _==="function"?_:constant(+_),area):x1};area.y=function(_){return arguments.length?(y0=typeof _==="function"?_:constant(+_),y1=null,area):y0};area.y0=function(_){return arguments.length?(y0=typeof _==="function"?_:constant(+_),area):y0};area.y1=function(_){return arguments.length?(y1=_==null?null:typeof _==="function"?_:constant(+_),area):y1};area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)};area.lineY1=function(){return arealine().x(x0).y(y1)};area.lineX1=function(){return arealine().x(x1).y(y0)};area.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant(!!_),area):defined};area.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),area):curve};area.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),area):context};return area}function descending(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function identity(d){return d}function pie(){var value=identity,sortValues=descending,sort=null,startAngle=constant(0),endAngle=constant(tau$1),padAngle=constant(0);function pie(data){var i,n=data.length,j,k,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau$1,Math.max(-tau$1,endAngle.apply(this,arguments)-a0)),a1,p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1),v;for(i=0;i<n;++i){if((v=arcs[index[i]=i]=+value(data[i],i,data))>0){sum+=v}}if(sortValues!=null)index.sort(function(i,j){return sortValues(arcs[i],arcs[j])});else if(sort!=null)index.sort(function(i,j){return sort(data[i],data[j])});for(i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1){j=index[i],v=arcs[j],a1=a0+(v>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p}}return arcs}pie.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(+_),pie):value};pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues};pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort};pie.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant(+_),pie):startAngle};pie.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant(+_),pie):endAngle};pie.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant(+_),pie):padAngle};return pie}var curveRadialLinear=curveRadial(curveLinear);function Radial(curve){this._curve=curve}Radial.prototype={areaStart:function areaStart(){this._curve.areaStart()},areaEnd:function areaEnd(){this._curve.areaEnd()},lineStart:function lineStart(){this._curve.lineStart()},lineEnd:function lineEnd(){this._curve.lineEnd()},point:function point(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};function curveRadial(curve){function radial(context){return new Radial(curve(context))}radial._curve=curve;return radial}function radialLine(l){var c=l.curve;l.angle=l.x,delete l.x;l.radius=l.y,delete l.y;l.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve};return l}function radialLine$1(){return radialLine(line().curve(curveRadialLinear))}function radialArea(){var a=area().curve(curveRadialLinear),c=a.curve,x0=a.lineX0,x1=a.lineX1,y0=a.lineY0,y1=a.lineY1;a.angle=a.x,delete a.x;a.startAngle=a.x0,delete a.x0;a.endAngle=a.x1,delete a.x1;a.radius=a.y,delete a.y;a.innerRadius=a.y0,delete a.y0;a.outerRadius=a.y1,delete a.y1;a.lineStartAngle=function(){return radialLine(x0())},delete a.lineX0;a.lineEndAngle=function(){return radialLine(x1())},delete a.lineX1;a.lineInnerRadius=function(){return radialLine(y0())},delete a.lineY0;a.lineOuterRadius=function(){return radialLine(y1())},delete a.lineY1;a.curve=function(_){return arguments.length?c(curveRadial(_)):c()._curve};return a}var circle={draw:function draw(context,size){var r=Math.sqrt(size/pi$1);context.moveTo(r,0);context.arc(0,0,r,0,tau$1)}};var cross={draw:function draw(context,size){var r=Math.sqrt(size/5)/2;context.moveTo(-3*r,-r);context.lineTo(-r,-r);context.lineTo(-r,-3*r);context.lineTo(r,-3*r);context.lineTo(r,-r);context.lineTo(3*r,-r);context.lineTo(3*r,r);context.lineTo(r,r);context.lineTo(r,3*r);context.lineTo(-r,3*r);context.lineTo(-r,r);context.lineTo(-3*r,r);context.closePath()}};var tan30=Math.sqrt(1/3),tan30_2=tan30*2;var diamond={draw:function draw(context,size){var y=Math.sqrt(size/tan30_2),x=y*tan30;context.moveTo(0,-y);context.lineTo(x,0);context.lineTo(0,y);context.lineTo(-x,0);context.closePath()}};var ka=.8908130915292852,kr=Math.sin(pi$1/10)/Math.sin(7*pi$1/10),kx=Math.sin(tau$1/10)*kr,ky=-Math.cos(tau$1/10)*kr;var star={draw:function draw(context,size){var r=Math.sqrt(size*ka),x=kx*r,y=ky*r;context.moveTo(0,-r);context.lineTo(x,y);for(var i=1;i<5;++i){var a=tau$1*i/5,c=Math.cos(a),s=Math.sin(a);context.lineTo(s*r,-c*r);context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}};var square={draw:function draw(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}};var sqrt3=Math.sqrt(3);var triangle={draw:function draw(context,size){var y=-Math.sqrt(size/(sqrt3*3));context.moveTo(0,y*2);context.lineTo(-sqrt3*y,-y);context.lineTo(sqrt3*y,-y);context.closePath()}};var c=-.5,s=Math.sqrt(3)/2,k=1/Math.sqrt(12),a=(k/2+1)*3;var wye={draw:function draw(context,size){var r=Math.sqrt(size/a),x0=r/2,y0=r*k,x1=x0,y1=r*k+r,x2=-x1,y2=y1;context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.lineTo(c*x0-s*y0,s*x0+c*y0);context.lineTo(c*x1-s*y1,s*x1+c*y1);context.lineTo(c*x2-s*y2,s*x2+c*y2);context.lineTo(c*x0+s*y0,c*y0-s*x0);context.lineTo(c*x1+s*y1,c*y1-s*x1);context.lineTo(c*x2+s*y2,c*y2-s*x2);context.closePath()}};var symbols=[circle,cross,diamond,square,star,triangle,wye];function symbol(){var type=constant(circle),size=constant(64),context=null;function symbol(){var buffer;if(!context)context=buffer=path();type.apply(this,arguments).draw(context,+size.apply(this,arguments));if(buffer)return context=null,buffer+""||null}symbol.type=function(_){return arguments.length?(type=typeof _==="function"?_:constant(_),symbol):type};symbol.size=function(_){return arguments.length?(size=typeof _==="function"?_:constant(+_),symbol):size};symbol.context=function(_){return arguments.length?(context=_==null?null:_,symbol):context};return symbol}function noop$1(){}function _point(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis(context){this._context=context}Basis.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 3:_point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function basis(context){return new Basis(context)}function BasisClosed(context){this._context=context}BasisClosed.prototype={areaStart:noop$1,areaEnd:noop$1,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2);this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break;case 3:this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x2=x,this._y2=y;break;case 1:this._point=2;this._x3=x,this._y3=y;break;case 2:this._point=3;this._x4=x,this._y4=y;this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:_point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function basisClosed(context){return new BasisClosed(context)}function BasisOpen(context){this._context=context}BasisOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:_point(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function basisOpen(context){return new BasisOpen(context)}function Bundle(context,beta){this._basis=new Basis(context);this._beta=beta}Bundle.prototype={lineStart:function lineStart(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function lineEnd(){var x=this._x,y=this._y,j=x.length-1;if(j>0){var x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1,t;while(++i<=j){t=i/j;this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy))}}this._x=this._y=null;this._basis.lineEnd()},point:function point(x,y){this._x.push(+x);this._y.push(+y)}};var bundle=function custom(beta){function bundle(context){return beta===1?new Basis(context):new Bundle(context,beta)}bundle.beta=function(beta){return custom(+beta)};return bundle}(.85);function _point$1(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal(context,tension){this._context=context;this._k=(1-tension)/6}Cardinal.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:_point$1(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;this._x1=x,this._y1=y;break;case 2:this._point=3;default:_point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinal=function custom(tension){function cardinal(context){return new Cardinal(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalClosed(context,tension){this._context=context;this._k=(1-tension)/6}CardinalClosed.prototype={areaStart:noop$1,areaEnd:noop$1,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3);this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3);this._context.closePath();break;case 3:this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:_point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalClosed=function custom(tension){function cardinal(context){return new CardinalClosed(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalOpen(context,tension){this._context=context;this._k=(1-tension)/6}CardinalOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_point$1(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalOpen=function custom(tension){function cardinal(context){return new CardinalOpen(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function _point$2(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>epsilon$1){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n;y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>epsilon$1){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m;y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom(context,alpha){this._context=context;this._alpha=alpha}CatmullRom.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:_point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom(context,alpha):new Cardinal(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomClosed(context,alpha){this._context=context;this._alpha=alpha}CatmullRomClosed.prototype={areaStart:noop$1,areaEnd:noop$1,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3);this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3);this._context.closePath();break;case 3:this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:_point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomClosed=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed(context,alpha):new CardinalClosed(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomOpen(context,alpha){this._context=context;this._alpha=alpha}CatmullRomOpen.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_point$2(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomOpen=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen(context,alpha):new CardinalOpen(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function LinearClosed(context){this._context=context}LinearClosed.prototype={areaStart:noop$1,areaEnd:noop$1,lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){if(this._point)this._context.closePath()},point:function point(x,y){x=+x,y=+y;if(this._point)this._context.lineTo(x,y);else this._point=1,this._context.moveTo(x,y)}};function linearClosed(context){return new LinearClosed(context)}function sign(x){return x<0?-1:1}function slope3(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(sign(s0)+sign(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function _point$3(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX(context){this._context=context}MonotoneX.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:_point$3(this,this._t0,slope2(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){var t1=NaN;x=+x,y=+y;if(x===this._x1&&y===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;_point$3(this,slope2(this,t1=slope3(this,x,y)),t1);break;default:_point$3(this,this._t0,t1=slope3(this,x,y));break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y;this._t0=t1}};function MonotoneY(context){this._context=new ReflectContext(context)}(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(x,y){MonotoneX.prototype.point.call(this,y,x)};function ReflectContext(context){this._context=context}ReflectContext.prototype={moveTo:function moveTo(x,y){this._context.moveTo(y,x)},closePath:function closePath(){this._context.closePath()},lineTo:function lineTo(x,y){this._context.lineTo(y,x)},bezierCurveTo:function bezierCurveTo(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}};function monotoneX(context){return new MonotoneX(context)}function monotoneY(context){return new MonotoneY(context)}function Natural(context){this._context=context}Natural.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=[];this._y=[]},lineEnd:function lineEnd(){var x=this._x,y=this._y,n=x.length;if(n){this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]);if(n===2){this._context.lineTo(x[1],y[1])}else{var px=controlPoints(x),py=controlPoints(y);for(var i0=0,i1=1;i1<n;++i0,++i1){this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function point(x,y){this._x.push(+x);this._y.push(+y)}};function controlPoints(x){var i,n=x.length-1,m,a=new Array(n),b=new Array(n),r=new Array(n);a[0]=0,b[0]=2,r[0]=x[0]+2*x[1];for(i=1;i<n-1;++i){a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1]}a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n];for(i=1;i<n;++i){m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1]}a[n-1]=r[n-1]/b[n-1];for(i=n-2;i>=0;--i){a[i]=(r[i]-a[i+1])/b[i]}b[n-1]=(x[n]+a[n-1])/2;for(i=0;i<n-1;++i){b[i]=2*x[i+1]-a[i+1]}return[a,b]}function natural(context){return new Natural(context)}function Step(context,t){this._context=context;this._t=t}Step.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=this._y=NaN;this._point=0},lineEnd:function lineEnd(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:if(this._t<=0){this._context.lineTo(this._x,y);this._context.lineTo(x,y)}else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y);this._context.lineTo(x1,y)}break}this._x=x,this._y=y}};function step(context){return new Step(context,.5)}function stepBefore(context){return new Step(context,0)}function stepAfter(context){return new Step(context,1)}var slice=Array.prototype.slice;function none(series,order){if(!((n=series.length)>1))return;for(var i=1,s0,s1=series[order[0]],n,m=s1.length;i<n;++i){s0=s1,s1=series[order[i]];for(var j=0;j<m;++j){s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}}}function none$1(series){var n=series.length,o=new Array(n);while(--n>=0){o[n]=n}return o}function stackValue(d,key){return d[key]}function stack(){var keys=constant([]),order=none$1,offset=none,value=stackValue;function stack(data){var kz=keys.apply(this,arguments),i,m=data.length,n=kz.length,sz=new Array(n),oz;for(i=0;i<n;++i){for(var ki=kz[i],si=sz[i]=new Array(m),j=0,sij;j<m;++j){si[j]=sij=[0,+value(data[j],ki,j,data)];sij.data=data[j]}si.key=ki}for(i=0,oz=order(sz);i<n;++i){sz[oz[i]].index=i}offset(sz,oz);return sz}stack.keys=function(_){return arguments.length?(keys=typeof _==="function"?_:constant(slice.call(_)),stack):keys};stack.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant(+_),stack):value};stack.order=function(_){return arguments.length?(order=_==null?none$1:typeof _==="function"?_:constant(slice.call(_)),stack):order};stack.offset=function(_){return arguments.length?(offset=_==null?none:_,stack):offset};return stack}function expand(series,order){if(!((n=series.length)>0))return;for(var i,n,j=0,m=series[0].length,y;j<m;++j){for(y=i=0;i<n;++i){y+=series[i][j][1]||0}if(y)for(i=0;i<n;++i){series[i][j][1]/=y}}none(series,order)}function silhouette(series,order){if(!((n=series.length)>0))return;for(var j=0,s0=series[order[0]],n,m=s0.length;j<m;++j){for(var i=0,y=0;i<n;++i){y+=series[i][j][1]||0}s0[j][1]+=s0[j][0]=-y/2}none(series,order)}function wiggle(series,order){if(!((n=series.length)>0)||!((m=(s0=series[order[0]]).length)>0))return;for(var y=0,j=1,s0,m,n;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){var si=series[order[i]],sij0=si[j][1]||0,sij1=si[j-1][1]||0,s3=(sij0-sij1)/2;for(var k=0;k<i;++k){var sk=series[order[k]],skj0=sk[j][1]||0,skj1=sk[j-1][1]||0;s3+=skj0-skj1}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y;if(s1)y-=s2/s1}s0[j-1][1]+=s0[j-1][0]=y;none(series,order)}function ascending(series){var sums=series.map(sum);return none$1(series).sort(function(a,b){return sums[a]-sums[b]})}function sum(series){var s=0,i=-1,n=series.length,v;while(++i<n){if(v=+series[i][1])s+=v}return s}function descending$1(series){return ascending(series).reverse()}function insideOut(series){var n=series.length,i,j,sums=series.map(sum),order=none$1(series).sort(function(a,b){return sums[b]-sums[a]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=order[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)}function reverse(series){return none$1(series).reverse()}var d3Shape=Object.freeze({arc:arc,area:area,line:line,pie:pie,radialArea:radialArea,radialLine:radialLine$1,symbol:symbol,symbols:symbols,symbolCircle:circle,symbolCross:cross,symbolDiamond:diamond,symbolSquare:square,symbolStar:star,symbolTriangle:triangle,symbolWye:wye,curveBasisClosed:basisClosed,curveBasisOpen:basisOpen,curveBasis:basis,curveBundle:bundle,curveCardinalClosed:cardinalClosed,curveCardinalOpen:cardinalOpen,curveCardinal:cardinal,curveCatmullRomClosed:catmullRomClosed,curveCatmullRomOpen:catmullRomOpen,curveCatmullRom:catmullRom,curveLinearClosed:linearClosed,curveLinear:curveLinear,curveMonotoneX:monotoneX,curveMonotoneY:monotoneY,curveNatural:natural,curveStep:step,curveStepAfter:stepAfter,curveStepBefore:stepBefore,stack:stack,stackOffsetExpand:expand,stackOffsetNone:none,stackOffsetSilhouette:silhouette,stackOffsetWiggle:wiggle,stackOrderAscending:ascending,stackOrderDescending:descending$1,stackOrderInsideOut:insideOut,stackOrderNone:none$1,stackOrderReverse:reverse});var _d3Shape=d3Shape&&undefined||d3Shape;var Builder=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.arcBuilder=exports.pathBuilder=exports.lineBuilder=undefined;var lineBuilder=exports.lineBuilder=function lineBuilder(_ref){var data=_ref.data,_ref$curve=_ref.curve,curve=_ref$curve===undefined?_d3Shape.curveLinear:_ref$curve,canvasContext=_ref.canvasContext,className=_ref.className,classID=_ref.classID;var lineGen=(0,_d3Shape.line)().curve(curve);var builder={type:"path",className:className,classID:classID,data:data};if(canvasContext){lineGen.context(canvasContext);builder.pathMethods=lineGen}else{builder.attrs={d:lineGen(data)}}return builder};var pathBuilder=exports.pathBuilder=function pathBuilder(_ref2){var d=_ref2.d,_ref2$curve=_ref2.curve,curve=_ref2$curve===undefined?_d3Shape.curveLinear:_ref2$curve,canvasContext=_ref2.canvasContext,className=_ref2.className,classID=_ref2.classID;var lineGen=(0,_d3Shape.line)().curve(curve);var builder={type:"path",className:className,classID:classID};if(canvasContext){lineGen.context(canvasContext)}else{builder.attrs={d:d}}return builder};var arcBuilder=exports.arcBuilder=function arcBuilder(_ref3){var data=_ref3.data,canvasContext=_ref3.canvasContext,className=_ref3.className,classID=_ref3.classID;var builder={type:"path",className:className,classID:classID,data:data};var arcShape=(0,_d3Shape.arc)().innerRadius(data.innerRadius||0).outerRadius(data.outerRadius||data.radius||2).startAngle(data.startAngle||0).endAngle(data.endAngle||2*Math.PI);if(canvasContext){arcShape.context(canvasContext)}else{builder.attrs={d:arcShape()}}return builder}});var Builder$1=unwrapExports(Builder);var Builder_1=Builder.arcBuilder;var Builder_2=Builder.pathBuilder;var Builder_3=Builder.lineBuilder;var Builder$2=Object.freeze({default:Builder$1,__moduleExports:Builder,arcBuilder:Builder_1,pathBuilder:Builder_2,lineBuilder:Builder_3});var _Builder=Builder$2&&Builder$1||Builder$2;var typeLine=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.lineSetup=undefined;var lineSetup=exports.lineSetup=function lineSetup(_ref){var dx=_ref.dx,dy=_ref.dy,radius=_ref.radius,outerRadius=_ref.outerRadius,radiusPadding=_ref.radiusPadding,width=_ref.width,height=_ref.height;var x1=0,x2=dx,y1=0,y2=dy;if(outerRadius||radius){var h=Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));var angle=Math.asin(-y2/h);var r=(outerRadius||radius)+(radiusPadding||0);x1=Math.abs(Math.cos(angle)*r)*(x2<0?-1:1);y1=Math.abs(Math.sin(angle)*r)*(y2<0?-1:1)}if(width&&height){if(width>0&&dx>0||width<0&&dx<0){if(Math.abs(width)>Math.abs(dx))x1=width/2;else x1=width}if(height>0&&dy>0||height<0&&dy<0){if(Math.abs(height)>Math.abs(dy))y1=height/2;else y1=height}if(x1===width/2&&y1===height/2){x1=x2;y1=y2}}return[[x1,y1],[x2,y2]]};exports.default=function(connectorData){var data=lineSetup(connectorData);return{components:[(0,_Builder.lineBuilder)({data:data,className:"connector"})]}}});var typeLine$1=unwrapExports(typeLine);var typeLine_1=typeLine.lineSetup;var typeLine$2=Object.freeze({default:typeLine$1,__moduleExports:typeLine,lineSetup:typeLine_1});var Connector_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$1.apply(this,arguments)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Connector=function(_React$Component){_inherits(Connector,_React$Component);function Connector(){_classCallCheck(this,Connector);return _possibleConstructorReturn(this,_getPrototypeOf(Connector).apply(this,arguments))}_createClass(Connector,[{key:"getComponents",value:function getComponents(){}},{key:"render",value:function render(){var _this$props=this.props,color=_this$props.color,dx=_this$props.dx,dy=_this$props.dy,customID=_this$props.customID;if(dx===0&&dy===0){return _react.default.createElement("g",{className:"annotation-connector"})}var d=this.getComponents(this.props)||[];var cleanedProps=_extends({},this.props);delete cleanedProps.children;var childrenWithProps=_react.default.Children.map(this.props.children,function(child){return _react.default.cloneElement(child,_objectSpread({},cleanedProps,child.props,{scale:cleanedProps.endScale||child.props.endScale,lineData:d.components[0].data}))});return _react.default.createElement("g",_extends$1({className:"annotation-connector"},this.props.gAttrs),d.components&&d.components.map(function(c,i){var attrs={};if(!c)return null;Object.keys(c.attrs).forEach(function(k){if(c.attrs[k]&&k!=="text"){attrs[k.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})]=c.attrs[k]}});return _react.default.createElement(c.type,_extends$1({mask:customID?"url(#".concat(customID,")"):undefined,key:i,className:c.className,fill:"none",stroke:color},attrs),c.attrs.text)}),childrenWithProps)}}]);return Connector}(_react.default.Component);exports.default=Connector});var Connector=unwrapExports(Connector_1);var Connector$1=Object.freeze({default:Connector,__moduleExports:Connector_1});var _typeLine=typeLine$2&&typeLine$1||typeLine$2;var require$$1$2=Connector$1&&Connector||Connector$1;var ConnectorLine_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _typeLine$1=_interopRequireDefault(_typeLine);var _Connector2=_interopRequireDefault(require$$1$2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorLine=function(_Connector){_inherits(ConnectorLine,_Connector);function ConnectorLine(){_classCallCheck(this,ConnectorLine);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorLine).apply(this,arguments))}_createClass(ConnectorLine,[{key:"getComponents",value:function getComponents(_ref){var x=_ref.x,y=_ref.y,dy=_ref.dy,dx=_ref.dx,radius=_ref.radius,outerRadius=_ref.outerRadius,width=_ref.width,height=_ref.height;return(0,_typeLine$1.default)({x:x,y:y,dx:dx,dy:dy,radius:radius,outerRadius:outerRadius,width:width,height:height})}}]);return ConnectorLine}(_Connector2.default);exports.default=ConnectorLine});var ConnectorLine=unwrapExports(ConnectorLine_1);var ConnectorLine$1=Object.freeze({default:ConnectorLine,__moduleExports:ConnectorLine_1});var typeElbow=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var dx=_ref.dx,dy=_ref.dy,radius=_ref.radius,outerRadius=_ref.outerRadius,radiusPadding=_ref.radiusPadding,width=_ref.width,height=_ref.height;var x1=0,x2=dx,y1=0,y2=dy;if(width&&height){if(width>0&&dx>0||width<0&&dx<0){if(Math.abs(width)>Math.abs(dx))x1=width/2;else x1=width}if(height>0&&dy>0||height<0&&dy<0){if(Math.abs(height)>Math.abs(dy))y1=height/2;else y1=height}if(x1===width/2&&y1===height/2){x1=x2;y1=y2}}var data=[[x1,y1],[x2,y2]];var diffY=y2-y1;var diffX=x2-x1;var xe=x2;var ye=y2;var opposite=y2<y1&&x2>x1||x2<x1&&y2>y1?-1:1;if(Math.abs(diffX)<Math.abs(diffY)){xe=x2;ye=y1+diffX*opposite}else{ye=y2;xe=x1+diffY*opposite}if(outerRadius||radius){var r=(outerRadius||radius)+(radiusPadding||0);var length=r/Math.sqrt(2);if(Math.abs(diffX)>length&&Math.abs(diffY)>length){x1=length*(x2<0?-1:1);y1=length*(y2<0?-1:1);data=[[x1,y1],[xe,ye],[x2,y2]]}else if(Math.abs(diffX)>Math.abs(diffY)){var angle=Math.asin(-y2/r);x1=Math.abs(Math.cos(angle)*r)*(x2<0?-1:1);data=[[x1,y2],[x2,y2]]}else{var _angle=Math.acos(x2/r);y1=Math.abs(Math.sin(_angle)*r)*(y2<0?-1:1);data=[[x2,y1],[x2,y2]]}}else{data=[[x1,y1],[xe,ye],[x2,y2]]}return{components:[(0,_Builder.lineBuilder)({data:data,className:"connector"})]}}});var typeElbow$1=unwrapExports(typeElbow);var typeElbow$2=Object.freeze({default:typeElbow$1,__moduleExports:typeElbow});var require$$1$3=typeElbow$2&&typeElbow$1||typeElbow$2;var ConnectorElbow_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _typeElbow=_interopRequireDefault(require$$1$3);var _Connector2=_interopRequireDefault(require$$1$2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorElbow=function(_Connector){_inherits(ConnectorElbow,_Connector);function ConnectorElbow(){_classCallCheck(this,ConnectorElbow);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorElbow).apply(this,arguments))}_createClass(ConnectorElbow,[{key:"getComponents",value:function getComponents(_ref){var x=_ref.x,y=_ref.y,dy=_ref.dy,dx=_ref.dx,radius=_ref.radius,radiusPadding=_ref.radiusPadding,outerRadius=_ref.outerRadius,width=_ref.width,height=_ref.height;return(0,_typeElbow.default)({x:x,y:y,dx:dx,dy:dy,radius:radius,radiusPadding:radiusPadding,outerRadius:outerRadius,width:width,height:height})}}]);return ConnectorElbow}(_Connector2.default);exports.default=ConnectorElbow});var ConnectorElbow=unwrapExports(ConnectorElbow_1);var ConnectorElbow$1=Object.freeze({default:ConnectorElbow,__moduleExports:ConnectorElbow_1});var typeCurve=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var createPoints=function createPoints(offset){var anchors=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var diff={x:offset.x/(anchors+1),y:offset.y/(anchors+1)};var p=[];var i=1;for(;i<=anchors;i++){p.push([diff.x*i+i%2*20,diff.y*i-i%2*20])}return p};exports.default=function(_ref){var curve=_ref.curve,points=_ref.points,x=_ref.x,y=_ref.y,dx=_ref.dx,dy=_ref.dy,radius=_ref.radius,outerRadius=_ref.outerRadius,width=_ref.width,height=_ref.height;if(!points||typeof points==="number"){points=createPoints({x:dx,y:dy},points)}if(!curve){curve=_d3Shape.curveCatmullRom}var handles=[];var data=(0,_typeLine.lineSetup)({x:x,y:y,dx:dx,dy:dy,radius:radius,outerRadius:outerRadius,width:width,height:height});data=[data[0]].concat(_toConsumableArray(points),[data[1]]);var components=[(0,_Builder.lineBuilder)({data:data,curve:curve,className:"connector"})];return{components:components,handles:handles}}});var typeCurve$1=unwrapExports(typeCurve);var typeCurve$2=Object.freeze({default:typeCurve$1,__moduleExports:typeCurve});var require$$0=typeCurve$2&&typeCurve$1||typeCurve$2;var ConnectorCurve_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _typeCurve=_interopRequireDefault(require$$0);var _Connector2=_interopRequireDefault(require$$1$2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorCurve=function(_Connector){_inherits(ConnectorCurve,_Connector);function ConnectorCurve(){_classCallCheck(this,ConnectorCurve);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorCurve).apply(this,arguments))}_createClass(ConnectorCurve,[{key:"getComponents",value:function getComponents(_ref){var curve=_ref.curve,points=_ref.points,x=_ref.x,y=_ref.y,dx=_ref.dx,dy=_ref.dy,radius=_ref.radius,outerRadius=_ref.outerRadius,width=_ref.width,height=_ref.height;return(0,_typeCurve.default)({curve:curve,points:points,x:x,y:y,dx:dx,dy:dy,radius:radius,outerRadius:outerRadius,width:width,height:height})}}]);return ConnectorCurve}(_Connector2.default);exports.default=ConnectorCurve});var ConnectorCurve=unwrapExports(ConnectorCurve_1);var ConnectorCurve$1=Object.freeze({default:ConnectorCurve,__moduleExports:ConnectorCurve_1});var endDot=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var lineData=_ref.lineData,_ref$scale=_ref.scale,scale=_ref$scale===undefined?1:_ref$scale;var dot=(0,_Builder.arcBuilder)({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(scale)}});dot.attrs.transform="translate("+lineData[0][0]+", "+lineData[0][1]+")";return{components:[dot]}}});var endDot$1=unwrapExports(endDot);var endDot$2=Object.freeze({default:endDot$1,__moduleExports:endDot});var ConnectorEnd_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorEnd=function(_React$Component){_inherits(ConnectorEnd,_React$Component);function ConnectorEnd(){_classCallCheck(this,ConnectorEnd);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorEnd).apply(this,arguments))}_createClass(ConnectorEnd,[{key:"getComponents",value:function getComponents(){}},{key:"render",value:function render(){var color=this.props.color;var d=this.getComponents(this.props)||[];var c=d.components[0];return _react.default.createElement(c.type,_extends({className:c.className},c.attrs,{fill:color}))}}]);return ConnectorEnd}(_react.default.Component);exports.default=ConnectorEnd});var ConnectorEnd=unwrapExports(ConnectorEnd_1);var ConnectorEnd$1=Object.freeze({default:ConnectorEnd,__moduleExports:ConnectorEnd_1});var require$$1$4=endDot$2&&endDot$1||endDot$2;var require$$2$1=ConnectorEnd$1&&ConnectorEnd||ConnectorEnd$1;var ConnectorEndDot_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _endDot=_interopRequireDefault(require$$1$4);var _ConnectorEnd2=_interopRequireDefault(require$$2$1);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorEndDot=function(_ConnectorEnd){_inherits(ConnectorEndDot,_ConnectorEnd);function ConnectorEndDot(){_classCallCheck(this,ConnectorEndDot);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorEndDot).apply(this,arguments))}_createClass(ConnectorEndDot,[{key:"getComponents",value:function getComponents(_ref){var x=_ref.x,y=_ref.y,dy=_ref.dy,dx=_ref.dx,lineData=_ref.lineData,scale=_ref.scale;return(0,_endDot.default)({x:x,y:y,dx:dx,dy:dy,lineData:lineData,scale:scale})}}]);return ConnectorEndDot}(_ConnectorEnd2.default);exports.default=ConnectorEndDot;ConnectorEndDot.propTypes={x:_propTypes.default.number,y:_propTypes.default.number,dx:_propTypes.default.number,dy:_propTypes.default.number,scale:_propTypes.default.number,lineData:_propTypes.default.array}});var ConnectorEndDot=unwrapExports(ConnectorEndDot_1);var ConnectorEndDot$1=Object.freeze({default:ConnectorEndDot,__moduleExports:ConnectorEndDot_1});var endArrow=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var dx=_ref.dx,dy=_ref.dy,start=_ref.start,end=_ref.end,_ref$scale=_ref.scale,scale=_ref$scale===undefined?1:_ref$scale;if(!start){start=[dx,dy]}else{start=[-end[0]+start[0],-end[1]+start[1]]}if(!end){end=[0,0]}var x1=end[0],y1=end[1];var size=10*scale;var angleOffset=16/180*Math.PI;var angle=Math.atan(start[1]/start[0]);if(start[0]<0){angle+=Math.PI}var data=[[x1,y1],[Math.cos(angle+angleOffset)*size+x1,Math.sin(angle+angleOffset)*size+y1],[Math.cos(angle-angleOffset)*size+x1,Math.sin(angle-angleOffset)*size+y1],[x1,y1]];return{components:[(0,_Builder.lineBuilder)({data:data,className:"connector-end connector-arrow",classID:"connector-end"})]}}});var endArrow$1=unwrapExports(endArrow);var endArrow$2=Object.freeze({default:endArrow$1,__moduleExports:endArrow});var require$$1$5=endArrow$2&&endArrow$1||endArrow$2;var ConnectorEndArrow_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _endArrow=_interopRequireDefault(require$$1$5);var _ConnectorEnd2=_interopRequireDefault(require$$2$1);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var ConnectorEndArrow=function(_ConnectorEnd){_inherits(ConnectorEndArrow,_ConnectorEnd);function ConnectorEndArrow(){_classCallCheck(this,ConnectorEndArrow);return _possibleConstructorReturn(this,_getPrototypeOf(ConnectorEndArrow).apply(this,arguments))}_createClass(ConnectorEndArrow,[{key:"getComponents",value:function getComponents(_ref){var x=_ref.x,y=_ref.y,dy=_ref.dy,dx=_ref.dx,lineData=_ref.lineData,scale=_ref.scale;var start=lineData[1];var end=lineData[0];var distance=Math.sqrt(Math.pow(start[0]-end[0],2)+Math.pow(start[1]-end[1],2));if(distance<5&&lineData[2]){start=lineData[2]}return(0,_endArrow.default)({x:x,y:y,dx:dx,dy:dy,start:start,end:end,scale:scale})}}]);return ConnectorEndArrow}(_ConnectorEnd2.default);exports.default=ConnectorEndArrow;ConnectorEndArrow.propTypes={x:_propTypes.default.number,y:_propTypes.default.number,dx:_propTypes.default.number,dy:_propTypes.default.number,scale:_propTypes.default.number,lineData:_propTypes.default.array}});var ConnectorEndArrow=unwrapExports(ConnectorEndArrow_1);var ConnectorEndArrow$1=Object.freeze({default:ConnectorEndArrow,__moduleExports:ConnectorEndArrow_1});var Handle_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=Handle;var _react=_interopRequireDefault(React__default);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var events={mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"},touch:{start:"touchstart",move:"touchemove",stop:"touchend"}};var listenerOptions={passive:false};var makeHandler=function makeHandler(type,handleStart,handleStop,handleDrag){return function(e){e.preventDefault();var xDim="clientX";var yDim="clientY";var oX=e.nativeEvent[xDim];var oY=e.nativeEvent[yDim];var x=oX;var y=oY;handleStart&&handleStart();var move=function move(d){d.preventDefault();handleDrag&&handleDrag(d,{deltaX:d[xDim]-x,deltaY:d[yDim]-y,oDeltaX:d[xDim]-oX,oDeltaY:d[yDim]-oY});x=d[xDim];y=d[yDim]};var stop=function stop(e){e.preventDefault();document.removeEventListener(events[type].move,move,listenerOptions);document.removeEventListener(events[type].stop,stop,listenerOptions);handleStop&&handleStop()};document.addEventListener(events[type].move,move,listenerOptions);document.addEventListener(events[type].stop,stop,listenerOptions)}};function Handle(_ref){var _ref$x=_ref.x,x=_ref$x===void 0?0:_ref$x,_ref$y=_ref.y,y=_ref$y===void 0?0:_ref$y,_ref$r=_ref.r,r=_ref$r===void 0?10:_ref$r,handleStart=_ref.handleStart,handleStop=_ref.handleStop,handleDrag=_ref.handleDrag;return _react.default.createElement("circle",{className:"handle",cx:x,cy:y,r:r,onMouseDown:makeHandler("mouse",handleStart,handleStop,handleDrag),onTouchStart:makeHandler("touch",handleStart,handleStop,handleDrag),strokeDasharray:"5",stroke:"grey",fill:"white",fillOpacity:0})}Handle.propTypes={x:_propTypes.default.number,y:_propTypes.default.number,r:_propTypes.default.number,handleStart:_propTypes.default.func,handleStop:_propTypes.default.func,handleDrag:_propTypes.default.func}});var Handle=unwrapExports(Handle_1);var Handle$1=Object.freeze({default:Handle,__moduleExports:Handle_1});var require$$3$1=Handle$1&&Handle||Handle$1;var Subject_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _Handle=_interopRequireDefault(require$$3$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Subject=function(_React$Component){_inherits(Subject,_React$Component);function Subject(){_classCallCheck(this,Subject);return _possibleConstructorReturn(this,_getPrototypeOf(Subject).apply(this,arguments))}_createClass(Subject,[{key:"getComponents",value:function getComponents(){}},{key:"render",value:function render(){var _this=this;var _this$props=this.props,editMode=_this$props.editMode,color=_this$props.color;var d=this.getComponents(this.props)||{};var handles;if(editMode){handles=[_react.default.createElement(_Handle.default,{key:"subject-handle",handleStart:this.props.dragStart,handleStop:this.props.dragEnd,handleDrag:this.props.dragSubject})];if(d.handles){handles=handles.concat(d.handles.map(function(h,i){return _react.default.createElement(_Handle.default,{key:"subjecthandle-".concat(i),handleStart:_this.props.dragStart,handleStop:_this.props.dragEnd,x:h.x,y:h.y,offsetParent:h.offsetParent&&_this.subject,handleDrag:function handleDrag(e,data){_this.props.dragSubjectSettings(e,d.handleFunction(h,data))}})}))}}return _react.default.createElement("g",_extends({className:"annotation-subject"},this.props.gAttrs,{ref:function ref(subject){_this.subject=subject}}),d.components&&d.components.map(function(c,i){var attrs={};if(!c)return null;Object.keys(c.attrs).forEach(function(k){if(c.attrs[k]&&k!=="text"){attrs[k.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})]=c.attrs[k]}});return _react.default.createElement(c.type,_extends({key:i,className:c.className,fill:"none",stroke:color},attrs),c.attrs.text)}),handles)}}]);return Subject}(_react.default.Component);exports.default=Subject});var Subject=unwrapExports(Subject_1);var Subject$1=Object.freeze({default:Subject,__moduleExports:Subject_1});var alignment=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var leftRightDynamic=exports.leftRightDynamic=function leftRightDynamic(align,y){if(!align||align==="dynamic"||align==="left"||align==="right"){if(y<0){align="top"}else{align="bottom"}}return align};var topBottomDynamic=exports.topBottomDynamic=function topBottomDynamic(align,x){if(!align||align==="dynamic"||align==="top"||align==="bottom"){if(x<0){align="right"}else{align="left"}}return align};var orientationTopBottom=["topBottom","top","bottom"];var orientationLeftRight=["leftRight","left","right"];exports.default=function(_ref){var _ref$padding=_ref.padding,padding=_ref$padding===undefined?0:_ref$padding,_ref$bbox=_ref.bbox,bbox=_ref$bbox===undefined?{x:0,y:0,width:0,height:0}:_ref$bbox,align=_ref.align,orientation=_ref.orientation,_ref$offset=_ref.offset,offset=_ref$offset===undefined?{x:0,y:0}:_ref$offset;var x=-bbox.x;var y=-bbox.y;if(orientationTopBottom.indexOf(orientation)!==-1){align=topBottomDynamic(align,offset.x);if(offset.y<0&&orientation==="topBottom"||orientation==="top"){y-=bbox.height+padding}else{y+=padding}if(align==="middle"){x-=bbox.width/2}else if(align==="right"){x-=bbox.width}}else if(orientationLeftRight.indexOf(orientation)!==-1){align=leftRightDynamic(align,offset.y);if(offset.x<0&&orientation==="leftRight"||orientation==="left"){x-=bbox.width+padding}else{x+=padding}if(align==="middle"){y-=bbox.height/2}else if(align==="top"){y-=bbox.height}}return{x:x,y:y}}});var alignment$1=unwrapExports(alignment);var alignment_1=alignment.leftRightDynamic;var alignment_2=alignment.topBottomDynamic;var alignment$2=Object.freeze({default:alignment$1,__moduleExports:alignment,leftRightDynamic:alignment_1,topBottomDynamic:alignment_2});var require$$1$6=alignment$2&&alignment$1||alignment$2;var lineTypeVertical=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var align=_ref.align,_ref$x=_ref.x,x=_ref$x===undefined?0:_ref$x,_ref$y=_ref.y,y=_ref$y===undefined?0:_ref$y,bbox=_ref.bbox,offset=_ref.offset;align=(0,require$$1$6.leftRightDynamic)(align,offset.y);if(align==="top"){y-=bbox.height}else if(align==="middle"){y-=bbox.height/2}var data=[[x,y],[x,y+bbox.height]];return{components:[(0,_Builder.lineBuilder)({data:data,className:"note-line"})]}}});var lineTypeVertical$1=unwrapExports(lineTypeVertical);var lineTypeVertical$2=Object.freeze({default:lineTypeVertical$1,__moduleExports:lineTypeVertical});var lineTypeHorizontal=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var align=_ref.align,_ref$x=_ref.x,x=_ref$x===undefined?0:_ref$x,_ref$y=_ref.y,y=_ref$y===undefined?0:_ref$y,offset=_ref.offset,bbox=_ref.bbox;align=(0,require$$1$6.topBottomDynamic)(align,offset.x);if(align==="right"){x-=bbox.width}else if(align==="middle"){x-=bbox.width/2}var data=[[x,y],[x+bbox.width,y]];return{components:[(0,_Builder.lineBuilder)({data:data,className:"note-line"})]}}});var lineTypeHorizontal$1=unwrapExports(lineTypeHorizontal);var lineTypeHorizontal$2=Object.freeze({default:lineTypeHorizontal$1,__moduleExports:lineTypeHorizontal});var require$$3$2=lineTypeVertical$2&&lineTypeVertical$1||lineTypeVertical$2;var require$$4=lineTypeHorizontal$2&&lineTypeHorizontal$1||lineTypeHorizontal$2;var Note_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _alignment4=_interopRequireDefault(require$$1$6);var _Handle=_interopRequireDefault(require$$3$1);var _lineTypeVertical=_interopRequireDefault(require$$3$2);var _lineTypeHorizontal=_interopRequireDefault(require$$4);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _extends$1(){_extends$1=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends$1.apply(this,arguments)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var getOuterBBox=function getOuterBBox(){for(var _len=arguments.length,domNodes=new Array(_len),_key=0;_key<_len;_key++){domNodes[_key]=arguments[_key]}return domNodes.concat().reduce(function(p,c){if(c){var bbox=c.getBBox();p.x=Math.min(p.x,bbox.x);p.y=Math.min(p.y,bbox.y);p.width=Math.max(p.width,bbox.width);var yOffset=c&&c.attributes&&c.attributes.y;p.height=Math.max(p.height,(yOffset&&parseFloat(yOffset.value)||0)+bbox.height)}return p},{x:0,y:0,width:0,height:0})};var Note=function(_React$Component){_inherits(Note,_React$Component);function Note(props){var _this;_classCallCheck(this,Note);_this=_possibleConstructorReturn(this,_getPrototypeOf(Note).call(this,props));_defineProperty(_assertThisInitialized(_assertThisInitialized(_this)),"state",{translateX:0,translateY:0,labelOffset:0,changed:0,bbox:{width:0,height:0,x:0,y:0}});_this.updateText=_this.updateText.bind(_assertThisInitialized(_assertThisInitialized(_this)));return _this}_createClass(Note,[{key:"componentDidMount",value:function componentDidMount(){this.updateText(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.title!==this.props.title||nextProps.label!==this.props.label||nextProps.wrap!==this.props.wrap){this.updateText(nextProps)}if(nextProps.editMode&&(nextProps.align==="dynamic"||!nextProps.align)){this.updateText(nextProps)}}},{key:"updateText",value:function updateText(_ref){var _this2=this;var orientation=_ref.orientation,padding=_ref.padding,align=_ref.align,lineType=_ref.lineType,label=_ref.label,title=_ref.title,wrap=_ref.wrap,wrapSplitter=_ref.wrapSplitter,dx=_ref.dx,dy=_ref.dy;var newState={titleWrapped:null,labelWrapped:null};newState.changed=this.state.changed+1;if(title){newState.titleWrapped=this.title&&this.wrapText(this.title,newState.changed,title,wrap,wrapSplitter)}if(label)newState.labelWrapped=this.label&&this.wrapText(this.label,newState.changed,label,wrap,wrapSplitter);this.setState(newState,function(){var setLabel=function setLabel(){var bbox=getOuterBBox(_this2.title,_this2.label);var noteParams={padding:padding,bbox:bbox,offset:{x:dx,y:dy},orientation:orientation,align:align};if(lineType==="vertical")noteParams.orientation="leftRight";else if(lineType==="horizontal")noteParams.orientation="topBottom";var _alignment=(0,_alignment4.default)(noteParams),x=_alignment.x,y=_alignment.y;_this2.setState({translateX:x,translateY:y,bbox:bbox})};_this2.setState({labelOffset:title&&_this2.title.getBBox().height||0},setLabel)})}},{key:"wrapText",value:function wrapText(textRef,key,text,width,wrapSplitter){var initialAttrs={x:0,dy:"1.2em"};var words=text.split(wrapSplitter||/[ \t\r\n]+/).reverse().filter(function(w){return w!==""});var word,line=[];var tspans=[];while(word=words.pop()){line.push(word);textRef.lastChild.textContent=line.join(" ");var length=textRef.lastChild.getComputedTextLength();textRef.lastChild.textContent="";if(length>width&&line.length>1){line.pop();tspans.push(_react.default.createElement("tspan",_extends$1({key:tspans.length+text},initialAttrs),line.join(" ")));line=[word]}}if(line.length!==0){tspans.push(_react.default.createElement("tspan",_extends$1({key:tspans.length+text},initialAttrs),line.join(" ")))}return _react.default.createElement("tspan",_extends$1({},initialAttrs,{key:key+text}),tspans)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _this$props=this.props,orientation=_this$props.orientation,padding=_this$props.padding,align=_this$props.align,dx=_this$props.dx,dy=_this$props.dy,lineType=_this$props.lineType;if(this.state.bbox.width&&(prevProps.dx!==this.props.dx||prevProps.dy!==this.props.dy)&&(this.title||this.label)){var bbox=getOuterBBox(this.title,this.label);var noteParams={padding:padding,bbox:bbox,offset:{x:dx,y:dy},orientation:orientation,align:align};if(lineType==="vertical")noteParams.orientation="leftRight";else if(lineType==="horizontal")noteParams.orientation="topBottom";var _alignment2=(0,_alignment4.default)(noteParams),x=_alignment2.x,y=_alignment2.y;var updates={bbox:bbox};if(this.state.translateX!==x)updates.translateX=x;if(this.state.translateY!==y)updates.translateY=y;if(updates.translateX!==undefined||updates.translateY!==undefined){this.setState(updates)}}else if(this.state.align!==prevProps.align||this.props.orientation!==prevProps.orientation||this.props.padding!==prevProps.padding){var _noteParams={padding:padding,bbox:this.state.bbox,offset:{x:dx,y:dy},orientation:orientation,align:align};if(lineType==="vertical")_noteParams.orientation="leftRight";else if(lineType==="horizontal")_noteParams.orientation="topBottom";var _alignment3=(0,_alignment4.default)(_noteParams),_x=_alignment3.x,_y=_alignment3.y;var _updates={};if(this.state.translateX!==_x)_updates.translateX=_x;if(this.state.translateY!==_y)_updates.translateY=_y;if(_updates.translateX!==undefined||_updates.translateY!==undefined){this.setState(_updates)}}}},{key:"render",value:function render(){var _this3=this;var _this$props2=this.props,dx=_this$props2.dx,dy=_this$props2.dy,title=_this$props2.title,label=_this$props2.label,align=_this$props2.align,editMode=_this$props2.editMode,lineType=_this$props2.lineType,color=_this$props2.color,titleColor=_this$props2.titleColor,labelColor=_this$props2.labelColor,bgPadding=_this$props2.bgPadding;var bgPaddingFinal={top:0,bottom:0,left:0,right:0};if(typeof bgPadding==="number"){bgPaddingFinal={top:bgPadding,bottom:bgPadding,left:bgPadding,right:bgPadding}}else if(bgPadding&&_typeof$1(bgPadding)==="object"){bgPaddingFinal=_extends(bgPaddingFinal,bgPadding)}var noteTitle,noteText,noteLineType;if(title){noteTitle=_react.default.createElement("text",{ref:function ref(el){return _this3.title=el},className:"annotation-note-title",fontWeight:"bold",key:"title",fill:titleColor||color},this.state.titleWrapped||_react.default.createElement("tspan",{x:0,dy:".8em"},title))}if(label){noteText=_react.default.createElement("text",{ref:function ref(el){return _this3.label=el},className:"annotation-note-label",y:this.state.labelOffset*1.1,key:"label",fill:labelColor||color},this.state.labelWrapped||_react.default.createElement("tspan",{x:0,dy:".8em"},label))}if(lineType&&this.state.bbox.width){var noteParams={bbox:this.state.bbox,align:align,offset:{x:dx,y:dy}};var noteComponent=(lineType==="vertical"&&(0,_lineTypeVertical.default)(noteParams)||lineType==="horizontal"&&(0,_lineTypeHorizontal.default)(noteParams)).components[0];noteLineType=_react.default.createElement(noteComponent.type,_extends$1({className:noteComponent.className},noteComponent.attrs,{stroke:color}))}var handle;if(editMode){handle=_react.default.createElement(_Handle.default,{handleStart:this.props.dragStart,handleStop:this.props.dragEnd,handleDrag:this.props.dragNote})}return _react.default.createElement("g",_extends$1({transform:"translate(".concat(dx,", ").concat(dy,")"),className:"annotation-note"},this.props.gProps),_react.default.createElement("g",{className:"annotation-note-content",transform:"translate(".concat(this.state.translateX,",\n          ").concat(this.state.translateY,")"),ref:function ref(el){return _this3.note=el}},_react.default.createElement("rect",{className:"annotation-note-bg",width:this.state.bbox.width+bgPaddingFinal.left+bgPaddingFinal.right,x:-bgPaddingFinal.left,y:-bgPaddingFinal.top,height:this.state.bbox.height+bgPaddingFinal.top+bgPaddingFinal.bottom,stroke:"none",fill:"white",fillOpacity:"0"}),noteTitle,noteText),noteLineType,handle)}}]);return Note}(_react.default.Component);exports.default=Note;Note.defaultProps={wrap:120,align:"dynamic",orientation:"topBottom",padding:3};Note.propTypes={dx:_propTypes.default.number,dy:_propTypes.default.number,title:_propTypes.default.string,label:_propTypes.default.string,orientation:_propTypes.default.oneOf(["leftRight","topBottom"]),padding:_propTypes.default.number,bgPadding:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.object]),align:_propTypes.default.oneOf(["left","right","middle","top","bottom","dynamic"]),editMode:_propTypes.default.bool,lineType:_propTypes.default.oneOf(["vertical","horizontal"]),color:_propTypes.default.string,titleColor:_propTypes.default.string,labelColor:_propTypes.default.string}});var Note=unwrapExports(Note_1);var Note$1=Object.freeze({default:Note,__moduleExports:Note_1});var JSXNote_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=JSXNote;var _react=_interopRequireDefault(React__default);var _Handle=_interopRequireDefault(require$$3$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function JSXNote(props){var note=props.note,dx=props.dx,dy=props.dy,editMode=props.editMode,dragStart=props.dragStart,dragEnd=props.dragEnd,dragNote=props.dragNote;var handle;if(editMode){handle=_react.default.createElement(_Handle.default,{handleStart:dragStart,handleStop:dragEnd,handleDrag:dragNote})}return _react.default.createElement("g",{className:"annotation-note",transform:"translate(".concat(dx,", ").concat(dy,")")},typeof note==="function"?note(props):note,handle)}});var JSXNote=unwrapExports(JSXNote_1);var JSXNote$1=Object.freeze({default:JSXNote,__moduleExports:JSXNote_1});var require$$2$2=EditableAnnotation$1&&EditableAnnotation||EditableAnnotation$1;var require$$2$3=ConnectorLine$1&&ConnectorLine||ConnectorLine$1;var require$$1$7=ConnectorElbow$1&&ConnectorElbow||ConnectorElbow$1;var require$$5=ConnectorCurve$1&&ConnectorCurve||ConnectorCurve$1;var require$$6=ConnectorEndDot$1&&ConnectorEndDot||ConnectorEndDot$1;var require$$7=ConnectorEndArrow$1&&ConnectorEndArrow||ConnectorEndArrow$1;var require$$2$4=Subject$1&&Subject||Subject$1;var require$$1$8=Note$1&&Note||Note$1;var require$$10=JSXNote$1&&JSXNote||JSXNote$1;var Type=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=_default;var _react=_interopRequireDefault(React__default);var _Annotation=_interopRequireDefault(require$$1$1);var _EditableAnnotation=_interopRequireDefault(require$$2$2);var _ConnectorLine=_interopRequireDefault(require$$2$3);var _ConnectorElbow=_interopRequireDefault(require$$1$7);var _ConnectorCurve=_interopRequireDefault(require$$5);var _ConnectorEndDot=_interopRequireDefault(require$$6);var _ConnectorEndArrow=_interopRequireDefault(require$$7);var _Subject=_interopRequireDefault(require$$2$4);var _Note=_interopRequireDefault(require$$1$8);var _JSXNote=_interopRequireDefault(require$$10);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}var getAnnotationType=function getAnnotationType(editMode){return editMode?_EditableAnnotation.default:_Annotation.default};function _default(props,Connector){var NoteDefaultProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var Subject=arguments.length>3&&arguments[3]!==undefined?arguments[3]:_Subject.default;var SubjectDefaultProps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var NoteType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:_Note.default;var _props$disable=props.disable,disable=_props$disable===void 0?[]:_props$disable,connector=props.connector,note=props.note,subject=props.subject,x=props.x,y=props.y,dx=props.dx,dy=props.dy,nx=props.nx,ny=props.ny,color=props.color,className=props.className,onDrag=props.onDrag,onDragStart=props.onDragStart,onDragEnd=props.onDragEnd,editMode=props.editMode,events=props.events;var CONNECTORS={type:{curve:_ConnectorCurve.default,line:_ConnectorLine.default,elbow:_ConnectorElbow.default},end:{dot:_ConnectorEndDot.default,arrow:_ConnectorEndArrow.default}};var ConnectorType,ConnectorEndType;if(disable.indexOf("connector")===-1){ConnectorType=connector&&CONNECTORS.type[connector.type]||Connector;ConnectorEndType=connector&&CONNECTORS.end[connector.end]}var AnnotationType=getAnnotationType(props.editMode);return _react.default.createElement(AnnotationType,_extends({x:x,y:y,dx:dx,dy:dy,nx:nx,ny:ny,color:color,className:className,onDrag:onDrag,onDragStart:onDragStart,onDragEnd:onDragEnd,editMode:editMode},SubjectDefaultProps,subject,{events:events}),ConnectorType&&_react.default.createElement(ConnectorType,connector,ConnectorEndType&&_react.default.createElement(ConnectorEndType,null)),Subject&&disable.indexOf("subject")===-1&&_react.default.createElement(Subject,null),note&&disable.indexOf("note")===-1&&(_react.default.isValidElement(note)||typeof note==="function")?_react.default.createElement(_JSXNote.default,{noteDefaultProps:NoteDefaultProps,note:note}):_react.default.createElement(NoteType,_extends({},NoteDefaultProps,note)))}});var Type$1=unwrapExports(Type);var Type$2=Object.freeze({default:Type$1,__moduleExports:Type});var require$$3$3=Type$2&&Type$1||Type$2;var AnnotationLabel_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationLabel;var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);var _ConnectorLine=_interopRequireDefault(require$$2$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationLabel(props){var className=(0,_classnames.default)("label",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorLine.default,{align:"middle"})}});var AnnotationLabel=unwrapExports(AnnotationLabel_1);var interactivityFns=["onDragEnd","onDragStart","onDrag"];var SemioticAnnotation=function(_super){__extends(SemioticAnnotation,_super);function SemioticAnnotation(){return _super!==null&&_super.apply(this,arguments)||this}SemioticAnnotation.prototype.render=function(){var baseNoteData=this.props.noteData;var screenCoordinates=baseNoteData.screenCoordinates;var noteData=__assign({},baseNoteData);interactivityFns.forEach(function(d){if(baseNoteData[d]){delete noteData[d];var originalFn_1=baseNoteData[d];noteData[d]=function(updatedSettingsFromRA){originalFn_1({originalSettings:baseNoteData,updatedSettings:updatedSettingsFromRA,noteIndex:baseNoteData.i})}}});var AnnotationType=typeof noteData.type==="function"?noteData.type:AnnotationLabel;var eventListeners=noteData.eventListeners||noteData.events||{};var finalStyle={};if(noteData.events||noteData.eventListeners||noteData.editMode){finalStyle.pointerEvents="all"}if(noteData.coordinates&&screenCoordinates){var setNX_1=noteData.nx||screenCoordinates[0][0]+noteData.dx;var setNY_1=noteData.ny||screenCoordinates[0][1]+noteData.dy;var notes=screenCoordinates.map(function(d,i){var subjectNote=Object.assign({},noteData,{note:i===0?noteData.note:{label:""},x:d[0],y:d[1],nx:setNX_1,ny:setNY_1});return React.createElement(AnnotationType,__assign({key:"multi-annotation-"+i},subjectNote))});return React.createElement("g",__assign({},eventListeners,{style:finalStyle}),notes)}var finalAnnotation=React.createElement(AnnotationType,__assign({events:eventListeners},noteData));if(finalStyle.pointerEvents){return React.createElement("g",{style:finalStyle},finalAnnotation)}return finalAnnotation};return SemioticAnnotation}(React.Component);var labella_min=createCommonjsModule(function(module,exports){!function(t,e){module.exports=e()}(commonjsGlobal,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){t.exports={Node:r(1),Force:r(2),Distributor:r(3),Renderer:r(10)}},function(t,e){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(){function t(e,n,i){r(this,t),this.idealPos=e,this.currentPos=e,this.width=n,this.data=i,this.layerIndex=0}return n(t,[{key:"distanceFrom",value:function value(t){var e=this.width/2,r=t.width/2;return Math.max(this.currentPos-e,t.currentPos-r)-Math.min(this.currentPos+e,t.currentPos+r)}},{key:"moveToIdealPosition",value:function value(){return this.currentPos=this.idealPos,this}},{key:"displacement",value:function value(){return this.idealPos-this.currentPos}},{key:"overlapWithNode",value:function value(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.distanceFrom(t)-e<0}},{key:"overlapWithPoint",value:function value(t){var e=this.width/2;return t>=this.currentPos-e&&t<=this.currentPos+e}},{key:"positionBefore",value:function value(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.currentLeft()-this.width/2-e}},{key:"positionAfter",value:function value(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.currentRight()+this.width/2+e}},{key:"currentRight",value:function value(){return this.currentPos+this.width/2}},{key:"currentLeft",value:function value(){return this.currentPos-this.width/2}},{key:"idealRight",value:function value(){return this.idealPos+this.width/2}},{key:"idealLeft",value:function value(){return this.idealPos-this.width/2}},{key:"createStub",value:function value(e){var r=new t(this.idealPos,e,this.data);return r.currentPos=this.currentPos,r.child=this,this.parent=r,r}},{key:"removeStub",value:function value(){return this.parent&&(this.parent.child=null,this.parent=null),this}},{key:"isStub",value:function value(){return!!this.child}},{key:"getPathToRoot",value:function value(){for(var t=[],e=this;e;){t.push(e),e=e.parent}return t}},{key:"getPathFromRoot",value:function value(){return this.getPathToRoot().reverse()}},{key:"getPathToRootLength",value:function value(){for(var t=0,e=this;e;){var r=e.parent?e.parent.currentPos:e.idealPos;t+=Math.abs(e.currentPos-r),e=e.parent}return t}},{key:"getRoot",value:function value(){for(var t=this,e=this;e;){t=e,e=e.parent}return t}},{key:"getLayerIndex",value:function value(){return this.layerIndex}},{key:"clone",value:function value(){var e=new t(this.idealPos,this.width,this.data);return e.currentPos=this.currentPos,e.layerIndex=this.layerIndex,e}}]),t}();t.exports=i},function(t,e,r){var n=r(3),i=r(4),o=r(8),s={nodeSpacing:3,minPos:0,maxPos:null,algorithm:"overlap",removeOverlap:!0,density:.85,stubWidth:1},u=function u(t){var e={},r=i.extend({},s),u=new n,a=[],c=null;return e.nodes=function(t){return arguments.length?(a=t,c=[t.concat()],e):a},e.getLayers=function(){return c},e.options=function(t){if(!arguments.length)return r;r=i.extend(r,t);var o=i.pick(r,Object.keys(n.DEFAULT_OPTIONS));return i.isDefined(r.minPos)&&i.isDefined(r.maxPos)?o.layerWidth=r.maxPos-r.minPos:o.layerWidth=null,u.options(o),e},e.options(t),e.compute=function(){var t=i.pick(r,Object.keys(o.DEFAULT_OPTIONS));return a.forEach(function(t){t.removeStub()}),c=u.distribute(a),c.map(function(e,n){e.forEach(function(t){t.layerIndex=n}),r.removeOverlap&&o(e,t)}),e},e.start=function(){console.log("[warning] force.start() is deprecated. Please use force.compute() instead.")},e};u.DEFAULT_OPTIONS=s,t.exports=u},function(t,e,r){var n=r(4),i=r(6),o={algorithm:"overlap",layerWidth:1e3,density:.75,nodeSpacing:3,stubWidth:1},s=function s(t){var e={};t=n.extend({},o,t),e.options=function(r){return arguments.length?(t=n.extend(t,r),e):t},e.computeRequiredWidth=function(e){return n.sum(e,function(e){return e.width+t.nodeSpacing})-t.nodeSpacing},e.maxWidthPerLayer=function(){return t.density*t.layerWidth},e.needToSplit=function(t){return e.estimateRequiredLayers(t)>1},e.estimateRequiredLayers=function(r){return t.layerWidth?Math.ceil(e.computeRequiredWidth(r)/e.maxWidthPerLayer()):1};var r={simple:function simple(r){for(var n=e.estimateRequiredLayers(r),i=[],o=0;o<n;o++){i.push([])}return r.forEach(function(e,r){var o=r%n;i[o].push(e);for(var s=e,u=o-1;u>=0;u--){s=s.createStub(t.stubWidth),i[u].push(s)}}),i},roundRobin:function roundRobin(t){var e=[];return e},overlap:function overlap(r){for(var n=[],i=e.maxWidthPerLayer(),o=r.concat(),s=e.computeRequiredWidth(o);s>i;){e.countIdealOverlaps(o);var u=o.concat(),a=s;for(o=[];u.length>2&&a>i;){u.sort(function(t,e){return e.overlapCount-t.overlapCount});var c=u.shift();a-=c.width,a+=t.stubWidth,c.overlaps.forEach(function(t){t.overlapCount--}),o.push(c)}n.push(u),s=e.computeRequiredWidth(o)}o.length>0&&n.push(o);for(var h=n.length-1;h>=1;h--){for(var l=n[h],f=0;f<l.length;f++){var p=l[f];if(!p.isStub())for(var d=p,v=h-1;v>=0;v--){d=d.createStub(t.stubWidth),n[v].push(d)}}}return n}};return e.countIdealOverlaps=function(e){var r=new i(t.layerWidth/2);return e.forEach(function(t){r.add([t.idealLeft(),t.idealRight(),t])}),e.forEach(function(t){var e=r.search(t.idealLeft(),t.idealRight());t.overlaps=e.map(function(t){return t.data[2]}),t.overlapCount=e.length}),e},e.distribute=function(i){if(!i||0===i.length)return[];if("none"==t.algorithm||!n.isDefined(t.algorithm))return[i];if(!e.needToSplit(i))return[i];var o=i.concat().sort(function(t,e){return t.idealPos-e.idealPos});if("function"==typeof t.algorithm)return t.algorithm(o,t);if(r.hasOwnProperty(t.algorithm))return r[t.algorithm](o);throw"Unknown algorithm: "+t.algorithm},e};s.DEFAULT_OPTIONS=o,t.exports=s},function(t,e,r){var n={isDefined:function isDefined(t){return null!==t&&void 0!==t},last:function last(t){return t.length>0?t[t.length-1]:null},pick:function pick(t,e){return e.reduce(function(e,r){return e[r]=t[r],e},{})},sum:function sum(t,e){return t.map(e).reduce(function(t,e){return t+e},0)}};n.extend=r(5),t.exports=n},function(t,e){var r="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(t){return _typeof(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof(t)},n=Object.prototype.hasOwnProperty,i=Object.prototype.toString,o=function o(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===i.call(t)},s=function s(t){if(!t||"[object Object]"!==i.call(t))return!1;var e=n.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!r)return!1;var o;for(o in t){}return void 0===o||n.call(t,o)};t.exports=function u(){var t,e,n,i,a,c,h=arguments[0],l=1,f=arguments.length,p=!1;for("boolean"==typeof h?(p=h,h=arguments[1]||{},l=2):("object"!==("undefined"==typeof h?"undefined":r(h))&&"function"!=typeof h||null==h)&&(h={});l<f;++l){if(t=arguments[l],null!=t)for(e in t){n=h[e],i=t[e],h!==i&&(p&&i&&(s(i)||(a=o(i)))?(a?(a=!1,c=n&&o(n)?n:[]):c=n&&s(n)?n:{},h[e]=u(p,c,i)):void 0!==i&&(h[e]=i))}}return h}},function(t,e,r){function n(t,e){if(e||(e={}),this.startKey=e.startKey||0,this.endKey=e.endKey||1,this.intervalHash={},this.pointTree=new c({compare:function compare(t,e){if(null==t)return-1;if(null==e)return 1;var r=t[0]-e[0];return r>0?1:0==r?0:-1}}),this._autoIncrement=0,!t||"number"!=typeof t)throw new Error("you must specify center index as the 2nd argument.");this.root=new u(t,this)}function i(t,e){return e.end<t.idx?(t.left||(t.left=new u(e.start+e.end>>1,this)),i.call(this,t.left,e)):t.idx<e.start?(t.right||(t.right=new u(e.start+e.end>>1,this)),i.call(this,t.right,e)):t.insert(e)}function o(t,e,r){if(t)return e<t.idx?(t.starts.every(function(t){var n=t.start<=e;return n&&r.push(t.result()),n}),o.call(this,t.left,e,r)):e>t.idx?(t.ends.every(function(t){var n=t.end>=e;return n&&r.push(t.result()),n}),o.call(this,t.right,e,r)):void t.starts.map(function(t){r.push(t.result())})}function s(t,e,r){if(e-t<=0)throw new Error("end must be greater than start. start: "+t+", end: "+e);var n={},i=[];o.call(this,this.root,t+e>>1,i,!0),i.forEach(function(t){n[t.id]=!0});for(var s=this.pointTree.bsearch([t,null]),u=this.pointTree;s>=0&&u[s][0]==t;){s--}var a=this.pointTree.bsearch([e,null]);if(a>=0){for(var c=u.length-1;a<=c&&u[a][0]<=e;){a++}u.slice(s+1,a).forEach(function(t){var e=t[1];n[e]=!0},this),Object.keys(n).forEach(function(n){var i=this.intervalHash[n];r.push(i.result(t,e))},this)}}function u(t){this.idx=t,this.starts=new c({compare:function compare(t,e){if(null==t)return-1;if(null==e)return 1;var r=t.start-e.start;return r>0?1:0==r?0:-1}}),this.ends=new c({compare:function compare(t,e){if(null==t)return-1;if(null==e)return 1;var r=t.end-e.end;return r<0?1:0==r?0:-1}})}function a(t,e,r,n){if(this.id=e,this.start=t[r],this.end=t[n],this.data=t,"number"!=typeof this.start||"number"!=typeof this.end)throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}var c=r(7);n.prototype.add=function(t,e){if(this.intervalHash[e])throw new Error("id "+e+" is already registered.");if(void 0==e){for(;this.intervalHash[this._autoIncrement];){this._autoIncrement++}e=this._autoIncrement}var r=new a(t,e,this.startKey,this.endKey);this.pointTree.insert([r.start,e]),this.pointTree.insert([r.end,e]),this.intervalHash[e]=r,this._autoIncrement++,i.call(this,this.root,r)},n.prototype.search=function(t,e){var r=[];if("number"!=typeof t)throw new Error(t+": invalid input");if(void 0==e)o.call(this,this.root,t,r);else{if("number"!=typeof e)throw new Error(t+","+e+": invalid input");s.call(this,t,e,r)}return r},n.prototype.remove=function(t){},u.prototype.insert=function(t){this.starts.insert(t),this.ends.insert(t)},a.prototype.result=function(t,e){var r={id:this.id,data:this.data};if("number"==typeof t&&"number"==typeof e){var n=Math.max(this.start,t),i=Math.min(this.end,e),o=i-n;r.rate1=o/(e-t),r.rate2=o/(this.end-this.start)}return r},t.exports=n},function(t,e){var r="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(t){return _typeof(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":_typeof(t)},n=function i(){var t=null,e={},n=arguments;["0","1"].forEach(function(i){var o=n[i];Array.isArray(o)?t=o:o&&"object"==("undefined"==typeof o?"undefined":r(o))&&(e=o)}),"function"==typeof e.filter&&(this._filter=e.filter),"function"==typeof e.compare?this._compare=e.compare:"string"==typeof e.compare&&i.compares[e.compare]&&(this._compare=i.compares[e.compare]),this._unique=!!e.unique,e.resume&&t?t.forEach(function(t,e){this.push(t)},this):t&&this.insert.apply(this,t)};n.create=function(t,e){return new n(t,e)},n.prototype=new Array,n.prototype.constructor=Array.prototype.constructor,n.prototype.insertOne=function(t){var e=this.bsearch(t);return(!this._unique||null==this.key(t,e))&&!!this._filter(t,e)&&(this.splice(e+1,0,t),e+1)},n.prototype.insert=function(){return Array.prototype.map.call(arguments,function(t){return this.insertOne(t)},this)},n.prototype.remove=function(t){return this.splice(t,1),this},n.prototype.bsearch=function(t){if(!this.length)return-1;for(var e,r=0,n=this.length;n-r>1;){e=Math.floor((r+n)/2);var i=this[e],o=this._compare(t,i);if(0==o)return e;o>0?r=e:n=e}return 0==r&&this._compare(this[0],t)>0?-1:r},n.prototype.key=function(t,e){null==e&&(e=this.bsearch(t));var r=e;if(r==-1||this._compare(this[r],t)<0)return r+1<this.length&&0==this._compare(this[r+1],t)?r+1:null;for(;r>=1&&0==this._compare(this[r-1],t);){r--}return r},n.prototype.keys=function(t,e){var r=[];null==e&&(e=this.bsearch(t));for(var n=e;n>=0&&0==this._compare(this[n],t);){r.push(n),n--}var i=this.length;for(n=e+1;n<i&&0==this._compare(this[n],t);){r.push(n),n++}return r.length?r:null},n.prototype.unique=function(t){if(t)return this.filter(function(t,e){return 0==e||0!=this._compare(this[e-1],t)},this);var e=0;return this.map(function(t,r){return 0==r||0!=this._compare(this[r-1],t)?null:r-e++},this).forEach(function(t){null!=t&&this.remove(t)},this),this},n.prototype.toArray=function(){return this.slice()},n.prototype._filter=function(t,e){return!0},n.compares={number:function number(t,e){var r=t-e;return r>0?1:0==r?0:-1},string:function string(t,e){return t>e?1:t==e?0:-1}},n.prototype._compare=n.compares.string,t.exports=n},function(t,e,r){function n(t){var e=new s.Variable(t.targetPos);return e.node=t,e}function i(t,e){if(t.length>0){e=o.extend(u,e),t.forEach(function(t,e){t.targetPos=t.parent?t.parent.currentPos:t.idealPos,t.index=e});for(var r=t.concat().sort(function(t,e){var r=t.targetPos-e.targetPos;if(0!==r)return r;var n=t.isStub()-e.isStub();return 0!==n?n:t.index-e.index}).map(n),i=[],a=1;a<r.length;a++){var c=r[a-1],h=r[a],l=void 0;l=c.node.isStub()&&h.node.isStub()?(c.node.width+h.node.width)/2+e.lineSpacing:(c.node.width+h.node.width)/2+e.nodeSpacing,i.push(new s.Constraint(c,h,l))}if(o.isDefined(e.minPos)){var f=new s.Variable(e.minPos,1e10),p=r[0];i.push(new s.Constraint(f,p,p.node.width/2)),r.unshift(f)}if(o.isDefined(e.maxPos)){var d=new s.Variable(e.maxPos,1e10),v=o.last(r);i.push(new s.Constraint(v,d,v.node.width/2)),r.push(d)}new s.Solver(r,i).solve(),r.filter(function(t){return t.node}).map(function(t){return t.node.currentPos=Math.round(t.position()),t})}return t}var o=r(4),s=r(9),u={lineSpacing:2,nodeSpacing:3,minPos:0,maxPos:null};i.DEFAULT_OPTIONS=u,t.exports=i},function(t,e){var r={},n=function(){function t(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}return t.prototype.addVariable=function(t){var e=this.scale/t.scale,r=t.offset/t.scale,n=t.weight;this.AB+=n*e*r,this.AD+=n*e*t.desiredPosition,this.A2+=n*e*e},t.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},t}();r.PositionStats=n;var i=function(){function t(t,e,r,n){void 0===n&&(n=!1),this.left=t,this.right=e,this.gap=r,this.equality=n,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=e,this.gap=r,this.equality=n}return t.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},t}();r.Constraint=i;var o=function(){function t(t,e,r){void 0===e&&(e=1),void 0===r&&(r=1),this.desiredPosition=t,this.weight=e,this.scale=r,this.offset=0}return t.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},t.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},t.prototype.visitNeighbours=function(t,e){var r=function r(_r,n){return _r.active&&t!==n&&e(_r,n)};this.cOut.forEach(function(t){return r(t,t.right)}),this.cIn.forEach(function(t){return r(t,t.left)})},t}();r.Variable=o;var s=function(){function t(t){this.vars=[],t.offset=0,this.ps=new n(t.scale),this.addVariable(t)}return t.prototype.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},t.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,e=this.vars.length;t<e;++t){this.ps.addVariable(this.vars[t])}this.posn=this.ps.getPosn()},t.prototype.compute_lm=function(t,e,r){var n=this,i=t.dfdv();return t.visitNeighbours(e,function(e,o){var s=n.compute_lm(o,t,r);o===e.right?(i+=s*e.left.scale,e.lm=s):(i+=s*e.right.scale,e.lm=-s),r(e)}),i/t.scale},t.prototype.populateSplitBlock=function(t,e){var r=this;t.visitNeighbours(e,function(e,n){n.offset=t.offset+(n===e.right?e.gap:-e.gap),r.addVariable(n),r.populateSplitBlock(n,t)})},t.prototype.traverse=function(t,e,r,n){var i=this;void 0===r&&(r=this.vars[0]),void 0===n&&(n=null),r.visitNeighbours(n,function(n,o){e.push(t(n)),i.traverse(t,e,o,r)})},t.prototype.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,function(e){!e.equality&&(null===t||e.lm<t.lm)&&(t=e)}),t},t.prototype.findMinLMBetween=function(t,e){this.compute_lm(t,null,function(){});var r=null;return this.findPath(t,null,e,function(t,e){!t.equality&&t.right===e&&(null===r||t.lm<r.lm)&&(r=t)}),r},t.prototype.findPath=function(t,e,r,n){var i=this,o=!1;return t.visitNeighbours(e,function(e,s){o||s!==r&&!i.findPath(s,t,r,n)||(o=!0,n(e,s))}),o},t.prototype.isActiveDirectedPathBetween=function(t,e){if(t===e)return!0;for(var r=t.cOut.length;r--;){var n=t.cOut[r];if(n.active&&this.isActiveDirectedPathBetween(n.right,e))return!0}return!1},t.split=function(e){return e.active=!1,[t.createSplitBlock(e.left),t.createSplitBlock(e.right)]},t.createSplitBlock=function(e){var r=new t(e);return r.populateSplitBlock(e,null),r},t.prototype.splitBetween=function(e,r){var n=this.findMinLMBetween(e,r);if(null!==n){var i=t.split(n);return{constraint:n,lb:i[0],rb:i[1]}}return null},t.prototype.mergeAcross=function(t,e,r){e.active=!0;for(var n=0,i=t.vars.length;n<i;++n){var o=t.vars[n];o.offset+=r,this.addVariable(o)}this.posn=this.ps.getPosn()},t.prototype.cost=function(){for(var t=0,e=this.vars.length;e--;){var r=this.vars[e],n=r.position()-r.desiredPosition;t+=n*n*r.weight}return t},t}();r.Block=s;var u=function(){function t(t){this.vs=t;var e=t.length;for(this.list=new Array(e);e--;){var r=new s(t[e]);this.list[e]=r,r.blockInd=e}}return t.prototype.cost=function(){for(var t=0,e=this.list.length;e--;){t+=this.list[e].cost()}return t},t.prototype.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},t.prototype.remove=function(t){var e=this.list.length-1,r=this.list[e];this.list.length=e,t!==r&&(this.list[t.blockInd]=r,r.blockInd=t.blockInd)},t.prototype.merge=function(t){var e=t.left.block,r=t.right.block,n=t.right.offset-t.left.offset-t.gap;e.vars.length<r.vars.length?(r.mergeAcross(e,t,n),this.remove(e)):(e.mergeAcross(r,t,-n),this.remove(r))},t.prototype.forEach=function(t){this.list.forEach(t)},t.prototype.updateBlockPositions=function(){this.list.forEach(function(t){return t.updateWeightedPosition()})},t.prototype.split=function(t){var e=this;this.updateBlockPositions(),this.list.forEach(function(r){var n=r.findMinLM();null!==n&&n.lm<a.LAGRANGIAN_TOLERANCE&&(r=n.left.block,s.split(n).forEach(function(t){return e.insert(t)}),e.remove(r),t.push(n))})},t}();r.Blocks=u;var a=function(){function t(t,e){this.vs=t,this.cs=e,this.vs=t,t.forEach(function(t){t.cIn=[],t.cOut=[]}),this.cs=e,e.forEach(function(t){t.left.cOut.push(t),t.right.cIn.push(t)}),this.inactive=e.map(function(t){return t.active=!1,t}),this.bs=null}return t.prototype.cost=function(){return this.bs.cost()},t.prototype.setStartingPositions=function(t){this.inactive=this.cs.map(function(t){return t.active=!1,t}),this.bs=new u(this.vs),this.bs.forEach(function(e,r){return e.posn=t[r]})},t.prototype.setDesiredPositions=function(t){this.vs.forEach(function(e,r){return e.desiredPosition=t[r]})},t.prototype.mostViolated=function(){for(var e=Number.MAX_VALUE,r=null,n=this.inactive,i=n.length,o=i,s=0;s<i;++s){var u=n[s];if(!u.unsatisfiable){var a=u.slack();if((u.equality||a<e)&&(e=a,r=u,o=s,u.equality))break}}return o!==i&&(e<t.ZERO_UPPERBOUND&&!r.active||r.equality)&&(n[o]=n[i-1],n.length=i-1),r},t.prototype.satisfy=function(){null==this.bs&&(this.bs=new u(this.vs)),this.bs.split(this.inactive);for(var e=null;(e=this.mostViolated())&&(e.equality||e.slack()<t.ZERO_UPPERBOUND&&!e.active);){var r=e.left.block,n=e.right.block;if(r!==n)this.bs.merge(e);else{if(r.isActiveDirectedPathBetween(e.right,e.left)){e.unsatisfiable=!0;continue}var i=r.splitBetween(e.left,e.right);if(null===i){e.unsatisfiable=!0;continue}this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(r),this.inactive.push(i.constraint),e.slack()>=0?this.inactive.push(e):this.bs.merge(e)}}},t.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,e=this.bs.cost();Math.abs(t-e)>1e-4;){this.satisfy(),t=e,e=this.bs.cost()}return e},t.LAGRANGIAN_TOLERANCE=-1e-4,t.ZERO_UPPERBOUND=-1e-10,t}();r.Solver=a,t.exports=r},function(t,e,r){function n(t){this.options=c.extend({layerGap:60,nodeHeight:10,direction:"down"},t)}function i(t){return"L "+t.join(" ")}function o(t){return"M "+t.join(" ")}function s(t,e,r){return"C "+t.join(" ")+" "+e.join(" ")+" "+r.join(" ")}function u(t,e){var r=(t[1]+e[1])/2;return s([t[0],r],[e[0],r],e)}function a(t,e){var r=(t[0]+e[0])/2;return s([r,t[1]],[r,e[1]],e)}var c=r(4);n.lineTo=i,n.moveTo=o,n.curveTo=s,n.vCurveBetween=u,n.hCurveBetween=a,n.prototype.getWaypoints=function(t){var e=this.options,r=e.direction,n=t.getPathFromRoot(),i=e.nodeHeight+e.layerGap;return"left"===r?[[[0,n[0].idealPos]]].concat(n.map(function(t,r){var n=i*(r+1)*-1;return[[n+e.nodeHeight,t.currentPos],[n,t.currentPos]]})):"right"===r?[[[0,n[0].idealPos]]].concat(n.map(function(t,r){var n=i*(r+1);return[[n-e.nodeHeight,t.currentPos],[n,t.currentPos]]})):"up"===r?[[[n[0].idealPos,0]]].concat(n.map(function(t,r){var n=i*(r+1)*-1;return[[t.currentPos,n+e.nodeHeight],[t.currentPos,n]]})):[[[n[0].idealPos,0]]].concat(n.map(function(t,r){var n=i*(r+1);return[[t.currentPos,n-e.nodeHeight],[t.currentPos,n]]}))},n.prototype.layout=function(t){var e=this.options,r=e.layerGap+e.nodeHeight;switch(e.direction){case"left":t.forEach(function(t){var n=t.getLayerIndex()*r+e.layerGap;t.x=-n-e.nodeHeight,t.y=t.currentPos,t.dx=e.nodeHeight,t.dy=t.width});break;case"right":t.forEach(function(t){var n=t.getLayerIndex()*r+e.layerGap;t.x=n,t.y=t.currentPos,t.dx=e.nodeHeight,t.dy=t.width});break;case"up":t.forEach(function(t){var n=t.getLayerIndex()*r+e.layerGap;t.x=t.currentPos,t.y=-n-e.nodeHeight,t.dx=t.width,t.dy=e.nodeHeight});break;default:case"down":t.forEach(function(t){var n=t.getLayerIndex()*r+e.layerGap;t.x=t.currentPos,t.y=n,t.dx=t.width,t.dy=e.nodeHeight})}return t},n.prototype.generatePath=function(t){var e=this.options,r=e.direction,n=this.getWaypoints(t,r),s=[o(n[0][0])];return"left"===r||"right"===r?n.reduce(function(t,e,r){return s.push(a(t[t.length-1],e[0])),r<n.length-1&&s.push(i(e[1])),e}):n.reduce(function(t,e,r){return s.push(u(t[t.length-1],e[0])),r<n.length-1&&s.push(i(e[1])),e}),s.join(" ")},t.exports=n}])})});var labella_min_1=labella_min.labella;function SpanOrDiv(props){var style=props.style,className=props.className,children=props.children,span=props.span;if(span)return React.createElement("span",{className:className,style:__assign({display:"block"},style)},children);return React.createElement("div",{className:className,style:style},children)}function marginOffsetFn(orient,axisSettings,marginOffset){if(typeof marginOffset==="number"){return marginOffset}if(axisSettings&&axisSettings.find(function(d){return d.props.orient===orient})){return 50}return 10}function adjustedAnnotationKeyMapper(d){return d.props.noteData.id||d.props.noteData.x+"-"+d.props.noteData.y}function noteDataWidth(noteData,charWidth){if(charWidth===void 0){charWidth=8}var wrap=noteData.note&&noteData.note.wrap||120;var noteText=noteData.note.label||noteData.note.label||"";return Math.min(wrap,noteText.length*charWidth)}function noteDataHeight(noteData,charWidth,lineHeight){if(charWidth===void 0){charWidth=8}if(lineHeight===void 0){lineHeight=20}var wrap=noteData.note&&noteData.note.wrap||120;var text=noteData.note.label||noteData.note.title||"";return Math.ceil(text.length*charWidth/wrap)*lineHeight+(noteData.note.label&&noteData.note.title?lineHeight:0)}var AnnotationLayer=function(_super){__extends(AnnotationLayer,_super);function AnnotationLayer(props){var _this=_super.call(this,props)||this;_this.generateSVGAnnotations=function(props,annotations){var renderedAnnotations=annotations.map(function(d,i){return props.svgAnnotationRule(d,i,props)}).filter(function(d){return d!==null&&d!==undefined});return renderedAnnotations};_this.generateHTMLAnnotations=function(props,annotations){var renderedAnnotations=annotations.map(function(d,i){return props.htmlAnnotationRule(d,i,props)}).filter(function(d){return d!==null&&d!==undefined});return renderedAnnotations};_this.processAnnotations=function(adjustableAnnotations,annotationProcessor,props){var _a=annotationProcessor.layout,layout=_a===void 0?{type:false}:_a;if(layout.type===false){return adjustableAnnotations}var _b=props.margin,margin=_b===void 0?{top:0,bottom:0,left:0,right:0}:_b;var size=props.size,_c=props.axes,axes=_c===void 0?[]:_c;margin=typeof margin==="number"?{top:margin,left:margin,right:margin,bottom:margin}:margin;if(layout.type==="bump"){var adjustedAnnotations=bumpAnnotations(adjustableAnnotations,layout,size,props.pointSizeFunction,props.labelSizeFunction);return adjustedAnnotations}else if(layout.type==="marginalia"){var marginOffset_1=layout.marginOffset,_d=layout.orient,orient=_d===void 0?"nearest":_d,_e=layout.characterWidth,characterWidth_1=_e===void 0?8:_e,_f=layout.lineHeight,lineHeight_1=_f===void 0?20:_f,_g=layout.padding,padding_1=_g===void 0?2:_g,_h=layout.axisMarginOverride,axisMarginOverride=_h===void 0?{}:_h;var finalOrientation=orient==="nearest"?["left","right","top","bottom"]:Array.isArray(orient)?orient:[orient];var leftOn_1=finalOrientation.find(function(d){return d==="left"});var rightOn_1=finalOrientation.find(function(d){return d==="right"});var topOn_1=finalOrientation.find(function(d){return d==="top"});var bottomOn_1=finalOrientation.find(function(d){return d==="bottom"});var leftNodes_1=[];var rightNodes_1=[];var topNodes_1=[];var bottomNodes_1=[];adjustableAnnotations.forEach(function(aNote){var noteData=aNote.props.noteData;var noteX=noteData.x[0]||noteData.x;var noteY=noteData.y[0]||noteData.y;var leftDist=leftOn_1?noteX:Infinity;var rightDist=rightOn_1?size[0]-noteX:Infinity;var topDist=topOn_1?noteY:Infinity;var bottomDist=bottomOn_1?size[1]-noteY:Infinity;var minDist=Math.min(leftDist,rightDist,topDist,bottomDist);if(leftDist===minDist){leftNodes_1.push(aNote)}else if(rightDist===minDist){rightNodes_1.push(aNote)}else if(topDist===minDist){topNodes_1.push(aNote)}else{bottomNodes_1.push(aNote)}});var leftForce=new undefined({minPos:axisMarginOverride.top!==undefined?0+axisMarginOverride.top:0-margin.top,maxPos:axisMarginOverride.bottom!==undefined?size[1]-axisMarginOverride.bottom:bottomOn_1?size[1]:size[1]+margin.bottom}).nodes(leftNodes_1.map(function(d){var noteY=d.props.noteData.y[0]||d.props.noteData.y;return new undefined(noteY,noteDataHeight(d.props.noteData,characterWidth_1,lineHeight_1)+padding_1)})).compute();var rightForce=new undefined({minPos:axisMarginOverride.top!==undefined?0+axisMarginOverride.top:topOn_1?0:0-margin.top,maxPos:axisMarginOverride.bottom!==undefined?size[1]-axisMarginOverride.bottom:size[1]+margin.bottom}).nodes(rightNodes_1.map(function(d){var noteY=d.props.noteData.y[0]||d.props.noteData.y;return new undefined(noteY,noteDataHeight(d.props.noteData,characterWidth_1,lineHeight_1)+padding_1)})).compute();var topForce=new undefined({minPos:axisMarginOverride.left!==undefined?0+axisMarginOverride.left:leftOn_1?0:0-margin.left,maxPos:axisMarginOverride.right!==undefined?size[0]-axisMarginOverride.right:size[0]+margin.right}).nodes(topNodes_1.map(function(d){var noteX=d.props.noteData.x[0]||d.props.noteData.x;return new undefined(noteX,noteDataWidth(d.props.noteData,characterWidth_1)+padding_1)})).compute();var bottomForce=new undefined({minPos:axisMarginOverride.left!==undefined?0+axisMarginOverride.left:0-margin.left,maxPos:axisMarginOverride.right!==undefined?size[0]-axisMarginOverride.right:rightOn_1?size[0]:size[0]+margin.right}).nodes(bottomNodes_1.map(function(d){var noteX=d.props.noteData.x[0]||d.props.noteData.x;return new undefined(noteX,noteDataWidth(d.props.noteData,characterWidth_1)+padding_1)})).compute();var bottomOffset_1=Math.max.apply(Math,__spread(bottomNodes_1.map(function(d){return noteDataHeight(d.props.noteData,characterWidth_1,lineHeight_1)+padding_1})));var topOffset_1=Math.max.apply(Math,__spread(topNodes_1.map(function(d){return noteDataHeight(d.props.noteData,characterWidth_1,lineHeight_1)+padding_1})));var leftOffset_1=Math.max.apply(Math,__spread(leftNodes_1.map(function(d){return noteDataWidth(d.props.noteData,characterWidth_1)+padding_1})));var rightOffset_1=Math.max.apply(Math,__spread(rightNodes_1.map(function(d){return noteDataWidth(d.props.noteData,characterWidth_1)+padding_1})));var leftSortedNodes_1=leftForce.nodes();var rightSortedNodes_1=rightForce.nodes();var topSortedNodes_1=topForce.nodes();var bottomSortedNodes_1=bottomForce.nodes();leftNodes_1.forEach(function(note,i){note.props.noteData.ny=leftSortedNodes_1[i].currentPos;note.props.noteData.nx=0-leftSortedNodes_1[i].layerIndex*leftOffset_1-marginOffsetFn("left",axes,marginOffset_1);if(note.props.noteData.note){note.props.noteData.note.orientation=note.props.noteData.note.orientation||"leftRight";note.props.noteData.note.align=note.props.noteData.note.align||"right"}});rightNodes_1.forEach(function(note,i){note.props.noteData.ny=rightSortedNodes_1[i].currentPos;note.props.noteData.nx=size[0]+rightSortedNodes_1[i].layerIndex*rightOffset_1+marginOffsetFn("right",axes,marginOffset_1);if(note.props.noteData.note){note.props.noteData.note.orientation=note.props.noteData.note.orientation||"leftRight";note.props.noteData.note.align=note.props.noteData.note.align||"left"}});topNodes_1.forEach(function(note,i){note.props.noteData.nx=topSortedNodes_1[i].currentPos;note.props.noteData.ny=0-topSortedNodes_1[i].layerIndex*topOffset_1-marginOffsetFn("top",axes,marginOffset_1)});bottomNodes_1.forEach(function(note,i){note.props.noteData.nx=bottomSortedNodes_1[i].currentPos;note.props.noteData.ny=size[1]+bottomSortedNodes_1[i].layerIndex*bottomOffset_1+marginOffsetFn("bottom",axes,marginOffset_1)});return adjustableAnnotations}return adjustableAnnotations};_this.createAnnotations=function(props){var renderedSVGAnnotations=_this.state.svgAnnotations,renderedHTMLAnnotations=[],adjustedAnnotations=_this.state.adjustedAnnotations,adjustableAnnotationsKey=_this.state.adjustedAnnotationsKey;var adjustedAnnotationsKey=_this.state.adjustedAnnotationsKey,adjustedAnnotationsDataVersion=_this.state.adjustedAnnotationsDataVersion;var annotations=props.annotations,_a=props.annotationHandling,annotationHandling=_a===void 0?false:_a,size=props.size,svgAnnotationRule=props.svgAnnotationRule,htmlAnnotationRule=props.htmlAnnotationRule;var annotationProcessor=typeof annotationHandling==="object"?annotationHandling:{layout:{type:annotationHandling},dataVersion:""};var _b=annotationProcessor.dataVersion,dataVersion=_b===void 0?"":_b;if(svgAnnotationRule){var initialSVGAnnotations=_this.generateSVGAnnotations(props,annotations);var adjustableAnnotations_1=initialSVGAnnotations.filter(function(d){return d.props&&d.props.noteData&&!d.props.noteData.fixedPosition});var fixedAnnotations=initialSVGAnnotations.filter(function(d){return!d.props||!d.props.noteData||d.props.noteData.fixedPosition});adjustableAnnotationsKey=""+adjustableAnnotations_1.map(adjustedAnnotationKeyMapper).join(",")+JSON.stringify(annotationProcessor)+size.join(",");if(annotationHandling===false){adjustedAnnotations=adjustableAnnotations_1}if(adjustedAnnotations.length!==adjustableAnnotations_1.length||adjustedAnnotationsKey!==adjustableAnnotationsKey||adjustedAnnotationsDataVersion!==dataVersion){adjustedAnnotations=_this.processAnnotations(adjustableAnnotations_1,annotationProcessor,props)}else{adjustedAnnotations=adjustedAnnotations.map(function(d,i){var newNoteData=Object.assign(adjustableAnnotations_1[i].props.noteData,{nx:d.props.noteData.nx,ny:d.props.noteData.ny,note:d.props.noteData.note});return React.createElement(SemioticAnnotation,{key:d.key,noteData:newNoteData})})}renderedSVGAnnotations=__spread(adjustedAnnotations,fixedAnnotations)}if(htmlAnnotationRule){renderedHTMLAnnotations=_this.generateHTMLAnnotations(props,annotations)}_this.setState({svgAnnotations:renderedSVGAnnotations,htmlAnnotations:renderedHTMLAnnotations,adjustedAnnotations:adjustedAnnotations,adjustedAnnotationsKey:adjustableAnnotationsKey,adjustedAnnotationsDataVersion:dataVersion})};_this.state={svgAnnotations:[],htmlAnnotations:[],adjustedAnnotations:[],adjustedAnnotationsKey:"",adjustedAnnotationsDataVersion:""};return _this}AnnotationLayer.prototype.componentWillMount=function(){this.createAnnotations(this.props)};AnnotationLayer.prototype.componentWillReceiveProps=function(nextProps){this.createAnnotations(nextProps)};AnnotationLayer.prototype.render=function(){var _a=this.state,svgAnnotations=_a.svgAnnotations,htmlAnnotations=_a.htmlAnnotations;var _b=this.props,useSpans=_b.useSpans,legendSettings=_b.legendSettings,margin=_b.margin,size=_b.size;var renderedLegend;if(legendSettings){var positionHash={left:[15,15],right:[size[0]+15,15]};var _c=legendSettings.position,position=_c===void 0?"right":_c,_d=legendSettings.title,title=_d===void 0?"Legend":_d;var legendPosition=positionHash[position];renderedLegend=React.createElement("g",{transform:"translate("+legendPosition.join(",")+")"},React.createElement(Legend,__assign({},legendSettings,{title:title,position:position})))}return React.createElement(SpanOrDiv,{span:useSpans,className:"annotation-layer",style:{position:"absolute",pointerEvents:"none",background:"none"}},React.createElement("svg",{className:"annotation-layer-svg",height:size[1],width:size[0],style:{background:"none",pointerEvents:"none",position:"absolute",left:margin.left+"px",top:margin.top+"px",overflow:"visible"}},React.createElement("g",null,renderedLegend,svgAnnotations)),React.createElement(SpanOrDiv,{span:useSpans,className:"annotation-layer-html",style:{background:"none",pointerEvents:"none",position:"absolute",height:size[1]+"px",width:size[0]+"px",left:margin.left+"px",top:margin.top+"px"}},htmlAnnotations))};return AnnotationLayer}(React.Component);function constant$1(x){return function constant(){return x}}var abs$1=Math.abs;var atan2$1=Math.atan2;var cos$1=Math.cos;var max$1=Math.max;var min$1=Math.min;var sin$1=Math.sin;var sqrt$1=Math.sqrt;var epsilon$2=1e-12;var pi$2=Math.PI;var halfPi$1=pi$2/2;var tau$2=2*pi$2;function acos$1(x){return x>1?0:x<-1?pi$2:Math.acos(x)}function asin$1(x){return x>=1?halfPi$1:x<=-1?-halfPi$1:Math.asin(x)}function arcInnerRadius$1(d){return d.innerRadius}function arcOuterRadius$1(d){return d.outerRadius}function arcStartAngle$1(d){return d.startAngle}function arcEndAngle$1(d){return d.endAngle}function arcPadAngle$1(d){return d&&d.padAngle}function intersect$1(x0,y0,x1,y1,x2,y2,x3,y3){var x10=x1-x0,y10=y1-y0,x32=x3-x2,y32=y3-y2,t=y32*x10-x32*y10;if(t*t<epsilon$2)return;t=(x32*(y0-y2)-y32*(x0-x2))/t;return[x0+t*x10,y0+t*y10]}function cornerTangents$1(x0,y0,x1,y1,r1,rc,cw){var x01=x0-x1,y01=y0-y1,lo=(cw?rc:-rc)/sqrt$1(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x11=x0+ox,y11=y0+oy,x10=x1+ox,y10=y1+oy,x00=(x11+x10)/2,y00=(y11+y10)/2,dx=x10-x11,dy=y10-y11,d2=dx*dx+dy*dy,r=r1-rc,D=x11*y10-x10*y11,d=(dy<0?-1:1)*sqrt$1(max$1(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x00,dy0=cy0-y00,dx1=cx1-x00,dy1=cy1-y00;if(dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1)cx0=cx1,cy0=cy1;return{cx:cx0,cy:cy0,x01:-ox,y01:-oy,x11:cx0*(r1/r-1),y11:cy0*(r1/r-1)}}function arc$1(){var innerRadius=arcInnerRadius$1,outerRadius=arcOuterRadius$1,cornerRadius=constant$1(0),padRadius=null,startAngle=arcStartAngle$1,endAngle=arcEndAngle$1,padAngle=arcPadAngle$1,context=null;function arc(){var buffer,r,r0=+innerRadius.apply(this,arguments),r1=+outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)-halfPi$1,a1=endAngle.apply(this,arguments)-halfPi$1,da=abs$1(a1-a0),cw=a1>a0;if(!context)context=buffer=path();if(r1<r0)r=r1,r1=r0,r0=r;if(!(r1>epsilon$2))context.moveTo(0,0);else if(da>tau$2-epsilon$2){context.moveTo(r1*cos$1(a0),r1*sin$1(a0));context.arc(0,0,r1,a0,a1,!cw);if(r0>epsilon$2){context.moveTo(r0*cos$1(a1),r0*sin$1(a1));context.arc(0,0,r0,a1,a0,cw)}}else{var a01=a0,a11=a1,a00=a0,a10=a1,da0=da,da1=da,ap=padAngle.apply(this,arguments)/2,rp=ap>epsilon$2&&(padRadius?+padRadius.apply(this,arguments):sqrt$1(r0*r0+r1*r1)),rc=min$1(abs$1(r1-r0)/2,+cornerRadius.apply(this,arguments)),rc0=rc,rc1=rc,t0,t1;if(rp>epsilon$2){var p0=asin$1(rp/r0*sin$1(ap)),p1=asin$1(rp/r1*sin$1(ap));if((da0-=p0*2)>epsilon$2)p0*=cw?1:-1,a00+=p0,a10-=p0;else da0=0,a00=a10=(a0+a1)/2;if((da1-=p1*2)>epsilon$2)p1*=cw?1:-1,a01+=p1,a11-=p1;else da1=0,a01=a11=(a0+a1)/2}var x01=r1*cos$1(a01),y01=r1*sin$1(a01),x10=r0*cos$1(a10),y10=r0*sin$1(a10);if(rc>epsilon$2){var x11=r1*cos$1(a11),y11=r1*sin$1(a11),x00=r0*cos$1(a00),y00=r0*sin$1(a00),oc;if(da<pi$2&&(oc=intersect$1(x01,y01,x00,y00,x11,y11,x10,y10))){var ax=x01-oc[0],ay=y01-oc[1],bx=x11-oc[0],by=y11-oc[1],kc=1/sin$1(acos$1((ax*bx+ay*by)/(sqrt$1(ax*ax+ay*ay)*sqrt$1(bx*bx+by*by)))/2),lc=sqrt$1(oc[0]*oc[0]+oc[1]*oc[1]);rc0=min$1(rc,(r0-lc)/(kc-1));rc1=min$1(rc,(r1-lc)/(kc+1))}}if(!(da1>epsilon$2))context.moveTo(x01,y01);else if(rc1>epsilon$2){t0=cornerTangents$1(x00,y00,x01,y01,r1,rc1,cw);t1=cornerTangents$1(x11,y11,x10,y10,r1,rc1,cw);context.moveTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc1<rc)context.arc(t0.cx,t0.cy,rc1,atan2$1(t0.y01,t0.x01),atan2$1(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc1,atan2$1(t0.y01,t0.x01),atan2$1(t0.y11,t0.x11),!cw);context.arc(0,0,r1,atan2$1(t0.cy+t0.y11,t0.cx+t0.x11),atan2$1(t1.cy+t1.y11,t1.cx+t1.x11),!cw);context.arc(t1.cx,t1.cy,rc1,atan2$1(t1.y11,t1.x11),atan2$1(t1.y01,t1.x01),!cw)}}else context.moveTo(x01,y01),context.arc(0,0,r1,a01,a11,!cw);if(!(r0>epsilon$2)||!(da0>epsilon$2))context.lineTo(x10,y10);else if(rc0>epsilon$2){t0=cornerTangents$1(x10,y10,x11,y11,r0,-rc0,cw);t1=cornerTangents$1(x01,y01,x00,y00,r0,-rc0,cw);context.lineTo(t0.cx+t0.x01,t0.cy+t0.y01);if(rc0<rc)context.arc(t0.cx,t0.cy,rc0,atan2$1(t0.y01,t0.x01),atan2$1(t1.y01,t1.x01),!cw);else{context.arc(t0.cx,t0.cy,rc0,atan2$1(t0.y01,t0.x01),atan2$1(t0.y11,t0.x11),!cw);context.arc(0,0,r0,atan2$1(t0.cy+t0.y11,t0.cx+t0.x11),atan2$1(t1.cy+t1.y11,t1.cx+t1.x11),cw);context.arc(t1.cx,t1.cy,rc0,atan2$1(t1.y11,t1.x11),atan2$1(t1.y01,t1.x01),!cw)}}else context.arc(0,0,r0,a10,a00,cw)}context.closePath();if(buffer)return context=null,buffer+""||null}arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-pi$2/2;return[cos$1(a)*r,sin$1(a)*r]};arc.innerRadius=function(_){return arguments.length?(innerRadius=typeof _==="function"?_:constant$1(+_),arc):innerRadius};arc.outerRadius=function(_){return arguments.length?(outerRadius=typeof _==="function"?_:constant$1(+_),arc):outerRadius};arc.cornerRadius=function(_){return arguments.length?(cornerRadius=typeof _==="function"?_:constant$1(+_),arc):cornerRadius};arc.padRadius=function(_){return arguments.length?(padRadius=_==null?null:typeof _==="function"?_:constant$1(+_),arc):padRadius};arc.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant$1(+_),arc):startAngle};arc.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant$1(+_),arc):endAngle};arc.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant$1(+_),arc):padAngle};arc.context=function(_){return arguments.length?(context=_==null?null:_,arc):context};return arc}function Linear$1(context){this._context=context}Linear$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:this._context.lineTo(x,y);break}}};function curveLinear$1(context){return new Linear$1(context)}function x$1(p){return p[0]}function y$1(p){return p[1]}function line$1(){var x=x$1,y=y$1,defined=constant$1(true),context=null,curve=curveLinear$1,output=null;function line(data){var i,n=data.length,d,defined0=false,buffer;if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0)output.lineStart();else output.lineEnd()}if(defined0)output.point(+x(d,i,data),+y(d,i,data))}if(buffer)return output=null,buffer+""||null}line.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$1(+_),line):x};line.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$1(+_),line):y};line.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant$1(!!_),line):defined};line.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),line):curve};line.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),line):context};return line}function area$1(){var x0=x$1,x1=null,y0=constant$1(0),y1=y$1,defined=constant$1(true),context=null,curve=curveLinear$1,output=null;function area(data){var i,j,k,n=data.length,d,defined0=false,buffer,x0z=new Array(n),y0z=new Array(n);if(context==null)output=curve(buffer=path());for(i=0;i<=n;++i){if(!(i<n&&defined(d=data[i],i,data))===defined0){if(defined0=!defined0){j=i;output.areaStart();output.lineStart()}else{output.lineEnd();output.lineStart();for(k=i-1;k>=j;--k){output.point(x0z[k],y0z[k])}output.lineEnd();output.areaEnd()}}if(defined0){x0z[i]=+x0(d,i,data),y0z[i]=+y0(d,i,data);output.point(x1?+x1(d,i,data):x0z[i],y1?+y1(d,i,data):y0z[i])}}if(buffer)return output=null,buffer+""||null}function arealine(){return line$1().defined(defined).curve(curve).context(context)}area.x=function(_){return arguments.length?(x0=typeof _==="function"?_:constant$1(+_),x1=null,area):x0};area.x0=function(_){return arguments.length?(x0=typeof _==="function"?_:constant$1(+_),area):x0};area.x1=function(_){return arguments.length?(x1=_==null?null:typeof _==="function"?_:constant$1(+_),area):x1};area.y=function(_){return arguments.length?(y0=typeof _==="function"?_:constant$1(+_),y1=null,area):y0};area.y0=function(_){return arguments.length?(y0=typeof _==="function"?_:constant$1(+_),area):y0};area.y1=function(_){return arguments.length?(y1=_==null?null:typeof _==="function"?_:constant$1(+_),area):y1};area.lineX0=area.lineY0=function(){return arealine().x(x0).y(y0)};area.lineY1=function(){return arealine().x(x0).y(y1)};area.lineX1=function(){return arealine().x(x1).y(y0)};area.defined=function(_){return arguments.length?(defined=typeof _==="function"?_:constant$1(!!_),area):defined};area.curve=function(_){return arguments.length?(curve=_,context!=null&&(output=curve(context)),area):curve};area.context=function(_){return arguments.length?(_==null?context=output=null:output=curve(context=_),area):context};return area}function descending$2(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function identity$1(d){return d}function pie$1(){var value=identity$1,sortValues=descending$2,sort=null,startAngle=constant$1(0),endAngle=constant$1(tau$2),padAngle=constant$1(0);function pie(data){var i,n=data.length,j,k,sum=0,index=new Array(n),arcs=new Array(n),a0=+startAngle.apply(this,arguments),da=Math.min(tau$2,Math.max(-tau$2,endAngle.apply(this,arguments)-a0)),a1,p=Math.min(Math.abs(da)/n,padAngle.apply(this,arguments)),pa=p*(da<0?-1:1),v;for(i=0;i<n;++i){if((v=arcs[index[i]=i]=+value(data[i],i,data))>0){sum+=v}}if(sortValues!=null)index.sort(function(i,j){return sortValues(arcs[i],arcs[j])});else if(sort!=null)index.sort(function(i,j){return sort(data[i],data[j])});for(i=0,k=sum?(da-n*pa)/sum:0;i<n;++i,a0=a1){j=index[i],v=arcs[j],a1=a0+(v>0?v*k:0)+pa,arcs[j]={data:data[j],index:i,value:v,startAngle:a0,endAngle:a1,padAngle:p}}return arcs}pie.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant$1(+_),pie):value};pie.sortValues=function(_){return arguments.length?(sortValues=_,sort=null,pie):sortValues};pie.sort=function(_){return arguments.length?(sort=_,sortValues=null,pie):sort};pie.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant$1(+_),pie):startAngle};pie.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant$1(+_),pie):endAngle};pie.padAngle=function(_){return arguments.length?(padAngle=typeof _==="function"?_:constant$1(+_),pie):padAngle};return pie}var curveRadialLinear$1=curveRadial$1(curveLinear$1);function Radial$1(curve){this._curve=curve}Radial$1.prototype={areaStart:function areaStart(){this._curve.areaStart()},areaEnd:function areaEnd(){this._curve.areaEnd()},lineStart:function lineStart(){this._curve.lineStart()},lineEnd:function lineEnd(){this._curve.lineEnd()},point:function point(a,r){this._curve.point(r*Math.sin(a),r*-Math.cos(a))}};function curveRadial$1(curve){function radial(context){return new Radial$1(curve(context))}radial._curve=curve;return radial}function lineRadial(l){var c=l.curve;l.angle=l.x,delete l.x;l.radius=l.y,delete l.y;l.curve=function(_){return arguments.length?c(curveRadial$1(_)):c()._curve};return l}function lineRadial$1(){return lineRadial(line$1().curve(curveRadialLinear$1))}function areaRadial(){var a=area$1().curve(curveRadialLinear$1),c=a.curve,x0=a.lineX0,x1=a.lineX1,y0=a.lineY0,y1=a.lineY1;a.angle=a.x,delete a.x;a.startAngle=a.x0,delete a.x0;a.endAngle=a.x1,delete a.x1;a.radius=a.y,delete a.y;a.innerRadius=a.y0,delete a.y0;a.outerRadius=a.y1,delete a.y1;a.lineStartAngle=function(){return lineRadial(x0())},delete a.lineX0;a.lineEndAngle=function(){return lineRadial(x1())},delete a.lineX1;a.lineInnerRadius=function(){return lineRadial(y0())},delete a.lineY0;a.lineOuterRadius=function(){return lineRadial(y1())},delete a.lineY1;a.curve=function(_){return arguments.length?c(curveRadial$1(_)):c()._curve};return a}function pointRadial(x,y){return[(y=+y)*Math.cos(x-=Math.PI/2),y*Math.sin(x)]}var slice$1=Array.prototype.slice;function linkSource(d){return d.source}function linkTarget(d){return d.target}function link(curve){var source=linkSource,target=linkTarget,x=x$1,y=y$1,context=null;function link(){var buffer,argv=slice$1.call(arguments),s=source.apply(this,argv),t=target.apply(this,argv);if(!context)context=buffer=path();curve(context,+x.apply(this,(argv[0]=s,argv)),+y.apply(this,argv),+x.apply(this,(argv[0]=t,argv)),+y.apply(this,argv));if(buffer)return context=null,buffer+""||null}link.source=function(_){return arguments.length?(source=_,link):source};link.target=function(_){return arguments.length?(target=_,link):target};link.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$1(+_),link):x};link.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$1(+_),link):y};link.context=function(_){return arguments.length?(context=_==null?null:_,link):context};return link}function curveHorizontal(context,x0,y0,x1,y1){context.moveTo(x0,y0);context.bezierCurveTo(x0=(x0+x1)/2,y0,x0,y1,x1,y1)}function curveVertical(context,x0,y0,x1,y1){context.moveTo(x0,y0);context.bezierCurveTo(x0,y0=(y0+y1)/2,x1,y0,x1,y1)}function curveRadial$2(context,x0,y0,x1,y1){var p0=pointRadial(x0,y0),p1=pointRadial(x0,y0=(y0+y1)/2),p2=pointRadial(x1,y0),p3=pointRadial(x1,y1);context.moveTo(p0[0],p0[1]);context.bezierCurveTo(p1[0],p1[1],p2[0],p2[1],p3[0],p3[1])}function linkHorizontal(){return link(curveHorizontal)}function linkVertical(){return link(curveVertical)}function linkRadial(){var l=link(curveRadial$2);l.angle=l.x,delete l.x;l.radius=l.y,delete l.y;return l}var circle$1={draw:function draw(context,size){var r=Math.sqrt(size/pi$2);context.moveTo(r,0);context.arc(0,0,r,0,tau$2)}};var cross$1={draw:function draw(context,size){var r=Math.sqrt(size/5)/2;context.moveTo(-3*r,-r);context.lineTo(-r,-r);context.lineTo(-r,-3*r);context.lineTo(r,-3*r);context.lineTo(r,-r);context.lineTo(3*r,-r);context.lineTo(3*r,r);context.lineTo(r,r);context.lineTo(r,3*r);context.lineTo(-r,3*r);context.lineTo(-r,r);context.lineTo(-3*r,r);context.closePath()}};var tan30$1=Math.sqrt(1/3),tan30_2$1=tan30$1*2;var diamond$1={draw:function draw(context,size){var y=Math.sqrt(size/tan30_2$1),x=y*tan30$1;context.moveTo(0,-y);context.lineTo(x,0);context.lineTo(0,y);context.lineTo(-x,0);context.closePath()}};var ka$1=.8908130915292852,kr$1=Math.sin(pi$2/10)/Math.sin(7*pi$2/10),kx$1=Math.sin(tau$2/10)*kr$1,ky$1=-Math.cos(tau$2/10)*kr$1;var star$1={draw:function draw(context,size){var r=Math.sqrt(size*ka$1),x=kx$1*r,y=ky$1*r;context.moveTo(0,-r);context.lineTo(x,y);for(var i=1;i<5;++i){var a=tau$2*i/5,c=Math.cos(a),s=Math.sin(a);context.lineTo(s*r,-c*r);context.lineTo(c*x-s*y,s*x+c*y)}context.closePath()}};var square$1={draw:function draw(context,size){var w=Math.sqrt(size),x=-w/2;context.rect(x,x,w,w)}};var sqrt3$1=Math.sqrt(3);var triangle$1={draw:function draw(context,size){var y=-Math.sqrt(size/(sqrt3$1*3));context.moveTo(0,y*2);context.lineTo(-sqrt3$1*y,-y);context.lineTo(sqrt3$1*y,-y);context.closePath()}};var c$1=-.5,s$1=Math.sqrt(3)/2,k$1=1/Math.sqrt(12),a$1=(k$1/2+1)*3;var wye$1={draw:function draw(context,size){var r=Math.sqrt(size/a$1),x0=r/2,y0=r*k$1,x1=x0,y1=r*k$1+r,x2=-x1,y2=y1;context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.lineTo(c$1*x0-s$1*y0,s$1*x0+c$1*y0);context.lineTo(c$1*x1-s$1*y1,s$1*x1+c$1*y1);context.lineTo(c$1*x2-s$1*y2,s$1*x2+c$1*y2);context.lineTo(c$1*x0+s$1*y0,c$1*y0-s$1*x0);context.lineTo(c$1*x1+s$1*y1,c$1*y1-s$1*x1);context.lineTo(c$1*x2+s$1*y2,c$1*y2-s$1*x2);context.closePath()}};var symbols$1=[circle$1,cross$1,diamond$1,square$1,star$1,triangle$1,wye$1];function symbol$1(){var type=constant$1(circle$1),size=constant$1(64),context=null;function symbol(){var buffer;if(!context)context=buffer=path();type.apply(this,arguments).draw(context,+size.apply(this,arguments));if(buffer)return context=null,buffer+""||null}symbol.type=function(_){return arguments.length?(type=typeof _==="function"?_:constant$1(_),symbol):type};symbol.size=function(_){return arguments.length?(size=typeof _==="function"?_:constant$1(+_),symbol):size};symbol.context=function(_){return arguments.length?(context=_==null?null:_,symbol):context};return symbol}function noop$2(){}function _point$4(that,x,y){that._context.bezierCurveTo((2*that._x0+that._x1)/3,(2*that._y0+that._y1)/3,(that._x0+2*that._x1)/3,(that._y0+2*that._y1)/3,(that._x0+4*that._x1+x)/6,(that._y0+4*that._y1+y)/6)}function Basis$1(context){this._context=context}Basis$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 3:_point$4(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:_point$4(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function curveBasis(context){return new Basis$1(context)}function BasisClosed$1(context){this._context=context}BasisClosed$1.prototype={areaStart:noop$2,areaEnd:noop$2,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2);this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3);this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3);this._context.closePath();break;case 3:this.point(this._x2,this._y2);this.point(this._x3,this._y3);this.point(this._x4,this._y4);break}},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x2=x,this._y2=y;break;case 1:this._point=2;this._x3=x,this._y3=y;break;case 2:this._point=3;this._x4=x,this._y4=y;this._context.moveTo((this._x0+4*this._x1+x)/6,(this._y0+4*this._y1+y)/6);break;default:_point$4(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function basisClosed$1(context){return new BasisClosed$1(context)}function BasisOpen$1(context){this._context=context}BasisOpen$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var x0=(this._x0+4*this._x1+x)/6,y0=(this._y0+4*this._y1+y)/6;this._line?this._context.lineTo(x0,y0):this._context.moveTo(x0,y0);break;case 3:this._point=4;default:_point$4(this,x,y);break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y}};function basisOpen$1(context){return new BasisOpen$1(context)}function Bundle$1(context,beta){this._basis=new Basis$1(context);this._beta=beta}Bundle$1.prototype={lineStart:function lineStart(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function lineEnd(){var x=this._x,y=this._y,j=x.length-1;if(j>0){var x0=x[0],y0=y[0],dx=x[j]-x0,dy=y[j]-y0,i=-1,t;while(++i<=j){t=i/j;this._basis.point(this._beta*x[i]+(1-this._beta)*(x0+t*dx),this._beta*y[i]+(1-this._beta)*(y0+t*dy))}}this._x=this._y=null;this._basis.lineEnd()},point:function point(x,y){this._x.push(+x);this._y.push(+y)}};var bundle$1=function custom(beta){function bundle(context){return beta===1?new Basis$1(context):new Bundle$1(context,beta)}bundle.beta=function(beta){return custom(+beta)};return bundle}(.85);function _point$5(that,x,y){that._context.bezierCurveTo(that._x1+that._k*(that._x2-that._x0),that._y1+that._k*(that._y2-that._y0),that._x2+that._k*(that._x1-x),that._y2+that._k*(that._y1-y),that._x2,that._y2)}function Cardinal$1(context,tension){this._context=context;this._k=(1-tension)/6}Cardinal$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:_point$5(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;this._x1=x,this._y1=y;break;case 2:this._point=3;default:_point$5(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCardinal=function custom(tension){function cardinal(context){return new Cardinal$1(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalClosed$1(context,tension){this._context=context;this._k=(1-tension)/6}CardinalClosed$1.prototype={areaStart:noop$2,areaEnd:noop$2,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3);this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3);this._context.closePath();break;case 3:this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:_point$5(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalClosed$1=function custom(tension){function cardinal(context){return new CardinalClosed$1(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function CardinalOpen$1(context,tension){this._context=context;this._k=(1-tension)/6}CardinalOpen$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_point$5(this,x,y);break}this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var cardinalOpen$1=function custom(tension){function cardinal(context){return new CardinalOpen$1(context,tension)}cardinal.tension=function(tension){return custom(+tension)};return cardinal}(0);function _point$6(that,x,y){var x1=that._x1,y1=that._y1,x2=that._x2,y2=that._y2;if(that._l01_a>epsilon$2){var a=2*that._l01_2a+3*that._l01_a*that._l12_a+that._l12_2a,n=3*that._l01_a*(that._l01_a+that._l12_a);x1=(x1*a-that._x0*that._l12_2a+that._x2*that._l01_2a)/n;y1=(y1*a-that._y0*that._l12_2a+that._y2*that._l01_2a)/n}if(that._l23_a>epsilon$2){var b=2*that._l23_2a+3*that._l23_a*that._l12_a+that._l12_2a,m=3*that._l23_a*(that._l23_a+that._l12_a);x2=(x2*b+that._x1*that._l23_2a-x*that._l12_2a)/m;y2=(y2*b+that._y1*that._l23_2a-y*that._l12_2a)/m}that._context.bezierCurveTo(x1,y1,x2,y2,that._x2,that._y2)}function CatmullRom$1(context,alpha){this._context=context;this._alpha=alpha}CatmullRom$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;default:_point$6(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var curveCatmullRom=function custom(alpha){function catmullRom(context){return alpha?new CatmullRom$1(context,alpha):new Cardinal$1(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomClosed$1(context,alpha){this._context=context;this._alpha=alpha}CatmullRomClosed$1.prototype={areaStart:noop$2,areaEnd:noop$2,lineStart:function lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3);this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3);this._context.closePath();break;case 3:this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=x,this._y3=y;break;case 1:this._point=2;this._context.moveTo(this._x4=x,this._y4=y);break;case 2:this._point=3;this._x5=x,this._y5=y;break;default:_point$6(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomClosed$1=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomClosed$1(context,alpha):new CardinalClosed$1(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function CatmullRomOpen$1(context,alpha){this._context=context;this._alpha=alpha}CatmullRomOpen$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function lineEnd(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function point(x,y){x=+x,y=+y;if(this._point){var x23=this._x2-x,y23=this._y2-y;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(x23*x23+y23*y23,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_point$6(this,x,y);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=x;this._y0=this._y1,this._y1=this._y2,this._y2=y}};var catmullRomOpen$1=function custom(alpha){function catmullRom(context){return alpha?new CatmullRomOpen$1(context,alpha):new CardinalOpen$1(context,0)}catmullRom.alpha=function(alpha){return custom(+alpha)};return catmullRom}(.5);function LinearClosed$1(context){this._context=context}LinearClosed$1.prototype={areaStart:noop$2,areaEnd:noop$2,lineStart:function lineStart(){this._point=0},lineEnd:function lineEnd(){if(this._point)this._context.closePath()},point:function point(x,y){x=+x,y=+y;if(this._point)this._context.lineTo(x,y);else this._point=1,this._context.moveTo(x,y)}};function curveLinearClosed(context){return new LinearClosed$1(context)}function sign$1(x){return x<0?-1:1}function slope3$1(that,x2,y2){var h0=that._x1-that._x0,h1=x2-that._x1,s0=(that._y1-that._y0)/(h0||h1<0&&-0),s1=(y2-that._y1)/(h1||h0<0&&-0),p=(s0*h1+s1*h0)/(h0+h1);return(sign$1(s0)+sign$1(s1))*Math.min(Math.abs(s0),Math.abs(s1),.5*Math.abs(p))||0}function slope2$1(that,t){var h=that._x1-that._x0;return h?(3*(that._y1-that._y0)/h-t)/2:t}function _point$7(that,t0,t1){var x0=that._x0,y0=that._y0,x1=that._x1,y1=that._y1,dx=(x1-x0)/3;that._context.bezierCurveTo(x0+dx,y0+dx*t0,x1-dx,y1-dx*t1,x1,y1)}function MonotoneX$1(context){this._context=context}MonotoneX$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function lineEnd(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:_point$7(this,this._t0,slope2$1(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function point(x,y){var t1=NaN;x=+x,y=+y;if(x===this._x1&&y===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;break;case 2:this._point=3;_point$7(this,slope2$1(this,t1=slope3$1(this,x,y)),t1);break;default:_point$7(this,this._t0,t1=slope3$1(this,x,y));break}this._x0=this._x1,this._x1=x;this._y0=this._y1,this._y1=y;this._t0=t1}};function MonotoneY$1(context){this._context=new ReflectContext$1(context)}(MonotoneY$1.prototype=Object.create(MonotoneX$1.prototype)).point=function(x,y){MonotoneX$1.prototype.point.call(this,y,x)};function ReflectContext$1(context){this._context=context}ReflectContext$1.prototype={moveTo:function moveTo(x,y){this._context.moveTo(y,x)},closePath:function closePath(){this._context.closePath()},lineTo:function lineTo(x,y){this._context.lineTo(y,x)},bezierCurveTo:function bezierCurveTo(x1,y1,x2,y2,x,y){this._context.bezierCurveTo(y1,x1,y2,x2,y,x)}};function monotoneX$1(context){return new MonotoneX$1(context)}function monotoneY$1(context){return new MonotoneY$1(context)}function Natural$1(context){this._context=context}Natural$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=[];this._y=[]},lineEnd:function lineEnd(){var x=this._x,y=this._y,n=x.length;if(n){this._line?this._context.lineTo(x[0],y[0]):this._context.moveTo(x[0],y[0]);if(n===2){this._context.lineTo(x[1],y[1])}else{var px=controlPoints$1(x),py=controlPoints$1(y);for(var i0=0,i1=1;i1<n;++i0,++i1){this._context.bezierCurveTo(px[0][i0],py[0][i0],px[1][i0],py[1][i0],x[i1],y[i1])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function point(x,y){this._x.push(+x);this._y.push(+y)}};function controlPoints$1(x){var i,n=x.length-1,m,a=new Array(n),b=new Array(n),r=new Array(n);a[0]=0,b[0]=2,r[0]=x[0]+2*x[1];for(i=1;i<n-1;++i){a[i]=1,b[i]=4,r[i]=4*x[i]+2*x[i+1]}a[n-1]=2,b[n-1]=7,r[n-1]=8*x[n-1]+x[n];for(i=1;i<n;++i){m=a[i]/b[i-1],b[i]-=m,r[i]-=m*r[i-1]}a[n-1]=r[n-1]/b[n-1];for(i=n-2;i>=0;--i){a[i]=(r[i]-a[i+1])/b[i]}b[n-1]=(x[n]+a[n-1])/2;for(i=0;i<n-1;++i){b[i]=2*x[i+1]-a[i+1]}return[a,b]}function curveNatural(context){return new Natural$1(context)}function Step$1(context,t){this._context=context;this._t=t}Step$1.prototype={areaStart:function areaStart(){this._line=0},areaEnd:function areaEnd(){this._line=NaN},lineStart:function lineStart(){this._x=this._y=NaN;this._point=0},lineEnd:function lineEnd(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function point(x,y){x=+x,y=+y;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(x,y):this._context.moveTo(x,y);break;case 1:this._point=2;default:if(this._t<=0){this._context.lineTo(this._x,y);this._context.lineTo(x,y)}else{var x1=this._x*(1-this._t)+x*this._t;this._context.lineTo(x1,this._y);this._context.lineTo(x1,y)}break}this._x=x,this._y=y}};function curveStep(context){return new Step$1(context,.5)}function stepBefore$1(context){return new Step$1(context,0)}function stepAfter$1(context){return new Step$1(context,1)}function none$2(series,order){if(!((n=series.length)>1))return;for(var i=1,j,s0,s1=series[order[0]],n,m=s1.length;i<n;++i){s0=s1,s1=series[order[i]];for(j=0;j<m;++j){s1[j][1]+=s1[j][0]=isNaN(s0[j][1])?s0[j][0]:s0[j][1]}}}function none$3(series){var n=series.length,o=new Array(n);while(--n>=0){o[n]=n}return o}function stackValue$1(d,key){return d[key]}function stack$1(){var keys=constant$1([]),order=none$3,offset=none$2,value=stackValue$1;function stack(data){var kz=keys.apply(this,arguments),i,m=data.length,n=kz.length,sz=new Array(n),oz;for(i=0;i<n;++i){for(var ki=kz[i],si=sz[i]=new Array(m),j=0,sij;j<m;++j){si[j]=sij=[0,+value(data[j],ki,j,data)];sij.data=data[j]}si.key=ki}for(i=0,oz=order(sz);i<n;++i){sz[oz[i]].index=i}offset(sz,oz);return sz}stack.keys=function(_){return arguments.length?(keys=typeof _==="function"?_:constant$1(slice$1.call(_)),stack):keys};stack.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant$1(+_),stack):value};stack.order=function(_){return arguments.length?(order=_==null?none$3:typeof _==="function"?_:constant$1(slice$1.call(_)),stack):order};stack.offset=function(_){return arguments.length?(offset=_==null?none$2:_,stack):offset};return stack}function expand$1(series,order){if(!((n=series.length)>0))return;for(var i,n,j=0,m=series[0].length,y;j<m;++j){for(y=i=0;i<n;++i){y+=series[i][j][1]||0}if(y)for(i=0;i<n;++i){series[i][j][1]/=y}}none$2(series,order)}function diverging(series,order){if(!((n=series.length)>1))return;for(var i,j=0,d,dy,yp,yn,n,m=series[order[0]].length;j<m;++j){for(yp=yn=0,i=0;i<n;++i){if((dy=(d=series[order[i]][j])[1]-d[0])>=0){d[0]=yp,d[1]=yp+=dy}else if(dy<0){d[1]=yn,d[0]=yn+=dy}else{d[0]=yp}}}}function silhouette$1(series,order){if(!((n=series.length)>0))return;for(var j=0,s0=series[order[0]],n,m=s0.length;j<m;++j){for(var i=0,y=0;i<n;++i){y+=series[i][j][1]||0}s0[j][1]+=s0[j][0]=-y/2}none$2(series,order)}function wiggle$1(series,order){if(!((n=series.length)>0)||!((m=(s0=series[order[0]]).length)>0))return;for(var y=0,j=1,s0,m,n;j<m;++j){for(var i=0,s1=0,s2=0;i<n;++i){var si=series[order[i]],sij0=si[j][1]||0,sij1=si[j-1][1]||0,s3=(sij0-sij1)/2;for(var k=0;k<i;++k){var sk=series[order[k]],skj0=sk[j][1]||0,skj1=sk[j-1][1]||0;s3+=skj0-skj1}s1+=sij0,s2+=s3*sij0}s0[j-1][1]+=s0[j-1][0]=y;if(s1)y-=s2/s1}s0[j-1][1]+=s0[j-1][0]=y;none$2(series,order)}function appearance(series){var peaks=series.map(peak);return none$3(series).sort(function(a,b){return peaks[a]-peaks[b]})}function peak(series){var i=-1,j=0,n=series.length,vi,vj=-Infinity;while(++i<n){if((vi=+series[i][1])>vj)vj=vi,j=i}return j}function ascending$1(series){var sums=series.map(sum$1);return none$3(series).sort(function(a,b){return sums[a]-sums[b]})}function sum$1(series){var s=0,i=-1,n=series.length,v;while(++i<n){if(v=+series[i][1])s+=v}return s}function descending$3(series){return ascending$1(series).reverse()}function insideOut$1(series){var n=series.length,i,j,sums=series.map(sum$1),order=appearance(series),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=order[i];if(top<bottom){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)}function reverse$1(series){return none$3(series).reverse()}var src=Object.freeze({arc:arc$1,area:area$1,line:line$1,pie:pie$1,areaRadial:areaRadial,radialArea:areaRadial,lineRadial:lineRadial$1,radialLine:lineRadial$1,pointRadial:pointRadial,linkHorizontal:linkHorizontal,linkVertical:linkVertical,linkRadial:linkRadial,symbol:symbol$1,symbols:symbols$1,symbolCircle:circle$1,symbolCross:cross$1,symbolDiamond:diamond$1,symbolSquare:square$1,symbolStar:star$1,symbolTriangle:triangle$1,symbolWye:wye$1,curveBasisClosed:basisClosed$1,curveBasisOpen:basisOpen$1,curveBasis:curveBasis,curveBundle:bundle$1,curveCardinalClosed:cardinalClosed$1,curveCardinalOpen:cardinalOpen$1,curveCardinal:curveCardinal,curveCatmullRomClosed:catmullRomClosed$1,curveCatmullRomOpen:catmullRomOpen$1,curveCatmullRom:curveCatmullRom,curveLinearClosed:curveLinearClosed,curveLinear:curveLinear$1,curveMonotoneX:monotoneX$1,curveMonotoneY:monotoneY$1,curveNatural:curveNatural,curveStep:curveStep,curveStepAfter:stepAfter$1,curveStepBefore:stepBefore$1,stack:stack$1,stackOffsetExpand:expand$1,stackOffsetDiverging:diverging,stackOffsetNone:none$2,stackOffsetSilhouette:silhouette$1,stackOffsetWiggle:wiggle$1,stackOrderAppearance:appearance,stackOrderAscending:ascending$1,stackOrderDescending:descending$3,stackOrderInsideOut:insideOut$1,stackOrderNone:none$3,stackOrderReverse:reverse$1});function ascending$2(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function bisector(compare){if(compare.length===1)compare=ascendingComparator(compare);return{left:function left(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid}return lo},right:function right(a,x,lo,hi){if(lo==null)lo=0;if(hi==null)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1}return lo}}}function ascendingComparator(f){return function(d,x){return ascending$2(f(d),x)}}var ascendingBisect=bisector(ascending$2);var bisectRight=ascendingBisect.right;var bisectLeft=ascendingBisect.left;function pairs(array,f){if(f==null)f=pair;var i=0,n=array.length-1,p=array[0],pairs=new Array(n<0?0:n);while(i<n){pairs[i]=f(p,p=array[++i])}return pairs}function pair(a,b){return[a,b]}function cross$2(values0,values1,reduce){var n0=values0.length,n1=values1.length,values=new Array(n0*n1),i0,i1,i,value0;if(reduce==null)reduce=pair;for(i0=i=0;i0<n0;++i0){for(value0=values0[i0],i1=0;i1<n1;++i1,++i){values[i]=reduce(value0,values1[i1])}}return values}function descending$4(a,b){return b<a?-1:b>a?1:b>=a?0:NaN}function number(x){return x===null?NaN:+x}function variance(values,valueof){var n=values.length,m=0,i=-1,mean=0,value,delta,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i]))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values)))){delta=value-mean;mean+=delta/++m;sum+=delta*(value-mean)}}}if(m>1)return sum/(m-1)}function deviation(array,f){var v=variance(array,f);return v?Math.sqrt(v):v}function extent(values,valueof){var n=values.length,i=-1,value,min,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=max=value;while(++i<n){if((value=values[i])!=null){if(min>value)min=value;if(max<value)max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null){if(min>value)min=value;if(max<value)max=value}}}}}return[min,max]}var array=Array.prototype;var slice$2=array.slice;var map=array.map;function constant$2(x){return function(){return x}}function identity$2(x){return x}function range(start,stop,step){start=+start,stop=+stop,step=(n=arguments.length)<2?(stop=start,start=0,1):n<3?1:+step;var i=-1,n=Math.max(0,Math.ceil((stop-start)/step))|0,range=new Array(n);while(++i<n){range[i]=start+i*step}return range}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(start,stop,count){var reverse,i=-1,n,ticks,step;stop=+stop,start=+start,count=+count;if(start===stop&&count>0)return[start];if(reverse=stop<start)n=start,start=stop,stop=n;if((step=tickIncrement(start,stop,count))===0||!isFinite(step))return[];if(step>0){start=Math.ceil(start/step);stop=Math.floor(stop/step);ticks=new Array(n=Math.ceil(stop-start+1));while(++i<n){ticks[i]=(start+i)*step}}else{start=Math.floor(start*step);stop=Math.ceil(stop*step);ticks=new Array(n=Math.ceil(start-stop+1));while(++i<n){ticks[i]=(start-i)/step}}if(reverse)ticks.reverse();return ticks}function tickIncrement(start,stop,count){var step=(stop-start)/Math.max(0,count),power=Math.floor(Math.log(step)/Math.LN10),error=step/Math.pow(10,power);return power>=0?(error>=e10?10:error>=e5?5:error>=e2?2:1)*Math.pow(10,power):-Math.pow(10,-power)/(error>=e10?10:error>=e5?5:error>=e2?2:1)}function tickStep(start,stop,count){var step0=Math.abs(stop-start)/Math.max(0,count),step1=Math.pow(10,Math.floor(Math.log(step0)/Math.LN10)),error=step0/step1;if(error>=e10)step1*=10;else if(error>=e5)step1*=5;else if(error>=e2)step1*=2;return stop<start?-step1:step1}function thresholdSturges(values){return Math.ceil(Math.log(values.length)/Math.LN2)+1}function histogram(){var value=identity$2,domain=extent,threshold=thresholdSturges;function histogram(data){var i,n=data.length,x,values=new Array(n);for(i=0;i<n;++i){values[i]=value(data[i],i,data)}var xz=domain(values),x0=xz[0],x1=xz[1],tz=threshold(values,x0,x1);if(!Array.isArray(tz)){tz=tickStep(x0,x1,tz);tz=range(Math.ceil(x0/tz)*tz,x1,tz)}var m=tz.length;while(tz[0]<=x0){tz.shift(),--m}while(tz[m-1]>x1){tz.pop(),--m}var bins=new Array(m+1),bin;for(i=0;i<=m;++i){bin=bins[i]=[];bin.x0=i>0?tz[i-1]:x0;bin.x1=i<m?tz[i]:x1}for(i=0;i<n;++i){x=values[i];if(x0<=x&&x<=x1){bins[bisectRight(tz,x,0,m)].push(data[i])}}return bins}histogram.value=function(_){return arguments.length?(value=typeof _==="function"?_:constant$2(_),histogram):value};histogram.domain=function(_){return arguments.length?(domain=typeof _==="function"?_:constant$2([_[0],_[1]]),histogram):domain};histogram.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant$2(slice$2.call(_)):constant$2(_),histogram):threshold};return histogram}function quantile(values,p,valueof){if(valueof==null)valueof=number;if(!(n=values.length))return;if((p=+p)<=0||n<2)return+valueof(values[0],0,values);if(p>=1)return+valueof(values[n-1],n-1,values);var n,i=(n-1)*p,i0=Math.floor(i),value0=+valueof(values[i0],i0,values),value1=+valueof(values[i0+1],i0+1,values);return value0+(value1-value0)*(i-i0)}function freedmanDiaconis(values,min,max){values=map.call(values,number).sort(ascending$2);return Math.ceil((max-min)/(2*(quantile(values,.75)-quantile(values,.25))*Math.pow(values.length,-1/3)))}function scott(values,min,max){return Math.ceil((max-min)/(3.5*deviation(values)*Math.pow(values.length,-1/3)))}function max$2(values,valueof){var n=values.length,i=-1,value,max;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){max=value;while(++i<n){if((value=values[i])!=null&&value>max){max=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){max=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>max){max=value}}}}}return max}function mean(values,valueof){var n=values.length,m=n,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i])))sum+=value;else--m}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values))))sum+=value;else--m}}if(m)return sum/m}function median(values,valueof){var n=values.length,i=-1,value,numbers=[];if(valueof==null){while(++i<n){if(!isNaN(value=number(values[i]))){numbers.push(value)}}}else{while(++i<n){if(!isNaN(value=number(valueof(values[i],i,values)))){numbers.push(value)}}}return quantile(numbers.sort(ascending$2),.5)}function merge(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n){j+=arrays[i].length}merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m]}}return merged}function min$2(values,valueof){var n=values.length,i=-1,value,min;if(valueof==null){while(++i<n){if((value=values[i])!=null&&value>=value){min=value;while(++i<n){if((value=values[i])!=null&&min>value){min=value}}}}}else{while(++i<n){if((value=valueof(values[i],i,values))!=null&&value>=value){min=value;while(++i<n){if((value=valueof(values[i],i,values))!=null&&min>value){min=value}}}}}return min}function permute(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--){permutes[i]=array[indexes[i]]}return permutes}function scan(values,compare){if(!(n=values.length))return;var n,i=0,j=0,xi,xj=values[j];if(compare==null)compare=ascending$2;while(++i<n){if(compare(xi=values[i],xj)<0||compare(xj,xj)!==0){xj=xi,j=i}}if(compare(xj,xj)===0)return j}function shuffle(array,i0,i1){var m=(i1==null?array.length:i1)-(i0=i0==null?0:+i0),t,i;while(m){i=Math.random()*m--|0;t=array[m+i0];array[m+i0]=array[i+i0];array[i+i0]=t}return array}function sum$2(values,valueof){var n=values.length,i=-1,value,sum=0;if(valueof==null){while(++i<n){if(value=+values[i])sum+=value}}else{while(++i<n){if(value=+valueof(values[i],i,values))sum+=value}}return sum}function transpose(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=min$2(matrix,length),transpose=new Array(m);++i<m;){for(var j=-1,n,row=transpose[i]=new Array(n);++j<n;){row[j]=matrix[j][i]}}return transpose}function length(d){return d.length}function zip(){return transpose(arguments)}var src$1=Object.freeze({bisect:bisectRight,bisectRight:bisectRight,bisectLeft:bisectLeft,ascending:ascending$2,bisector:bisector,cross:cross$2,descending:descending$4,deviation:deviation,extent:extent,histogram:histogram,thresholdFreedmanDiaconis:freedmanDiaconis,thresholdScott:scott,thresholdSturges:thresholdSturges,max:max$2,mean:mean,median:median,merge:merge,min:min$2,pairs:pairs,permute:permute,quantile:quantile,range:range,scan:scan,shuffle:shuffle,sum:sum$2,ticks:ticks,tickIncrement:tickIncrement,tickStep:tickStep,transpose:transpose,variance:variance,zip:zip});var findFirstAccessorValue=function(accessorArray,data){for(var i=0;i<accessorArray.length;i++){var valueCheck=accessorArray[i](data);if(valueCheck!==undefined&&!Number.isNaN(valueCheck)&&valueCheck!==null)return valueCheck}return undefined};var datesForUnique=function(d){return d instanceof Date?d.getTime():d};var projectSummaryData=function(_a){var data=_a.data,summaryDataAccessor=_a.summaryDataAccessor,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor;var projectedData=[];summaryDataAccessor.forEach(function(actualSummaryAccessor){xAccessor.forEach(function(actualXAccessor){yAccessor.forEach(function(actualYAccessor){var projection=function(d){return actualSummaryAccessor(d).map(function(p,q){return[actualXAccessor(p,q),actualYAccessor(p,q)]})};data.forEach(function(d){projectedData.push(__assign({},d,{_baseData:actualSummaryAccessor(d),_xyfCoordinates:projection(d)}))})})})});return projectedData};var projectLineData=function(_a){var data=_a.data,lineDataAccessor=_a.lineDataAccessor,xProp=_a.xProp,yProp=_a.yProp,yPropTop=_a.yPropTop,yPropBottom=_a.yPropBottom,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor;if(!Array.isArray(data)){data=[data]}var projectedLine=[];lineDataAccessor.forEach(function(actualLineAccessor,lineIndex){xAccessor.forEach(function(actualXAccessor,xIndex){yAccessor.forEach(function(actualYAccessor,yIndex){data.forEach(function(d){var originalLineData=__assign({},d,{xIndex:xIndex,yIndex:yIndex,lineIndex:lineIndex});originalLineData.data=actualLineAccessor(d).map(function(p,q){var originalCoords={data:p};originalCoords[xProp]=actualXAccessor(p,q);originalCoords[yProp]=actualYAccessor(p,q);originalCoords[yPropTop]=originalCoords[yProp];originalCoords[yPropBottom]=originalCoords[yProp];return originalCoords});originalLineData.key=originalLineData.key||projectedLine.length;projectedLine.push(originalLineData)})})})});return projectedLine};var differenceLine=function(_a){var data=_a.data,yProp=_a.yProp,yPropTop=_a.yPropTop,yPropBottom=_a.yPropBottom;data.forEach(function(l,i){l.data.forEach(function(point,q){var otherLine=i===0?1:0;if(point[yProp]>data[otherLine].data[q][yProp]){point[yPropBottom]=data[otherLine].data[q][yProp];point[yPropTop]=point[yProp]}else{point[yPropTop]=point[yProp];point[yPropBottom]=point[yProp]}})});return data};var stackedArea=function(_a){var _b=_a.type,type=_b===void 0?"stackedarea":_b,data=_a.data,xProp=_a.xProp,yProp=_a.yProp,yPropMiddle=_a.yPropMiddle,sort=_a.sort,yPropTop=_a.yPropTop,yPropBottom=_a.yPropBottom;var uniqXValues=data.map(function(d){return d.data.map(function(p){return datesForUnique(p[xProp])})}).reduce(function(a,b){return a.concat(b)},[]).reduce(function(p,c){if(p.indexOf(c)===-1){p.push(c)}return p},[]);var stackSort=function(a,b){return sum$2(b.data.map(function(p){return p[yProp]}))-sum$2(a.data.map(function(p){return p[yProp]}))};if(type==="stackedpercent-invert"||type==="stackedarea-invert"){stackSort=function(a,b){return sum$2(a.data.map(function(p){return p[yProp]}))-sum$2(b.data.map(function(p){return p[yProp]}))}}sort=sort===undefined?stackSort:sort;if(sort!==null){data=data.sort(sort)}uniqXValues.forEach(function(xValue){var negativeOffset=0;var positiveOffset=0;var stepValues=data.map(function(d){return d.data.filter(function(p){return datesForUnique(p[xProp])===xValue})}).reduce(function(a,b){return a.concat(b)},[]);var positiveStepTotal=sum$2(stepValues.map(function(d){return d[yProp]>0?d[yProp]:0}));var negativeStepTotal=sum$2(stepValues.map(function(d){return d[yProp]<0?d[yProp]:0}));stepValues.forEach(function(l){if(l[yProp]<0){if(type==="linepercent"||type==="stackedpercent"||type==="stackedpercent-invert"){var percent=l[yProp]/negativeStepTotal;l.percent=percent;if(type==="linepercent"){l[yPropBottom]=l[yPropBottom]=l[yPropTop]=l[yPropMiddle]=percent}else{var adjustment=negativeStepTotal>=0?0:percent;l[yPropBottom]=negativeStepTotal===0?0:-(negativeOffset/negativeStepTotal);l[yPropTop]=l[yPropBottom]-adjustment;l[yPropMiddle]=l[yPropBottom]-adjustment/2}}else{l[yPropBottom]=negativeOffset;l[yPropTop]=negativeOffset+l[yProp];l[yPropMiddle]=negativeOffset+l[yProp]/2}negativeOffset+=l[yProp]}else{if(type==="linepercent"||type==="stackedpercent"||type==="stackedpercent-invert"){var percent=l[yProp]/positiveStepTotal;l.percent=percent;if(type==="linepercent"){l[yPropBottom]=l[yPropTop]=l[yPropMiddle]=percent}else{var adjustment=positiveStepTotal<=0?0:percent;l[yPropBottom]=positiveStepTotal===0?0:positiveOffset/positiveStepTotal;l[yPropTop]=l[yPropBottom]+adjustment;l[yPropMiddle]=l[yPropBottom]+adjustment/2}}else{l[yPropBottom]=positiveOffset;l[yPropTop]=positiveOffset+l[yProp];l[yPropMiddle]=positiveOffset+l[yProp]/2}positiveOffset+=l[yProp]}})});return data};var lineChart=function(_a){var data=_a.data,y1=_a.y1,yPropTop=_a.yPropTop,yPropMiddle=_a.yPropMiddle,yPropBottom=_a.yPropBottom;if(y1){data.forEach(function(d){d.data.forEach(function(p){p[yPropBottom]=y1(p);p[yPropMiddle]=p[yPropBottom]+p[yPropTop]/2})})}return data};var cumulativeLine=function(_a){var data=_a.data,yPropTop=_a.yPropTop,yPropMiddle=_a.yPropMiddle,yPropBottom=_a.yPropBottom,_b=_a.type,type=_b===void 0?"cumulative":_b;data.forEach(function(d){var cumulativeValue=0;var dataArray=type==="cumulative-reverse"?d.data.reverse():d.data;dataArray.forEach(function(p){cumulativeValue+=p[yPropTop];p[yPropBottom]=p[yPropTop]=p[yPropMiddle]=cumulativeValue})});return data};var bumpChart=function(_a){var _b=_a.type,type=_b===void 0?"bumpline":_b,data=_a.data,xProp=_a.xProp,yProp=_a.yProp,yPropMiddle=_a.yPropMiddle,yPropTop=_a.yPropTop,yPropBottom=_a.yPropBottom;var uniqXValues=data.map(function(d){return d.data.map(function(p){return datesForUnique(p[xProp])})}).reduce(function(a,b){return a.concat(b)},[]).reduce(function(p,c){if(p.indexOf(c)===-1){p.push(c)}return p},[]);var bumpSort=function(a,b){if(a[yProp]>b[yProp]){return 1}if(a[yProp]<b[yProp]){return-1}return-1};if(type==="bumparea-invert"||type==="bumpline-invert"){bumpSort=function(a,b){if(a[yProp]<b[yProp]){return 1}if(a[yProp]>b[yProp]){return-1}return-1}}uniqXValues.forEach(function(xValue){var negativeOffset=0;var positiveOffset=0;data.map(function(d){return d.data.filter(function(p){return datesForUnique(p[xProp])===xValue})}).reduce(function(a,b){return a.concat(b)},[]).sort(bumpSort).forEach(function(l,rank){l._XYFrameRank=rank+1;if(type==="bumparea"||type==="bumparea-invert"){if(l[yProp]<0){l[yPropTop]=negativeOffset+l[yProp];l[yPropMiddle]=negativeOffset+l[yProp]/2;l[yPropBottom]=negativeOffset;negativeOffset+=l[yProp]}else{l[yPropTop]=positiveOffset+l[yProp];l[yPropMiddle]=positiveOffset+l[yProp]/2;l[yPropBottom]=positiveOffset;positiveOffset+=l[yProp]}}else{l[yProp]=rank+1;l[yPropTop]=rank+1;l[yPropBottom]=rank+1}})});return data};var dividedLine=function(parameters,points,searchIterations){if(searchIterations===void 0){searchIterations=10}var currentParameters=parameters(points[0],0);var currentPointsArray=[];var dividedLinesData=[{key:currentParameters,points:currentPointsArray}];points.forEach(function(point,pointI){var newParameters=parameters(point,pointI);var matchingParams=newParameters===currentParameters;var stringNewParams=JSON.stringify(newParameters);var stringCurrentParams=JSON.stringify(currentParameters);if(typeof currentParameters==="object"){matchingParams=stringNewParams===stringCurrentParams}if(matchingParams){currentPointsArray.push(point)}else{var lastPoint=currentPointsArray[currentPointsArray.length-1];var pointA=lastPoint;var pointB=point;var stringBParams=stringNewParams;var x=0;while(x<searchIterations&&stringNewParams===stringBParams){var keys=Object.keys(pointA);var findPoints=simpleSearchFunction({pointA:pointA,pointB:pointB,currentParameters:currentParameters,parameters:parameters,keys:keys});pointA=findPoints[0];pointB=findPoints[1];stringBParams=JSON.stringify(parameters(pointB));x++}currentPointsArray.push(pointB);currentPointsArray=[pointB,point];dividedLinesData.push({key:newParameters,points:currentPointsArray});currentParameters=newParameters}});return dividedLinesData};function simpleSearchFunction(_a){var pointA=_a.pointA,pointB=_a.pointB,currentParameters=_a.currentParameters,parameters=_a.parameters,keys=_a.keys;var betweenPoint={};keys.forEach(function(key){betweenPoint[key]=typeof pointA[key]==="number"?(pointA[key]+pointB[key])/2:undefined});var stringBetween=JSON.stringify(parameters(betweenPoint));var stringCurrent=JSON.stringify(currentParameters);if(stringBetween===stringCurrent){return[betweenPoint,pointB]}return[pointA,betweenPoint]}function funnelize(_a){var data=_a.data,steps=_a.steps,key=_a.key;var funnelData=[];if(!Array.isArray(data)){data=[data]}if(!steps){steps=data.map(function(d){return Object.keys(d)}).reduce(function(a,b){return a.concat(b)},[])}data.forEach(function(datum,i){var datumKey=key?datum[key]:i;steps.forEach(function(step){var funnelDatum={funnelKey:datumKey,stepName:"",stepValue:0};funnelDatum.stepName=step;funnelDatum.stepValue=datum[step]?datum[step]:0;funnelData.push(funnelDatum)})});return funnelData}var whichPoint={bottom:"yBottom",top:"yTop"};function relativeY(_a){var point=_a.point,projectedY=_a.projectedY,yAccessor=_a.yAccessor,yScale=_a.yScale,showLinePoints=_a.showLinePoints;var baseData=point&&(showLinePoints&&showLinePoints!==true&&point[whichPoint[showLinePoints]]!==undefined?point[whichPoint[showLinePoints]]:point.yMiddle!==undefined?point.yMiddle:point[projectedY]!==undefined?point[projectedY]:findFirstAccessorValue(yAccessor,point));if(Array.isArray(baseData)){return baseData.map(function(d){return yScale(d)})}return baseData!==undefined?yScale(baseData):0}function relativeX(_a){var point=_a.point,projectedXMiddle=_a.projectedXMiddle,projectedX=_a.projectedX,xAccessor=_a.xAccessor,xScale=_a.xScale;var baseData=point&&(point[projectedXMiddle]!==undefined?point[projectedXMiddle]:point[projectedX]!==undefined?point[projectedX]:findFirstAccessorValue(xAccessor,point));if(Array.isArray(baseData)){return baseData.map(function(d){return xScale(d)})}return baseData!==undefined?xScale(baseData):0}function findPointByID(_a){var point=_a.point,idAccessor=_a.idAccessor,lines=_a.lines,xScale=_a.xScale,projectedX=_a.projectedX,xAccessor=_a.xAccessor;var pointID=idAccessor(point.parentLine||point);if(pointID){var thisLine=lines.data.find(function(l){return idAccessor(l)===pointID});if(!thisLine){return null}var pointX_1=xScale(findFirstAccessorValue(xAccessor,point));var thisPoint=thisLine.data.find(function(p){return xScale(p[projectedX])===pointX_1});if(!thisPoint){return null}var newPoint_1=__assign({},point,thisPoint,thisPoint.data,{parentLine:thisLine});var reactAnnotationProps=["type","label","note","connector","disabled","color","subject"];reactAnnotationProps.forEach(function(prop){if(point[prop])newPoint_1[prop]=point[prop]});return newPoint_1}return point}var xhtml="http://www.w3.org/1999/xhtml";var namespaces={svg:"http://www.w3.org/2000/svg",xhtml:xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(name){var prefix=name+="",i=prefix.indexOf(":");if(i>=0&&(prefix=name.slice(0,i))!=="xmlns")name=name.slice(i+1);return namespaces.hasOwnProperty(prefix)?{space:namespaces[prefix],local:name}:name}function creatorInherit(name){return function(){var document=this.ownerDocument,uri=this.namespaceURI;return uri===xhtml&&document.documentElement.namespaceURI===xhtml?document.createElement(name):document.createElementNS(uri,name)}}function creatorFixed(fullname){return function(){return this.ownerDocument.createElementNS(fullname.space,fullname.local)}}function creator(name){var fullname=namespace(name);return(fullname.local?creatorFixed:creatorInherit)(fullname)}function none$4(){}function selector(selector){return selector==null?none$4:function(){return this.querySelector(selector)}}function selection_select(select){if(typeof select!=="function")select=selector(select);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),node,subnode,i=0;i<n;++i){if((node=group[i])&&(subnode=select.call(node,node.__data__,i,group))){if("__data__"in node)subnode.__data__=node.__data__;subgroup[i]=subnode}}}return new Selection(subgroups,this._parents)}function empty(){return[]}function selectorAll(selector){return selector==null?empty:function(){return this.querySelectorAll(selector)}}function selection_selectAll(select){if(typeof select!=="function")select=selectorAll(select);for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){subgroups.push(select.call(node,node.__data__,i,group));parents.push(node)}}}return new Selection(subgroups,parents)}function matcher(selector){return function(){return this.matches(selector)}}function selection_filter(match){if(typeof match!=="function")match=matcher(match);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=[],node,i=0;i<n;++i){if((node=group[i])&&match.call(node,node.__data__,i,group)){subgroup.push(node)}}}return new Selection(subgroups,this._parents)}function sparse(update){return new Array(update.length)}function selection_enter(){return new Selection(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(parent,datum){this.ownerDocument=parent.ownerDocument;this.namespaceURI=parent.namespaceURI;this._next=null;this._parent=parent;this.__data__=datum}EnterNode.prototype={constructor:EnterNode,appendChild:function appendChild(child){return this._parent.insertBefore(child,this._next)},insertBefore:function insertBefore(child,next){return this._parent.insertBefore(child,next)},querySelector:function querySelector(selector){return this._parent.querySelector(selector)},querySelectorAll:function querySelectorAll(selector){return this._parent.querySelectorAll(selector)}};function constant$3(x){return function(){return x}}var keyPrefix="$";function bindIndex(parent,group,enter,update,exit,data){var i=0,node,groupLength=group.length,dataLength=data.length;for(;i<dataLength;++i){if(node=group[i]){node.__data__=data[i];update[i]=node}else{enter[i]=new EnterNode(parent,data[i])}}for(;i<groupLength;++i){if(node=group[i]){exit[i]=node}}}function bindKey(parent,group,enter,update,exit,data,key){var i,node,nodeByKeyValue={},groupLength=group.length,dataLength=data.length,keyValues=new Array(groupLength),keyValue;for(i=0;i<groupLength;++i){if(node=group[i]){keyValues[i]=keyValue=keyPrefix+key.call(node,node.__data__,i,group);if(keyValue in nodeByKeyValue){exit[i]=node}else{nodeByKeyValue[keyValue]=node}}}for(i=0;i<dataLength;++i){keyValue=keyPrefix+key.call(parent,data[i],i,data);if(node=nodeByKeyValue[keyValue]){update[i]=node;node.__data__=data[i];nodeByKeyValue[keyValue]=null}else{enter[i]=new EnterNode(parent,data[i])}}for(i=0;i<groupLength;++i){if((node=group[i])&&nodeByKeyValue[keyValues[i]]===node){exit[i]=node}}}function selection_data(value,key){if(!value){data=new Array(this.size()),j=-1;this.each(function(d){data[++j]=d});return data}var bind=key?bindKey:bindIndex,parents=this._parents,groups=this._groups;if(typeof value!=="function")value=constant$3(value);for(var m=groups.length,update=new Array(m),enter=new Array(m),exit=new Array(m),j=0;j<m;++j){var parent=parents[j],group=groups[j],groupLength=group.length,data=value.call(parent,parent&&parent.__data__,j,parents),dataLength=data.length,enterGroup=enter[j]=new Array(dataLength),updateGroup=update[j]=new Array(dataLength),exitGroup=exit[j]=new Array(groupLength);bind(parent,group,enterGroup,updateGroup,exitGroup,data,key);for(var i0=0,i1=0,previous,next;i0<dataLength;++i0){if(previous=enterGroup[i0]){if(i0>=i1)i1=i0+1;while(!(next=updateGroup[i1])&&++i1<dataLength){}previous._next=next||null}}}update=new Selection(update,parents);update._enter=enter;update._exit=exit;return update}function selection_exit(){return new Selection(this._exit||this._groups.map(sparse),this._parents)}function selection_join(onenter,onupdate,onexit){var enter=this.enter(),update=this,exit=this.exit();enter=typeof onenter==="function"?onenter(enter):enter.append(onenter+"");if(onupdate!=null)update=onupdate(update);if(onexit==null)exit.remove();else onexit(exit);return enter&&update?enter.merge(update).order():update}function selection_merge(selection){for(var groups0=this._groups,groups1=selection._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j){for(var group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),node,i=0;i<n;++i){if(node=group0[i]||group1[i]){merge[i]=node}}}for(;j<m0;++j){merges[j]=groups0[j]}return new Selection(merges,this._parents)}function selection_order(){for(var groups=this._groups,j=-1,m=groups.length;++j<m;){for(var group=groups[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&node.compareDocumentPosition(next)^4)next.parentNode.insertBefore(node,next);next=node}}}return this}function selection_sort(compare){if(!compare)compare=ascending$3;function compareNode(a,b){return a&&b?compare(a.__data__,b.__data__):!a-!b}for(var groups=this._groups,m=groups.length,sortgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,sortgroup=sortgroups[j]=new Array(n),node,i=0;i<n;++i){if(node=group[i]){sortgroup[i]=node}}sortgroup.sort(compareNode)}return new Selection(sortgroups,this._parents).order()}function ascending$3(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function selection_call(){var callback=arguments[0];arguments[0]=this;callback.apply(null,arguments);return this}function selection_nodes(){var nodes=new Array(this.size()),i=-1;this.each(function(){nodes[++i]=this});return nodes}function selection_node(){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length;i<n;++i){var node=group[i];if(node)return node}}return null}function selection_size(){var size=0;this.each(function(){++size});return size}function selection_empty(){return!this.node()}function selection_each(callback){for(var groups=this._groups,j=0,m=groups.length;j<m;++j){for(var group=groups[j],i=0,n=group.length,node;i<n;++i){if(node=group[i])callback.call(node,node.__data__,i,group)}}return this}function attrRemove(name){return function(){this.removeAttribute(name)}}function attrRemoveNS(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant(name,value){return function(){this.setAttribute(name,value)}}function attrConstantNS(fullname,value){return function(){this.setAttributeNS(fullname.space,fullname.local,value)}}function attrFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttribute(name);else this.setAttribute(name,v)}}function attrFunctionNS(fullname,value){return function(){var v=value.apply(this,arguments);if(v==null)this.removeAttributeNS(fullname.space,fullname.local);else this.setAttributeNS(fullname.space,fullname.local,v)}}function selection_attr(name,value){var fullname=namespace(name);if(arguments.length<2){var node=this.node();return fullname.local?node.getAttributeNS(fullname.space,fullname.local):node.getAttribute(fullname)}return this.each((value==null?fullname.local?attrRemoveNS:attrRemove:typeof value==="function"?fullname.local?attrFunctionNS:attrFunction:fullname.local?attrConstantNS:attrConstant)(fullname,value))}function defaultView(node){return node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView}function styleRemove(name){return function(){this.style.removeProperty(name)}}function styleConstant(name,value,priority){return function(){this.style.setProperty(name,value,priority)}}function styleFunction(name,value,priority){return function(){var v=value.apply(this,arguments);if(v==null)this.style.removeProperty(name);else this.style.setProperty(name,v,priority)}}function selection_style(name,value,priority){return arguments.length>1?this.each((value==null?styleRemove:typeof value==="function"?styleFunction:styleConstant)(name,value,priority==null?"":priority)):styleValue(this.node(),name)}function styleValue(node,name){return node.style.getPropertyValue(name)||defaultView(node).getComputedStyle(node,null).getPropertyValue(name)}function propertyRemove(name){return function(){delete this[name]}}function propertyConstant(name,value){return function(){this[name]=value}}function propertyFunction(name,value){return function(){var v=value.apply(this,arguments);if(v==null)delete this[name];else this[name]=v}}function selection_property(name,value){return arguments.length>1?this.each((value==null?propertyRemove:typeof value==="function"?propertyFunction:propertyConstant)(name,value)):this.node()[name]}function classArray(string){return string.trim().split(/^|\s+/)}function classList(node){return node.classList||new ClassList(node)}function ClassList(node){this._node=node;this._names=classArray(node.getAttribute("class")||"")}ClassList.prototype={add:function add(name){var i=this._names.indexOf(name);if(i<0){this._names.push(name);this._node.setAttribute("class",this._names.join(" "))}},remove:function remove(name){var i=this._names.indexOf(name);if(i>=0){this._names.splice(i,1);this._node.setAttribute("class",this._names.join(" "))}},contains:function contains(name){return this._names.indexOf(name)>=0}};function classedAdd(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n){list.add(names[i])}}function classedRemove(node,names){var list=classList(node),i=-1,n=names.length;while(++i<n){list.remove(names[i])}}function classedTrue(names){return function(){classedAdd(this,names)}}function classedFalse(names){return function(){classedRemove(this,names)}}function classedFunction(names,value){return function(){(value.apply(this,arguments)?classedAdd:classedRemove)(this,names)}}function selection_classed(name,value){var names=classArray(name+"");if(arguments.length<2){var list=classList(this.node()),i=-1,n=names.length;while(++i<n){if(!list.contains(names[i]))return false}return true}return this.each((typeof value==="function"?classedFunction:value?classedTrue:classedFalse)(names,value))}function textRemove(){this.textContent=""}function textConstant(value){return function(){this.textContent=value}}function textFunction(value){return function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v}}function selection_text(value){return arguments.length?this.each(value==null?textRemove:(typeof value==="function"?textFunction:textConstant)(value)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(value){return function(){this.innerHTML=value}}function htmlFunction(value){return function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v}}function selection_html(value){return arguments.length?this.each(value==null?htmlRemove:(typeof value==="function"?htmlFunction:htmlConstant)(value)):this.node().innerHTML}function raise(){if(this.nextSibling)this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){if(this.previousSibling)this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(name){var create=typeof name==="function"?name:creator(name);return this.select(function(){return this.appendChild(create.apply(this,arguments))})}function constantNull(){return null}function selection_insert(name,before){var create=typeof name==="function"?name:creator(name),select=before==null?constantNull:typeof before==="function"?before:selector(before);return this.select(function(){return this.insertBefore(create.apply(this,arguments),select.apply(this,arguments)||null)})}function remove(){var parent=this.parentNode;if(parent)parent.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){return this.parentNode.insertBefore(this.cloneNode(false),this.nextSibling)}function selection_cloneDeep(){return this.parentNode.insertBefore(this.cloneNode(true),this.nextSibling)}function selection_clone(deep){return this.select(deep?selection_cloneDeep:selection_cloneShallow)}function selection_datum(value){return arguments.length?this.property("__data__",value):this.node().__data__}var filterEvents={};var event$1=null;if(typeof document!=="undefined"){var element=document.documentElement;if(!("onmouseenter"in element)){filterEvents={mouseenter:"mouseover",mouseleave:"mouseout"}}}function filterContextListener(listener,index,group){listener=contextListener(listener,index,group);return function(event){var related=event.relatedTarget;if(!related||related!==this&&!(related.compareDocumentPosition(this)&8)){listener.call(this,event)}}}function contextListener(listener,index,group){return function(event1){var event0=event$1;event$1=event1;try{listener.call(this,this.__data__,index,group)}finally{event$1=event0}}}function parseTypenames(typenames){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0)name=t.slice(i+1),t=t.slice(0,i);return{type:t,name:name}})}function onRemove(typename){return function(){var on=this.__on;if(!on)return;for(var j=0,i=-1,m=on.length,o;j<m;++j){if(o=on[j],(!typename.type||o.type===typename.type)&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture)}else{on[++i]=o}}if(++i)on.length=i;else delete this.__on}}function onAdd(typename,value,capture){var wrap=filterEvents.hasOwnProperty(typename.type)?filterContextListener:contextListener;return function(d,i,group){var on=this.__on,o,listener=wrap(value,i,group);if(on)for(var j=0,m=on.length;j<m;++j){if((o=on[j]).type===typename.type&&o.name===typename.name){this.removeEventListener(o.type,o.listener,o.capture);this.addEventListener(o.type,o.listener=listener,o.capture=capture);o.value=value;return}}this.addEventListener(typename.type,listener,capture);o={type:typename.type,name:typename.name,value:value,listener:listener,capture:capture};if(!on)this.__on=[o];else on.push(o)}}function selection_on(typename,value,capture){var typenames=parseTypenames(typename+""),i,n=typenames.length,t;if(arguments.length<2){var on=this.node().__on;if(on)for(var j=0,m=on.length,o;j<m;++j){for(i=0,o=on[j];i<n;++i){if((t=typenames[i]).type===o.type&&t.name===o.name){return o.value}}}return}on=value?onAdd:onRemove;if(capture==null)capture=false;for(i=0;i<n;++i){this.each(on(typenames[i],value,capture))}return this}function customEvent(event1,listener,that,args){var event0=event$1;event1.sourceEvent=event$1;event$1=event1;try{return listener.apply(that,args)}finally{event$1=event0}}function dispatchEvent(node,type,params){var window=defaultView(node),event=window.CustomEvent;if(typeof event==="function"){event=new event(type,params)}else{event=window.document.createEvent("Event");if(params)event.initEvent(type,params.bubbles,params.cancelable),event.detail=params.detail;else event.initEvent(type,false,false)}node.dispatchEvent(event)}function dispatchConstant(type,params){return function(){return dispatchEvent(this,type,params)}}function dispatchFunction(type,params){return function(){return dispatchEvent(this,type,params.apply(this,arguments))}}function selection_dispatch(type,params){return this.each((typeof params==="function"?dispatchFunction:dispatchConstant)(type,params))}var root=[null];function Selection(groups,parents){this._groups=groups;this._parents=parents}function selection(){return new Selection([[document.documentElement]],root)}Selection.prototype=selection.prototype={constructor:Selection,select:selection_select,selectAll:selection_selectAll,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch};function select(selector){return typeof selector==="string"?new Selection([[document.querySelector(selector)]],[document.documentElement]):new Selection([[selector]],root)}function create(name){return select(creator(name).call(document.documentElement))}var nextId=0;function local(){return new Local}function Local(){this._="@"+(++nextId).toString(36)}Local.prototype=local.prototype={constructor:Local,get:function get(node){var id=this._;while(!(id in node)){if(!(node=node.parentNode))return}return node[id]},set:function set(node,value){return node[this._]=value},remove:function remove(node){return this._ in node&&delete node[this._]},toString:function toString(){return this._}};function sourceEvent(){var current=event$1,source;while(source=current.sourceEvent){current=source}return current}function point(node,event){var svg=node.ownerSVGElement||node;if(svg.createSVGPoint){var point=svg.createSVGPoint();point.x=event.clientX,point.y=event.clientY;point=point.matrixTransform(node.getScreenCTM().inverse());return[point.x,point.y]}var rect=node.getBoundingClientRect();return[event.clientX-rect.left-node.clientLeft,event.clientY-rect.top-node.clientTop]}function mouse(node){var event=sourceEvent();if(event.changedTouches)event=event.changedTouches[0];return point(node,event)}function selectAll(selector){return typeof selector==="string"?new Selection([document.querySelectorAll(selector)],[document.documentElement]):new Selection([selector==null?[]:selector],root)}function touch(node,touches,identifier){if(arguments.length<3)identifier=touches,touches=sourceEvent().changedTouches;for(var i=0,n=touches?touches.length:0,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return point(node,touch)}}return null}function touches(node,touches){if(touches==null)touches=sourceEvent().touches;for(var i=0,n=touches?touches.length:0,points=new Array(n);i<n;++i){points[i]=point(node,touches[i])}return points}var src$2=Object.freeze({create:create,creator:creator,local:local,matcher:matcher,mouse:mouse,namespace:namespace,namespaces:namespaces,clientPoint:point,select:select,selectAll:selectAll,selection:selection,selector:selector,selectorAll:selectorAll,style:styleValue,touch:touch,touches:touches,window:defaultView,get event(){return event$1},customEvent:customEvent});var noop$3={value:function value(){}};function dispatch(){for(var i=0,n=arguments.length,_={},t;i<n;++i){if(!(t=arguments[i]+"")||t in _)throw new Error("illegal type: "+t);_[t]=[]}return new Dispatch(_)}function Dispatch(_){this._=_}function parseTypenames$1(typenames,types){return typenames.trim().split(/^|\s+/).map(function(t){var name="",i=t.indexOf(".");if(i>=0)name=t.slice(i+1),t=t.slice(0,i);if(t&&!types.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:name}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function on(typename,callback){var _=this._,T=parseTypenames$1(typename+"",_),t,i=-1,n=T.length;if(arguments.length<2){while(++i<n){if((t=(typename=T[i]).type)&&(t=get(_[t],typename.name)))return t}return}if(callback!=null&&typeof callback!=="function")throw new Error("invalid callback: "+callback);while(++i<n){if(t=(typename=T[i]).type)_[t]=set(_[t],typename.name,callback);else if(callback==null)for(t in _){_[t]=set(_[t],typename.name,null)}}return this},copy:function copy(){var copy={},_=this._;for(var t in _){copy[t]=_[t].slice()}return new Dispatch(copy)},call:function call(type,that){if((n=arguments.length-2)>0)for(var args=new Array(n),i=0,n,t;i<n;++i){args[i]=arguments[i+2]}if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(t=this._[type],i=0,n=t.length;i<n;++i){t[i].value.apply(that,args)}},apply:function apply(type,that,args){if(!this._.hasOwnProperty(type))throw new Error("unknown type: "+type);for(var t=this._[type],i=0,n=t.length;i<n;++i){t[i].value.apply(that,args)}}};function get(type,name){for(var i=0,n=type.length,c;i<n;++i){if((c=type[i]).name===name){return c.value}}}function set(type,name,callback){for(var i=0,n=type.length;i<n;++i){if(type[i].name===name){type[i]=noop$3,type=type.slice(0,i).concat(type.slice(i+1));break}}if(callback!=null)type.push({name:name,value:callback});return type}var frame=0,timeout=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=(typeof performance==="undefined"?"undefined":_typeof(performance))==="object"&&performance.now?performance:Date,setFrame=(typeof window==="undefined"?"undefined":_typeof(window))==="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(f){setTimeout(f,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function restart(callback,delay,time){if(typeof callback!=="function")throw new TypeError("callback is not a function");time=(time==null?now():+time)+(delay==null?0:+delay);if(!this._next&&taskTail!==this){if(taskTail)taskTail._next=this;else taskHead=this;taskTail=this}this._call=callback;this._time=time;sleep()},stop:function stop(){if(this._call){this._call=null;this._time=Infinity;sleep()}}};function timer(callback,delay,time){var t=new Timer;t.restart(callback,delay,time);return t}function timerFlush(){now();++frame;var t=taskHead,e;while(t){if((e=clockNow-t._time)>=0)t._call.call(null,e);t=t._next}--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew;frame=timeout=0;try{timerFlush()}finally{frame=0;nap();clockNow=0}}function poke(){var now=clock.now(),delay=now-clockLast;if(delay>pokeDelay)clockSkew-=delay,clockLast=now}function nap(){var t0,t1=taskHead,t2,time=Infinity;while(t1){if(t1._call){if(time>t1._time)time=t1._time;t0=t1,t1=t1._next}else{t2=t1._next,t1._next=null;t1=t0?t0._next=t2:taskHead=t2}}taskTail=t0;sleep(time)}function sleep(time){if(frame)return;if(timeout)timeout=clearTimeout(timeout);var delay=time-clockNow;if(delay>24){if(time<Infinity)timeout=setTimeout(wake,time-clock.now()-clockSkew);if(interval)interval=clearInterval(interval)}else{if(!interval)clockLast=clock.now(),interval=setInterval(poke,pokeDelay);frame=1,setFrame(wake)}}function timeout$1(callback,delay,time){var t=new Timer;delay=delay==null?0:+delay;t.restart(function(elapsed){t.stop();callback(elapsed+delay)},delay,time);return t}var emptyOn=dispatch("start","end","cancel","interrupt");var emptyTween=[];var CREATED=0;var SCHEDULED=1;var STARTING=2;var STARTED=3;var RUNNING=4;var ENDING=5;var ENDED=6;function schedule(node,name,id,index,group,timing){var schedules=node.__transition;if(!schedules)node.__transition={};else if(id in schedules)return;create$1(node,id,{name:name,index:index,group:group,on:emptyOn,tween:emptyTween,time:timing.time,delay:timing.delay,duration:timing.duration,ease:timing.ease,timer:null,state:CREATED})}function init(node,id){var schedule=get$1(node,id);if(schedule.state>CREATED)throw new Error("too late; already scheduled");return schedule}function set$1(node,id){var schedule=get$1(node,id);if(schedule.state>STARTED)throw new Error("too late; already running");return schedule}function get$1(node,id){var schedule=node.__transition;if(!schedule||!(schedule=schedule[id]))throw new Error("transition not found");return schedule}function create$1(node,id,self){var schedules=node.__transition,tween;schedules[id]=self;self.timer=timer(schedule,0,self.time);function schedule(elapsed){self.state=SCHEDULED;self.timer.restart(start,self.delay,self.time);if(self.delay<=elapsed)start(elapsed-self.delay)}function start(elapsed){var i,j,n,o;if(self.state!==SCHEDULED)return stop();for(i in schedules){o=schedules[i];if(o.name!==self.name)continue;if(o.state===STARTED)return timeout$1(start);if(o.state===RUNNING){o.state=ENDED;o.timer.stop();o.on.call("interrupt",node,node.__data__,o.index,o.group);delete schedules[i]}else if(+i<id){o.state=ENDED;o.timer.stop();o.on.call("cancel",node,node.__data__,o.index,o.group);delete schedules[i]}}timeout$1(function(){if(self.state===STARTED){self.state=RUNNING;self.timer.restart(tick,self.delay,self.time);tick(elapsed)}});self.state=STARTING;self.on.call("start",node,node.__data__,self.index,self.group);if(self.state!==STARTING)return;self.state=STARTED;tween=new Array(n=self.tween.length);for(i=0,j=-1;i<n;++i){if(o=self.tween[i].value.call(node,node.__data__,self.index,self.group)){tween[++j]=o}}tween.length=j+1}function tick(elapsed){var t=elapsed<self.duration?self.ease.call(null,elapsed/self.duration):(self.timer.restart(stop),self.state=ENDING,1),i=-1,n=tween.length;while(++i<n){tween[i].call(node,t)}if(self.state===ENDING){self.on.call("end",node,node.__data__,self.index,self.group);stop()}}function stop(){self.state=ENDED;self.timer.stop();delete schedules[id];for(var i in schedules){return}delete node.__transition}}function interrupt(node,name){var schedules=node.__transition,schedule,active,empty=true,i;if(!schedules)return;name=name==null?null:name+"";for(i in schedules){if((schedule=schedules[i]).name!==name){empty=false;continue}active=schedule.state>STARTING&&schedule.state<ENDING;schedule.state=ENDED;schedule.timer.stop();schedule.on.call(active?"interrupt":"cancel",node,node.__data__,schedule.index,schedule.group);delete schedules[i]}if(empty)delete node.__transition}function selection_interrupt(name){return this.each(function(){interrupt(this,name)})}function define(constructor,factory,prototype){constructor.prototype=factory.prototype=prototype;prototype.constructor=constructor}function extend(parent,definition){var prototype=Object.create(parent.prototype);for(var key in definition){prototype[key]=definition[key]}return prototype}function Color(){}var _darker=.7;var _brighter=1/_darker;var reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex3=/^#([0-9a-f]{3})$/,reHex6=/^#([0-9a-f]{6})$/,reRgbInteger=new RegExp("^rgb\\("+[reI,reI,reI]+"\\)$"),reRgbPercent=new RegExp("^rgb\\("+[reP,reP,reP]+"\\)$"),reRgbaInteger=new RegExp("^rgba\\("+[reI,reI,reI,reN]+"\\)$"),reRgbaPercent=new RegExp("^rgba\\("+[reP,reP,reP,reN]+"\\)$"),reHslPercent=new RegExp("^hsl\\("+[reN,reP,reP]+"\\)$"),reHslaPercent=new RegExp("^hsla\\("+[reN,reP,reP,reN]+"\\)$");var named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{displayable:function displayable(){return this.rgb().displayable()},hex:function hex(){return this.rgb().hex()},toString:function toString(){return this.rgb()+""}});function color(format){var m;format=(format+"").trim().toLowerCase();return(m=reHex3.exec(format))?(m=parseInt(m[1],16),new Rgb(m>>8&15|m>>4&240,m>>4&15|m&240,(m&15)<<4|m&15,1)):(m=reHex6.exec(format))?rgbn(parseInt(m[1],16)):(m=reRgbInteger.exec(format))?new Rgb(m[1],m[2],m[3],1):(m=reRgbPercent.exec(format))?new Rgb(m[1]*255/100,m[2]*255/100,m[3]*255/100,1):(m=reRgbaInteger.exec(format))?rgba(m[1],m[2],m[3],m[4]):(m=reRgbaPercent.exec(format))?rgba(m[1]*255/100,m[2]*255/100,m[3]*255/100,m[4]):(m=reHslPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,1):(m=reHslaPercent.exec(format))?hsla(m[1],m[2]/100,m[3]/100,m[4]):named.hasOwnProperty(format)?rgbn(named[format]):format==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(n){return new Rgb(n>>16&255,n>>8&255,n&255,1)}function rgba(r,g,b,a){if(a<=0)r=g=b=NaN;return new Rgb(r,g,b,a)}function rgbConvert(o){if(!(o instanceof Color))o=color(o);if(!o)return new Rgb;o=o.rgb();return new Rgb(o.r,o.g,o.b,o.opacity)}function rgb(r,g,b,opacity){return arguments.length===1?rgbConvert(r):new Rgb(r,g,b,opacity==null?1:opacity)}function Rgb(r,g,b,opacity){this.r=+r;this.g=+g;this.b=+b;this.opacity=+opacity}define(Rgb,rgb,extend(Color,{brighter:function brighter(k){k=k==null?_brighter:Math.pow(_brighter,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},darker:function darker(k){k=k==null?_darker:Math.pow(_darker,k);return new Rgb(this.r*k,this.g*k,this.b*k,this.opacity)},rgb:function rgb(){return this},displayable:function displayable(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function hex(){return"#"+_hex(this.r)+_hex(this.g)+_hex(this.b)},toString:function toString(){var a=this.opacity;a=isNaN(a)?1:Math.max(0,Math.min(1,a));return(a===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(a===1?")":", "+a+")")}}));function _hex(value){value=Math.max(0,Math.min(255,Math.round(value)||0));return(value<16?"0":"")+value.toString(16)}function hsla(h,s,l,a){if(a<=0)h=s=l=NaN;else if(l<=0||l>=1)h=s=NaN;else if(s<=0)h=NaN;return new Hsl(h,s,l,a)}function hslConvert(o){if(o instanceof Hsl)return new Hsl(o.h,o.s,o.l,o.opacity);if(!(o instanceof Color))o=color(o);if(!o)return new Hsl;if(o instanceof Hsl)return o;o=o.rgb();var r=o.r/255,g=o.g/255,b=o.b/255,min=Math.min(r,g,b),max=Math.max(r,g,b),h=NaN,s=max-min,l=(max+min)/2;if(s){if(r===max)h=(g-b)/s+(g<b)*6;else if(g===max)h=(b-r)/s+2;else h=(r-g)/s+4;s/=l<.5?max+min:2-max-min;h*=60}else{s=l>0&&l<1?0:h}return new Hsl(h,s,l,o.opacity)}function hsl(h,s,l,opacity){return arguments.length===1?hslConvert(h):new Hsl(h,s,l,opacity==null?1:opacity)}function Hsl(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Hsl,hsl,extend(Color,{brighter:function brighter(k){k=k==null?_brighter:Math.pow(_brighter,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},darker:function darker(k){k=k==null?_darker:Math.pow(_darker,k);return new Hsl(this.h,this.s,this.l*k,this.opacity)},rgb:function rgb(){var h=this.h%360+(this.h<0)*360,s=isNaN(h)||isNaN(this.s)?0:this.s,l=this.l,m2=l+(l<.5?l:1-l)*s,m1=2*l-m2;return new Rgb(hsl2rgb(h>=240?h-240:h+120,m1,m2),hsl2rgb(h,m1,m2),hsl2rgb(h<120?h+240:h-120,m1,m2),this.opacity)},displayable:function displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));function hsl2rgb(h,m1,m2){return(h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1)*255}var deg2rad=Math.PI/180;var rad2deg=180/Math.PI;var K=18,Xn=.96422,Yn=1,Zn=.82521,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1;function labConvert(o){if(o instanceof Lab)return new Lab(o.l,o.a,o.b,o.opacity);if(o instanceof Hcl){if(isNaN(o.h))return new Lab(o.l,0,0,o.opacity);var h=o.h*deg2rad;return new Lab(o.l,Math.cos(h)*o.c,Math.sin(h)*o.c,o.opacity)}if(!(o instanceof Rgb))o=rgbConvert(o);var r=rgb2lrgb(o.r),g=rgb2lrgb(o.g),b=rgb2lrgb(o.b),y=xyz2lab((.2225045*r+.7168786*g+.0606169*b)/Yn),x,z;if(r===g&&g===b)x=z=y;else{x=xyz2lab((.4360747*r+.3850649*g+.1430804*b)/Xn);z=xyz2lab((.0139322*r+.0971045*g+.7141733*b)/Zn)}return new Lab(116*y-16,500*(x-y),200*(y-z),o.opacity)}function gray(l,opacity){return new Lab(l,0,0,opacity==null?1:opacity)}function lab(l,a,b,opacity){return arguments.length===1?labConvert(l):new Lab(l,a,b,opacity==null?1:opacity)}function Lab(l,a,b,opacity){this.l=+l;this.a=+a;this.b=+b;this.opacity=+opacity}define(Lab,lab,extend(Color,{brighter:function brighter(k){return new Lab(this.l+K*(k==null?1:k),this.a,this.b,this.opacity)},darker:function darker(k){return new Lab(this.l-K*(k==null?1:k),this.a,this.b,this.opacity)},rgb:function rgb(){var y=(this.l+16)/116,x=isNaN(this.a)?y:y+this.a/500,z=isNaN(this.b)?y:y-this.b/200;x=Xn*lab2xyz(x);y=Yn*lab2xyz(y);z=Zn*lab2xyz(z);return new Rgb(lrgb2rgb(3.1338561*x-1.6168667*y-.4906146*z),lrgb2rgb(-.9787684*x+1.9161415*y+.033454*z),lrgb2rgb(.0719453*x-.2289914*y+1.4052427*z),this.opacity)}}));function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function lrgb2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2lrgb(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function hclConvert(o){if(o instanceof Hcl)return new Hcl(o.h,o.c,o.l,o.opacity);if(!(o instanceof Lab))o=labConvert(o);if(o.a===0&&o.b===0)return new Hcl(NaN,0,o.l,o.opacity);var h=Math.atan2(o.b,o.a)*rad2deg;return new Hcl(h<0?h+360:h,Math.sqrt(o.a*o.a+o.b*o.b),o.l,o.opacity)}function lch(l,c,h,opacity){return arguments.length===1?hclConvert(l):new Hcl(h,c,l,opacity==null?1:opacity)}function hcl(h,c,l,opacity){return arguments.length===1?hclConvert(h):new Hcl(h,c,l,opacity==null?1:opacity)}function Hcl(h,c,l,opacity){this.h=+h;this.c=+c;this.l=+l;this.opacity=+opacity}define(Hcl,hcl,extend(Color,{brighter:function brighter(k){return new Hcl(this.h,this.c,this.l+K*(k==null?1:k),this.opacity)},darker:function darker(k){return new Hcl(this.h,this.c,this.l-K*(k==null?1:k),this.opacity)},rgb:function rgb(){return labConvert(this).rgb()}}));var A=-.14861,B=+1.78277,C=-.29227,D=-.90649,E=+1.97294,ED=E*D,EB=E*B,BC_DA=B*C-D*A;function cubehelixConvert(o){if(o instanceof Cubehelix)return new Cubehelix(o.h,o.s,o.l,o.opacity);if(!(o instanceof Rgb))o=rgbConvert(o);var r=o.r/255,g=o.g/255,b=o.b/255,l=(BC_DA*b+ED*r-EB*g)/(BC_DA+ED-EB),bl=b-l,k=(E*(g-l)-C*bl)/D,s=Math.sqrt(k*k+bl*bl)/(E*l*(1-l)),h=s?Math.atan2(k,bl)*rad2deg-120:NaN;return new Cubehelix(h<0?h+360:h,s,l,o.opacity)}function cubehelix(h,s,l,opacity){return arguments.length===1?cubehelixConvert(h):new Cubehelix(h,s,l,opacity==null?1:opacity)}function Cubehelix(h,s,l,opacity){this.h=+h;this.s=+s;this.l=+l;this.opacity=+opacity}define(Cubehelix,cubehelix,extend(Color,{brighter:function brighter(k){k=k==null?_brighter:Math.pow(_brighter,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},darker:function darker(k){k=k==null?_darker:Math.pow(_darker,k);return new Cubehelix(this.h,this.s,this.l*k,this.opacity)},rgb:function rgb(){var h=isNaN(this.h)?0:(this.h+120)*deg2rad,l=+this.l,a=isNaN(this.s)?0:this.s*l*(1-l),cosh=Math.cos(h),sinh=Math.sin(h);return new Rgb(255*(l+a*(A*cosh+B*sinh)),255*(l+a*(C*cosh+D*sinh)),255*(l+a*(E*cosh)),this.opacity)}}));var src$3=Object.freeze({color:color,rgb:rgb,hsl:hsl,lab:lab,hcl:hcl,lch:lch,gray:gray,cubehelix:cubehelix});function constant$4(x){return function(){return x}}function linear(a,d){return function(t){return a+t*d}}function exponential(a,b,y){return a=Math.pow(a,y),b=Math.pow(b,y)-a,y=1/y,function(t){return Math.pow(a+t*b,y)}}function hue(a,b){var d=b-a;return d?linear(a,d>180||d<-180?d-360*Math.round(d/360):d):constant$4(isNaN(a)?b:a)}function gamma(y){return(y=+y)===1?nogamma:function(a,b){return b-a?exponential(a,b,y):constant$4(isNaN(a)?b:a)}}function nogamma(a,b){var d=b-a;return d?linear(a,d):constant$4(isNaN(a)?b:a)}var interpolateRgb=function rgbGamma(y){var color=gamma(y);function rgb$1(start,end){var r=color((start=rgb(start)).r,(end=rgb(end)).r),g=color(start.g,end.g),b=color(start.b,end.b),opacity=nogamma(start.opacity,end.opacity);return function(t){start.r=r(t);start.g=g(t);start.b=b(t);start.opacity=opacity(t);return start+""}}rgb$1.gamma=rgbGamma;return rgb$1}(1);function array$1(a,b){var nb=b?b.length:0,na=a?Math.min(nb,a.length):0,x=new Array(na),c=new Array(nb),i;for(i=0;i<na;++i){x[i]=interpolate(a[i],b[i])}for(;i<nb;++i){c[i]=b[i]}return function(t){for(i=0;i<na;++i){c[i]=x[i](t)}return c}}function date(a,b){var d=new Date;return a=+a,b-=a,function(t){return d.setTime(a+b*t),d}}function interpolateNumber(a,b){return a=+a,b-=a,function(t){return a+b*t}}function object(a,b){var i={},c={},k;if(a===null||_typeof(a)!=="object")a={};if(b===null||_typeof(b)!=="object")b={};for(k in b){if(k in a){i[k]=interpolate(a[k],b[k])}else{c[k]=b[k]}}return function(t){for(k in i){c[k]=i[k](t)}return c}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(b){return function(){return b}}function one(b){return function(t){return b(t)+""}}function interpolateString(a,b){var bi=reA.lastIndex=reB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=reA.exec(a))&&(bm=reB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs}if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm}else{s[++i]=null;q.push({i:i,x:interpolateNumber(am,bm)})}bi=reB.lastIndex}if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs}return s.length<2?q[0]?one(q[0].x):zero(b):(b=q.length,function(t){for(var i=0,o;i<b;++i){s[(o=q[i]).i]=o.x(t)}return s.join("")})}function interpolate(a,b){var t=_typeof(b),c;return b==null||t==="boolean"?constant$4(b):(t==="number"?interpolateNumber:t==="string"?(c=color(b))?(b=c,interpolateRgb):interpolateString:b instanceof color?interpolateRgb:b instanceof Date?date:Array.isArray(b)?array$1:typeof b.valueOf!=="function"&&typeof b.toString!=="function"||isNaN(b)?object:interpolateNumber)(a,b)}function interpolateRound(a,b){return a=+a,b-=a,function(t){return Math.round(a+b*t)}}var degrees=180/Math.PI;var identity$3={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(a,b,c,d,e,f){var scaleX,scaleY,skewX;if(scaleX=Math.sqrt(a*a+b*b))a/=scaleX,b/=scaleX;if(skewX=a*c+b*d)c-=a*skewX,d-=b*skewX;if(scaleY=Math.sqrt(c*c+d*d))c/=scaleY,d/=scaleY,skewX/=scaleY;if(a*d<b*c)a=-a,b=-b,skewX=-skewX,scaleX=-scaleX;return{translateX:e,translateY:f,rotate:Math.atan2(b,a)*degrees,skewX:Math.atan(skewX)*degrees,scaleX:scaleX,scaleY:scaleY}}var cssNode,cssRoot,cssView,svgNode;function parseCss(value){if(value==="none")return identity$3;if(!cssNode)cssNode=document.createElement("DIV"),cssRoot=document.documentElement,cssView=document.defaultView;cssNode.style.transform=value;value=cssView.getComputedStyle(cssRoot.appendChild(cssNode),null).getPropertyValue("transform");cssRoot.removeChild(cssNode);value=value.slice(7,-1).split(",");return decompose(+value[0],+value[1],+value[2],+value[3],+value[4],+value[5])}function parseSvg(value){if(value==null)return identity$3;if(!svgNode)svgNode=document.createElementNS("http://www.w3.org/2000/svg","g");svgNode.setAttribute("transform",value);if(!(value=svgNode.transform.baseVal.consolidate()))return identity$3;value=value.matrix;return decompose(value.a,value.b,value.c,value.d,value.e,value.f)}function interpolateTransform(parse,pxComma,pxParen,degParen){function pop(s){return s.length?s.pop()+" ":""}function translate(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push("translate(",null,pxComma,null,pxParen);q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else if(xb||yb){s.push("translate("+xb+pxComma+yb+pxParen)}}function rotate(a,b,s,q){if(a!==b){if(a-b>180)b+=360;else if(b-a>180)a+=360;q.push({i:s.push(pop(s)+"rotate(",null,degParen)-2,x:interpolateNumber(a,b)})}else if(b){s.push(pop(s)+"rotate("+b+degParen)}}function skewX(a,b,s,q){if(a!==b){q.push({i:s.push(pop(s)+"skewX(",null,degParen)-2,x:interpolateNumber(a,b)})}else if(b){s.push(pop(s)+"skewX("+b+degParen)}}function scale(xa,ya,xb,yb,s,q){if(xa!==xb||ya!==yb){var i=s.push(pop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:interpolateNumber(xa,xb)},{i:i-2,x:interpolateNumber(ya,yb)})}else if(xb!==1||yb!==1){s.push(pop(s)+"scale("+xb+","+yb+")")}}return function(a,b){var s=[],q=[];a=parse(a),b=parse(b);translate(a.translateX,a.translateY,b.translateX,b.translateY,s,q);rotate(a.rotate,b.rotate,s,q);skewX(a.skewX,b.skewX,s,q);scale(a.scaleX,a.scaleY,b.scaleX,b.scaleY,s,q);a=b=null;return function(t){var i=-1,n=q.length,o;while(++i<n){s[(o=q[i]).i]=o.x(t)}return s.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)");var interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");var rho=Math.SQRT2;function cubehelix$1(hue){return function cubehelixGamma(y){y=+y;function cubehelix$1(start,end){var h=hue((start=cubehelix(start)).h,(end=cubehelix(end)).h),s=nogamma(start.s,end.s),l=nogamma(start.l,end.l),opacity=nogamma(start.opacity,end.opacity);return function(t){start.h=h(t);start.s=s(t);start.l=l(Math.pow(t,y));start.opacity=opacity(t);return start+""}}cubehelix$1.gamma=cubehelixGamma;return cubehelix$1}(1)}cubehelix$1(hue);var cubehelixLong=cubehelix$1(nogamma);function tweenRemove(id,name){var tween0,tween1;return function(){var schedule=set$1(this,id),tween=schedule.tween;if(tween!==tween0){tween1=tween0=tween;for(var i=0,n=tween1.length;i<n;++i){if(tween1[i].name===name){tween1=tween1.slice();tween1.splice(i,1);break}}}schedule.tween=tween1}}function tweenFunction(id,name,value){var tween0,tween1;if(typeof value!=="function")throw new Error;return function(){var schedule=set$1(this,id),tween=schedule.tween;if(tween!==tween0){tween1=(tween0=tween).slice();for(var t={name:name,value:value},i=0,n=tween1.length;i<n;++i){if(tween1[i].name===name){tween1[i]=t;break}}if(i===n)tween1.push(t)}schedule.tween=tween1}}function transition_tween(name,value){var id=this._id;name+="";if(arguments.length<2){var tween=get$1(this.node(),id).tween;for(var i=0,n=tween.length,t;i<n;++i){if((t=tween[i]).name===name){return t.value}}return null}return this.each((value==null?tweenRemove:tweenFunction)(id,name,value))}function tweenValue(transition,name,value){var id=transition._id;transition.each(function(){var schedule=set$1(this,id);(schedule.value||(schedule.value={}))[name]=value.apply(this,arguments)});return function(node){return get$1(node,id).value[name]}}function interpolate$1(a,b){var c;return(typeof b==="number"?interpolateNumber:b instanceof color?interpolateRgb:(c=color(b))?(b=c,interpolateRgb):interpolateString)(a,b)}function attrRemove$1(name){return function(){this.removeAttribute(name)}}function attrRemoveNS$1(fullname){return function(){this.removeAttributeNS(fullname.space,fullname.local)}}function attrConstant$1(name,interpolate,value1){var string00,string1=value1+"",interpolate0;return function(){var string0=this.getAttribute(name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}function attrConstantNS$1(fullname,interpolate,value1){var string00,string1=value1+"",interpolate0;return function(){var string0=this.getAttributeNS(fullname.space,fullname.local);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}function attrFunction$1(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0,value1=value(this),string1;if(value1==null)return void this.removeAttribute(name);string0=this.getAttribute(name);string1=value1+"";return string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1))}}function attrFunctionNS$1(fullname,interpolate,value){var string00,string10,interpolate0;return function(){var string0,value1=value(this),string1;if(value1==null)return void this.removeAttributeNS(fullname.space,fullname.local);string0=this.getAttributeNS(fullname.space,fullname.local);string1=value1+"";return string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1))}}function transition_attr(name,value){var fullname=namespace(name),i=fullname==="transform"?interpolateTransformSvg:interpolate$1;return this.attrTween(name,typeof value==="function"?(fullname.local?attrFunctionNS$1:attrFunction$1)(fullname,i,tweenValue(this,"attr."+name,value)):value==null?(fullname.local?attrRemoveNS$1:attrRemove$1)(fullname):(fullname.local?attrConstantNS$1:attrConstant$1)(fullname,i,value))}function attrInterpolate(name,i){return function(t){this.setAttribute(name,i(t))}}function attrInterpolateNS(fullname,i){return function(t){this.setAttributeNS(fullname.space,fullname.local,i(t))}}function attrTweenNS(fullname,value){var t0,i0;function tween(){var i=value.apply(this,arguments);if(i!==i0)t0=(i0=i)&&attrInterpolateNS(fullname,i);return t0}tween._value=value;return tween}function attrTween(name,value){var t0,i0;function tween(){var i=value.apply(this,arguments);if(i!==i0)t0=(i0=i)&&attrInterpolate(name,i);return t0}tween._value=value;return tween}function transition_attrTween(name,value){var key="attr."+name;if(arguments.length<2)return(key=this.tween(key))&&key._value;if(value==null)return this.tween(key,null);if(typeof value!=="function")throw new Error;var fullname=namespace(name);return this.tween(key,(fullname.local?attrTweenNS:attrTween)(fullname,value))}function delayFunction(id,value){return function(){init(this,id).delay=+value.apply(this,arguments)}}function delayConstant(id,value){return value=+value,function(){init(this,id).delay=value}}function transition_delay(value){var id=this._id;return arguments.length?this.each((typeof value==="function"?delayFunction:delayConstant)(id,value)):get$1(this.node(),id).delay}function durationFunction(id,value){return function(){set$1(this,id).duration=+value.apply(this,arguments)}}function durationConstant(id,value){return value=+value,function(){set$1(this,id).duration=value}}function transition_duration(value){var id=this._id;return arguments.length?this.each((typeof value==="function"?durationFunction:durationConstant)(id,value)):get$1(this.node(),id).duration}function easeConstant(id,value){if(typeof value!=="function")throw new Error;return function(){set$1(this,id).ease=value}}function transition_ease(value){var id=this._id;return arguments.length?this.each(easeConstant(id,value)):get$1(this.node(),id).ease}function transition_filter(match){if(typeof match!=="function")match=matcher(match);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=[],node,i=0;i<n;++i){if((node=group[i])&&match.call(node,node.__data__,i,group)){subgroup.push(node)}}}return new Transition(subgroups,this._parents,this._name,this._id)}function transition_merge(transition){if(transition._id!==this._id)throw new Error;for(var groups0=this._groups,groups1=transition._groups,m0=groups0.length,m1=groups1.length,m=Math.min(m0,m1),merges=new Array(m0),j=0;j<m;++j){for(var group0=groups0[j],group1=groups1[j],n=group0.length,merge=merges[j]=new Array(n),node,i=0;i<n;++i){if(node=group0[i]||group1[i]){merge[i]=node}}}for(;j<m0;++j){merges[j]=groups0[j]}return new Transition(merges,this._parents,this._name,this._id)}function start(name){return(name+"").trim().split(/^|\s+/).every(function(t){var i=t.indexOf(".");if(i>=0)t=t.slice(0,i);return!t||t==="start"})}function onFunction(id,name,listener){var on0,on1,sit=start(name)?init:set$1;return function(){var schedule=sit(this,id),on=schedule.on;if(on!==on0)(on1=(on0=on).copy()).on(name,listener);schedule.on=on1}}function transition_on(name,listener){var id=this._id;return arguments.length<2?get$1(this.node(),id).on.on(name):this.each(onFunction(id,name,listener))}function removeFunction(id){return function(){var parent=this.parentNode;for(var i in this.__transition){if(+i!==id)return}if(parent)parent.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(select){var name=this._name,id=this._id;if(typeof select!=="function")select=selector(select);for(var groups=this._groups,m=groups.length,subgroups=new Array(m),j=0;j<m;++j){for(var group=groups[j],n=group.length,subgroup=subgroups[j]=new Array(n),node,subnode,i=0;i<n;++i){if((node=group[i])&&(subnode=select.call(node,node.__data__,i,group))){if("__data__"in node)subnode.__data__=node.__data__;subgroup[i]=subnode;schedule(subgroup[i],name,id,i,subgroup,get$1(node,id))}}}return new Transition(subgroups,this._parents,name,id)}function transition_selectAll(select){var name=this._name,id=this._id;if(typeof select!=="function")select=selectorAll(select);for(var groups=this._groups,m=groups.length,subgroups=[],parents=[],j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){for(var children=select.call(node,node.__data__,i,group),child,inherit=get$1(node,id),k=0,l=children.length;k<l;++k){if(child=children[k]){schedule(child,name,id,k,children,inherit)}}subgroups.push(children);parents.push(node)}}}return new Transition(subgroups,parents,name,id)}var Selection$1=selection.prototype.constructor;function transition_selection(){return new Selection$1(this._groups,this._parents)}function styleNull(name,interpolate){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),string1=(this.style.removeProperty(name),styleValue(this,name));return string0===string1?null:string0===string00&&string1===string10?interpolate0:interpolate0=interpolate(string00=string0,string10=string1)}}function styleRemove$1(name){return function(){this.style.removeProperty(name)}}function styleConstant$1(name,interpolate,value1){var string00,string1=value1+"",interpolate0;return function(){var string0=styleValue(this,name);return string0===string1?null:string0===string00?interpolate0:interpolate0=interpolate(string00=string0,value1)}}function styleFunction$1(name,interpolate,value){var string00,string10,interpolate0;return function(){var string0=styleValue(this,name),value1=value(this),string1=value1+"";if(value1==null)string1=value1=(this.style.removeProperty(name),styleValue(this,name));return string0===string1?null:string0===string00&&string1===string10?interpolate0:(string10=string1,interpolate0=interpolate(string00=string0,value1))}}function styleMaybeRemove(id,name){var on0,on1,listener0,key="style."+name,event="end."+key,remove;return function(){var schedule=set$1(this,id),on=schedule.on,listener=schedule.value[key]==null?remove||(remove=styleRemove$1(name)):undefined;if(on!==on0||listener0!==listener)(on1=(on0=on).copy()).on(event,listener0=listener);schedule.on=on1}}function transition_style(name,value,priority){var i=(name+="")==="transform"?interpolateTransformCss:interpolate$1;return value==null?this.styleTween(name,styleNull(name,i)).on("end.style."+name,styleRemove$1(name)):typeof value==="function"?this.styleTween(name,styleFunction$1(name,i,tweenValue(this,"style."+name,value))).each(styleMaybeRemove(this._id,name)):this.styleTween(name,styleConstant$1(name,i,value),priority).on("end.style."+name,null)}function styleInterpolate(name,i,priority){return function(t){this.style.setProperty(name,i(t),priority)}}function styleTween(name,value,priority){var t,i0;function tween(){var i=value.apply(this,arguments);if(i!==i0)t=(i0=i)&&styleInterpolate(name,i,priority);return t}tween._value=value;return tween}function transition_styleTween(name,value,priority){var key="style."+(name+="");if(arguments.length<2)return(key=this.tween(key))&&key._value;if(value==null)return this.tween(key,null);if(typeof value!=="function")throw new Error;return this.tween(key,styleTween(name,value,priority==null?"":priority))}function textConstant$1(value){return function(){this.textContent=value}}function textFunction$1(value){return function(){var value1=value(this);this.textContent=value1==null?"":value1}}function transition_text(value){return this.tween("text",typeof value==="function"?textFunction$1(tweenValue(this,"text",value)):textConstant$1(value==null?"":value+""))}function transition_transition(){var name=this._name,id0=this._id,id1=newId();for(var groups=this._groups,m=groups.length,j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){var inherit=get$1(node,id0);schedule(node,name,id1,i,group,{time:inherit.time+inherit.delay+inherit.duration,delay:0,duration:inherit.duration,ease:inherit.ease})}}}return new Transition(groups,this._parents,name,id1)}function transition_end(){var on0,on1,that=this,id=that._id,size=that.size();return new Promise(function(resolve,reject){var cancel={value:reject},end={value:function value(){if(--size===0)resolve()}};that.each(function(){var schedule=set$1(this,id),on=schedule.on;if(on!==on0){on1=(on0=on).copy();on1._.cancel.push(cancel);on1._.interrupt.push(cancel);on1._.end.push(end)}schedule.on=on1})})}var id=0;function Transition(groups,parents,name,id){this._groups=groups;this._parents=parents;this._name=name;this._id=id}function transition(name){return selection().transition(name)}function newId(){return++id}var selection_prototype=selection.prototype;Transition.prototype=transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,end:transition_end};function cubicInOut(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var pi$3=Math.PI;var tau$3=2*Math.PI;var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(node,id){var timing;while(!(timing=node.__transition)||!(timing=timing[id])){if(!(node=node.parentNode)){return defaultTiming.time=now(),defaultTiming}}return timing}function selection_transition(name){var id,timing;if(name instanceof Transition){id=name._id,name=name._name}else{id=newId(),(timing=defaultTiming).time=now(),name=name==null?null:name+""}for(var groups=this._groups,m=groups.length,j=0;j<m;++j){for(var group=groups[j],n=group.length,node,i=0;i<n;++i){if(node=group[i]){schedule(node,name,id,i,group,timing||inherit(node,id))}}}return new Transition(groups,this._parents,name,id)}selection.prototype.interrupt=selection_interrupt;selection.prototype.transition=selection_transition;var prefix="$";function Map$1(){}Map$1.prototype=map$1.prototype={constructor:Map$1,has:function has(key){return prefix+key in this},get:function get(key){return this[prefix+key]},set:function set(key,value){this[prefix+key]=value;return this},remove:function remove(key){var property=prefix+key;return property in this&&delete this[property]},clear:function clear(){for(var property in this){if(property[0]===prefix)delete this[property]}},keys:function keys(){var keys=[];for(var property in this){if(property[0]===prefix)keys.push(property.slice(1))}return keys},values:function values(){var values=[];for(var property in this){if(property[0]===prefix)values.push(this[property])}return values},entries:function entries(){var entries=[];for(var property in this){if(property[0]===prefix)entries.push({key:property.slice(1),value:this[property]})}return entries},size:function size(){var size=0;for(var property in this){if(property[0]===prefix)++size}return size},empty:function empty(){for(var property in this){if(property[0]===prefix)return false}return true},each:function each(f){for(var property in this){if(property[0]===prefix)f(this[property],property.slice(1),this)}}};function map$1(object,f){var map=new Map$1;if(object instanceof Map$1)object.each(function(value,key){map.set(key,value)});else if(Array.isArray(object)){var i=-1,n=object.length,o;if(f==null)while(++i<n){map.set(i,object[i])}else while(++i<n){map.set(f(o=object[i],i,object),o)}}else if(object)for(var key in object){map.set(key,object[key])}return map}function nest(){var keys=[],_sortKeys=[],_sortValues,_rollup,nest;function apply(array,depth,createResult,setResult){if(depth>=keys.length){if(_sortValues!=null)array.sort(_sortValues);return _rollup!=null?_rollup(array):array}var i=-1,n=array.length,key=keys[depth++],keyValue,value,valuesByKey=map$1(),values,result=createResult();while(++i<n){if(values=valuesByKey.get(keyValue=key(value=array[i])+"")){values.push(value)}else{valuesByKey.set(keyValue,[value])}}valuesByKey.each(function(values,key){setResult(result,key,apply(values,depth,createResult,setResult))});return result}function _entries(map,depth){if(++depth>keys.length)return map;var array,sortKey=_sortKeys[depth-1];if(_rollup!=null&&depth>=keys.length)array=map.entries();else array=[],map.each(function(v,k){array.push({key:k,values:_entries(v,depth)})});return sortKey!=null?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}return nest={object:function object(array){return apply(array,0,createObject,setObject)},map:function map(array){return apply(array,0,createMap,setMap)},entries:function entries(array){return _entries(apply(array,0,createMap,setMap),0)},key:function key(d){keys.push(d);return nest},sortKeys:function sortKeys(order){_sortKeys[keys.length-1]=order;return nest},sortValues:function sortValues(order){_sortValues=order;return nest},rollup:function rollup(f){_rollup=f;return nest}}}function createObject(){return{}}function setObject(object,key,value){object[key]=value}function createMap(){return map$1()}function setMap(map,key,value){map.set(key,value)}function Set(){}var proto=map$1.prototype;Set.prototype=set$2.prototype={constructor:Set,has:proto.has,add:function add(value){value+="";this[prefix+value]=value;return this},remove:proto.remove,clear:proto.clear,values:proto.keys,size:proto.size,empty:proto.empty,each:proto.each};function set$2(object,f){var set=new Set;if(object instanceof Set)object.each(function(value){set.add(value)});else if(object){var i=-1,n=object.length;if(f==null)while(++i<n){set.add(object[i])}else while(++i<n){set.add(f(object[i],i,object))}}return set}function keys(map){var keys=[];for(var key in map){keys.push(key)}return keys}function values(map){var values=[];for(var key in map){values.push(map[key])}return values}function entries(map){var entries=[];for(var key in map){entries.push({key:key,value:map[key]})}return entries}var src$4=Object.freeze({nest:nest,set:set$2,map:map$1,keys:keys,values:values,entries:entries});var array$2=Array.prototype;var map$2=array$2.map;var slice$3=array$2.slice;var implicit={name:"implicit"};function ordinal(range){var index=map$1(),domain=[],unknown=implicit;range=range==null?[]:slice$3.call(range);function scale(d){var key=d+"",i=index.get(key);if(!i){if(unknown!==implicit)return unknown;index.set(key,i=domain.push(d))}return range[(i-1)%range.length]}scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[],index=map$1();var i=-1,n=_.length,d,key;while(++i<n){if(!index.has(key=(d=_[i])+""))index.set(key,domain.push(d))}return scale};scale.range=function(_){return arguments.length?(range=slice$3.call(_),scale):range.slice()};scale.unknown=function(_){return arguments.length?(unknown=_,scale):unknown};scale.copy=function(){return ordinal().domain(domain).range(range).unknown(unknown)};return scale}function band(){var scale=ordinal().unknown(undefined),domain=scale.domain,ordinalRange=scale.range,range$1=[0,1],step,bandwidth,round=false,paddingInner=0,paddingOuter=0,align=.5;delete scale.unknown;function rescale(){var n=domain().length,reverse=range$1[1]<range$1[0],start=range$1[reverse-0],stop=range$1[1-reverse];step=(stop-start)/Math.max(1,n-paddingInner+paddingOuter*2);if(round)step=Math.floor(step);start+=(stop-start-step*(n-paddingInner))*align;bandwidth=step*(1-paddingInner);if(round)start=Math.round(start),bandwidth=Math.round(bandwidth);var values=range(n).map(function(i){return start+step*i});return ordinalRange(reverse?values.reverse():values)}scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.range=function(_){return arguments.length?(range$1=[+_[0],+_[1]],rescale()):range$1.slice()};scale.rangeRound=function(_){return range$1=[+_[0],+_[1]],round=true,rescale()};scale.bandwidth=function(){return bandwidth};scale.step=function(){return step};scale.round=function(_){return arguments.length?(round=!!_,rescale()):round};scale.padding=function(_){return arguments.length?(paddingInner=paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingInner=function(_){return arguments.length?(paddingInner=Math.max(0,Math.min(1,_)),rescale()):paddingInner};scale.paddingOuter=function(_){return arguments.length?(paddingOuter=Math.max(0,Math.min(1,_)),rescale()):paddingOuter};scale.align=function(_){return arguments.length?(align=Math.max(0,Math.min(1,_)),rescale()):align};scale.copy=function(){return band().domain(domain()).range(range$1).round(round).paddingInner(paddingInner).paddingOuter(paddingOuter).align(align)};return rescale()}function pointish(scale){var copy=scale.copy;scale.padding=scale.paddingOuter;delete scale.paddingInner;delete scale.paddingOuter;scale.copy=function(){return pointish(copy())};return scale}function point$1(){return pointish(band().paddingInner(1))}function constant$5(x){return function(){return x}}function number$1(x){return+x}var unit=[0,1];function deinterpolateLinear(a,b){return(b-=a=+a)?function(x){return(x-a)/b}:constant$5(b)}function deinterpolateClamp(deinterpolate){return function(a,b){var d=deinterpolate(a=+a,b=+b);return function(x){return x<=a?0:x>=b?1:d(x)}}}function reinterpolateClamp(reinterpolate){return function(a,b){var r=reinterpolate(a=+a,b=+b);return function(t){return t<=0?a:t>=1?b:r(t)}}}function bimap(domain,range,deinterpolate,reinterpolate){var d0=domain[0],d1=domain[1],r0=range[0],r1=range[1];if(d1<d0)d0=deinterpolate(d1,d0),r0=reinterpolate(r1,r0);else d0=deinterpolate(d0,d1),r0=reinterpolate(r0,r1);return function(x){return r0(d0(x))}}function polymap(domain,range,deinterpolate,reinterpolate){var j=Math.min(domain.length,range.length)-1,d=new Array(j),r=new Array(j),i=-1;if(domain[j]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}while(++i<j){d[i]=deinterpolate(domain[i],domain[i+1]);r[i]=reinterpolate(range[i],range[i+1])}return function(x){var i=bisectRight(domain,x,1,j)-1;return r[i](d[i](x))}}function copy(source,target){return target.domain(source.domain()).range(source.range()).interpolate(source.interpolate()).clamp(source.clamp())}function continuous(deinterpolate,reinterpolate){var domain=unit,range=unit,interpolate$1=interpolate,clamp=false,piecewise,output,input;function rescale(){piecewise=Math.min(domain.length,range.length)>2?polymap:bimap;output=input=null;return scale}function scale(x){return(output||(output=piecewise(domain,range,clamp?deinterpolateClamp(deinterpolate):deinterpolate,interpolate$1)))(+x)}scale.invert=function(y){return(input||(input=piecewise(range,domain,deinterpolateLinear,clamp?reinterpolateClamp(reinterpolate):reinterpolate)))(+y)};scale.domain=function(_){return arguments.length?(domain=map$2.call(_,number$1),rescale()):domain.slice()};scale.range=function(_){return arguments.length?(range=slice$3.call(_),rescale()):range.slice()};scale.rangeRound=function(_){return range=slice$3.call(_),interpolate$1=interpolateRound,rescale()};scale.clamp=function(_){return arguments.length?(clamp=!!_,rescale()):clamp};scale.interpolate=function(_){return arguments.length?(interpolate$1=_,rescale()):interpolate$1};return rescale()}function formatDecimal(x,p){if((i=(x=p?x.toExponential(p-1):x.toExponential()).indexOf("e"))<0)return null;var i,coefficient=x.slice(0,i);return[coefficient.length>1?coefficient[0]+coefficient.slice(2):coefficient,+x.slice(i+1)]}function exponent(x){return x=formatDecimal(Math.abs(x)),x?x[1]:NaN}function formatGroup(grouping,thousands){return function(value,width){var i=value.length,t=[],j=0,g=grouping[0],length=0;while(i>0&&g>0){if(length+g+1>width)g=Math.max(1,width-length);t.push(value.substring(i-=g,i+g));if((length+=g+1)>width)break;g=grouping[j=(j+1)%grouping.length]}return t.reverse().join(thousands)}}function formatNumerals(numerals){return function(value){return value.replace(/[0-9]/g,function(i){return numerals[+i]})}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(specifier){return new FormatSpecifier(specifier)}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(specifier){if(!(match=re.exec(specifier)))throw new Error("invalid format: "+specifier);var match;this.fill=match[1]||" ";this.align=match[2]||">";this.sign=match[3]||"-";this.symbol=match[4]||"";this.zero=!!match[5];this.width=match[6]&&+match[6];this.comma=!!match[7];this.precision=match[8]&&+match[8].slice(1);this.trim=!!match[9];this.type=match[10]||""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(s){out:for(var n=s.length,i=1,i0=-1,i1;i<n;++i){switch(s[i]){case".":i0=i1=i;break;case"0":if(i0===0)i0=i;i1=i;break;default:if(i0>0){if(!+s[i])break out;i0=0}break}}return i0>0?s.slice(0,i0)+s.slice(i1+1):s}var prefixExponent;function formatPrefixAuto(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1],i=exponent-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(exponent/3)))*3)+1,n=coefficient.length;return i===n?coefficient:i>n?coefficient+new Array(i-n+1).join("0"):i>0?coefficient.slice(0,i)+"."+coefficient.slice(i):"0."+new Array(1-i).join("0")+formatDecimal(x,Math.max(0,p+i-1))[0]}function formatRounded(x,p){var d=formatDecimal(x,p);if(!d)return x+"";var coefficient=d[0],exponent=d[1];return exponent<0?"0."+new Array(-exponent).join("0")+coefficient:coefficient.length>exponent+1?coefficient.slice(0,exponent+1)+"."+coefficient.slice(exponent+1):coefficient+new Array(exponent-coefficient.length+2).join("0")}var formatTypes={"%":function _(x,p){return(x*100).toFixed(p)},b:function b(x){return Math.round(x).toString(2)},c:function c(x){return x+""},d:function d(x){return Math.round(x).toString(10)},e:function e(x,p){return x.toExponential(p)},f:function f(x,p){return x.toFixed(p)},g:function g(x,p){return x.toPrecision(p)},o:function o(x){return Math.round(x).toString(8)},p:function p(x,_p){return formatRounded(x*100,_p)},r:formatRounded,s:formatPrefixAuto,X:function X(x){return Math.round(x).toString(16).toUpperCase()},x:function x(_x){return Math.round(_x).toString(16)}};function identity$4(x){return x}var prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(locale){var group=locale.grouping&&locale.thousands?formatGroup(locale.grouping,locale.thousands):identity$4,currency=locale.currency,decimal=locale.decimal,numerals=locale.numerals?formatNumerals(locale.numerals):identity$4,percent=locale.percent||"%";function newFormat(specifier){specifier=formatSpecifier(specifier);var fill=specifier.fill,align=specifier.align,sign=specifier.sign,symbol=specifier.symbol,zero=specifier.zero,width=specifier.width,comma=specifier.comma,precision=specifier.precision,trim=specifier.trim,type=specifier.type;if(type==="n")comma=true,type="g";else if(!formatTypes[type])precision==null&&(precision=12),trim=true,type="g";if(zero||fill==="0"&&align==="=")zero=true,fill="0",align="=";var prefix=symbol==="$"?currency[0]:symbol==="#"&&/[boxX]/.test(type)?"0"+type.toLowerCase():"",suffix=symbol==="$"?currency[1]:/[%p]/.test(type)?percent:"";var formatType=formatTypes[type],maybeSuffix=/[defgprs%]/.test(type);precision=precision==null?6:/[gprs]/.test(type)?Math.max(1,Math.min(21,precision)):Math.max(0,Math.min(20,precision));function format(value){var valuePrefix=prefix,valueSuffix=suffix,i,n,c;if(type==="c"){valueSuffix=formatType(value)+valueSuffix;value=""}else{value=+value;var valueNegative=value<0;value=formatType(Math.abs(value),precision);if(trim)value=formatTrim(value);if(valueNegative&&+value===0)valueNegative=false;valuePrefix=(valueNegative?sign==="("?sign:"-":sign==="-"||sign==="("?"":sign)+valuePrefix;valueSuffix=(type==="s"?prefixes[8+prefixExponent/3]:"")+valueSuffix+(valueNegative&&sign==="("?")":"");if(maybeSuffix){i=-1,n=value.length;while(++i<n){if(c=value.charCodeAt(i),48>c||c>57){valueSuffix=(c===46?decimal+value.slice(i+1):value.slice(i))+valueSuffix;value=value.slice(0,i);break}}}}if(comma&&!zero)value=group(value,Infinity);var length=valuePrefix.length+value.length+valueSuffix.length,padding=length<width?new Array(width-length+1).join(fill):"";if(comma&&zero)value=group(padding+value,padding.length?width-valueSuffix.length:Infinity),padding="";switch(align){case"<":value=valuePrefix+value+valueSuffix+padding;break;case"=":value=valuePrefix+padding+value+valueSuffix;break;case"^":value=padding.slice(0,length=padding.length>>1)+valuePrefix+value+valueSuffix+padding.slice(length);break;default:value=padding+valuePrefix+value+valueSuffix;break}return numerals(value)}format.toString=function(){return specifier+""};return format}function formatPrefix(specifier,value){var f=newFormat((specifier=formatSpecifier(specifier),specifier.type="f",specifier)),e=Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3,k=Math.pow(10,-e),prefix=prefixes[8+e/3];return function(value){return f(k*value)+prefix}}return{format:newFormat,formatPrefix:formatPrefix}}var locale;var format;var formatPrefix;defaultLocale({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(definition){locale=formatLocale(definition);format=locale.format;formatPrefix=locale.formatPrefix;return locale}function precisionFixed(step){return Math.max(0,-exponent(Math.abs(step)))}function precisionPrefix(step,value){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(value)/3)))*3-exponent(Math.abs(step)))}function precisionRound(step,max){step=Math.abs(step),max=Math.abs(max)-step;return Math.max(0,exponent(max)-exponent(step))+1}function tickFormat(domain,count,specifier){var start=domain[0],stop=domain[domain.length-1],step=tickStep(start,stop,count==null?10:count),precision;specifier=formatSpecifier(specifier==null?",f":specifier);switch(specifier.type){case"s":var value=Math.max(Math.abs(start),Math.abs(stop));if(specifier.precision==null&&!isNaN(precision=precisionPrefix(step,value)))specifier.precision=precision;return formatPrefix(specifier,value);case"":case"e":case"g":case"p":case"r":if(specifier.precision==null&&!isNaN(precision=precisionRound(step,Math.max(Math.abs(start),Math.abs(stop)))))specifier.precision=precision-(specifier.type==="e");break;case"f":case"%":if(specifier.precision==null&&!isNaN(precision=precisionFixed(step)))specifier.precision=precision-(specifier.type==="%")*2;break}return format(specifier)}function linearish(scale){var domain=scale.domain;scale.ticks=function(count){var d=domain();return ticks(d[0],d[d.length-1],count==null?10:count)};scale.tickFormat=function(count,specifier){return tickFormat(domain(),count,specifier)};scale.nice=function(count){if(count==null)count=10;var d=domain(),i0=0,i1=d.length-1,start=d[i0],stop=d[i1],step;if(stop<start){step=start,start=stop,stop=step;step=i0,i0=i1,i1=step}step=tickIncrement(start,stop,count);if(step>0){start=Math.floor(start/step)*step;stop=Math.ceil(stop/step)*step;step=tickIncrement(start,stop,count)}else if(step<0){start=Math.ceil(start*step)/step;stop=Math.floor(stop*step)/step;step=tickIncrement(start,stop,count)}if(step>0){d[i0]=Math.floor(start/step)*step;d[i1]=Math.ceil(stop/step)*step;domain(d)}else if(step<0){d[i0]=Math.ceil(start*step)/step;d[i1]=Math.floor(stop*step)/step;domain(d)}return scale};return scale}function linear$1(){var scale=continuous(deinterpolateLinear,interpolateNumber);scale.copy=function(){return copy(scale,linear$1())};return linearish(scale)}function identity$5(){var domain=[0,1];function scale(x){return+x}scale.invert=scale;scale.domain=scale.range=function(_){return arguments.length?(domain=map$2.call(_,number$1),scale):domain.slice()};scale.copy=function(){return identity$5().domain(domain)};return linearish(scale)}function nice(domain,interval){domain=domain.slice();var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],t;if(x1<x0){t=i0,i0=i1,i1=t;t=x0,x0=x1,x1=t}domain[i0]=interval.floor(x0);domain[i1]=interval.ceil(x1);return domain}function deinterpolate(a,b){return(b=Math.log(b/a))?function(x){return Math.log(x/a)/b}:constant$5(b)}function reinterpolate(a,b){return a<0?function(t){return-Math.pow(-b,t)*Math.pow(-a,1-t)}:function(t){return Math.pow(b,t)*Math.pow(a,1-t)}}function pow10(x){return isFinite(x)?+("1e"+x):x<0?0:x}function powp(base){return base===10?pow10:base===Math.E?Math.exp:function(x){return Math.pow(base,x)}}function logp(base){return base===Math.E?Math.log:base===10&&Math.log10||base===2&&Math.log2||(base=Math.log(base),function(x){return Math.log(x)/base})}function reflect(f){return function(x){return-f(-x)}}function log(){var scale=continuous(deinterpolate,reinterpolate).domain([1,10]),domain=scale.domain,base=10,logs=logp(10),pows=powp(10);function rescale(){logs=logp(base),pows=powp(base);if(domain()[0]<0)logs=reflect(logs),pows=reflect(pows);return scale}scale.base=function(_){return arguments.length?(base=+_,rescale()):base};scale.domain=function(_){return arguments.length?(domain(_),rescale()):domain()};scale.ticks=function(count){var d=domain(),u=d[0],v=d[d.length-1],r;if(r=v<u)i=u,u=v,v=i;var i=logs(u),j=logs(v),p,k,t,n=count==null?10:+count,z=[];if(!(base%1)&&j-i<n){i=Math.round(i)-1,j=Math.round(j)+1;if(u>0)for(;i<j;++i){for(k=1,p=pows(i);k<base;++k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}else for(;i<j;++i){for(k=base-1,p=pows(i);k>=1;--k){t=p*k;if(t<u)continue;if(t>v)break;z.push(t)}}}else{z=ticks(i,j,Math.min(j-i,n)).map(pows)}return r?z.reverse():z};scale.tickFormat=function(count,specifier){if(specifier==null)specifier=base===10?".0e":",";if(typeof specifier!=="function")specifier=format(specifier);if(count===Infinity)return specifier;if(count==null)count=10;var k=Math.max(1,base*count/scale.ticks().length);return function(d){var i=d/pows(Math.round(logs(d)));if(i*base<base-.5)i*=base;return i<=k?specifier(d):""}};scale.nice=function(){return domain(nice(domain(),{floor:function floor(x){return pows(Math.floor(logs(x)))},ceil:function ceil(x){return pows(Math.ceil(logs(x)))}}))};scale.copy=function(){return copy(scale,log().base(base))};return scale}function raise$1(x,exponent){return x<0?-Math.pow(-x,exponent):Math.pow(x,exponent)}function pow(){var exponent=1,scale=continuous(deinterpolate,reinterpolate),domain=scale.domain;function deinterpolate(a,b){return(b=raise$1(b,exponent)-(a=raise$1(a,exponent)))?function(x){return(raise$1(x,exponent)-a)/b}:constant$5(b)}function reinterpolate(a,b){b=raise$1(b,exponent)-(a=raise$1(a,exponent));return function(t){return raise$1(a+b*t,1/exponent)}}scale.exponent=function(_){return arguments.length?(exponent=+_,domain(domain())):exponent};scale.copy=function(){return copy(scale,pow().exponent(exponent))};return linearish(scale)}function sqrt$2(){return pow().exponent(.5)}function quantile$1(){var domain=[],range=[],thresholds=[];function rescale(){var i=0,n=Math.max(1,range.length);thresholds=new Array(n-1);while(++i<n){thresholds[i-1]=quantile(domain,i/n)}return scale}function scale(x){if(!isNaN(x=+x))return range[bisectRight(thresholds,x)]}scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:[i>0?thresholds[i-1]:domain[0],i<thresholds.length?thresholds[i]:domain[domain.length-1]]};scale.domain=function(_){if(!arguments.length)return domain.slice();domain=[];for(var i=0,n=_.length,d;i<n;++i){if(d=_[i],d!=null&&!isNaN(d=+d))domain.push(d)}domain.sort(ascending$2);return rescale()};scale.range=function(_){return arguments.length?(range=slice$3.call(_),rescale()):range.slice()};scale.quantiles=function(){return thresholds.slice()};scale.copy=function(){return quantile$1().domain(domain).range(range)};return scale}function quantize(){var x0=0,x1=1,n=1,domain=[.5],range=[0,1];function scale(x){if(x<=x)return range[bisectRight(domain,x,0,n)]}function rescale(){var i=-1;domain=new Array(n);while(++i<n){domain[i]=((i+1)*x1-(i-n)*x0)/(n+1)}return scale}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],rescale()):[x0,x1]};scale.range=function(_){return arguments.length?(n=(range=slice$3.call(_)).length-1,rescale()):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return i<0?[NaN,NaN]:i<1?[x0,domain[0]]:i>=n?[domain[n-1],x1]:[domain[i-1],domain[i]]};scale.copy=function(){return quantize().domain([x0,x1]).range(range)};return linearish(scale)}function threshold(){var domain=[.5],range=[0,1],n=1;function scale(x){if(x<=x)return range[bisectRight(domain,x,0,n)]}scale.domain=function(_){return arguments.length?(domain=slice$3.call(_),n=Math.min(domain.length,range.length-1),scale):domain.slice()};scale.range=function(_){return arguments.length?(range=slice$3.call(_),n=Math.min(domain.length,range.length-1),scale):range.slice()};scale.invertExtent=function(y){var i=range.indexOf(y);return[domain[i-1],domain[i]]};scale.copy=function(){return threshold().domain(domain).range(range)};return scale}var t0$1=new Date,t1$1=new Date;function newInterval(floori,offseti,count,field){function interval(date){return floori(date=new Date(+date)),date}interval.floor=interval;interval.ceil=function(date){return floori(date=new Date(date-1)),offseti(date,1),floori(date),date};interval.round=function(date){var d0=interval(date),d1=interval.ceil(date);return date-d0<d1-date?d0:d1};interval.offset=function(date,step){return offseti(date=new Date(+date),step==null?1:Math.floor(step)),date};interval.range=function(start,stop,step){var range=[],previous;start=interval.ceil(start);step=step==null?1:Math.floor(step);if(!(start<stop)||!(step>0))return range;do{range.push(previous=new Date(+start)),offseti(start,step),floori(start)}while(previous<start&&start<stop);return range};interval.filter=function(test){return newInterval(function(date){if(date>=date)while(floori(date),!test(date)){date.setTime(date-1)}},function(date,step){if(date>=date){if(step<0)while(++step<=0){while(offseti(date,-1),!test(date)){}}else while(--step>=0){while(offseti(date,+1),!test(date)){}}}})};if(count){interval.count=function(start,end){t0$1.setTime(+start),t1$1.setTime(+end);floori(t0$1),floori(t1$1);return Math.floor(count(t0$1,t1$1))};interval.every=function(step){step=Math.floor(step);return!isFinite(step)||!(step>0)?null:!(step>1)?interval:interval.filter(field?function(d){return field(d)%step===0}:function(d){return interval.count(0,d)%step===0})}}return interval}var millisecond=newInterval(function(){},function(date,step){date.setTime(+date+step)},function(start,end){return end-start});millisecond.every=function(k){k=Math.floor(k);if(!isFinite(k)||!(k>0))return null;if(!(k>1))return millisecond;return newInterval(function(date){date.setTime(Math.floor(date/k)*k)},function(date,step){date.setTime(+date+step*k)},function(start,end){return(end-start)/k})};var durationSecond=1e3;var durationMinute=6e4;var durationHour=36e5;var durationDay=864e5;var durationWeek=6048e5;var second=newInterval(function(date){date.setTime(date-date.getMilliseconds())},function(date,step){date.setTime(+date+step*durationSecond)},function(start,end){return(end-start)/durationSecond},function(date){return date.getUTCSeconds()});var minute=newInterval(function(date){date.setTime(date-date.getMilliseconds()-date.getSeconds()*durationSecond)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getMinutes()});var hour=newInterval(function(date){date.setTime(date-date.getMilliseconds()-date.getSeconds()*durationSecond-date.getMinutes()*durationMinute)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getHours()});var day=newInterval(function(date){date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationDay},function(date){return date.getDate()-1});function weekday(i){return newInterval(function(date){date.setDate(date.getDate()-(date.getDay()+7-i)%7);date.setHours(0,0,0,0)},function(date,step){date.setDate(date.getDate()+step*7)},function(start,end){return(end-start-(end.getTimezoneOffset()-start.getTimezoneOffset())*durationMinute)/durationWeek})}var sunday=weekday(0);var monday=weekday(1);var tuesday=weekday(2);var wednesday=weekday(3);var thursday=weekday(4);var friday=weekday(5);var saturday=weekday(6);var month=newInterval(function(date){date.setDate(1);date.setHours(0,0,0,0)},function(date,step){date.setMonth(date.getMonth()+step)},function(start,end){return end.getMonth()-start.getMonth()+(end.getFullYear()-start.getFullYear())*12},function(date){return date.getMonth()});var year=newInterval(function(date){date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step)},function(start,end){return end.getFullYear()-start.getFullYear()},function(date){return date.getFullYear()});year.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setFullYear(Math.floor(date.getFullYear()/k)*k);date.setMonth(0,1);date.setHours(0,0,0,0)},function(date,step){date.setFullYear(date.getFullYear()+step*k)})};var utcMinute=newInterval(function(date){date.setUTCSeconds(0,0)},function(date,step){date.setTime(+date+step*durationMinute)},function(start,end){return(end-start)/durationMinute},function(date){return date.getUTCMinutes()});var utcHour=newInterval(function(date){date.setUTCMinutes(0,0,0)},function(date,step){date.setTime(+date+step*durationHour)},function(start,end){return(end-start)/durationHour},function(date){return date.getUTCHours()});var utcDay=newInterval(function(date){date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step)},function(start,end){return(end-start)/durationDay},function(date){return date.getUTCDate()-1});function utcWeekday(i){return newInterval(function(date){date.setUTCDate(date.getUTCDate()-(date.getUTCDay()+7-i)%7);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCDate(date.getUTCDate()+step*7)},function(start,end){return(end-start)/durationWeek})}var utcSunday=utcWeekday(0);var utcMonday=utcWeekday(1);var utcTuesday=utcWeekday(2);var utcWednesday=utcWeekday(3);var utcThursday=utcWeekday(4);var utcFriday=utcWeekday(5);var utcSaturday=utcWeekday(6);var utcMonth=newInterval(function(date){date.setUTCDate(1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCMonth(date.getUTCMonth()+step)},function(start,end){return end.getUTCMonth()-start.getUTCMonth()+(end.getUTCFullYear()-start.getUTCFullYear())*12},function(date){return date.getUTCMonth()});var utcYear=newInterval(function(date){date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step)},function(start,end){return end.getUTCFullYear()-start.getUTCFullYear()},function(date){return date.getUTCFullYear()});utcYear.every=function(k){return!isFinite(k=Math.floor(k))||!(k>0)?null:newInterval(function(date){date.setUTCFullYear(Math.floor(date.getUTCFullYear()/k)*k);date.setUTCMonth(0,1);date.setUTCHours(0,0,0,0)},function(date,step){date.setUTCFullYear(date.getUTCFullYear()+step*k)})};function localDate(d){if(0<=d.y&&d.y<100){var date=new Date(-1,d.m,d.d,d.H,d.M,d.S,d.L);date.setFullYear(d.y);return date}return new Date(d.y,d.m,d.d,d.H,d.M,d.S,d.L)}function utcDate(d){if(0<=d.y&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))}function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}}function formatLocale$1(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_weekdays=locale.days,locale_shortWeekdays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;var periodRe=formatRe(locale_periods),periodLookup=formatLookup(locale_periods),weekdayRe=formatRe(locale_weekdays),weekdayLookup=formatLookup(locale_weekdays),shortWeekdayRe=formatRe(locale_shortWeekdays),shortWeekdayLookup=formatLookup(locale_shortWeekdays),monthRe=formatRe(locale_months),monthLookup=formatLookup(locale_months),shortMonthRe=formatRe(locale_shortMonths),shortMonthLookup=formatLookup(locale_shortMonths);var formats={a:formatShortWeekday,A:formatWeekday,b:formatShortMonth,B:formatMonth,c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:formatPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent};var utcFormats={a:formatUTCShortWeekday,A:formatUTCWeekday,b:formatUTCShortMonth,B:formatUTCMonth,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:formatUTCPeriod,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent};var parses={a:parseShortWeekday,A:parseWeekday,b:parseShortMonth,B:parseMonth,c:parseLocaleDateTime,d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:parsePeriod,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:parseLocaleDate,X:parseLocaleTime,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};formats.x=newFormat(locale_date,formats);formats.X=newFormat(locale_time,formats);formats.c=newFormat(locale_dateTime,formats);utcFormats.x=newFormat(locale_date,utcFormats);utcFormats.X=newFormat(locale_time,utcFormats);utcFormats.c=newFormat(locale_dateTime,utcFormats);function newFormat(specifier,formats){return function(date){var string=[],i=-1,j=0,n=specifier.length,c,pad,format;if(!(date instanceof Date))date=new Date(+date);while(++i<n){if(specifier.charCodeAt(i)===37){string.push(specifier.slice(j,i));if((pad=pads[c=specifier.charAt(++i)])!=null)c=specifier.charAt(++i);else pad=c==="e"?" ":"0";if(format=formats[c])c=format(date,pad);string.push(c);j=i+1}}string.push(specifier.slice(j,i));return string.join("")}}function newParse(specifier,newDate){return function(string){var d=newYear(1900),i=parseSpecifier(d,specifier,string+="",0),week,day$1;if(i!=string.length)return null;if("Q"in d)return new Date(d.Q);if("p"in d)d.H=d.H%12+d.p*12;if("V"in d){if(d.V<1||d.V>53)return null;if(!("w"in d))d.w=1;if("Z"in d){week=utcDate(newYear(d.y)),day$1=week.getUTCDay();week=day$1>4||day$1===0?utcMonday.ceil(week):utcMonday(week);week=utcDay.offset(week,(d.V-1)*7);d.y=week.getUTCFullYear();d.m=week.getUTCMonth();d.d=week.getUTCDate()+(d.w+6)%7}else{week=newDate(newYear(d.y)),day$1=week.getDay();week=day$1>4||day$1===0?monday.ceil(week):monday(week);week=day.offset(week,(d.V-1)*7);d.y=week.getFullYear();d.m=week.getMonth();d.d=week.getDate()+(d.w+6)%7}}else if("W"in d||"U"in d){if(!("w"in d))d.w="u"in d?d.u%7:"W"in d?1:0;day$1="Z"in d?utcDate(newYear(d.y)).getUTCDay():newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day$1+5)%7:d.w+d.U*7-(day$1+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return newDate(d)}}function parseSpecifier(d,specifier,string,j){var i=0,n=specifier.length,m=string.length,c,parse;while(i<n){if(j>=m)return-1;c=specifier.charCodeAt(i++);if(c===37){c=specifier.charAt(i++);parse=parses[c in pads?specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0)return-1}else if(c!=string.charCodeAt(j++)){return-1}}return j}function parsePeriod(d,string,i){var n=periodRe.exec(string.slice(i));return n?(d.p=periodLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortWeekday(d,string,i){var n=shortWeekdayRe.exec(string.slice(i));return n?(d.w=shortWeekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseWeekday(d,string,i){var n=weekdayRe.exec(string.slice(i));return n?(d.w=weekdayLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseShortMonth(d,string,i){var n=shortMonthRe.exec(string.slice(i));return n?(d.m=shortMonthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseMonth(d,string,i){var n=monthRe.exec(string.slice(i));return n?(d.m=monthLookup[n[0].toLowerCase()],i+n[0].length):-1}function parseLocaleDateTime(d,string,i){return parseSpecifier(d,locale_dateTime,string,i)}function parseLocaleDate(d,string,i){return parseSpecifier(d,locale_date,string,i)}function parseLocaleTime(d,string,i){return parseSpecifier(d,locale_time,string,i)}function formatShortWeekday(d){return locale_shortWeekdays[d.getDay()]}function formatWeekday(d){return locale_weekdays[d.getDay()]}function formatShortMonth(d){return locale_shortMonths[d.getMonth()]}function formatMonth(d){return locale_months[d.getMonth()]}function formatPeriod(d){return locale_periods[+(d.getHours()>=12)]}function formatUTCShortWeekday(d){return locale_shortWeekdays[d.getUTCDay()]}function formatUTCWeekday(d){return locale_weekdays[d.getUTCDay()]}function formatUTCShortMonth(d){return locale_shortMonths[d.getUTCMonth()]}function formatUTCMonth(d){return locale_months[d.getUTCMonth()]}function formatUTCPeriod(d){return locale_periods[+(d.getUTCHours()>=12)]}return{format:function format(specifier){var f=newFormat(specifier+="",formats);f.toString=function(){return specifier};return f},parse:function parse(specifier){var p=newParse(specifier+="",localDate);p.toString=function(){return specifier};return p},utcFormat:function utcFormat(specifier){var f=newFormat(specifier+="",utcFormats);f.toString=function(){return specifier};return f},utcParse:function utcParse(specifier){var p=newParse(specifier,utcDate);p.toString=function(){return specifier};return p}}}var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function requote(s){return s.replace(requoteRe,"\\$&")}function formatRe(names){return new RegExp("^(?:"+names.map(requote).join("|")+")","i")}function formatLookup(names){var map={},i=-1,n=names.length;while(++i<n){map[names[i].toLowerCase()]=i}return map}function parseWeekdayNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.w=+n[0],i+n[0].length):-1}function parseWeekdayNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+1));return n?(d.u=+n[0],i+n[0].length):-1}function parseWeekNumberSunday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.U=+n[0],i+n[0].length):-1}function parseWeekNumberISO(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.V=+n[0],i+n[0].length):-1}function parseWeekNumberMonday(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.W=+n[0],i+n[0].length):-1}function parseFullYear(d,string,i){var n=numberRe.exec(string.slice(i,i+4));return n?(d.y=+n[0],i+n[0].length):-1}function parseYear(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function parseZone(d,string,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(string.slice(i,i+6));return n?(d.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function parseMonthNumber(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.m=n[0]-1,i+n[0].length):-1}function parseDayOfMonth(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.d=+n[0],i+n[0].length):-1}function parseDayOfYear(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.m=0,d.d=+n[0],i+n[0].length):-1}function parseHour24(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.H=+n[0],i+n[0].length):-1}function parseMinutes(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.M=+n[0],i+n[0].length):-1}function parseSeconds(d,string,i){var n=numberRe.exec(string.slice(i,i+2));return n?(d.S=+n[0],i+n[0].length):-1}function parseMilliseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+3));return n?(d.L=+n[0],i+n[0].length):-1}function parseMicroseconds(d,string,i){var n=numberRe.exec(string.slice(i,i+6));return n?(d.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function parseLiteralPercent(d,string,i){var n=percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function parseUnixTimestamp(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0],i+n[0].length):-1}function parseUnixTimestampSeconds(d,string,i){var n=numberRe.exec(string.slice(i));return n?(d.Q=+n[0]*1e3,i+n[0].length):-1}function formatDayOfMonth(d,p){return pad(d.getDate(),p,2)}function formatHour24(d,p){return pad(d.getHours(),p,2)}function formatHour12(d,p){return pad(d.getHours()%12||12,p,2)}function formatDayOfYear(d,p){return pad(1+day.count(year(d),d),p,3)}function formatMilliseconds(d,p){return pad(d.getMilliseconds(),p,3)}function formatMicroseconds(d,p){return formatMilliseconds(d,p)+"000"}function formatMonthNumber(d,p){return pad(d.getMonth()+1,p,2)}function formatMinutes(d,p){return pad(d.getMinutes(),p,2)}function formatSeconds(d,p){return pad(d.getSeconds(),p,2)}function formatWeekdayNumberMonday(d){var day=d.getDay();return day===0?7:day}function formatWeekNumberSunday(d,p){return pad(sunday.count(year(d),d),p,2)}function formatWeekNumberISO(d,p){var day=d.getDay();d=day>=4||day===0?thursday(d):thursday.ceil(d);return pad(thursday.count(year(d),d)+(year(d).getDay()===4),p,2)}function formatWeekdayNumberSunday(d){return d.getDay()}function formatWeekNumberMonday(d,p){return pad(monday.count(year(d),d),p,2)}function formatYear(d,p){return pad(d.getFullYear()%100,p,2)}function formatFullYear(d,p){return pad(d.getFullYear()%1e4,p,4)}function formatZone(d){var z=d.getTimezoneOffset();return(z>0?"-":(z*=-1,"+"))+pad(z/60|0,"0",2)+pad(z%60,"0",2)}function formatUTCDayOfMonth(d,p){return pad(d.getUTCDate(),p,2)}function formatUTCHour24(d,p){return pad(d.getUTCHours(),p,2)}function formatUTCHour12(d,p){return pad(d.getUTCHours()%12||12,p,2)}function formatUTCDayOfYear(d,p){return pad(1+utcDay.count(utcYear(d),d),p,3)}function formatUTCMilliseconds(d,p){return pad(d.getUTCMilliseconds(),p,3)}function formatUTCMicroseconds(d,p){return formatUTCMilliseconds(d,p)+"000"}function formatUTCMonthNumber(d,p){return pad(d.getUTCMonth()+1,p,2)}function formatUTCMinutes(d,p){return pad(d.getUTCMinutes(),p,2)}function formatUTCSeconds(d,p){return pad(d.getUTCSeconds(),p,2)}function formatUTCWeekdayNumberMonday(d){var dow=d.getUTCDay();return dow===0?7:dow}function formatUTCWeekNumberSunday(d,p){return pad(utcSunday.count(utcYear(d),d),p,2)}function formatUTCWeekNumberISO(d,p){var day=d.getUTCDay();d=day>=4||day===0?utcThursday(d):utcThursday.ceil(d);return pad(utcThursday.count(utcYear(d),d)+(utcYear(d).getUTCDay()===4),p,2)}function formatUTCWeekdayNumberSunday(d){return d.getUTCDay()}function formatUTCWeekNumberMonday(d,p){return pad(utcMonday.count(utcYear(d),d),p,2)}function formatUTCYear(d,p){return pad(d.getUTCFullYear()%100,p,2)}function formatUTCFullYear(d,p){return pad(d.getUTCFullYear()%1e4,p,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(d){return+d}function formatUnixTimestampSeconds(d){return Math.floor(+d/1e3)}var locale$1;var timeFormat;var timeParse;var utcFormat;var utcParse;defaultLocale$1({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale$1(definition){locale$1=formatLocale$1(definition);timeFormat=locale$1.format;timeParse=locale$1.parse;utcFormat=locale$1.utcFormat;utcParse=locale$1.utcParse;return locale$1}var isoSpecifier="%Y-%m-%dT%H:%M:%S.%LZ";function formatIsoNative(date){return date.toISOString()}var formatIso=Date.prototype.toISOString?formatIsoNative:utcFormat(isoSpecifier);function parseIsoNative(string){var date=new Date(string);return isNaN(date)?null:date}var parseIso=+new Date("2000-01-01T00:00:00.000Z")?parseIsoNative:utcParse(isoSpecifier);var durationSecond$1=1e3,durationMinute$1=durationSecond$1*60,durationHour$1=durationMinute$1*60,durationDay$1=durationHour$1*24,durationWeek$1=durationDay$1*7,durationMonth=durationDay$1*30,durationYear=durationDay$1*365;function date$1(t){return new Date(t)}function number$2(t){return t instanceof Date?+t:+new Date(+t)}function calendar(year,month,week,day,hour,minute,second,millisecond,format){var scale=continuous(deinterpolateLinear,interpolateNumber),invert=scale.invert,domain=scale.domain;var formatMillisecond=format(".%L"),formatSecond=format(":%S"),formatMinute=format("%I:%M"),formatHour=format("%I %p"),formatDay=format("%a %d"),formatWeek=format("%b %d"),formatMonth=format("%B"),formatYear=format("%Y");var tickIntervals=[[second,1,durationSecond$1],[second,5,5*durationSecond$1],[second,15,15*durationSecond$1],[second,30,30*durationSecond$1],[minute,1,durationMinute$1],[minute,5,5*durationMinute$1],[minute,15,15*durationMinute$1],[minute,30,30*durationMinute$1],[hour,1,durationHour$1],[hour,3,3*durationHour$1],[hour,6,6*durationHour$1],[hour,12,12*durationHour$1],[day,1,durationDay$1],[day,2,2*durationDay$1],[week,1,durationWeek$1],[month,1,durationMonth],[month,3,3*durationMonth],[year,1,durationYear]];function tickFormat(date){return(second(date)<date?formatMillisecond:minute(date)<date?formatSecond:hour(date)<date?formatMinute:day(date)<date?formatHour:month(date)<date?week(date)<date?formatDay:formatWeek:year(date)<date?formatMonth:formatYear)(date)}function tickInterval(interval,start,stop,step){if(interval==null)interval=10;if(typeof interval==="number"){var target=Math.abs(stop-start)/interval,i=bisector(function(i){return i[2]}).right(tickIntervals,target);if(i===tickIntervals.length){step=tickStep(start/durationYear,stop/durationYear,interval);interval=year}else if(i){i=tickIntervals[target/tickIntervals[i-1][2]<tickIntervals[i][2]/target?i-1:i];step=i[1];interval=i[0]}else{step=Math.max(tickStep(start,stop,interval),1);interval=millisecond}}return step==null?interval:interval.every(step)}scale.invert=function(y){return new Date(invert(y))};scale.domain=function(_){return arguments.length?domain(map$2.call(_,number$2)):domain().map(date$1)};scale.ticks=function(interval,step){var d=domain(),t0=d[0],t1=d[d.length-1],r=t1<t0,t;if(r)t=t0,t0=t1,t1=t;t=tickInterval(interval,t0,t1,step);t=t?t.range(t0,t1+1):[];return r?t.reverse():t};scale.tickFormat=function(count,specifier){return specifier==null?tickFormat:format(specifier)};scale.nice=function(interval,step){var d=domain();return(interval=tickInterval(interval,d[0],d[d.length-1],step))?domain(nice(d,interval)):scale};scale.copy=function(){return copy(scale,calendar(year,month,week,day,hour,minute,second,millisecond,format))};return scale}function time(){return calendar(year,month,sunday,day,hour,minute,second,millisecond,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)])}function utcTime(){return calendar(utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute,second,millisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)])}function colors(s){return s.match(/.{6}/g).map(function(x){return"#"+x})}var category10=colors("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var category20b=colors("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6");var category20c=colors("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9");var category20=colors("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5");var cubehelix$2=cubehelixLong(cubehelix(300,.5,0),cubehelix(-240,.5,1));var warm=cubehelixLong(cubehelix(-100,.75,.35),cubehelix(80,1.5,.8));var cool=cubehelixLong(cubehelix(260,.75,.35),cubehelix(80,1.5,.8));var rainbow=cubehelix();function rainbow$1(t){if(t<0||t>1)t-=Math.floor(t);var ts=Math.abs(t-.5);rainbow.h=360*t-100;rainbow.s=1.5-1.5*ts;rainbow.l=.8-.9*ts;return rainbow+""}function ramp(range){var n=range.length;return function(t){return range[Math.max(0,Math.min(n-1,Math.floor(t*n)))]}}var viridis=ramp(colors("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));var magma=ramp(colors("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var inferno=ramp(colors("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));var plasma=ramp(colors("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));function sequential(interpolator){var x0=0,x1=1,clamp=false;function scale(x){var t=(x-x0)/(x1-x0);return interpolator(clamp?Math.max(0,Math.min(1,t)):t)}scale.domain=function(_){return arguments.length?(x0=+_[0],x1=+_[1],scale):[x0,x1]};scale.clamp=function(_){return arguments.length?(clamp=!!_,scale):clamp};scale.interpolator=function(_){return arguments.length?(interpolator=_,scale):interpolator};scale.copy=function(){return sequential(interpolator).domain([x0,x1]).clamp(clamp)};return linearish(scale)}var d3Scale=Object.freeze({scaleBand:band,scalePoint:point$1,scaleIdentity:identity$5,scaleLinear:linear$1,scaleLog:log,scaleOrdinal:ordinal,scaleImplicit:implicit,scalePow:pow,scaleSqrt:sqrt$2,scaleQuantile:quantile$1,scaleQuantize:quantize,scaleThreshold:threshold,scaleTime:time,scaleUtc:utcTime,schemeCategory10:category10,schemeCategory20b:category20b,schemeCategory20c:category20c,schemeCategory20:category20,interpolateCubehelixDefault:cubehelix$2,interpolateRainbow:rainbow$1,interpolateWarm:warm,interpolateCool:cool,interpolateViridis:viridis,interpolateMagma:magma,interpolateInferno:inferno,interpolatePlasma:plasma,scaleSequential:sequential});var _d3Color=src$3&&undefined||src$3;var drawing=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _typeof$1=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"?function(obj){return _typeof(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)};var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.areaLineGenerator=areaLineGenerator;exports.areaLine=areaLine;exports.verticalbar=verticalbar;exports.horizontalbar=horizontalbar;exports.pathStr=pathStr;exports.circlePath=circlePath;exports.rectPath=rectPath;exports.linePath=linePath;exports.jitterLine=jitterLine;exports.cheapSketchy=cheapSketchy;exports.cheapPopArtsy=cheapPopArtsy;exports.randomColor=randomColor;exports.painty=painty;exports.generateSVG=generateSVG;var _react2=_interopRequireDefault(React__default);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function roundToTenth(number){return Math.round(number*10)/10}function areaLineGenerator(customAccessors,interpolator){var lineGenerator=(0,src.area)().x0(customAccessors.x).y0(customAccessors.y).x1(customAccessors.x1).y1(customAccessors.y1).interpolate(interpolator||"linear");return lineGenerator}function areaLine(props){var lineGenerator=areaLineGenerator(props.customAccessors,props.interpolate);props.d=lineGenerator(props.coordinates);return props}function verticalbar(props){props.y=props.y-props.height;return props}function horizontalbar(props){var originalHeight=props.height;var originalWidth=props.width;props.width=originalHeight;props.height=originalWidth;return props}function pathStr(_ref){var x=_ref.x,y=_ref.y,width=_ref.width,height=_ref.height,cx=_ref.cx,cy=_ref.cy,r=_ref.r;if(cx!==undefined){return["M",roundToTenth(cx-r),roundToTenth(cy),"a",r,r,0,1,0,r*2,0,"a",r,r,0,1,0,-(r*2),0].join(" ")+"Z"}return["M",roundToTenth(x),roundToTenth(y),"h",width,"v",height,"h",-width,"v",-height].join(" ")+"Z"}function circlePath(cx,cy,r){return pathStr({cx:cx,cy:cy,r:r})}function rectPath(x,y,width,height){return pathStr({x:x,y:y,width:width,height:height})}function linePath(x1,x2,y1,y2){return"M"+x1+","+y1+"L"+x2+","+y2+"L"}function jitterLine(pathNode){var length=pathNode.getTotalLength();var j=2;var x=j+Math.random()*j*5;var jitteredPoints=[];var lineGen=(0,src.line)().x(function(d){return d.x}).y(function(d){return d.y}).curve(src.curveBasis);var newPoint=pathNode.getPointAtLength(0);jitteredPoints.push(newPoint);while(x<length){newPoint=pathNode.getPointAtLength(x);var newX=newPoint.x+(Math.random()*j-j/2);var newY=newPoint.y+(Math.random()*j-j/2);jitteredPoints.push({x:newX,y:newY});x+=j+Math.random()*j*5}newPoint=pathNode.getPointAtLength(length);jitteredPoints.push(newPoint);return lineGen(jitteredPoints)}function cheapSketchy(path){var opacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(opacity===0){return""}var opacitySketchyScale=(0,d3Scale.scaleLinear)().domain([0,1]).range([10,1]).clamp(true);var length=path.getTotalLength();var drawCode="";var x=0;var step=opacitySketchyScale(opacity);while(x<length/2){var start=path.getPointAtLength(x);var end=path.getPointAtLength(length-x);drawCode+=" M"+(start.x+(Math.random()*step-step/2))+" "+(start.y+(Math.random()*step-step/2))+"L"+(end.x+(Math.random()*step-step/2))+" "+(end.y+(Math.random()*step-step/2));x+=step+Math.random()*step}return drawCode}function cheapPopArtsy(path,size){var length=path.getTotalLength();var circles=[];var x=0;var step=size*3;while(x<length/2){var start=path.getPointAtLength(x);var end=path.getPointAtLength(length-x);var distance=Math.sqrt(Math.pow(end.x-start.x,2)+Math.pow(end.y-start.y,2));var begin=size/2;while(begin<distance-size/2){var percent=begin/distance;var circleXa=percent*start.x;var circleXb=(1-percent)*end.x;var circleYa=percent*start.y;var circleYb=(1-percent)*end.y;circles.push([circleXa+circleXb,circleYa+circleYb]);begin=begin+(step+Math.random())}x=x+step}return circles}function randomColor(baseColor,range){var hslBase=(0,_d3Color.hsl)(baseColor);hslBase.h=hslBase.h+(Math.floor(Math.random()*(range*255))-Math.floor(range/2));hslBase.s=hslBase.s+(Math.floor(Math.random()*range)-Math.floor(range/2));hslBase.l=hslBase.l+(Math.floor(Math.random()*range)-Math.floor(range/2));return hslBase.toString()}function painty(markType,cloneProps){delete cloneProps.markType;if((markType==="path"||markType==="circle"||markType==="line"||markType==="rect")&&cloneProps.style&&(cloneProps.style.stroke||cloneProps.style.fill)){if(markType==="circle"){cloneProps.d=circlePath(cloneProps.cx||0,cloneProps.cy||0,cloneProps.r)}if(markType==="rect"){cloneProps.d=rectPath(cloneProps.x||0,cloneProps.y||0,cloneProps.width,cloneProps.height)}if(markType==="line"){cloneProps.d=linePath(cloneProps.x1,cloneProps.x2,cloneProps.y1,cloneProps.y2)}(0,src$2.select)("body").append("svg").attr("id","sketchyTempSVG");var fills=[];var outlines=[];cloneProps.d.split("M").filter(function(d,i){return i!==0}).forEach(function(pathD,i){var pathDummy=(0,src$2.select)("#sketchyTempSVG").append("path").attr("class",cloneProps.className).attr("d","M"+pathD);var pathNode=pathDummy.node();if(cloneProps.style&&cloneProps.style.fill!=="none"){var sketchyFill=cheapPopArtsy(pathNode,4);var fillProps=_extends({},cloneProps);var fillStyle=_extends({},cloneProps.style);var fillValue=fillStyle.fill;fillProps.style=fillStyle;delete fillProps.d;delete fillProps.style.fillOpacity;delete fillProps.style.stroke;delete fillProps.style.strokeWidth;fills.push(sketchyFill.map(function(circle,ci){fillProps.key="painty-fill-"+i+"-"+ci;fillProps.cx=circle[0];fillProps.cy=circle[1];fillProps.style=_extends({},fillProps.style);fillProps.style.fill=fillProps.style.fill.substr(0,3)==="url"?fillProps.style.fill:randomColor(fillValue,.05);fillProps.r=Math.random()*2+3;return _react2.default.createElement("circle",fillProps)}))}if(cloneProps.style&&cloneProps.style.stroke!=="none"&&cloneProps.style.strokeWidth!==0){var sketchyOutline=jitterLine(pathNode);var outlineProps=_extends({},cloneProps);var outlineStyle=_extends({},cloneProps.style);outlineProps.style=outlineStyle;outlineProps.d=sketchyOutline;outlineProps.key="painty-outline-"+i;outlineProps.style.fill="none";outlines.push(_react2.default.createElement("path",outlineProps))}});(0,src$2.select)("#sketchyTempSVG").remove();return[_react2.default.createElement("path",{key:"painty-interaction-overlay",d:cloneProps.d,style:{opacity:0}}),_react2.default.createElement("g",{key:"painty-fill",style:{filter:"url(#paintyFilterHeavy)"}},fills),outlines]}return _react2.default.createElement(markType,cloneProps)}function generateSVG(props,className){var markType=props.markType;var renderMode=props.renderMode;var cloneProps=_extends({},props);delete cloneProps.markType;delete cloneProps.renderMode;delete cloneProps.resetAfter;delete cloneProps.droppable;delete cloneProps.nid;delete cloneProps.dropFunction;delete cloneProps.context;delete cloneProps.updateContext;delete cloneProps.parameters;delete cloneProps.lineDataAccessor;delete cloneProps.customAccessors;delete cloneProps.interpolate;delete cloneProps.forceUpdate;delete cloneProps.searchIterations;delete cloneProps.simpleInterpolate;delete cloneProps.transitionDuration;delete cloneProps.tx;delete cloneProps.ty;delete cloneProps.customTween;if(markType==="verticalbar"){markType="rect";cloneProps=verticalbar(cloneProps)}else if(markType==="horizontalbar"){markType="rect";cloneProps=horizontalbar(cloneProps)}else if(markType==="simpleline"){markType="path";cloneProps=areaLine(cloneProps)}if(props.draggable){delete cloneProps.transform}cloneProps.className=className;var actualSVG=null;if(renderMode==="painty"){actualSVG=painty(markType,cloneProps)}else if(renderMode==="forcePath"&&markType==="circle"){cloneProps.d=circlePath(cloneProps.cx||0,cloneProps.cy||0,cloneProps.r);markType="path";actualSVG=_react2.default.createElement(markType,cloneProps)}else if(renderMode==="forcePath"&&markType==="rect"){cloneProps.d=rectPath(cloneProps.x||0,cloneProps.y||0,cloneProps.width,cloneProps.height);markType="path";actualSVG=_react2.default.createElement(markType,cloneProps)}else{if(props.markType==="text"&&_typeof$1(cloneProps.children)!=="object"){cloneProps.children=_react2.default.createElement("tspan",null,cloneProps.children)}actualSVG=_react2.default.createElement(markType,cloneProps)}return actualSVG}});var drawing$1=unwrapExports(drawing);var drawing_1=drawing.areaLineGenerator;var drawing_2=drawing.areaLine;var drawing_3=drawing.verticalbar;var drawing_4=drawing.horizontalbar;var drawing_5=drawing.pathStr;var drawing_6=drawing.circlePath;var drawing_7=drawing.rectPath;var drawing_8=drawing.linePath;var drawing_9=drawing.jitterLine;var drawing_10=drawing.cheapSketchy;var drawing_11=drawing.cheapPopArtsy;var drawing_12=drawing.randomColor;var drawing_13=drawing.painty;var drawing_14=drawing.generateSVG;var drawing$2=Object.freeze({default:drawing$1,__moduleExports:drawing,areaLineGenerator:drawing_1,areaLine:drawing_2,verticalbar:drawing_3,horizontalbar:drawing_4,pathStr:drawing_5,circlePath:drawing_6,rectPath:drawing_7,linePath:drawing_8,jitterLine:drawing_9,cheapSketchy:drawing_10,cheapPopArtsy:drawing_11,randomColor:drawing_12,painty:drawing_13,generateSVG:drawing_14});var runtime=createCommonjsModule(function(module){!function(global){var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined$1;var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";var runtime=global.regeneratorRuntime;if(runtime){{module.exports=runtime}return}runtime=global.regeneratorRuntime=module.exports;function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){IteratorPrototype=NativeIteratorPrototype}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype;if(!(toStringTagSymbol in genFun)){genFun[toStringTagSymbol]="GeneratorFunction"}}genFun.prototype=Object.create(Gp);return genFun};runtime.awrap=function(arg){return{__await:arg}};function AsyncIterator(generator){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg)}else{var result=record.arg;var value=result.value;if(value&&_typeof(value)==="object"&&hasOwn.call(value,"__await")){return Promise.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)})}return Promise.resolve(value).then(function(unwrapped){result.value=unwrapped;resolve(result)},reject)}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this};runtime.AsyncIterator=AsyncIterator;runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if(context.method==="next"){context.sent=context._sent=context.arg}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg}context.dispatchException(context.arg)}else if(context.method==="return"){context.abrupt("return",context.arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue}return{value:record.arg,done:context.done}}else if(record.type==="throw"){state=GenStateCompleted;context.method="throw";context.arg=record.arg}}}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined$1){context.delegate=null;if(context.method==="throw"){if(delegate.iterator.return){context.method="return";context.arg=undefined$1;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){return ContinueSentinel}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel}if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc;if(context.method!=="return"){context.method="next";context.arg=undefined$1}}else{return info}context.delegate=null;return ContinueSentinel}defineIteratorMethods(Gp);Gp[toStringTagSymbol]="Generator";Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined$1;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined$1,done:true}}Context.prototype={constructor:Context,reset:function reset(skipTempReset){this.prev=0;this.next=0;this.sent=this._sent=undefined$1;this.done=false;this.delegate=null;this.method="next";this.arg=undefined$1;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined$1}}}},stop:function stop(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function dispatchException(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){context.method="next";context.arg=undefined$1}return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel}return this.complete(record)},complete:function complete(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}return ContinueSentinel},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},catch:function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){this.arg=undefined$1}return ContinueSentinel}}}(function(){return this}()||Function("return this")())});var runtime$1=Object.freeze({default:runtime,__moduleExports:runtime});var require$$0$1=runtime$1&&runtime||runtime$1;var g=function(){return this}()||Function("return this")();var hadRuntime=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0;var oldRuntime=hadRuntime&&g.regeneratorRuntime;g.regeneratorRuntime=undefined;var runtimeModule=require$$0$1;if(hadRuntime){g.regeneratorRuntime=oldRuntime}else{try{delete g.regeneratorRuntime}catch(e){g.regeneratorRuntime=undefined}}var runtimeModule$1=Object.freeze({default:runtimeModule,__moduleExports:runtimeModule});var require$$0$2=runtimeModule$1&&runtimeModule||runtimeModule$1;var regenerator=require$$0$2;var regenerator$1=Object.freeze({default:regenerator,__moduleExports:regenerator});var segment=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.RoughSegmentRelation=RoughSegmentRelation;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function RoughSegmentRelation(){return{LEFT:0,RIGHT:1,INTERSECTS:2,AHEAD:3,BEHIND:4,SEPARATE:5,UNDEFINED:6}}var RoughSegment=exports.RoughSegment=function(){function RoughSegment(px1,py1,px2,py2){_classCallCheck(this,RoughSegment);this.RoughSegmentRelationConst=RoughSegmentRelation();this.px1=px1;this.py1=py1;this.px2=px2;this.py2=py2;this.xi=Number.MAX_VALUE;this.yi=Number.MAX_VALUE;this.a=py2-py1;this.b=px1-px2;this.c=px2*py1-px1*py2;this._undefined=this.a==0&&this.b==0&&this.c==0}_createClass(RoughSegment,[{key:"isUndefined",value:function isUndefined(){return this._undefined}},{key:"compare",value:function compare(otherSegment){if(this.isUndefined()||otherSegment.isUndefined()){return this.RoughSegmentRelationConst.UNDEFINED}var grad1=Number.MAX_VALUE;var grad2=Number.MAX_VALUE;var int1=0,int2=0;var a=this.a,b=this.b,c=this.c;if(Math.abs(b)>1e-5){grad1=-a/b;int1=-c/b}if(Math.abs(otherSegment.b)>1e-5){grad2=-otherSegment.a/otherSegment.b;int2=-otherSegment.c/otherSegment.b}if(grad1==Number.MAX_VALUE){if(grad2==Number.MAX_VALUE){if(-c/a!=-otherSegment.c/otherSegment.a){return this.RoughSegmentRelationConst.SEPARATE}if(this.py1>=Math.min(otherSegment.py1,otherSegment.py2)&&this.py1<=Math.max(otherSegment.py1,otherSegment.py2)){this.xi=this.px1;this.yi=this.py1;return this.RoughSegmentRelationConst.INTERSECTS}if(this.py2>=Math.min(otherSegment.py1,otherSegment.py2)&&this.py2<=Math.max(otherSegment.py1,otherSegment.py2)){this.xi=this.px2;this.yi=this.py2;return this.RoughSegmentRelationConst.INTERSECTS}return this.RoughSegmentRelationConst.SEPARATE}this.xi=this.px1;this.yi=grad2*this.xi+int2;if((this.py1-this.yi)*(this.yi-this.py2)<-1e-5||(otherSegment.py1-this.yi)*(this.yi-otherSegment.py2)<-1e-5){return this.RoughSegmentRelationConst.SEPARATE}if(Math.abs(otherSegment.a)<1e-5){if((otherSegment.px1-this.xi)*(this.xi-otherSegment.px2)<-1e-5){return this.RoughSegmentRelationConst.SEPARATE}return this.RoughSegmentRelationConst.INTERSECTS}return this.RoughSegmentRelationConst.INTERSECTS}if(grad2==Number.MAX_VALUE){this.xi=otherSegment.px1;this.yi=grad1*this.xi+int1;if((otherSegment.py1-this.yi)*(this.yi-otherSegment.py2)<-1e-5||(this.py1-this.yi)*(this.yi-this.py2)<-1e-5){return this.RoughSegmentRelationConst.SEPARATE}if(Math.abs(a)<1e-5){if((this.px1-this.xi)*(this.xi-this.px2)<-1e-5){return this.RoughSegmentRelationConst.SEPARATE}return this.RoughSegmentRelationConst.INTERSECTS}return this.RoughSegmentRelationConst.INTERSECTS}if(grad1==grad2){if(int1!=int2){return this.RoughSegmentRelationConst.SEPARATE}if(this.px1>=Math.min(otherSegment.px1,otherSegment.px2)&&this.px1<=Math.max(otherSegment.py1,otherSegment.py2)){this.xi=this.px1;this.yi=this.py1;return this.RoughSegmentRelationConst.INTERSECTS}if(this.px2>=Math.min(otherSegment.px1,otherSegment.px2)&&this.px2<=Math.max(otherSegment.px1,otherSegment.px2)){this.xi=this.px2;this.yi=this.py2;return this.RoughSegmentRelationConst.INTERSECTS}return this.RoughSegmentRelationConst.SEPARATE}this.xi=(int2-int1)/(grad1-grad2);this.yi=grad1*this.xi+int1;if((this.px1-this.xi)*(this.xi-this.px2)<-1e-5||(otherSegment.px1-this.xi)*(this.xi-otherSegment.px2)<-1e-5){return this.RoughSegmentRelationConst.SEPARATE}return this.RoughSegmentRelationConst.INTERSECTS}},{key:"getLength",value:function getLength(){return this._getLength(this.px1,this.py1,this.px2,this.py2)}},{key:"_getLength",value:function _getLength(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return Math.sqrt(dx*dx+dy*dy)}}]);return RoughSegment}()});var segment$1=unwrapExports(segment);var segment_1=segment.RoughSegmentRelation;var segment_2=segment.RoughSegment;var segment$2=Object.freeze({default:segment$1,__moduleExports:segment,RoughSegmentRelation:segment_1,RoughSegment:segment_2});var _segment=segment$2&&segment$1||segment$2;var hachure=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RoughHachureIterator=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RoughHachureIterator=exports.RoughHachureIterator=function(){function RoughHachureIterator(top,bottom,left,right,gap,sinAngle,cosAngle,tanAngle){_classCallCheck(this,RoughHachureIterator);this.top=top;this.bottom=bottom;this.left=left;this.right=right;this.gap=gap;this.sinAngle=sinAngle;this.tanAngle=tanAngle;if(Math.abs(sinAngle)<1e-4){this.pos=left+gap}else if(Math.abs(sinAngle)>.9999){this.pos=top+gap}else{this.deltaX=(bottom-top)*Math.abs(tanAngle);this.pos=left-Math.abs(this.deltaX);this.hGap=Math.abs(gap/cosAngle);this.sLeft=new _segment.RoughSegment(left,bottom,left,top);this.sRight=new _segment.RoughSegment(right,bottom,right,top)}}_createClass(RoughHachureIterator,[{key:"getNextLine",value:function getNextLine(){if(Math.abs(this.sinAngle)<1e-4){if(this.pos<this.right){var line=[this.pos,this.top,this.pos,this.bottom];this.pos+=this.gap;return line}}else if(Math.abs(this.sinAngle)>.9999){if(this.pos<this.bottom){var _line=[this.left,this.pos,this.right,this.pos];this.pos+=this.gap;return _line}}else{var xLower=this.pos-this.deltaX/2;var xUpper=this.pos+this.deltaX/2;var yLower=this.bottom;var yUpper=this.top;if(this.pos<this.right+this.deltaX){while(xLower<this.left&&xUpper<this.left||xLower>this.right&&xUpper>this.right){this.pos+=this.hGap;xLower=this.pos-this.deltaX/2;xUpper=this.pos+this.deltaX/2;if(this.pos>this.right+this.deltaX){return null}}var s=new _segment.RoughSegment(xLower,yLower,xUpper,yUpper);if(s.compare(this.sLeft)==(0,_segment.RoughSegmentRelation)().INTERSECTS){xLower=s.xi;yLower=s.yi}if(s.compare(this.sRight)==(0,_segment.RoughSegmentRelation)().INTERSECTS){xUpper=s.xi;yUpper=s.yi}if(this.tanAngle>0){xLower=this.right-(xLower-this.left);xUpper=this.right-(xUpper-this.left)}var _line2=[xLower,yLower,xUpper,yUpper];this.pos+=this.hGap;return _line2}}return null}}]);return RoughHachureIterator}()});var hachure$1=unwrapExports(hachure);var hachure_1=hachure.RoughHachureIterator;var hachure$2=Object.freeze({default:hachure$1,__moduleExports:hachure,RoughHachureIterator:hachure_1});var path$1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PathToken=function(){function PathToken(type,text){_classCallCheck(this,PathToken);this.type=type;this.text=text}_createClass(PathToken,[{key:"isType",value:function isType(type){return this.type===type}}]);return PathToken}();var ParsedPath=function(){function ParsedPath(d){_classCallCheck(this,ParsedPath);this.PARAMS={A:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],a:["rx","ry","x-axis-rotation","large-arc-flag","sweep-flag","x","y"],C:["x1","y1","x2","y2","x","y"],c:["x1","y1","x2","y2","x","y"],H:["x"],h:["x"],L:["x","y"],l:["x","y"],M:["x","y"],m:["x","y"],Q:["x1","y1","x","y"],q:["x1","y1","x","y"],S:["x2","y2","x","y"],s:["x2","y2","x","y"],T:["x","y"],t:["x","y"],V:["y"],v:["y"],Z:[],z:[]};this.COMMAND=0;this.NUMBER=1;this.EOD=2;this.segments=[];this.d=d||"";this.parseData(d);this.processPoints()}_createClass(ParsedPath,[{key:"loadFromSegments",value:function loadFromSegments(segments){this.segments=segments;this.processPoints()}},{key:"processPoints",value:function processPoints(){var first=null,currentPoint=[0,0];for(var i=0;i<this.segments.length;i++){var s=this.segments[i];switch(s.key){case"M":case"L":case"T":s.point=[s.data[0],s.data[1]];break;case"m":case"l":case"t":s.point=[s.data[0]+currentPoint[0],s.data[1]+currentPoint[1]];break;case"H":s.point=[s.data[0],currentPoint[1]];break;case"h":s.point=[s.data[0]+currentPoint[0],currentPoint[1]];break;case"V":s.point=[currentPoint[0],s.data[0]];break;case"v":s.point=[currentPoint[0],s.data[0]+currentPoint[1]];break;case"z":case"Z":if(first){s.point=[first[0],first[1]]}break;case"C":s.point=[s.data[4],s.data[5]];break;case"c":s.point=[s.data[4]+currentPoint[0],s.data[5]+currentPoint[1]];break;case"S":s.point=[s.data[2],s.data[3]];break;case"s":s.point=[s.data[2]+currentPoint[0],s.data[3]+currentPoint[1]];break;case"Q":s.point=[s.data[2],s.data[3]];break;case"q":s.point=[s.data[2]+currentPoint[0],s.data[3]+currentPoint[1]];break;case"A":s.point=[s.data[5],s.data[6]];break;case"a":s.point=[s.data[5]+currentPoint[0],s.data[6]+currentPoint[1]];break}if(s.key==="m"||s.key==="M"){first=null}if(s.point){currentPoint=s.point;if(!first){first=s.point}}if(s.key==="z"||s.key==="Z"){first=null}}}},{key:"parseData",value:function parseData(d){var tokens=this.tokenize(d);var index=0;var token=tokens[index];var mode="BOD";this.segments=new Array;while(!token.isType(this.EOD)){var param_length;var params=new Array;if(mode=="BOD"){if(token.text=="M"||token.text=="m"){index++;param_length=this.PARAMS[token.text].length;mode=token.text}else{return this.parseData("M0,0"+d)}}else{if(token.isType(this.NUMBER)){param_length=this.PARAMS[mode].length}else{index++;param_length=this.PARAMS[token.text].length;mode=token.text}}if(index+param_length<tokens.length){for(var i=index;i<index+param_length;i++){var number=tokens[i];if(number.isType(this.NUMBER)){params[params.length]=number.text}else{console.error("Parameter type is not a number: "+mode+","+number.text);return}}var segment;if(this.PARAMS[mode]){segment={key:mode,data:params}}else{console.error("Unsupported segment type: "+mode);return}this.segments.push(segment);index+=param_length;token=tokens[index];if(mode=="M")mode="L";if(mode=="m")mode="l"}else{console.error("Path data ended before all parameters were found")}}}},{key:"tokenize",value:function tokenize(d){var tokens=new Array;while(d!=""){if(d.match(/^([ \t\r\n,]+)/)){d=d.substr(RegExp.$1.length)}else if(d.match(/^([aAcChHlLmMqQsStTvVzZ])/)){tokens[tokens.length]=new PathToken(this.COMMAND,RegExp.$1);d=d.substr(RegExp.$1.length)}else if(d.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/)){tokens[tokens.length]=new PathToken(this.NUMBER,parseFloat(RegExp.$1));d=d.substr(RegExp.$1.length)}else{console.error("Unrecognized segment command: "+d);return null}}tokens[tokens.length]=new PathToken(this.EOD,null);return tokens}},{key:"closed",get:function get(){if(typeof this._closed==="undefined"){this._closed=false;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.segments[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var s=_step.value;if(s.key.toLowerCase()==="z"){this._closed=true}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}return this._closed}}]);return ParsedPath}();var RoughPath=exports.RoughPath=function(){function RoughPath(d){_classCallCheck(this,RoughPath);this.d=d;this.parsed=new ParsedPath(d);this._position=[0,0];this.bezierReflectionPoint=null;this.quadReflectionPoint=null;this._first=null}_createClass(RoughPath,[{key:"setPosition",value:function setPosition(x,y){this._position=[x,y];if(!this._first){this._first=[x,y]}}},{key:"segments",get:function get(){return this.parsed.segments}},{key:"closed",get:function get(){return this.parsed.closed}},{key:"linearPoints",get:function get(){if(!this._linearPoints){var lp=[];var points=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.parsed.segments[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var s=_step2.value;var key=s.key.toLowerCase();if(key==="m"||key==="z"){if(points.length){lp.push(points);points=[]}if(key==="z"){continue}}if(s.point){points.push(s.point)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}if(points.length){lp.push(points);points=[]}this._linearPoints=lp}return this._linearPoints}},{key:"first",get:function get(){return this._first},set:function set(v){this._first=v}},{key:"position",get:function get(){return this._position}},{key:"x",get:function get(){return this._position[0]}},{key:"y",get:function get(){return this._position[1]}}]);return RoughPath}();var RoughArcConverter=exports.RoughArcConverter=function(){function RoughArcConverter(from,to,radii,angle,largeArcFlag,sweepFlag){_classCallCheck(this,RoughArcConverter);var radPerDeg=Math.PI/180;this._segIndex=0;this._numSegs=0;if(from[0]==to[0]&&from[1]==to[1]){return}this._rx=Math.abs(radii[0]);this._ry=Math.abs(radii[1]);this._sinPhi=Math.sin(angle*radPerDeg);this._cosPhi=Math.cos(angle*radPerDeg);var x1dash=this._cosPhi*(from[0]-to[0])/2+this._sinPhi*(from[1]-to[1])/2;var y1dash=-this._sinPhi*(from[0]-to[0])/2+this._cosPhi*(from[1]-to[1])/2;var root;var numerator=this._rx*this._rx*this._ry*this._ry-this._rx*this._rx*y1dash*y1dash-this._ry*this._ry*x1dash*x1dash;if(numerator<0){var s=Math.sqrt(1-numerator/(this._rx*this._rx*this._ry*this._ry));this._rx=s;this._ry=s;root=0}else{root=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt(numerator/(this._rx*this._rx*y1dash*y1dash+this._ry*this._ry*x1dash*x1dash))}var cxdash=root*this._rx*y1dash/this._ry;var cydash=-root*this._ry*x1dash/this._rx;this._C=[0,0];this._C[0]=this._cosPhi*cxdash-this._sinPhi*cydash+(from[0]+to[0])/2;this._C[1]=this._sinPhi*cxdash+this._cosPhi*cydash+(from[1]+to[1])/2;this._theta=this.calculateVectorAngle(1,0,(x1dash-cxdash)/this._rx,(y1dash-cydash)/this._ry);var dtheta=this.calculateVectorAngle((x1dash-cxdash)/this._rx,(y1dash-cydash)/this._ry,(-x1dash-cxdash)/this._rx,(-y1dash-cydash)/this._ry);if(!sweepFlag&&dtheta>0){dtheta-=2*Math.PI}else if(sweepFlag&&dtheta<0){dtheta+=2*Math.PI}this._numSegs=Math.ceil(Math.abs(dtheta/(Math.PI/2)));this._delta=dtheta/this._numSegs;this._T=8/3*Math.sin(this._delta/4)*Math.sin(this._delta/4)/Math.sin(this._delta/2);this._from=from}_createClass(RoughArcConverter,[{key:"getNextSegment",value:function getNextSegment(){var cp1,cp2,to;if(this._segIndex==this._numSegs){return null}var cosTheta1=Math.cos(this._theta);var sinTheta1=Math.sin(this._theta);var theta2=this._theta+this._delta;var cosTheta2=Math.cos(theta2);var sinTheta2=Math.sin(theta2);to=[this._cosPhi*this._rx*cosTheta2-this._sinPhi*this._ry*sinTheta2+this._C[0],this._sinPhi*this._rx*cosTheta2+this._cosPhi*this._ry*sinTheta2+this._C[1]];cp1=[this._from[0]+this._T*(-this._cosPhi*this._rx*sinTheta1-this._sinPhi*this._ry*cosTheta1),this._from[1]+this._T*(-this._sinPhi*this._rx*sinTheta1+this._cosPhi*this._ry*cosTheta1)];cp2=[to[0]+this._T*(this._cosPhi*this._rx*sinTheta2+this._sinPhi*this._ry*cosTheta2),to[1]+this._T*(this._sinPhi*this._rx*sinTheta2-this._cosPhi*this._ry*cosTheta2)];this._theta=theta2;this._from=[to[0],to[1]];this._segIndex++;return{cp1:cp1,cp2:cp2,to:to}}},{key:"calculateVectorAngle",value:function calculateVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux);var tb=Math.atan2(vy,vx);if(tb>=ta)return tb-ta;return 2*Math.PI-(ta-tb)}}]);return RoughArcConverter}();var PathFitter=exports.PathFitter=function(){function PathFitter(sets,closed){_classCallCheck(this,PathFitter);this.sets=sets;this.closed=closed}_createClass(PathFitter,[{key:"fit",value:function fit(simplification){var outSets=[];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.sets[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var set=_step3.value;var length=set.length;var estLength=Math.floor(simplification*length);if(estLength<5){if(length<=5){continue}estLength=5}outSets.push(this.reduce(set,estLength))}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}var d="";var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=outSets[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _set=_step4.value;for(var i=0;i<_set.length;i++){var point=_set[i];if(i===0){d+="M"+point[0]+","+point[1]}else{d+="L"+point[0]+","+point[1]}}if(this.closed){d+="z "}}}catch(err){_didIteratorError4=true;_iteratorError4=err}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}}finally{if(_didIteratorError4){throw _iteratorError4}}}return d}},{key:"distance",value:function distance(p1,p2){return Math.sqrt(Math.pow(p1[0]-p2[0],2)+Math.pow(p1[1]-p2[1],2))}},{key:"reduce",value:function reduce(set,count){if(set.length<=count){return set}var points=set.slice(0);while(points.length>count){var areas=[];var minArea=-1;var minIndex=-1;for(var i=1;i<points.length-1;i++){var a=this.distance(points[i-1],points[i]);var b=this.distance(points[i],points[i+1]);var c=this.distance(points[i-1],points[i+1]);var s=(a+b+c)/2;var area=Math.sqrt(s*(s-a)*(s-b)*(s-c));areas.push(area);if(minArea<0||area<minArea){minArea=area;minIndex=i}}if(minIndex>0){points.splice(minIndex,1)}else{break}}return points}}]);return PathFitter}()});var path$2=unwrapExports(path$1);var path_1=path$1.RoughPath;var path_2=path$1.RoughArcConverter;var path_3=path$1.PathFitter;var path$3=Object.freeze({default:path$2,__moduleExports:path$1,RoughPath:path_1,RoughArcConverter:path_2,PathFitter:path_3});var _hachure=hachure$2&&hachure$1||hachure$2;var _path=path$3&&path$2||path$3;var renderer=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RoughRenderer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RoughRenderer=exports.RoughRenderer=function(){function RoughRenderer(){_classCallCheck(this,RoughRenderer)}_createClass(RoughRenderer,[{key:"line",value:function line(x1,y1,x2,y2,o){var ops=this._doubleLine(x1,y1,x2,y2,o);return{type:"path",ops:ops}}},{key:"linearPath",value:function linearPath(points,close,o){var len=(points||[]).length;if(len>2){var ops=[];for(var i=0;i<len-1;i++){ops=ops.concat(this._doubleLine(points[i][0],points[i][1],points[i+1][0],points[i+1][1],o))}if(close){ops=ops.concat(this._doubleLine(points[len-1][0],points[len-1][1],points[0][0],points[0][1],o))}return{type:"path",ops:ops}}else if(len===2){return this.line(points[0][0],points[0][1],points[1][0],points[1][1],o)}}},{key:"polygon",value:function polygon(points,o){return this.linearPath(points,true,o)}},{key:"rectangle",value:function rectangle(x,y,width,height,o){var points=[[x,y],[x+width,y],[x+width,y+height],[x,y+height]];return this.polygon(points,o)}},{key:"curve",value:function curve(points,o){var o1=this._curveWithOffset(points,1*(1+o.roughness*.2),o);var o2=this._curveWithOffset(points,1.5*(1+o.roughness*.22),o);return{type:"path",ops:o1.concat(o2)}}},{key:"ellipse",value:function ellipse(x,y,width,height,o){var increment=Math.PI*2/o.curveStepCount;var rx=Math.abs(width/2);var ry=Math.abs(height/2);rx+=this._getOffset(-rx*.05,rx*.05,o);ry+=this._getOffset(-ry*.05,ry*.05,o);var o1=this._ellipse(increment,x,y,rx,ry,1,increment*this._getOffset(.1,this._getOffset(.4,1,o),o),o);var o2=this._ellipse(increment,x,y,rx,ry,1.5,0,o);return{type:"path",ops:o1.concat(o2)}}},{key:"arc",value:function arc(x,y,width,height,start,stop,closed,roughClosure,o){var cx=x;var cy=y;var rx=Math.abs(width/2);var ry=Math.abs(height/2);rx+=this._getOffset(-rx*.01,rx*.01,o);ry+=this._getOffset(-ry*.01,ry*.01,o);var strt=start;var stp=stop;while(strt<0){strt+=Math.PI*2;stp+=Math.PI*2}if(stp-strt>Math.PI*2){strt=0;stp=Math.PI*2}var ellipseInc=Math.PI*2/o.curveStepCount;var arcInc=Math.min(ellipseInc/2,(stp-strt)/2);var o1=this._arc(arcInc,cx,cy,rx,ry,strt,stp,1,o);var o2=this._arc(arcInc,cx,cy,rx,ry,strt,stp,1.5,o);var ops=o1.concat(o2);if(closed){if(roughClosure){ops=ops.concat(this._doubleLine(cx,cy,cx+rx*Math.cos(strt),cy+ry*Math.sin(strt),o));ops=ops.concat(this._doubleLine(cx,cy,cx+rx*Math.cos(stp),cy+ry*Math.sin(stp),o))}else{ops.push({op:"lineTo",data:[cx,cy]});ops.push({op:"lineTo",data:[cx+rx*Math.cos(strt),cy+ry*Math.sin(strt)]})}}return{type:"path",ops:ops}}},{key:"hachureFillArc",value:function hachureFillArc(x,y,width,height,start,stop,o){var cx=x;var cy=y;var rx=Math.abs(width/2);var ry=Math.abs(height/2);rx+=this._getOffset(-rx*.01,rx*.01,o);ry+=this._getOffset(-ry*.01,ry*.01,o);var strt=start;var stp=stop;while(strt<0){strt+=Math.PI*2;stp+=Math.PI*2}if(stp-strt>Math.PI*2){strt=0;stp=Math.PI*2}var increment=(stp-strt)/o.curveStepCount;var xc=[],yc=[];for(var angle=strt;angle<=stp;angle=angle+increment){xc.push(cx+rx*Math.cos(angle));yc.push(cy+ry*Math.sin(angle))}xc.push(cx+rx*Math.cos(stp));yc.push(cy+ry*Math.sin(stp));xc.push(cx);yc.push(cy);return this.hachureFillShape(xc,yc,o)}},{key:"solidFillShape",value:function solidFillShape(xCoords,yCoords,o){var ops=[];if(xCoords&&yCoords&&xCoords.length&&yCoords.length&&xCoords.length===yCoords.length){var offset=o.maxRandomnessOffset||0;var len=xCoords.length;if(len>2){ops.push({op:"move",data:[xCoords[0]+this._getOffset(-offset,offset,o),yCoords[0]+this._getOffset(-offset,offset,o)]});for(var i=1;i<len;i++){ops.push({op:"lineTo",data:[xCoords[i]+this._getOffset(-offset,offset,o),yCoords[i]+this._getOffset(-offset,offset,o)]})}}}return{type:"fillPath",ops:ops}}},{key:"hachureFillShape",value:function hachureFillShape(xCoords,yCoords,o){var ops=[];if(xCoords&&yCoords&&xCoords.length&&yCoords.length){var left=xCoords[0];var right=xCoords[0];var top=yCoords[0];var bottom=yCoords[0];for(var i=1;i<xCoords.length;i++){left=Math.min(left,xCoords[i]);right=Math.max(right,xCoords[i]);top=Math.min(top,yCoords[i]);bottom=Math.max(bottom,yCoords[i])}var angle=o.hachureAngle;var gap=o.hachureGap;if(gap<0){gap=o.strokeWidth*4}gap=Math.max(gap,.1);var radPerDeg=Math.PI/180;var hachureAngle=angle%180*radPerDeg;var cosAngle=Math.cos(hachureAngle);var sinAngle=Math.sin(hachureAngle);var tanAngle=Math.tan(hachureAngle);var it=new _hachure.RoughHachureIterator(top-1,bottom+1,left-1,right+1,gap,sinAngle,cosAngle,tanAngle);var rectCoords=void 0;while((rectCoords=it.getNextLine())!=null){var lines=this._getIntersectingLines(rectCoords,xCoords,yCoords);for(var _i=0;_i<lines.length;_i++){if(_i<lines.length-1){var p1=lines[_i];var p2=lines[_i+1];ops=ops.concat(this._doubleLine(p1[0],p1[1],p2[0],p2[1],o))}}}}return{type:"fillSketch",ops:ops}}},{key:"hachureFillEllipse",value:function hachureFillEllipse(cx,cy,width,height,o){var ops=[];var rx=Math.abs(width/2);var ry=Math.abs(height/2);rx+=this._getOffset(-rx*.05,rx*.05,o);ry+=this._getOffset(-ry*.05,ry*.05,o);var angle=o.hachureAngle;var gap=o.hachureGap;if(gap<=0){gap=o.strokeWidth*4}var fweight=o.fillWeight;if(fweight<0){fweight=o.strokeWidth/2}var radPerDeg=Math.PI/180;var hachureAngle=angle%180*radPerDeg;var tanAngle=Math.tan(hachureAngle);var aspectRatio=ry/rx;var hyp=Math.sqrt(aspectRatio*tanAngle*aspectRatio*tanAngle+1);var sinAnglePrime=aspectRatio*tanAngle/hyp;var cosAnglePrime=1/hyp;var gapPrime=gap/(rx*ry/Math.sqrt(ry*cosAnglePrime*(ry*cosAnglePrime)+rx*sinAnglePrime*(rx*sinAnglePrime))/rx);var halfLen=Math.sqrt(rx*rx-(cx-rx+gapPrime)*(cx-rx+gapPrime));for(var xPos=cx-rx+gapPrime;xPos<cx+rx;xPos+=gapPrime){halfLen=Math.sqrt(rx*rx-(cx-xPos)*(cx-xPos));var p1=this._affine(xPos,cy-halfLen,cx,cy,sinAnglePrime,cosAnglePrime,aspectRatio);var p2=this._affine(xPos,cy+halfLen,cx,cy,sinAnglePrime,cosAnglePrime,aspectRatio);ops=ops.concat(this._doubleLine(p1[0],p1[1],p2[0],p2[1],o))}return{type:"fillSketch",ops:ops}}},{key:"svgPath",value:function svgPath(path,o){path=(path||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");var p=new _path.RoughPath(path);if(o.simplification){var fitter=new _path.PathFitter(p.linearPoints,p.closed);var d=fitter.fit(o.simplification);p=new _path.RoughPath(d)}var ops=[];var segments=p.segments||[];for(var i=0;i<segments.length;i++){var s=segments[i];var prev=i>0?segments[i-1]:null;var opList=this._processSegment(p,s,prev,o);if(opList&&opList.length){ops=ops.concat(opList)}}return{type:"path",ops:ops}}},{key:"_bezierTo",value:function _bezierTo(x1,y1,x2,y2,x,y,path,o){var ops=[];var ros=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.5];var f=null;for(var i=0;i<2;i++){if(i===0){ops.push({op:"move",data:[path.x,path.y]})}else{ops.push({op:"move",data:[path.x+this._getOffset(-ros[0],ros[0],o),path.y+this._getOffset(-ros[0],ros[0],o)]})}f=[x+this._getOffset(-ros[i],ros[i],o),y+this._getOffset(-ros[i],ros[i],o)];ops.push({op:"bcurveTo",data:[x1+this._getOffset(-ros[i],ros[i],o),y1+this._getOffset(-ros[i],ros[i],o),x2+this._getOffset(-ros[i],ros[i],o),y2+this._getOffset(-ros[i],ros[i],o),f[0],f[1]]})}path.setPosition(f[0],f[1]);return ops}},{key:"_processSegment",value:function _processSegment(path,seg,prevSeg,o){var ops=[];switch(seg.key){case"M":case"m":var delta=seg.key==="m";if(seg.data.length>=2){var x=+seg.data[0];var y=+seg.data[1];if(delta){x+=path.x;y+=path.y}var ro=1*(o.maxRandomnessOffset||0);x=x+this._getOffset(-ro,ro,o);y=y+this._getOffset(-ro,ro,o);path.setPosition(x,y);ops.push({op:"move",data:[x,y]})}break;case"L":case"l":var _delta=seg.key==="l";if(seg.data.length>=2){var _x=+seg.data[0];var _y=+seg.data[1];if(_delta){_x+=path.x;_y+=path.y}ops=ops.concat(this._doubleLine(path.x,path.y,_x,_y,o));path.setPosition(_x,_y)}break;case"H":case"h":var _delta2=seg.key==="h";if(seg.data.length){var _x2=+seg.data[0];if(_delta2){_x2+=path.x}ops=ops.concat(this._doubleLine(path.x,path.y,_x2,path.y,o));path.setPosition(_x2,path.y)}break;case"V":case"v":var _delta3=seg.key==="v";if(seg.data.length){var _y2=+seg.data[0];if(_delta3){_y2+=path.y}ops=ops.concat(this._doubleLine(path.x,path.y,path.x,_y2,o));path.setPosition(path.x,_y2)}break;case"Z":case"z":if(path.first){ops=ops.concat(this._doubleLine(path.x,path.y,path.first[0],path.first[1],o));path.setPosition(path.first[0],path.first[1]);path.first=null}break;case"C":case"c":var _delta4=seg.key==="c";if(seg.data.length>=6){var x1=+seg.data[0];var y1=+seg.data[1];var x2=+seg.data[2];var y2=+seg.data[3];var _x3=+seg.data[4];var _y3=+seg.data[5];if(_delta4){x1+=path.x;x2+=path.x;_x3+=path.x;y1+=path.y;y2+=path.y;_y3+=path.y}var ob=this._bezierTo(x1,y1,x2,y2,_x3,_y3,path,o);ops=ops.concat(ob);path.bezierReflectionPoint=[_x3+(_x3-x2),_y3+(_y3-y2)]}break;case"S":case"s":var _delta5=seg.key==="s";if(seg.data.length>=4){var _x4=+seg.data[0];var _y4=+seg.data[1];var _x5=+seg.data[2];var _y5=+seg.data[3];if(_delta5){_x4+=path.x;_x5+=path.x;_y4+=path.y;_y5+=path.y}var _x6=_x4;var _y6=_y4;var prevKey=prevSeg?prevSeg.key:"";var ref=null;if(prevKey=="c"||prevKey=="C"||prevKey=="s"||prevKey=="S"){ref=path.bezierReflectionPoint}if(ref){_x6=ref[0];_y6=ref[1]}var _ob=this._bezierTo(_x6,_y6,_x4,_y4,_x5,_y5,path,o);ops=ops.concat(_ob);path.bezierReflectionPoint=[_x5+(_x5-_x4),_y5+(_y5-_y4)]}break;case"Q":case"q":var _delta6=seg.key==="q";if(seg.data.length>=4){var _x7=+seg.data[0];var _y7=+seg.data[1];var _x8=+seg.data[2];var _y8=+seg.data[3];if(_delta6){_x7+=path.x;_x8+=path.x;_y7+=path.y;_y8+=path.y}var offset1=1*(1+o.roughness*.2);var offset2=1.5*(1+o.roughness*.22);ops.push({op:"move",data:[path.x+this._getOffset(-offset1,offset1,o),path.y+this._getOffset(-offset1,offset1,o)]});var f=[_x8+this._getOffset(-offset1,offset1,o),_y8+this._getOffset(-offset1,offset1,o)];ops.push({op:"qcurveTo",data:[_x7+this._getOffset(-offset1,offset1,o),_y7+this._getOffset(-offset1,offset1,o),f[0],f[1]]});ops.push({op:"move",data:[path.x+this._getOffset(-offset2,offset2,o),path.y+this._getOffset(-offset2,offset2,o)]});f=[_x8+this._getOffset(-offset2,offset2,o),_y8+this._getOffset(-offset2,offset2,o)];ops.push({op:"qcurveTo",data:[_x7+this._getOffset(-offset2,offset2,o),_y7+this._getOffset(-offset2,offset2,o),f[0],f[1]]});path.setPosition(f[0],f[1]);path.quadReflectionPoint=[_x8+(_x8-_x7),_y8+(_y8-_y7)]}break;case"T":case"t":var _delta7=seg.key==="t";if(seg.data.length>=2){var _x9=+seg.data[0];var _y9=+seg.data[1];if(_delta7){_x9+=path.x;_y9+=path.y}var _x10=_x9;var _y10=_y9;var _prevKey=prevSeg?prevSeg.key:"";var ref=null;if(_prevKey=="q"||_prevKey=="Q"||_prevKey=="t"||_prevKey=="T"){ref=path.quadReflectionPoint}if(ref){_x10=ref[0];_y10=ref[1]}var _offset=1*(1+o.roughness*.2);var _offset2=1.5*(1+o.roughness*.22);ops.push({op:"move",data:[path.x+this._getOffset(-_offset,_offset,o),path.y+this._getOffset(-_offset,_offset,o)]});var _f=[_x9+this._getOffset(-_offset,_offset,o),_y9+this._getOffset(-_offset,_offset,o)];ops.push({op:"qcurveTo",data:[_x10+this._getOffset(-_offset,_offset,o),_y10+this._getOffset(-_offset,_offset,o),_f[0],_f[1]]});ops.push({op:"move",data:[path.x+this._getOffset(-_offset2,_offset2,o),path.y+this._getOffset(-_offset2,_offset2,o)]});_f=[_x9+this._getOffset(-_offset2,_offset2,o),_y9+this._getOffset(-_offset2,_offset2,o)];ops.push({op:"qcurveTo",data:[_x10+this._getOffset(-_offset2,_offset2,o),_y10+this._getOffset(-_offset2,_offset2,o),_f[0],_f[1]]});path.setPosition(_f[0],_f[1]);path.quadReflectionPoint=[_x9+(_x9-_x10),_y9+(_y9-_y10)]}break;case"A":case"a":var _delta8=seg.key==="a";if(seg.data.length>=7){var rx=+seg.data[0];var ry=+seg.data[1];var angle=+seg.data[2];var largeArcFlag=+seg.data[3];var sweepFlag=+seg.data[4];var _x11=+seg.data[5];var _y11=+seg.data[6];if(_delta8){_x11+=path.x;_y11+=path.y}if(_x11==path.x&&_y11==path.y){break}if(rx==0||ry==0){ops=ops.concat(this._doubleLine(path.x,path.y,_x11,_y11,o));path.setPosition(_x11,_y11)}else{var _ro=o.maxRandomnessOffset||0;for(var i=0;i<1;i++){var arcConverter=new _path.RoughArcConverter([path.x,path.y],[_x11,_y11],[rx,ry],angle,largeArcFlag?true:false,sweepFlag?true:false);var segment=arcConverter.getNextSegment();while(segment){var _ob2=this._bezierTo(segment.cp1[0],segment.cp1[1],segment.cp2[0],segment.cp2[1],segment.to[0],segment.to[1],path,o);ops=ops.concat(_ob2);segment=arcConverter.getNextSegment()}}}}break;default:break}return ops}},{key:"_getOffset",value:function _getOffset(min,max,ops){return ops.roughness*(Math.random()*(max-min)+min)}},{key:"_affine",value:function _affine(x,y,cx,cy,sinAnglePrime,cosAnglePrime,R){var A=-cx*cosAnglePrime-cy*sinAnglePrime+cx;var B=R*(cx*sinAnglePrime-cy*cosAnglePrime)+cy;var C=cosAnglePrime;var D=sinAnglePrime;var E=-R*sinAnglePrime;var F=R*cosAnglePrime;return[A+C*x+D*y,B+E*x+F*y]}},{key:"_doubleLine",value:function _doubleLine(x1,y1,x2,y2,o){var o1=this._line(x1,y1,x2,y2,o,true,false);var o2=this._line(x1,y1,x2,y2,o,true,true);return o1.concat(o2)}},{key:"_line",value:function _line(x1,y1,x2,y2,o,move,overlay){var lengthSq=Math.pow(x1-x2,2)+Math.pow(y1-y2,2);var offset=o.maxRandomnessOffset||0;if(offset*offset*100>lengthSq){offset=Math.sqrt(lengthSq)/10}var halfOffset=offset/2;var divergePoint=.2+Math.random()*.2;var midDispX=o.bowing*o.maxRandomnessOffset*(y2-y1)/200;var midDispY=o.bowing*o.maxRandomnessOffset*(x1-x2)/200;midDispX=this._getOffset(-midDispX,midDispX,o);midDispY=this._getOffset(-midDispY,midDispY,o);var ops=[];if(move){if(overlay){ops.push({op:"move",data:[x1+this._getOffset(-halfOffset,halfOffset,o),y1+this._getOffset(-halfOffset,halfOffset,o)]})}else{ops.push({op:"move",data:[x1+this._getOffset(-offset,offset,o),y1+this._getOffset(-offset,offset,o)]})}}if(overlay){ops.push({op:"bcurveTo",data:[midDispX+x1+(x2-x1)*divergePoint+this._getOffset(-halfOffset,halfOffset,o),midDispY+y1+(y2-y1)*divergePoint+this._getOffset(-halfOffset,halfOffset,o),midDispX+x1+2*(x2-x1)*divergePoint+this._getOffset(-halfOffset,halfOffset,o),midDispY+y1+2*(y2-y1)*divergePoint+this._getOffset(-halfOffset,halfOffset,o),x2+this._getOffset(-halfOffset,halfOffset,o),y2+this._getOffset(-halfOffset,halfOffset,o)]})}else{ops.push({op:"bcurveTo",data:[midDispX+x1+(x2-x1)*divergePoint+this._getOffset(-offset,offset,o),midDispY+y1+(y2-y1)*divergePoint+this._getOffset(-offset,offset,o),midDispX+x1+2*(x2-x1)*divergePoint+this._getOffset(-offset,offset,o),midDispY+y1+2*(y2-y1)*divergePoint+this._getOffset(-offset,offset,o),x2+this._getOffset(-offset,offset,o),y2+this._getOffset(-offset,offset,o)]})}return ops}},{key:"_curve",value:function _curve(points,closePoint,o){var len=points.length;var ops=[];if(len>3){var b=[];var s=1-o.curveTightness;ops.push({op:"move",data:[points[1][0],points[1][1]]});for(var i=1;i+2<len;i++){var cachedVertArray=points[i];b[0]=[cachedVertArray[0],cachedVertArray[1]];b[1]=[cachedVertArray[0]+(s*points[i+1][0]-s*points[i-1][0])/6,cachedVertArray[1]+(s*points[i+1][1]-s*points[i-1][1])/6];b[2]=[points[i+1][0]+(s*points[i][0]-s*points[i+2][0])/6,points[i+1][1]+(s*points[i][1]-s*points[i+2][1])/6];b[3]=[points[i+1][0],points[i+1][1]];ops.push({op:"bcurveTo",data:[b[1][0],b[1][1],b[2][0],b[2][1],b[3][0],b[3][1]]})}if(closePoint&&closePoint.length===2){var ro=o.maxRandomnessOffset;ops.push({ops:"lineTo",data:[closePoint[0]+this._getOffset(-ro,ro,o),closePoint[1]+ +this._getOffset(-ro,ro,o)]})}}else if(len===3){ops.push({op:"move",data:[points[1][0],points[1][1]]});ops.push({op:"bcurveTo",data:[points[1][0],points[1][1],points[2][0],points[2][1],points[2][0],points[2][1]]})}else if(len===2){ops=ops.concat(this._doubleLine(points[0][0],points[0][1],points[1][0],points[1][1],o))}return ops}},{key:"_ellipse",value:function _ellipse(increment,cx,cy,rx,ry,offset,overlap,o){var radOffset=this._getOffset(-.5,.5,o)-Math.PI/2;var points=[];points.push([this._getOffset(-offset,offset,o)+cx+.9*rx*Math.cos(radOffset-increment),this._getOffset(-offset,offset,o)+cy+.9*ry*Math.sin(radOffset-increment)]);for(var angle=radOffset;angle<Math.PI*2+radOffset-.01;angle=angle+increment){points.push([this._getOffset(-offset,offset,o)+cx+rx*Math.cos(angle),this._getOffset(-offset,offset,o)+cy+ry*Math.sin(angle)])}points.push([this._getOffset(-offset,offset,o)+cx+rx*Math.cos(radOffset+Math.PI*2+overlap*.5),this._getOffset(-offset,offset,o)+cy+ry*Math.sin(radOffset+Math.PI*2+overlap*.5)]);points.push([this._getOffset(-offset,offset,o)+cx+.98*rx*Math.cos(radOffset+overlap),this._getOffset(-offset,offset,o)+cy+.98*ry*Math.sin(radOffset+overlap)]);points.push([this._getOffset(-offset,offset,o)+cx+.9*rx*Math.cos(radOffset+overlap*.5),this._getOffset(-offset,offset,o)+cy+.9*ry*Math.sin(radOffset+overlap*.5)]);return this._curve(points,null,o)}},{key:"_curveWithOffset",value:function _curveWithOffset(points,offset,o){var ps=[];ps.push([points[0][0]+this._getOffset(-offset,offset,o),points[0][1]+this._getOffset(-offset,offset,o)]);ps.push([points[0][0]+this._getOffset(-offset,offset,o),points[0][1]+this._getOffset(-offset,offset,o)]);for(var i=1;i<points.length;i++){ps.push([points[i][0]+this._getOffset(-offset,offset,o),points[i][1]+this._getOffset(-offset,offset,o)]);if(i===points.length-1){ps.push([points[i][0]+this._getOffset(-offset,offset,o),points[i][1]+this._getOffset(-offset,offset,o)])}}return this._curve(ps,null,o)}},{key:"_arc",value:function _arc(increment,cx,cy,rx,ry,strt,stp,offset,o){var radOffset=strt+this._getOffset(-.1,.1,o);var points=[];points.push([this._getOffset(-offset,offset,o)+cx+.9*rx*Math.cos(radOffset-increment),this._getOffset(-offset,offset,o)+cy+.9*ry*Math.sin(radOffset-increment)]);for(var angle=radOffset;angle<=stp;angle=angle+increment){points.push([this._getOffset(-offset,offset,o)+cx+rx*Math.cos(angle),this._getOffset(-offset,offset,o)+cy+ry*Math.sin(angle)])}points.push([cx+rx*Math.cos(stp),cy+ry*Math.sin(stp)]);points.push([cx+rx*Math.cos(stp),cy+ry*Math.sin(stp)]);return this._curve(points,null,o)}},{key:"_getIntersectingLines",value:function _getIntersectingLines(lineCoords,xCoords,yCoords){var intersections=[];var s1=new _segment.RoughSegment(lineCoords[0],lineCoords[1],lineCoords[2],lineCoords[3]);for(var i=0;i<xCoords.length;i++){var s2=new _segment.RoughSegment(xCoords[i],yCoords[i],xCoords[(i+1)%xCoords.length],yCoords[(i+1)%xCoords.length]);if(s1.compare(s2)==(0,_segment.RoughSegmentRelation)().INTERSECTS){intersections.push([s1.xi,s1.yi])}}return intersections}}]);return RoughRenderer}()});var renderer$1=unwrapExports(renderer);var renderer_1=renderer.RoughRenderer;var renderer$2=Object.freeze({default:renderer$1,__moduleExports:renderer,RoughRenderer:renderer_1});var _regenerator=regenerator$1&&regenerator||regenerator$1;var _renderer=renderer$2&&renderer$1||renderer$2;var generator=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RoughGeneratorAsync=exports.RoughGenerator=undefined;var _regenerator2=_interopRequireDefault(_regenerator);var _typeof$1=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"?function(obj){return _typeof(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}self._roughScript=self.document&&self.document.currentScript&&self.document.currentScript.src;var RoughGenerator=exports.RoughGenerator=function(){function RoughGenerator(config,canvas){_classCallCheck(this,RoughGenerator);this.config=config||{};this.canvas=canvas;this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveStepCount:9,fill:null,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1};if(this.config.options){this.defaultOptions=this._options(this.config.options)}}_createClass(RoughGenerator,[{key:"_options",value:function _options(options){return options?_extends({},this.defaultOptions,options):this.defaultOptions}},{key:"_drawable",value:function _drawable(shape,sets,options){return{shape:shape,sets:sets||[],options:options||this.defaultOptions}}},{key:"line",value:function line(x1,y1,x2,y2,options){var o=this._options(options);return this._drawable("line",[this.lib.line(x1,y1,x2,y2,o)],o)}},{key:"rectangle",value:function rectangle(x,y,width,height,options){var o=this._options(options);var paths=[];if(o.fill){var xc=[x,x+width,x+width,x];var yc=[y,y,y+height,y+height];if(o.fillStyle==="solid"){paths.push(this.lib.solidFillShape(xc,yc,o))}else{paths.push(this.lib.hachureFillShape(xc,yc,o))}}paths.push(this.lib.rectangle(x,y,width,height,o));return this._drawable("rectangle",paths,o)}},{key:"ellipse",value:function ellipse(x,y,width,height,options){var o=this._options(options);var paths=[];if(o.fill){if(o.fillStyle==="solid"){var shape=this.lib.ellipse(x,y,width,height,o);shape.type="fillPath";paths.push(shape)}else{paths.push(this.lib.hachureFillEllipse(x,y,width,height,o))}}paths.push(this.lib.ellipse(x,y,width,height,o));return this._drawable("ellipse",paths,o)}},{key:"circle",value:function circle(x,y,diameter,options){var ret=this.ellipse(x,y,diameter,diameter,options);ret.shape="circle";return ret}},{key:"linearPath",value:function linearPath(points,options){var o=this._options(options);return this._drawable("linearPath",[this.lib.linearPath(points,false,o)],o)}},{key:"polygon",value:function polygon(points,options){var o=this._options(options);var paths=[];if(o.fill){var xc=[],yc=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=points[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var p=_step.value;xc.push(p[0]);yc.push(p[1])}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(o.fillStyle==="solid"){paths.push(this.lib.solidFillShape(xc,yc,o))}else{paths.push(this.lib.hachureFillShape(xc,yc,o))}}paths.push(this.lib.linearPath(points,true,o));return this._drawable("polygon",paths,o)}},{key:"arc",value:function arc(x,y,width,height,start,stop,closed,options){var o=this._options(options);var paths=[];if(closed&&o.fill){if(o.fillStyle==="solid"){var shape=this.lib.arc(x,y,width,height,start,stop,true,false,o);shape.type="fillPath";paths.push(shape)}else{paths.push(this.lib.hachureFillArc(x,y,width,height,start,stop,o))}}paths.push(this.lib.arc(x,y,width,height,start,stop,closed,true,o));return this._drawable("arc",paths,o)}},{key:"curve",value:function curve(points,options){var o=this._options(options);return this._drawable("curve",[this.lib.curve(points,o)],o)}},{key:"path",value:function path(d,options){var o=this._options(options);var paths=[];if(!d){return this._drawable("path",paths,o)}if(o.fill){if(o.fillStyle==="solid"){var shape={type:"path2Dfill",path:d};paths.push(shape)}else{var size=this._computePathSize(d);var xc=[0,size[0],size[0],0];var yc=[0,0,size[1],size[1]];var _shape=this.lib.hachureFillShape(xc,yc,o);_shape.type="path2Dpattern";_shape.size=size;_shape.path=d;paths.push(_shape)}}paths.push(this.lib.svgPath(d,o));return this._drawable("path",paths,o)}},{key:"toPaths",value:function toPaths(drawable){var sets=drawable.sets||[];var o=drawable.options||this.defaultOptions;var paths=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=sets[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var drawing=_step2.value;var path=null;switch(drawing.type){case"path":path={d:this.opsToPath(drawing),stroke:o.stroke,strokeWidth:o.strokeWidth,fill:"none"};break;case"fillPath":path={d:this.opsToPath(drawing),stroke:"none",strokeWidth:0,fill:o.fill};break;case"fillSketch":path=this._fillSketch(drawing,o);break;case"path2Dfill":path={d:drawing.path,stroke:"none",strokeWidth:0,fill:o.fill};break;case"path2Dpattern":var size=drawing.size;var pattern={x:0,y:0,width:1,height:1,viewBox:"0 0 "+Math.round(size[0])+" "+Math.round(size[1]),patternUnits:"objectBoundingBox",path:this._fillSketch(drawing,o)};path={d:drawing.path,stroke:"none",strokeWidth:0,pattern:pattern};break}if(path){paths.push(path)}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}return paths}},{key:"_fillSketch",value:function _fillSketch(drawing,o){var fweight=o.fillWeight;if(fweight<0){fweight=o.strokeWidth/2}return{d:this.opsToPath(drawing),stroke:o.fill,strokeWidth:fweight,fill:"none"}}},{key:"opsToPath",value:function opsToPath(drawing){var path="";var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=drawing.ops[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var item=_step3.value;var data=item.data;switch(item.op){case"move":path+="M"+data[0]+" "+data[1]+" ";break;case"bcurveTo":path+="C"+data[0]+" "+data[1]+", "+data[2]+" "+data[3]+", "+data[4]+" "+data[5]+" ";break;case"qcurveTo":path+="Q"+data[0]+" "+data[1]+", "+data[2]+" "+data[3]+" ";break;case"lineTo":path+="L"+data[0]+" "+data[1]+" ";break}}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}return path.trim()}},{key:"_computePathSize",value:function _computePathSize(d){var size=[0,0];if(self.document){try{var ns="http://www.w3.org/2000/svg";var svg=self.document.createElementNS(ns,"svg");svg.setAttribute("width","0");svg.setAttribute("height","0");var pathNode=self.document.createElementNS(ns,"path");pathNode.setAttribute("d",d);svg.appendChild(pathNode);self.document.body.appendChild(svg);var bb=pathNode.getBBox();if(bb){size[0]=bb.width||0;size[1]=bb.height||0}self.document.body.removeChild(svg)}catch(err){}}var canvasSize=this._canvasSize();if(!(size[0]*size[1])){size=canvasSize}size[0]=Math.min(size[0],canvasSize[0]);size[1]=Math.min(size[1],canvasSize[1]);return size}},{key:"_canvasSize",value:function _canvasSize(){var val=function val(w){if(w){if((typeof w==="undefined"?"undefined":_typeof$1(w))==="object"){if(w.baseVal&&w.baseVal.value){return w.baseVal.value}}}return w||100};return this.canvas?[val(this.canvas.width),val(this.canvas.height)]:[100,100]}},{key:"lib",get:function get(){if(!this._renderer){if(self&&self.workly&&this.config.async&&!this.config.noWorker){var tos=Function.prototype.toString;var worklySource=this.config.worklyURL||"https://cdn.jsdelivr.net/gh/pshihn/workly/dist/workly.min.js";var rendererSource=this.config.roughURL||self._roughScript;if(rendererSource&&worklySource){var code="importScripts('"+worklySource+"', '"+rendererSource+"');\nworkly.expose(self.rough.createRenderer());";var ourl=URL.createObjectURL(new Blob([code]));this._renderer=workly.proxy(ourl)}else{this._renderer=new _renderer.RoughRenderer}}else{this._renderer=new _renderer.RoughRenderer}}return this._renderer}}]);return RoughGenerator}();var RoughGeneratorAsync=exports.RoughGeneratorAsync=function(_RoughGenerator){_inherits(RoughGeneratorAsync,_RoughGenerator);function RoughGeneratorAsync(){_classCallCheck(this,RoughGeneratorAsync);return _possibleConstructorReturn(this,(RoughGeneratorAsync.__proto__||Object.getPrototypeOf(RoughGeneratorAsync)).apply(this,arguments))}_createClass(RoughGeneratorAsync,[{key:"line",value:function(){var _ref=_asyncToGenerator(_regenerator2.default.mark(function _callee(x1,y1,x2,y2,options){var o;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:o=this._options(options);_context.t0=this;_context.next=4;return this.lib.line(x1,y1,x2,y2,o);case 4:_context.t1=_context.sent;_context.t2=[_context.t1];_context.t3=o;return _context.abrupt("return",_context.t0._drawable.call(_context.t0,"line",_context.t2,_context.t3));case 8:case"end":return _context.stop()}}},_callee,this)}));function line(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)}return line}()},{key:"rectangle",value:function(){var _ref2=_asyncToGenerator(_regenerator2.default.mark(function _callee2(x,y,width,height,options){var o,paths,xc,yc;return _regenerator2.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:o=this._options(options);paths=[];if(!o.fill){_context2.next=18;break}xc=[x,x+width,x+width,x];yc=[y,y,y+height,y+height];if(!(o.fillStyle==="solid")){_context2.next=13;break}_context2.t0=paths;_context2.next=9;return this.lib.solidFillShape(xc,yc,o);case 9:_context2.t1=_context2.sent;_context2.t0.push.call(_context2.t0,_context2.t1);_context2.next=18;break;case 13:_context2.t2=paths;_context2.next=16;return this.lib.hachureFillShape(xc,yc,o);case 16:_context2.t3=_context2.sent;_context2.t2.push.call(_context2.t2,_context2.t3);case 18:_context2.t4=paths;_context2.next=21;return this.lib.rectangle(x,y,width,height,o);case 21:_context2.t5=_context2.sent;_context2.t4.push.call(_context2.t4,_context2.t5);return _context2.abrupt("return",this._drawable("rectangle",paths,o));case 24:case"end":return _context2.stop()}}},_callee2,this)}));function rectangle(_x6,_x7,_x8,_x9,_x10){return _ref2.apply(this,arguments)}return rectangle}()},{key:"ellipse",value:function(){var _ref3=_asyncToGenerator(_regenerator2.default.mark(function _callee3(x,y,width,height,options){var o,paths,shape;return _regenerator2.default.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:o=this._options(options);paths=[];if(!o.fill){_context3.next=16;break}if(!(o.fillStyle==="solid")){_context3.next=11;break}_context3.next=6;return this.lib.ellipse(x,y,width,height,o);case 6:shape=_context3.sent;shape.type="fillPath";paths.push(shape);_context3.next=16;break;case 11:_context3.t0=paths;_context3.next=14;return this.lib.hachureFillEllipse(x,y,width,height,o);case 14:_context3.t1=_context3.sent;_context3.t0.push.call(_context3.t0,_context3.t1);case 16:_context3.t2=paths;_context3.next=19;return this.lib.ellipse(x,y,width,height,o);case 19:_context3.t3=_context3.sent;_context3.t2.push.call(_context3.t2,_context3.t3);return _context3.abrupt("return",this._drawable("ellipse",paths,o));case 22:case"end":return _context3.stop()}}},_callee3,this)}));function ellipse(_x11,_x12,_x13,_x14,_x15){return _ref3.apply(this,arguments)}return ellipse}()},{key:"circle",value:function(){var _ref4=_asyncToGenerator(_regenerator2.default.mark(function _callee4(x,y,diameter,options){var ret;return _regenerator2.default.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.ellipse(x,y,diameter,diameter,options);case 2:ret=_context4.sent;ret.shape="circle";return _context4.abrupt("return",ret);case 5:case"end":return _context4.stop()}}},_callee4,this)}));function circle(_x16,_x17,_x18,_x19){return _ref4.apply(this,arguments)}return circle}()},{key:"linearPath",value:function(){var _ref5=_asyncToGenerator(_regenerator2.default.mark(function _callee5(points,options){var o;return _regenerator2.default.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:o=this._options(options);_context5.t0=this;_context5.next=4;return this.lib.linearPath(points,false,o);case 4:_context5.t1=_context5.sent;_context5.t2=[_context5.t1];_context5.t3=o;return _context5.abrupt("return",_context5.t0._drawable.call(_context5.t0,"linearPath",_context5.t2,_context5.t3));case 8:case"end":return _context5.stop()}}},_callee5,this)}));function linearPath(_x20,_x21){return _ref5.apply(this,arguments)}return linearPath}()},{key:"polygon",value:function(){var _ref6=_asyncToGenerator(_regenerator2.default.mark(function _callee6(points,options){var o,paths,xc,yc,_iteratorNormalCompletion4,_didIteratorError4,_iteratorError4,_iterator4,_step4,p;return _regenerator2.default.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:o=this._options(options);paths=[];if(!o.fill){_context6.next=36;break}xc=[],yc=[];_iteratorNormalCompletion4=true;_didIteratorError4=false;_iteratorError4=undefined;_context6.prev=7;for(_iterator4=points[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){p=_step4.value;xc.push(p[0]);yc.push(p[1])}_context6.next=15;break;case 11:_context6.prev=11;_context6.t0=_context6["catch"](7);_didIteratorError4=true;_iteratorError4=_context6.t0;case 15:_context6.prev=15;_context6.prev=16;if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return()}case 18:_context6.prev=18;if(!_didIteratorError4){_context6.next=21;break}throw _iteratorError4;case 21:return _context6.finish(18);case 22:return _context6.finish(15);case 23:if(!(o.fillStyle==="solid")){_context6.next=31;break}_context6.t1=paths;_context6.next=27;return this.lib.solidFillShape(xc,yc,o);case 27:_context6.t2=_context6.sent;_context6.t1.push.call(_context6.t1,_context6.t2);_context6.next=36;break;case 31:_context6.t3=paths;_context6.next=34;return this.lib.hachureFillShape(xc,yc,o);case 34:_context6.t4=_context6.sent;_context6.t3.push.call(_context6.t3,_context6.t4);case 36:_context6.t5=paths;_context6.next=39;return this.lib.linearPath(points,true,o);case 39:_context6.t6=_context6.sent;_context6.t5.push.call(_context6.t5,_context6.t6);return _context6.abrupt("return",this._drawable("polygon",paths,o));case 42:case"end":return _context6.stop()}}},_callee6,this,[[7,11,15,23],[16,,18,22]])}));function polygon(_x22,_x23){return _ref6.apply(this,arguments)}return polygon}()},{key:"arc",value:function(){var _ref7=_asyncToGenerator(_regenerator2.default.mark(function _callee7(x,y,width,height,start,stop,closed,options){var o,paths,shape;return _regenerator2.default.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:o=this._options(options);paths=[];if(!(closed&&o.fill)){_context7.next=16;break}if(!(o.fillStyle==="solid")){_context7.next=11;break}_context7.next=6;return this.lib.arc(x,y,width,height,start,stop,true,false,o);case 6:shape=_context7.sent;shape.type="fillPath";paths.push(shape);_context7.next=16;break;case 11:_context7.t0=paths;_context7.next=14;return this.lib.hachureFillArc(x,y,width,height,start,stop,o);case 14:_context7.t1=_context7.sent;_context7.t0.push.call(_context7.t0,_context7.t1);case 16:_context7.t2=paths;_context7.next=19;return this.lib.arc(x,y,width,height,start,stop,closed,true,o);case 19:_context7.t3=_context7.sent;_context7.t2.push.call(_context7.t2,_context7.t3);return _context7.abrupt("return",this._drawable("arc",paths,o));case 22:case"end":return _context7.stop()}}},_callee7,this)}));function arc(_x24,_x25,_x26,_x27,_x28,_x29,_x30,_x31){return _ref7.apply(this,arguments)}return arc}()},{key:"curve",value:function(){var _ref8=_asyncToGenerator(_regenerator2.default.mark(function _callee8(points,options){var o;return _regenerator2.default.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:o=this._options(options);_context8.t0=this;_context8.next=4;return this.lib.curve(points,o);case 4:_context8.t1=_context8.sent;_context8.t2=[_context8.t1];_context8.t3=o;return _context8.abrupt("return",_context8.t0._drawable.call(_context8.t0,"curve",_context8.t2,_context8.t3));case 8:case"end":return _context8.stop()}}},_callee8,this)}));function curve(_x32,_x33){return _ref8.apply(this,arguments)}return curve}()},{key:"path",value:function(){var _ref9=_asyncToGenerator(_regenerator2.default.mark(function _callee9(d,options){var o,paths,shape,size,xc,yc,_shape2;return _regenerator2.default.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:o=this._options(options);paths=[];if(d){_context9.next=4;break}return _context9.abrupt("return",this._drawable("path",paths,o));case 4:if(!o.fill){_context9.next=20;break}if(!(o.fillStyle==="solid")){_context9.next=10;break}shape={type:"path2Dfill",path:d};paths.push(shape);_context9.next=20;break;case 10:size=this._computePathSize(d);xc=[0,size[0],size[0],0];yc=[0,0,size[1],size[1]];_context9.next=15;return this.lib.hachureFillShape(xc,yc,o);case 15:_shape2=_context9.sent;_shape2.type="path2Dpattern";_shape2.size=size;_shape2.path=d;paths.push(_shape2);case 20:_context9.t0=paths;_context9.next=23;return this.lib.svgPath(d,o);case 23:_context9.t1=_context9.sent;_context9.t0.push.call(_context9.t0,_context9.t1);return _context9.abrupt("return",this._drawable("path",paths,o));case 26:case"end":return _context9.stop()}}},_callee9,this)}));function path(_x34,_x35){return _ref9.apply(this,arguments)}return path}()}]);return RoughGeneratorAsync}(RoughGenerator)});var generator$1=unwrapExports(generator);var generator_1=generator.RoughGeneratorAsync;var generator_2=generator.RoughGenerator;var generator$2=Object.freeze({default:generator$1,__moduleExports:generator,RoughGeneratorAsync:generator_1,RoughGenerator:generator_2});var markTransition=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var styleTransitionWhitelist=exports.styleTransitionWhitelist=["strokeOpacity","fillOpacity","strokeWidth","fill","stroke","opacity","strokeDasharray"];var redrawSketchyList=exports.redrawSketchyList=["fill","stroke","cx","cy","x","y","d","height","width","x1","x2","y1","y2","rx","ry","r"];var attributeTransitionWhitelist=exports.attributeTransitionWhitelist=["transform"].concat(redrawSketchyList,styleTransitionWhitelist);var reactCSSNameStyleHash=exports.reactCSSNameStyleHash={strokeWidth:"stroke-width",fillOpacity:"fill-opacity",strokeOpacity:"stroke-opacity",strokeDasharray:"stroke-dasharray"};var differentD=exports.differentD=function differentD(d,newD){if(!d||!newD){return true}var lowerD=d.toLowerCase();var lowerNewD=newD.toLowerCase();if((lowerD.match(/m/g)||[]).length!==(lowerNewD.match(/m/g)||[]).length){return true}if((lowerD.match(/l/g)||[]).length!==(lowerNewD.match(/l/g)||[]).length){return true}if((lowerD.match(/c/g)||[]).length!==(lowerNewD.match(/c/g)||[]).length){return true}if((lowerD.match(/a/g)||[]).length!==(lowerNewD.match(/a/g)||[]).length){return true}return false}});var markTransition$1=unwrapExports(markTransition);var markTransition_1=markTransition.styleTransitionWhitelist;var markTransition_2=markTransition.redrawSketchyList;var markTransition_3=markTransition.attributeTransitionWhitelist;var markTransition_4=markTransition.reactCSSNameStyleHash;var markTransition_5=markTransition.differentD;var markTransition$2=Object.freeze({default:markTransition$1,__moduleExports:markTransition,styleTransitionWhitelist:markTransition_1,redrawSketchyList:markTransition_2,attributeTransitionWhitelist:markTransition_3,reactCSSNameStyleHash:markTransition_4,differentD:markTransition_5});function makeEmptyFunction(arg){return function(){return arg}}var emptyFunction$1=function emptyFunction(){};emptyFunction$1.thatReturns=makeEmptyFunction;emptyFunction$1.thatReturnsFalse=makeEmptyFunction(false);emptyFunction$1.thatReturnsTrue=makeEmptyFunction(true);emptyFunction$1.thatReturnsNull=makeEmptyFunction(null);emptyFunction$1.thatReturnsThis=function(){return this};emptyFunction$1.thatReturnsArgument=function(arg){return arg};var emptyFunction_1=emptyFunction$1;var emptyFunction$2=Object.freeze({default:emptyFunction_1,__moduleExports:emptyFunction_1});var validateFormat=function validateFormat(format){};function invariant(condition,format,a,b,c,d,e,f){validateFormat(format);if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}}var invariant_1=invariant;var invariant$1=Object.freeze({default:invariant_1,__moduleExports:invariant_1});var emptyFunction$3=emptyFunction$2&&emptyFunction_1||emptyFunction$2;var ReactPropTypesSecret$3="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";var ReactPropTypesSecret_1$1=ReactPropTypesSecret$3;var ReactPropTypesSecret$4=Object.freeze({default:ReactPropTypesSecret_1$1,__moduleExports:ReactPropTypesSecret_1$1});var invariant$2=invariant$1&&invariant_1||invariant$1;var ReactPropTypesSecret$5=ReactPropTypesSecret$4&&ReactPropTypesSecret_1$1||ReactPropTypesSecret$4;var factoryWithThrowingShims$2=function factoryWithThrowingShims(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret$5){return}invariant$2(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types")}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};ReactPropTypes.checkPropTypes=emptyFunction$3;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes};var factoryWithThrowingShims$3=Object.freeze({default:factoryWithThrowingShims$2,__moduleExports:factoryWithThrowingShims$2});var require$$1$9=factoryWithThrowingShims$3&&factoryWithThrowingShims$2||factoryWithThrowingShims$3;var propTypes$2=createCommonjsModule(function(module){{module.exports=require$$1$9()}});var propTypes$3=Object.freeze({default:propTypes$2,__moduleExports:propTypes$2});var _drawing=drawing$2&&drawing$1||drawing$2;var _generator=generator$2&&generator$1||generator$2;var _markTransition=markTransition$2&&markTransition$1||markTransition$2;var _propTypes=propTypes$3&&propTypes$2||propTypes$3;var Mark_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof$1=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"?function(obj){return _typeof(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function generateSketchyHash(props){var _props$style=props.style,style=_props$style===undefined?{}:_props$style;var sketchyHash="";_markTransition.redrawSketchyList.forEach(function(d){sketchyHash+="-"+(style[d]||props[d])});return sketchyHash}var Mark=function(_React$Component){_inherits(Mark,_React$Component);function Mark(props){_classCallCheck(this,Mark);var _this=_possibleConstructorReturn(this,(Mark.__proto__||Object.getPrototypeOf(Mark)).call(this,props));_this._mouseup=_this._mouseup.bind(_this);_this._mousedown=_this._mousedown.bind(_this);_this._mousemove=_this._mousemove.bind(_this);_this.state={translate:[0,0],mouseOrigin:[],translateOrigin:[0,0],dragging:false,uiUpdate:false,sketchyFill:undefined,sketchyHash:""};return _this}_createClass(Mark,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.updateSketchy(nextProps)}},{key:"componentWillMount",value:function componentWillMount(){this.updateSketchy(this.props)}},{key:"updateSketchy",value:function updateSketchy(nextProps){var renderOptions=nextProps.renderMode!==null&&_typeof$1(nextProps.renderMode)==="object"?nextProps.renderMode:{renderMode:nextProps.renderMode};var sketchyHash=renderOptions.renderMode==="sketchy"&&generateSketchyHash(nextProps);if(sketchyHash&&sketchyHash!==this.state.sketchyHash){var _nextProps$style=nextProps.style,style=_nextProps$style===undefined?{}:_nextProps$style;var _renderOptions$simpli=renderOptions.simplification,simplification=_renderOptions$simpli===undefined?0:_renderOptions$simpli,_renderOptions$curveS=renderOptions.curveStepCount,curveStepCount=_renderOptions$curveS===undefined?9:_renderOptions$curveS,_renderOptions$fillSt=renderOptions.fillStyle,fillStyle=_renderOptions$fillSt===undefined?"hachure":_renderOptions$fillSt,_renderOptions$roughn=renderOptions.roughness,roughness=_renderOptions$roughn===undefined?1:_renderOptions$roughn,_renderOptions$bowing=renderOptions.bowing,bowing=_renderOptions$bowing===undefined?1:_renderOptions$bowing,_renderOptions$fillWe=renderOptions.fillWeight,fillWeight=_renderOptions$fillWe===undefined?1:_renderOptions$fillWe,_renderOptions$hachur=renderOptions.hachureAngle,hachureAngle=_renderOptions$hachur===undefined?-41:_renderOptions$hachur;var roughGenerator=new _generator.RoughGenerator({},{width:1e3,height:1e3});var drawingInstructions=void 0;var roughOptions={fill:style.fill||nextProps.fill,stroke:style.stroke||nextProps.stroke,strokeWidth:style.strokeWidth||nextProps.strokeWidth,fillStyle:fillStyle,roughness:roughness,bowing:bowing,fillWeight:fillWeight,hachureAngle:hachureAngle,hachureGap:renderOptions.hachureGap||style.fillOpacity&&(5-style.fillOpacity*5)*fillWeight||fillWeight*2,curveStepCount:curveStepCount,simplification:simplification};switch(nextProps.markType){case"line":drawingInstructions=roughGenerator.line(nextProps.x1||0,nextProps.y1||0,nextProps.x2||0,nextProps.y2||0,roughOptions);break;case"rect":if(nextProps.rx||nextProps.ry){drawingInstructions=roughGenerator.circle((nextProps.x||0)+nextProps.width/2,(nextProps.y||0)+nextProps.width/2,nextProps.width,roughOptions)}else{drawingInstructions=roughGenerator.rectangle(nextProps.x||0,nextProps.y||0,nextProps.width,nextProps.height,roughOptions)}break;case"circle":drawingInstructions=roughGenerator.circle(nextProps.cx||0,nextProps.cy||0,nextProps.r*2,roughOptions);break;case"ellipse":drawingInstructions=roughGenerator.ellipse(nextProps.x||0,nextProps.y||0,nextProps.width,nextProps.height,roughOptions);break;case"polygon":drawingInstructions=roughGenerator.polygon(nextProps.points,roughOptions);break;case"path":drawingInstructions=roughGenerator.path(nextProps.d,roughOptions);break}var roughPieces=[];roughGenerator.toPaths(drawingInstructions).forEach(function(_ref,i){var d=_ref.d,fill=_ref.fill,stroke=_ref.stroke,strokeWidth=_ref.strokeWidth,pattern=_ref.pattern;if(pattern){var roughRandomID="rough-"+Math.random();roughPieces.push(_react2.default.createElement("pattern",{key:"pattern-"+i,id:roughRandomID,x:pattern.x,y:pattern.y,height:pattern.height,width:pattern.width,viewBox:pattern.viewBox},_react2.default.createElement("path",{key:"pattern-path-"+i,d:pattern.path.d,style:{fill:pattern.path.fill,stroke:pattern.path.stroke,strokeWidth:pattern.path.strokeWidth}})));fill="url(#"+roughRandomID+")"}roughPieces.push(_react2.default.createElement("path",{key:"path-"+i,d:d,style:{fill:fill,stroke:stroke,strokeWidth:strokeWidth},transform:nextProps.transform}))});this.setState({sketchyHash:sketchyHash,sketchyFill:roughPieces})}}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){var _this2=this;if(nextProps.renderMode||this.props.renderMode||this.props.markType!==nextProps.markType||this.state.dragging||this.props.forceUpdate||nextProps.forceUpdate||this.props.className!==nextProps.className||this.props.children!==nextProps.children||this.props.customTween&&!nextProps.customTween||!this.props.customTween&&nextProps.customTween){return true}var canvas=this.props.canvas!==true&&this.props.canvas||this.context&&this.context.canvas;var node=this.node;var actualSVG=(0,_drawing.generateSVG)(nextProps,nextProps.className);var cloneProps=actualSVG.props;if(!cloneProps){return true}var _nextProps$transition=nextProps.transitionDuration,transitionDuration=_nextProps$transition===undefined?{}:_nextProps$transition;var isDefault=typeof transitionDuration==="number";var defaultDuration=isDefault?transitionDuration:1e3;transitionDuration=isDefault?{default:defaultDuration}:_extends({default:defaultDuration},transitionDuration);var newProps=Object.keys(cloneProps).filter(function(d){return d!=="style"});var oldProps=Object.keys(this.props).filter(function(d){return d!=="style"&&!newProps.find(function(p){return p===d})});var hasTransition=(0,src$2.select)(node).select("*").transition;function adjustedPropName(propname){return _markTransition.reactCSSNameStyleHash[propname]||propname}oldProps.forEach(function(oldProp){if(oldProp!=="style"){(0,src$2.select)(node).select("*").attr(adjustedPropName(oldProp),undefined)}});newProps.forEach(function(newProp){if(!hasTransition||!_markTransition.attributeTransitionWhitelist.find(function(d){return d===newProp})||newProp==="d"&&(0,_markTransition.differentD)(cloneProps.d,_this2.props.d)){if(newProp==="d"&&nextProps.customTween){(0,src$2.select)(node).select("*").attr("d",nextProps.customTween.fn(nextProps.customTween.props,nextProps.customTween.props)(1))}else{(0,src$2.select)(node).select("*").attr(adjustedPropName(newProp),cloneProps[newProp])}}else{var _transitionDuration=transitionDuration,defaultDur=_transitionDuration.default,_transitionDuration$n=_transitionDuration[newProp],appliedDuration=_transitionDuration$n===undefined?defaultDur:_transitionDuration$n;if(newProp==="d"&&nextProps.customTween){var initialTweenProps=_extends({},_this2.props.customTween.props);var nextTweenProps=_extends({},nextProps.customTween.props);(0,src$2.select)(node).select("*").transition(adjustedPropName("d")).duration(appliedDuration).attrTween("d",function(){return nextProps.customTween.fn(initialTweenProps,nextTweenProps)})}else{(0,src$2.select)(node).select("*").transition(adjustedPropName(newProp)).duration(appliedDuration).attr(adjustedPropName(newProp),cloneProps[newProp])}}});var newStyleProps=Object.keys(cloneProps.style||{});var oldStyleProps=Object.keys(this.props.style||{}).filter(function(d){return!newStyleProps.find(function(p){return p===d})});oldStyleProps.forEach(function(oldProp){(0,src$2.select)(node).select("*").style(adjustedPropName(oldProp),undefined)});newStyleProps.forEach(function(newProp){if(!hasTransition){(0,src$2.select)(node).select("*").style(adjustedPropName(newProp),cloneProps.style[newProp])}else{var _transitionDuration2=transitionDuration,defaultDur=_transitionDuration2.default,_transitionDuration2$=_transitionDuration2[newProp],appliedDuration=_transitionDuration2$===undefined?defaultDur:_transitionDuration2$;(0,src$2.select)(node).select("*").transition(adjustedPropName(newProp)).duration(appliedDuration).style(adjustedPropName(newProp),cloneProps.style[newProp])}});return false}},{key:"_mouseup",value:function _mouseup(){document.onmousemove=null;var finalTranslate=[0,0];if(!this.props.resetAfter)finalTranslate=this.state.translate;this.setState({dragging:false,translate:finalTranslate,uiUpdate:false});if(this.props.dropFunction&&this.props.context&&this.props.context.dragSource){this.props.dropFunction(this.props.context.dragSource.props,this.props);this.props.updateContext("dragSource",undefined)}}},{key:"_mousedown",value:function _mousedown(event){this.setState({mouseOrigin:[event.pageX,event.pageY],translateOrigin:this.state.translate,dragging:true});document.onmouseup=this._mouseup;document.onmousemove=this._mousemove}},{key:"_mousemove",value:function _mousemove(event){var xAdjust=this.props.freezeX?0:1;var yAdjust=this.props.freezeY?0:1;var adjustedPosition=[event.pageX-this.state.mouseOrigin[0],event.pageY-this.state.mouseOrigin[1]];var adjustedTranslate=[(adjustedPosition[0]+this.state.translateOrigin[0])*xAdjust,(adjustedPosition[1]+this.state.translateOrigin[1])*yAdjust];if(this.props.dropFunction&&this.state.uiUpdate===false){this.props.updateContext("dragSource",this);this.setState({translate:adjustedTranslate,uiUpdate:true,dragging:true})}else{this.setState({translate:adjustedTranslate})}}},{key:"render",value:function render(){var _this3=this;var className=this.props.className||"";var mouseIn=null;var mouseOut=null;var actualSVG=(this.props.renderMode==="sketchy"||this.props.renderMode&&this.props.renderMode.renderMode==="sketchy")&&this.state.sketchyFill||(0,_drawing.generateSVG)(this.props,className);if(this.props.draggable){return _react2.default.createElement("g",{ref:function ref(node){return _this3.node=node},className:className,onMouseEnter:mouseIn,onMouseOut:mouseOut,onDoubleClick:this._doubleclick,style:{pointerEvents:this.props.dropFunction&&this.state.dragging?"none":"all"},onMouseDown:this._mousedown,onMouseUp:this._mouseup,transform:"translate("+this.state.translate+")","aria-label":this.props["aria-label"]},actualSVG)}else{return _react2.default.createElement("g",{ref:function ref(node){return _this3.node=node},className:className,onMouseEnter:mouseIn,onMouseOut:mouseOut,"aria-label":this.props["aria-label"]},actualSVG)}}}]);return Mark}(_react2.default.Component);Mark.propTypes={markType:_propTypes2.default.string.isRequired,forceUpdate:_propTypes2.default.bool,renderMode:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.func,_propTypes2.default.object]),draggable:_propTypes2.default.bool,dropFunction:_propTypes2.default.func,resetAfter:_propTypes2.default.bool,freezeX:_propTypes2.default.bool,freezeY:_propTypes2.default.bool,context:_propTypes2.default.object,updateContext:_propTypes2.default.func,className:_propTypes2.default.string};Mark.contextTypes={canvas:_propTypes2.default.object};exports.default=Mark;module.exports=exports["default"]});var Mark=unwrapExports(Mark_1);var Mark$1=Object.freeze({default:Mark,__moduleExports:Mark_1});var _Mark=Mark$1&&Mark||Mark$1;var DraggableMark_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react2=_interopRequireDefault(React__default);var _Mark2=_interopRequireDefault(_Mark);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DraggableMark=function(_React$Component){_inherits(DraggableMark,_React$Component);function DraggableMark(){_classCallCheck(this,DraggableMark);return _possibleConstructorReturn(this,(DraggableMark.__proto__||Object.getPrototypeOf(DraggableMark)).apply(this,arguments))}_createClass(DraggableMark,[{key:"render",value:function render(){return _react2.default.createElement(_Mark2.default,_extends({draggable:true,resetAfter:true,droppable:true},this.props))}}]);return DraggableMark}(_react2.default.Component);DraggableMark.propTypes={draggable:_propTypes2.default.bool,resetAfter:_propTypes2.default.bool,droppable:_propTypes2.default.bool};exports.default=DraggableMark;module.exports=exports["default"]});var DraggableMark=unwrapExports(DraggableMark_1);var DraggableMark$1=Object.freeze({default:DraggableMark,__moduleExports:DraggableMark_1});var MarkContext_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});var _typeof$1=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"?function(obj){return _typeof(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react2=_interopRequireDefault(React__default);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MarkContext=function(_React$Component){_inherits(MarkContext,_React$Component);function MarkContext(props){_classCallCheck(this,MarkContext);var _this=_possibleConstructorReturn(this,(MarkContext.__proto__||Object.getPrototypeOf(MarkContext)).call(this,props));_this.mapElements=_this.mapElements.bind(_this);_this.shouldComponentUpdate=_this.shouldComponentUpdate.bind(_this);_this.updateContext=_this.updateContext.bind(_this);_this.state={context:{}};return _this}_createClass(MarkContext,[{key:"mapElements",value:function mapElements(element,ei){if(!element)return null;var props={key:"mc-mark-"+ei};if(typeof element.type!=="string"){props.context=this.state.context;props.updateContext=this.updateContext}if(Array.isArray(element))return element.map(this.mapElements);return _react2.default.cloneElement(element,props)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){if(this.props.xyFrameChildren&&this.props.renderNumber===nextProps.renderNumber){return false}return true}},{key:"updateContext",value:function updateContext(prop,value){var currentContext=this.state.context;currentContext[prop]=value;this.setState({context:currentContext})}},{key:"render",value:function render(){var elements=null;if(Array.isArray(this.props.children))elements=this.props.children.map(this.mapElements);else if(_typeof$1(this.props.children)==="object")elements=this.mapElements(this.props.children);var transform=[0,0];transform[0]=this.props.position?this.props.position[0]:0;transform[1]=this.props.position?this.props.position[1]:0;return _react2.default.createElement("g",{transform:"translate("+transform.toString()+")"},elements)}}]);return MarkContext}(_react2.default.Component);MarkContext.propTypes={position:_propTypes2.default.array,xyFrameChildren:_propTypes2.default.bool,renderNumber:_propTypes2.default.number};exports.default=MarkContext;module.exports=exports["default"]});var MarkContext=unwrapExports(MarkContext_1);var MarkContext$1=Object.freeze({default:MarkContext,__moduleExports:MarkContext_1});var _DraggableMark=DraggableMark$1&&DraggableMark||DraggableMark$1;var _MarkContext=MarkContext$1&&MarkContext||MarkContext$1;var lib=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.MarkContext=exports.Mark=exports.DraggableMark=undefined;var _Mark2=_interopRequireDefault(_Mark);var _DraggableMark2=_interopRequireDefault(_DraggableMark);var _MarkContext2=_interopRequireDefault(_MarkContext);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={DraggableMark:_DraggableMark2.default,Mark:_Mark2.default,MarkContext:_MarkContext2.default};exports.DraggableMark=_DraggableMark2.default;exports.Mark=_Mark2.default;exports.MarkContext=_MarkContext2.default});unwrapExports(lib);var lib_1=lib.MarkContext;var lib_2=lib.Mark;var lib_3=lib.DraggableMark;var DividedLine=function(_super){__extends(DividedLine,_super);function DividedLine(props){var _this=_super.call(this,props)||this;_this.createLineSegments=_this.createLineSegments.bind(_this);return _this}DividedLine.prototype.createLineSegments=function(){var _a=this.props,parameters=_a.parameters,className=_a.className,_b=_a.interpolate,interpolate=_b===void 0?curveLinear$1:_b,customAccessors=_a.customAccessors,lineDataAccessor=_a.lineDataAccessor,data=_a.data,searchIterations=_a.searchIterations,rest=__rest(_a,["parameters","className","interpolate","customAccessors","lineDataAccessor","data","searchIterations"]);var x=customAccessors.x,y=customAccessors.y;var lineData=projectLineData({data:data,lineDataAccessor:[lineDataAccessor],xProp:"x",yProp:"y",xAccessor:[x],yAccessor:[y]});lineData.forEach(function(projectedD){projectedD.data=projectedD.data.map(function(d){return __assign({},d.data,d)})});var lines=dividedLine(parameters,lineData[0].data,searchIterations);var lineRender=line$1().curve(interpolate).x(function(d){return d.x}).y(function(d){return d.y});return lines.map(function(d,i){return React.createElement(lib_2,__assign({},rest,{className:className,markType:"path",key:"DividedLine-"+i,style:d.key,d:lineRender(d.points)}))})};DividedLine.prototype.render=function(){var lines=this.createLineSegments();return React.createElement("g",null,lines)};return DividedLine}(React.Component);var horizontalTornTickGenerator=function(width,ticks,y,orient){var step=width/ticks;var currentStep=0;var tickPath="M0,"+y;var mod=orient==="right"?-1:1;while(currentStep<=width){tickPath+="L"+currentStep+","+y;if(currentStep<width){tickPath+="L"+(currentStep+step/2)+","+(y+10*mod)}currentStep+=step}return tickPath};var verticalTornTickGenerator=function(height,ticks,x,orient){var step=height/ticks;var currentStep=0;var tickPath="M"+x+",0";var mod=orient==="bottom"?-1:1;while(currentStep<=height){tickPath+="L"+x+","+currentStep;if(currentStep<height){tickPath+="L"+(x+10*mod)+","+(currentStep+step/2)}currentStep+=step}return tickPath};var generateTornBaseline=function(orient,baselineSettings){var tornD="";var x1=baselineSettings.x1,x2=baselineSettings.x2,y1=baselineSettings.y1,y2=baselineSettings.y2;if(orient==="left"||orient==="right"){var calcWidth=Math.abs(x2-x1);var ticks=Math.ceil(calcWidth/40);tornD=horizontalTornTickGenerator(calcWidth,ticks,orient==="right"?0:y1,orient)}else{var calcHeight=Math.abs(y2-y1);var ticks=Math.ceil(calcHeight/40);tornD=verticalTornTickGenerator(calcHeight,ticks,x1,orient)}return tornD};var defaultTickLineGenerator=function(_a){var xy=_a.xy,orient=_a.orient,i=_a.i,baseMarkProps=_a.baseMarkProps,_b=_a.className,className=_b===void 0?"":_b,jaggedBase=_a.jaggedBase;var genD="M"+xy.x1+","+xy.y1+"L"+xy.x2+","+xy.y2;if(jaggedBase&&i===0){genD=generateTornBaseline(orient,xy)}return React.createElement(lib_2,__assign({key:i,markType:"path",renderMode:xy.renderMode,fill:"none",stroke:"black",strokeWidth:"1px",simpleInterpolate:true,d:genD,className:"tick-line tick "+orient+" "+className},baseMarkProps))};function generateTickValues(tickValues,ticks,scale){var axisSize=Math.abs(scale.range()[1]-scale.range()[0]);if(!tickValues){if(!ticks){ticks=Math.max(1,Math.floor(axisSize/40))}tickValues=scale.ticks&&scale.ticks(ticks)||scale.domain()}return tickValues}function axisPieces(_a){var _b=_a.renderMode,renderMode=_b===void 0?function(){return undefined}:_b,_c=_a.padding,padding=_c===void 0?5:_c,scale=_a.scale,ticks=_a.ticks,_d=_a.tickValues,tickValues=_d===void 0?generateTickValues(undefined,ticks,scale):_d,_e=_a.orient,orient=_e===void 0?"left":_e,size=_a.size,_f=_a.footer,footer=_f===void 0?false:_f,_g=_a.tickSize,tickSize=_g===void 0?footer?-10:["top","bottom"].find(function(d){return d===orient})?size[1]:size[0]:_g,jaggedBase=_a.jaggedBase;var axisDomain=[],position1,position2,domain1,domain2,tposition1,tposition2,textPositionMod=0,textPositionMod2=0,defaultAnchor="middle";switch(orient){case"top":position1="x1";position2="x2";domain1="y1";domain2="y2";axisDomain=[0,tickSize];tposition1="tx";tposition2="ty";textPositionMod-=20-padding;break;case"bottom":position1="x1";position2="x2";domain1="y2";domain2="y1";axisDomain=[size[1],size[1]-tickSize];tposition1="tx";tposition2="ty";textPositionMod+=20+padding;break;case"right":position1="y2";position2="y1";domain1="x2";domain2="x1";axisDomain=[size[0],size[0]-tickSize];tposition1="ty";tposition2="tx";textPositionMod+=5+padding;textPositionMod2+=5;defaultAnchor="start";break;default:position1="y1";position2="y2";domain1="x1";domain2="x2";axisDomain=[0,tickSize];tposition1="ty";tposition2="tx";textPositionMod-=5+padding;textPositionMod2+=5;defaultAnchor="end";break}var generatedTicks=tickValues instanceof Function?tickValues({orient:orient}):tickValues;if(jaggedBase&&generatedTicks.find(function(t){return t===scale.domain()[0]})===undefined){generatedTicks=__spread([scale.domain()[0]],generatedTicks)}return generatedTicks.map(function(tick,i){var _a;var tickPosition=scale(tick);return _a={},_a[position1]=tickPosition,_a[position2]=tickPosition,_a[domain1]=axisDomain[0],_a[domain2]=axisDomain[1],_a[tposition1]=tickPosition+textPositionMod2,_a[tposition2]=axisDomain[0]+textPositionMod,_a.defaultAnchor=defaultAnchor,_a.renderMode=renderMode(tick,i),_a.value=tick,_a})}var axisLabels=function(_a){var axisParts=_a.axisParts,tickFormat=_a.tickFormat,_b=_a.rotate,rotate=_b===void 0?0:_b,_c=_a.center,center=_c===void 0?false:_c,orient=_a.orient;return axisParts.map(function(axisPart,i){var renderedValue=tickFormat(axisPart.value,i);if(typeof renderedValue!=="object"||renderedValue instanceof Date){renderedValue=React.createElement("text",{textAnchor:axisPart.defaultAnchor,className:"axis-label"},renderedValue.toString?renderedValue.toString():renderedValue)}var textX=axisPart.tx;var textY=axisPart.ty;if(center){switch(orient){case"right":textX-=(axisPart.x2-axisPart.x1)/2;break;case"left":textX+=(axisPart.x2-axisPart.x1)/2;break;case"top":textY+=(axisPart.y2-axisPart.y1)/2;break;case"bottom":textY-=(axisPart.y2-axisPart.y1)/2;break}}return React.createElement("g",{key:i,pointerEvents:"none",transform:"translate("+textX+","+textY+") rotate("+rotate+")",className:"axis-label"},renderedValue)})};var baselineGenerator=function(orient,size,className){var offsets={left:{x:0,y:0,width:0,height:size[1]},right:{x:size[0],y:0,width:0,height:size[1]},top:{x:0,y:0,width:size[0],height:0},bottom:{x:0,y:size[1],width:size[0],height:0}};var orientOffset=offsets[orient];return React.createElement("line",{key:"baseline",className:"axis-baseline "+className,stroke:"black",strokeLinecap:"square",x1:orientOffset.x,x2:orientOffset.x+orientOffset.width,y1:orientOffset.y,y2:orientOffset.y+orientOffset.height})};var axisLines=function(_a){var axisParts=_a.axisParts,orient=_a.orient,_b=_a.tickLineGenerator,tickLineGenerator=_b===void 0?defaultTickLineGenerator:_b,baseMarkProps=_a.baseMarkProps,className=_a.className,jaggedBase=_a.jaggedBase,scale=_a.scale;return axisParts.map(function(axisPart,i){return tickLineGenerator({xy:axisPart,orient:orient,i:i,baseMarkProps:baseMarkProps,className:className,jaggedBase:jaggedBase,scale:scale})})};var array$3=Array.prototype;var slice$4=array$3.slice;function ascending$4(a,b){return a-b}function area$2(ring){var i=0,n=ring.length,area=ring[n-1][1]*ring[0][0]-ring[n-1][0]*ring[0][1];while(++i<n){area+=ring[i-1][1]*ring[i][0]-ring[i-1][0]*ring[i][1]}return area}function constant$6(x){return function(){return x}}function contains(ring,hole){var i=-1,n=hole.length,c;while(++i<n){if(c=ringContains(ring,hole[i]))return c}return 0}function ringContains(ring,point){var x=point[0],y=point[1],contains=-1;for(var i=0,n=ring.length,j=n-1;i<n;j=i++){var pi=ring[i],xi=pi[0],yi=pi[1],pj=ring[j],xj=pj[0],yj=pj[1];if(segmentContains(pi,pj,point))return 0;if(yi>y!==yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi)contains=-contains}return contains}function segmentContains(a,b,c){var i;return collinear(a,b,c)&&within(a[i=+(a[0]===b[0])],c[i],b[i])}function collinear(a,b,c){return(b[0]-a[0])*(c[1]-a[1])===(c[0]-a[0])*(b[1]-a[1])}function within(p,q,r){return p<=q&&q<=r||r<=q&&q<=p}function noop$4(){}var cases=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function contours(){var dx=1,dy=1,threshold=thresholdSturges,smooth=smoothLinear;function contours(values){var tz=threshold(values);if(!Array.isArray(tz)){var domain=extent(values),start=domain[0],stop=domain[1];tz=tickStep(start,stop,tz);tz=range(Math.floor(start/tz)*tz,Math.floor(stop/tz)*tz,tz)}else{tz=tz.slice().sort(ascending$4)}return tz.map(function(value){return contour(values,value)})}function contour(values,value){var polygons=[],holes=[];isorings(values,value,function(ring){smooth(ring,values,value);if(area$2(ring)>0)polygons.push([ring]);else holes.push(ring)});holes.forEach(function(hole){for(var i=0,n=polygons.length,polygon;i<n;++i){if(contains((polygon=polygons[i])[0],hole)!==-1){polygon.push(hole);return}}});return{type:"MultiPolygon",value:value,coordinates:polygons}}function isorings(values,value,callback){var fragmentByStart=new Array,fragmentByEnd=new Array,x,y,t0,t1,t2,t3;x=y=-1;t1=values[0]>=value;cases[t1<<1].forEach(stitch);while(++x<dx-1){t0=t1,t1=values[x+1]>=value;cases[t0|t1<<1].forEach(stitch)}cases[t1<<0].forEach(stitch);while(++y<dy-1){x=-1;t1=values[y*dx+dx]>=value;t2=values[y*dx]>=value;cases[t1<<1|t2<<2].forEach(stitch);while(++x<dx-1){t0=t1,t1=values[y*dx+dx+x+1]>=value;t3=t2,t2=values[y*dx+x+1]>=value;cases[t0|t1<<1|t2<<2|t3<<3].forEach(stitch)}cases[t1|t2<<3].forEach(stitch)}x=-1;t2=values[y*dx]>=value;cases[t2<<2].forEach(stitch);while(++x<dx-1){t3=t2,t2=values[y*dx+x+1]>=value;cases[t2<<2|t3<<3].forEach(stitch)}cases[t2<<3].forEach(stitch);function stitch(line){var start=[line[0][0]+x,line[0][1]+y],end=[line[1][0]+x,line[1][1]+y],startIndex=index(start),endIndex=index(end),f,g;if(f=fragmentByEnd[startIndex]){if(g=fragmentByStart[endIndex]){delete fragmentByEnd[f.end];delete fragmentByStart[g.start];if(f===g){f.ring.push(end);callback(f.ring)}else{fragmentByStart[f.start]=fragmentByEnd[g.end]={start:f.start,end:g.end,ring:f.ring.concat(g.ring)}}}else{delete fragmentByEnd[f.end];f.ring.push(end);fragmentByEnd[f.end=endIndex]=f}}else if(f=fragmentByStart[endIndex]){if(g=fragmentByEnd[startIndex]){delete fragmentByStart[f.start];delete fragmentByEnd[g.end];if(f===g){f.ring.push(end);callback(f.ring)}else{fragmentByStart[g.start]=fragmentByEnd[f.end]={start:g.start,end:f.end,ring:g.ring.concat(f.ring)}}}else{delete fragmentByStart[f.start];f.ring.unshift(start);fragmentByStart[f.start=startIndex]=f}}else{fragmentByStart[startIndex]=fragmentByEnd[endIndex]={start:startIndex,end:endIndex,ring:[start,end]}}}}function index(point){return point[0]*2+point[1]*(dx+1)*4}function smoothLinear(ring,values,value){ring.forEach(function(point){var x=point[0],y=point[1],xt=x|0,yt=y|0,v0,v1=values[yt*dx+xt];if(x>0&&x<dx&&xt===x){v0=values[yt*dx+xt-1];point[0]=x+(value-v0)/(v1-v0)-.5}if(y>0&&y<dy&&yt===y){v0=values[(yt-1)*dx+xt];point[1]=y+(value-v0)/(v1-v0)-.5}})}contours.contour=contour;contours.size=function(_){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_[0]),_1=Math.ceil(_[1]);if(!(_0>0)||!(_1>0))throw new Error("invalid size");return dx=_0,dy=_1,contours};contours.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant$6(slice$4.call(_)):constant$6(_),contours):threshold};contours.smooth=function(_){return arguments.length?(smooth=_?smoothLinear:noop$4,contours):smooth===smoothLinear};return contours}function blurX(source,target,r){var n=source.width,m=source.height,w=(r<<1)+1;for(var j=0;j<m;++j){for(var i=0,sr=0;i<n+r;++i){if(i<n){sr+=source.data[i+j*n]}if(i>=r){if(i>=w){sr-=source.data[i-w+j*n]}target.data[i-r+j*n]=sr/Math.min(i+1,n-1+w-i,w)}}}}function blurY(source,target,r){var n=source.width,m=source.height,w=(r<<1)+1;for(var i=0;i<n;++i){for(var j=0,sr=0;j<m+r;++j){if(j<m){sr+=source.data[i+j*n]}if(j>=r){if(j>=w){sr-=source.data[i+(j-w)*n]}target.data[i+(j-r)*n]=sr/Math.min(j+1,m-1+w-j,w)}}}}function defaultX(d){return d[0]}function defaultY(d){return d[1]}function defaultWeight(){return 1}function contourDensity(){var x=defaultX,y=defaultY,weight=defaultWeight,dx=960,dy=500,r=20,k=2,o=r*3,n=dx+o*2>>k,m=dy+o*2>>k,threshold=constant$6(20);function density(data){var values0=new Float32Array(n*m),values1=new Float32Array(n*m);data.forEach(function(d,i,data){var xi=+x(d,i,data)+o>>k,yi=+y(d,i,data)+o>>k,wi=+weight(d,i,data);if(xi>=0&&xi<n&&yi>=0&&yi<m){values0[xi+yi*n]+=wi}});blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);blurX({width:n,height:m,data:values0},{width:n,height:m,data:values1},r>>k);blurY({width:n,height:m,data:values1},{width:n,height:m,data:values0},r>>k);var tz=threshold(values0);if(!Array.isArray(tz)){var stop=max$2(values0);tz=tickStep(0,stop,tz);tz=range(0,Math.floor(stop/tz)*tz,tz);tz.shift()}return contours().thresholds(tz).size([n,m])(values0).map(transform)}function transform(geometry){geometry.value*=Math.pow(2,-2*k);geometry.coordinates.forEach(transformPolygon);return geometry}function transformPolygon(coordinates){coordinates.forEach(transformRing)}function transformRing(coordinates){coordinates.forEach(transformPoint)}function transformPoint(coordinates){coordinates[0]=coordinates[0]*Math.pow(2,k)-o;coordinates[1]=coordinates[1]*Math.pow(2,k)-o}function resize(){o=r*3;n=dx+o*2>>k;m=dy+o*2>>k;return density}density.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$6(+_),density):x};density.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$6(+_),density):y};density.weight=function(_){return arguments.length?(weight=typeof _==="function"?_:constant$6(+_),density):weight};density.size=function(_){if(!arguments.length)return[dx,dy];var _0=Math.ceil(_[0]),_1=Math.ceil(_[1]);if(!(_0>=0)&&!(_0>=0))throw new Error("invalid size");return dx=_0,dy=_1,resize()};density.cellSize=function(_){if(!arguments.length)return 1<<k;if(!((_=+_)>=1))throw new Error("invalid cell size");return k=Math.floor(Math.log(_)/Math.LN2),resize()};density.thresholds=function(_){return arguments.length?(threshold=typeof _==="function"?_:Array.isArray(_)?constant$6(slice$4.call(_)):constant$6(_),density):threshold};density.bandwidth=function(_){if(!arguments.length)return Math.sqrt(r*(r+1));if(!((_=+_)>=0))throw new Error("invalid bandwidth");return r=Math.round((Math.sqrt(4*_*_+1)-1)/2),resize()};return density}var tinyqueue=TinyQueue;var default_1=TinyQueue;function TinyQueue(data,compare){if(!(this instanceof TinyQueue))return new TinyQueue(data,compare);this.data=data||[];this.length=this.data.length;this.compare=compare||defaultCompare;if(this.length>0){for(var i=(this.length>>1)-1;i>=0;i--){this._down(i)}}}function defaultCompare(a,b){return a<b?-1:a>b?1:0}TinyQueue.prototype={push:function push(item){this.data.push(item);this.length++;this._up(this.length-1)},pop:function pop(){if(this.length===0)return undefined;var top=this.data[0];this.length--;if(this.length>0){this.data[0]=this.data[this.length];this._down(0)}this.data.pop();return top},peek:function peek(){return this.data[0]},_up:function _up(pos){var data=this.data;var compare=this.compare;var item=data[pos];while(pos>0){var parent=pos-1>>1;var current=data[parent];if(compare(item,current)>=0)break;data[pos]=current;pos=parent}data[pos]=item},_down:function _down(pos){var data=this.data;var compare=this.compare;var halfLength=this.length>>1;var item=data[pos];while(pos<halfLength){var left=(pos<<1)+1;var right=left+1;var best=data[left];if(right<this.length&&compare(data[right],best)<0){left=right;best=data[right]}if(compare(best,item)>=0)break;data[pos]=best;pos=left}data[pos]=item}};tinyqueue.default=default_1;var tinyqueue$1=Object.freeze({default:tinyqueue,__moduleExports:tinyqueue});var Queue=tinyqueue$1&&tinyqueue||tinyqueue$1;var polylabel_1=polylabel;var default_1$1=polylabel;function polylabel(polygon,precision,debug){precision=precision||1;var minX,minY,maxX,maxY;for(var i=0;i<polygon[0].length;i++){var p=polygon[0][i];if(!i||p[0]<minX)minX=p[0];if(!i||p[1]<minY)minY=p[1];if(!i||p[0]>maxX)maxX=p[0];if(!i||p[1]>maxY)maxY=p[1]}var width=maxX-minX;var height=maxY-minY;var cellSize=Math.min(width,height);var h=cellSize/2;var cellQueue=new Queue(null,compareMax);if(cellSize===0)return[minX,minY];for(var x=minX;x<maxX;x+=cellSize){for(var y=minY;y<maxY;y+=cellSize){cellQueue.push(new Cell(x+h,y+h,h,polygon))}}var bestCell=getCentroidCell(polygon);var bboxCell=new Cell(minX+width/2,minY+height/2,0,polygon);if(bboxCell.d>bestCell.d)bestCell=bboxCell;var numProbes=cellQueue.length;while(cellQueue.length){var cell=cellQueue.pop();if(cell.d>bestCell.d){bestCell=cell;if(debug)console.log("found best %d after %d probes",Math.round(1e4*cell.d)/1e4,numProbes)}if(cell.max-bestCell.d<=precision)continue;h=cell.h/2;cellQueue.push(new Cell(cell.x-h,cell.y-h,h,polygon));cellQueue.push(new Cell(cell.x+h,cell.y-h,h,polygon));cellQueue.push(new Cell(cell.x-h,cell.y+h,h,polygon));cellQueue.push(new Cell(cell.x+h,cell.y+h,h,polygon));numProbes+=4}if(debug){console.log("num probes: "+numProbes);console.log("best distance: "+bestCell.d)}return[bestCell.x,bestCell.y]}function compareMax(a,b){return b.max-a.max}function Cell(x,y,h,polygon){this.x=x;this.y=y;this.h=h;this.d=pointToPolygonDist(x,y,polygon);this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(x,y,polygon){var inside=false;var minDistSq=Infinity;for(var k=0;k<polygon.length;k++){var ring=polygon[k];for(var i=0,len=ring.length,j=len-1;i<len;j=i++){var a=ring[i];var b=ring[j];if(a[1]>y!==b[1]>y&&x<(b[0]-a[0])*(y-a[1])/(b[1]-a[1])+a[0])inside=!inside;minDistSq=Math.min(minDistSq,getSegDistSq(x,y,a,b))}}return(inside?1:-1)*Math.sqrt(minDistSq)}function getCentroidCell(polygon){var area=0;var x=0;var y=0;var points=polygon[0];for(var i=0,len=points.length,j=len-1;i<len;j=i++){var a=points[i];var b=points[j];var f=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*f;y+=(a[1]+b[1])*f;area+=f*3}if(area===0)return new Cell(points[0][0],points[0][1],0,polygon);return new Cell(x/area,y/area,0,polygon)}function getSegDistSq(px,py,a,b){var x=a[0];var y=a[1];var dx=b[0]-x;var dy=b[1]-y;if(dx!==0||dy!==0){var t=((px-x)*dx+(py-y)*dy)/(dx*dx+dy*dy);if(t>1){x=b[0];y=b[1]}else if(t>0){x+=dx*t;y+=dy*t}}dx=px-x;dy=py-y;return dx*dx+dy*dy}polylabel_1.default=default_1$1;var thirdPi=Math.PI/3,angles=[0,thirdPi,2*thirdPi,3*thirdPi,4*thirdPi,5*thirdPi];function pointX(d){return d[0]}function pointY(d){return d[1]}function hexbin(){var x0=0,y0=0,x1=1,y1=1,x=pointX,y=pointY,r,dx,dy;function hexbin(points){var binsById={},bins=[],i,n=points.length;for(i=0;i<n;++i){if(isNaN(px=+x.call(null,point=points[i],i,points))||isNaN(py=+y.call(null,point,i,points)))continue;var point,px,py,pj=Math.round(py=py/dy),pi=Math.round(px=px/dx-(pj&1)/2),py1=py-pj;if(Math.abs(py1)*3>1){var px1=px-pi,pi2=pi+(px<pi?-1:1)/2,pj2=pj+(py<pj?-1:1),px2=px-pi2,py2=py-pj2;if(px1*px1+py1*py1>px2*px2+py2*py2)pi=pi2+(pj&1?1:-1)/2,pj=pj2}var id=pi+"-"+pj,bin=binsById[id];if(bin)bin.push(point);else{bins.push(bin=binsById[id]=[point]);bin.x=(pi+(pj&1)/2)*dx;bin.y=pj*dy}}return bins}function hexagon(radius){var x0=0,y0=0;return angles.map(function(angle){var x1=Math.sin(angle)*radius,y1=-Math.cos(angle)*radius,dx=x1-x0,dy=y1-y0;x0=x1,y0=y1;return[dx,dy]})}hexbin.hexagon=function(radius){return"m"+hexagon(radius==null?r:+radius).join("l")+"z"};hexbin.centers=function(){var centers=[],j=Math.round(y0/dy),i=Math.round(x0/dx);for(var y=j*dy;y<y1+r;y+=dy,++j){for(var x=i*dx+(j&1)*dx/2;x<x1+dx/2;x+=dx){centers.push([x,y])}}return centers};hexbin.mesh=function(){var fragment=hexagon(r).slice(0,4).join("l");return hexbin.centers().map(function(p){return"M"+p+"m"+fragment}).join("")};hexbin.x=function(_){return arguments.length?(x=_,hexbin):x};hexbin.y=function(_){return arguments.length?(y=_,hexbin):y};hexbin.radius=function(_){return arguments.length?(r=+_,dx=r*2*Math.sin(thirdPi),dy=r*1.5,hexbin):r};hexbin.size=function(_){return arguments.length?(x0=y0=0,x1=+_[0],y1=+_[1],hexbin):[x1-x0,y1-y0]};hexbin.extent=function(_){return arguments.length?(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1],hexbin):[[x0,y0],[x1,y1]]};return hexbin.radius(1)}var regression=createCommonjsModule(function(module,exports){(function(global,factory){{factory(module)}})(commonjsGlobal,function(module){function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var DEFAULT_OPTIONS={order:2,precision:2,period:null};function determinationCoefficient(data,results){var predictions=[];var observations=[];data.forEach(function(d,i){if(d[1]!==null){observations.push(d);predictions.push(results[i])}});var sum=observations.reduce(function(a,observation){return a+observation[1]},0);var mean=sum/observations.length;var ssyy=observations.reduce(function(a,observation){var difference=observation[1]-mean;return a+difference*difference},0);var sse=observations.reduce(function(accum,observation,index){var prediction=predictions[index];var residual=observation[1]-prediction[1];return accum+residual*residual},0);return 1-sse/ssyy}function gaussianElimination(input,order){var matrix=input;var n=input.length-1;var coefficients=[order];for(var i=0;i<n;i++){var maxrow=i;for(var j=i+1;j<n;j++){if(Math.abs(matrix[i][j])>Math.abs(matrix[i][maxrow])){maxrow=j}}for(var k=i;k<n+1;k++){var tmp=matrix[k][i];matrix[k][i]=matrix[k][maxrow];matrix[k][maxrow]=tmp}for(var _j=i+1;_j<n;_j++){for(var _k=n;_k>=i;_k--){matrix[_k][_j]-=matrix[_k][i]*matrix[i][_j]/matrix[i][i]}}}for(var _j2=n-1;_j2>=0;_j2--){var total=0;for(var _k2=_j2+1;_k2<n;_k2++){total+=matrix[_k2][_j2]*coefficients[_k2]}coefficients[_j2]=(matrix[n][_j2]-total)/matrix[_j2][_j2]}return coefficients}function round(number,precision){var factor=Math.pow(10,precision);return Math.round(number*factor)/factor}var methods={linear:function linear(data,options){var sum=[0,0,0,0,0];var len=0;for(var n=0;n<data.length;n++){if(data[n][1]!==null){len++;sum[0]+=data[n][0];sum[1]+=data[n][1];sum[2]+=data[n][0]*data[n][0];sum[3]+=data[n][0]*data[n][1];sum[4]+=data[n][1]*data[n][1]}}var run=len*sum[2]-sum[0]*sum[0];var rise=len*sum[3]-sum[0]*sum[1];var gradient=run===0?0:round(rise/run,options.precision);var intercept=round(sum[1]/len-gradient*sum[0]/len,options.precision);var predict=function predict(x){return[round(x,options.precision),round(gradient*x+intercept,options.precision)]};var points=data.map(function(point){return predict(point[0])});return{points:points,predict:predict,equation:[gradient,intercept],r2:round(determinationCoefficient(data,points),options.precision),string:intercept===0?"y = "+gradient+"x":"y = "+gradient+"x + "+intercept}},exponential:function exponential(data,options){var sum=[0,0,0,0,0,0];for(var n=0;n<data.length;n++){if(data[n][1]!==null){sum[0]+=data[n][0];sum[1]+=data[n][1];sum[2]+=data[n][0]*data[n][0]*data[n][1];sum[3]+=data[n][1]*Math.log(data[n][1]);sum[4]+=data[n][0]*data[n][1]*Math.log(data[n][1]);sum[5]+=data[n][0]*data[n][1]}}var denominator=sum[1]*sum[2]-sum[5]*sum[5];var a=Math.exp((sum[2]*sum[3]-sum[5]*sum[4])/denominator);var b=(sum[1]*sum[4]-sum[5]*sum[3])/denominator;var coeffA=round(a,options.precision);var coeffB=round(b,options.precision);var predict=function predict(x){return[round(x,options.precision),round(coeffA*Math.exp(coeffB*x),options.precision)]};var points=data.map(function(point){return predict(point[0])});return{points:points,predict:predict,equation:[coeffA,coeffB],string:"y = "+coeffA+"e^("+coeffB+"x)",r2:round(determinationCoefficient(data,points),options.precision)}},logarithmic:function logarithmic(data,options){var sum=[0,0,0,0];var len=data.length;for(var n=0;n<len;n++){if(data[n][1]!==null){sum[0]+=Math.log(data[n][0]);sum[1]+=data[n][1]*Math.log(data[n][0]);sum[2]+=data[n][1];sum[3]+=Math.pow(Math.log(data[n][0]),2)}}var a=(len*sum[1]-sum[2]*sum[0])/(len*sum[3]-sum[0]*sum[0]);var coeffB=round(a,options.precision);var coeffA=round((sum[2]-coeffB*sum[0])/len,options.precision);var predict=function predict(x){return[round(x,options.precision),round(round(coeffA+coeffB*Math.log(x),options.precision),options.precision)]};var points=data.map(function(point){return predict(point[0])});return{points:points,predict:predict,equation:[coeffA,coeffB],string:"y = "+coeffA+" + "+coeffB+" ln(x)",r2:round(determinationCoefficient(data,points),options.precision)}},power:function power(data,options){var sum=[0,0,0,0,0];var len=data.length;for(var n=0;n<len;n++){if(data[n][1]!==null){sum[0]+=Math.log(data[n][0]);sum[1]+=Math.log(data[n][1])*Math.log(data[n][0]);sum[2]+=Math.log(data[n][1]);sum[3]+=Math.pow(Math.log(data[n][0]),2)}}var b=(len*sum[1]-sum[0]*sum[2])/(len*sum[3]-Math.pow(sum[0],2));var a=(sum[2]-b*sum[0])/len;var coeffA=round(Math.exp(a),options.precision);var coeffB=round(b,options.precision);var predict=function predict(x){return[round(x,options.precision),round(round(coeffA*Math.pow(x,coeffB),options.precision),options.precision)]};var points=data.map(function(point){return predict(point[0])});return{points:points,predict:predict,equation:[coeffA,coeffB],string:"y = "+coeffA+"x^"+coeffB,r2:round(determinationCoefficient(data,points),options.precision)}},polynomial:function polynomial(data,options){var lhs=[];var rhs=[];var a=0;var b=0;var len=data.length;var k=options.order+1;for(var i=0;i<k;i++){for(var l=0;l<len;l++){if(data[l][1]!==null){a+=Math.pow(data[l][0],i)*data[l][1]}}lhs.push(a);a=0;var c=[];for(var j=0;j<k;j++){for(var _l=0;_l<len;_l++){if(data[_l][1]!==null){b+=Math.pow(data[_l][0],i+j)}}c.push(b);b=0}rhs.push(c)}rhs.push(lhs);var coefficients=gaussianElimination(rhs,k).map(function(v){return round(v,options.precision)});var predict=function predict(x){return[round(x,options.precision),round(coefficients.reduce(function(sum,coeff,power){return sum+coeff*Math.pow(x,power)},0),options.precision)]};var points=data.map(function(point){return predict(point[0])});var string="y = ";for(var _i=coefficients.length-1;_i>=0;_i--){if(_i>1){string+=coefficients[_i]+"x^"+_i+" + "}else if(_i===1){string+=coefficients[_i]+"x + "}else{string+=coefficients[_i]}}return{string:string,points:points,predict:predict,equation:[].concat(_toConsumableArray(coefficients)).reverse(),r2:round(determinationCoefficient(data,points),options.precision)}}};function createWrapper(){var reduce=function reduce(accumulator,name){return _extends({_round:round},accumulator,_defineProperty({},name,function(data,supplied){return methods[name](data,_extends({},DEFAULT_OPTIONS,supplied))}))};return Object.keys(methods).reduce(reduce,{})}module.exports=createWrapper()})});function contouring(_a){var summaryType=_a.summaryType,data=_a.data,finalXExtent=_a.finalXExtent,finalYExtent=_a.finalYExtent;var projectedSummaries=[];if(!summaryType.type){summaryType={type:summaryType}}var _b=summaryType.resolution,resolution=_b===void 0?500:_b,_c=summaryType.thresholds,thresholds=_c===void 0?10:_c,_d=summaryType.bandwidth,bandwidth=_d===void 0?20:_d,neighborhood=summaryType.neighborhood;var xScale=linear$1().domain(finalXExtent).rangeRound([0,resolution]).nice();var yScale=linear$1().domain(finalYExtent).rangeRound([resolution,0]).nice();data.forEach(function(contourData){var contourProjectedSummaries=contourDensity().size([resolution,resolution]).x(function(d){return xScale(d[0])}).y(function(d){return yScale(d[1])}).thresholds(thresholds).bandwidth(bandwidth)(contourData._xyfCoordinates);if(neighborhood){contourProjectedSummaries=[contourProjectedSummaries[0]]}var max=Math.max.apply(Math,__spread(contourProjectedSummaries.map(function(d){return d.value})));contourProjectedSummaries.forEach(function(summary){summary.parentSummary=contourData;summary.bounds=[];summary.percent=summary.value/max;summary.coordinates.forEach(function(poly){poly.forEach(function(subpoly,i){poly[i]=subpoly.map(function(coordpair){coordpair=[xScale.invert(coordpair[0]),yScale.invert(coordpair[1])];return coordpair});if(i===0){summary.bounds.push(shapeBounds(poly[i]))}})})});projectedSummaries=__spread(projectedSummaries,contourProjectedSummaries)});return projectedSummaries}function hexbinning(_a){var _b=_a.preprocess,preprocess=_b===void 0?true:_b,_c=_a.processedData,processedData=_c===void 0?false:_c,summaryType=_a.summaryType,baseData=_a.data,_d=_a.finalXExtent,finalXExtent=_d===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x})))]:_d,_e=_a.finalYExtent,finalYExtent=_e===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y})))]:_e,size=_a.size,_f=_a.xScaleType,xScaleType=_f===void 0?linear$1():_f,_g=_a.yScaleType,yScaleType=_g===void 0?linear$1():_g,margin=_a.margin,baseMarkProps=_a.baseMarkProps,styleFn=_a.styleFn,classFn=_a.classFn,renderFn=_a.renderFn,chartSize=_a.chartSize;if(processedData){return baseData[0].coordinates}var projectedSummaries=[];if(!summaryType.type){summaryType={type:summaryType}}var _h=summaryType.bins,bins=_h===void 0?.05:_h,cellPx=summaryType.cellPx,_j=summaryType.binValue,binValue=_j===void 0?function(d){return d.length}:_j,binMax=summaryType.binMax,customMark=summaryType.customMark;if(baseData.coordinates&&!baseData._xyfCoordinates){baseData._xyfCoordinates=baseData.coordinates.map(function(d){return[d.x,d.y]})}var data=Array.isArray(baseData)?baseData:[baseData];var hexBinXScale=xScaleType.domain(finalXExtent).range([0,size[0]]);var hexBinYScale=yScaleType.domain(finalYExtent).range([0,size[1]]);var actualResolution=cellPx&&cellPx/2||(bins>1?1/bins:bins)*size[0]/2;var hexbinner=hexbin().x(function(d){return hexBinXScale(d._xyfPoint[0])}).y(function(d){return hexBinYScale(d._xyfPoint[1])}).radius(actualResolution).size(size);var hexMax;var allHexes=hexbinner.centers();data.forEach(function(hexbinData){hexMax=0;var hexes=hexbinner(hexbinData._xyfCoordinates.map(function(d,i){return __assign({_xyfPoint:d},hexbinData.coordinates[i])}));var centerHash={};hexes.forEach(function(d){centerHash[parseInt(d.x)+"-"+parseInt(d.y)]=true});allHexes.forEach(function(hexCenter){if(!centerHash[parseInt(hexCenter[0])+"-"+parseInt(hexCenter[1])]){var newHex=[];newHex.x=hexCenter[0];newHex.y=hexCenter[1];hexes.push(newHex)}});hexMax=Math.max.apply(Math,__spread(hexes.map(function(d){return binValue(d)})));if(binMax){binMax(hexMax)}var hexBase=[[0,-1],[.866,-.5],[.866,.5],[0,1],[-.866,.5],[-.866,-.5]];var hexWidth=hexBinXScale.invert(actualResolution)-finalXExtent[0];var hexHeight=hexBinYScale.invert(actualResolution)-finalYExtent[0];var hexacoordinates=hexBase.map(function(d){return[d[0]*hexWidth,d[1]*hexHeight]});var hexbinProjectedSummaries=hexes.map(function(d){var hexValue=binValue(d);var gx=d.x;var gy=d.y;d.x=hexBinXScale.invert(d.x);d.y=hexBinYScale.invert(d.y);var percent=hexValue/hexMax;return{customMark:customMark&&React.createElement("g",{transform:"translate("+gx+","+(size[1]-gy)+")"},customMark({d:__assign({},d,{binItems:d,percent:percent,value:hexValue,radius:actualResolution,hexCoordinates:hexBase.map(function(d){return[d[0]*actualResolution,d[1]*actualResolution]})}),baseMarkProps:baseMarkProps,margin:margin,styleFn:styleFn,classFn:classFn,renderFn:renderFn,chartSize:chartSize,adjustedSize:size})),_xyfCoordinates:hexacoordinates.map(function(p){return[p[0]+d.x,p[1]+d.y]}),value:hexValue,percent:percent,data:d,parentSummary:hexbinData,centroid:true}});projectedSummaries=__spread(projectedSummaries,hexbinProjectedSummaries)});if(preprocess){projectedSummaries.forEach(function(d){d.x=d.data.x;d.y=d.data.y});return{type:"hexbin",processedData:true,coordinates:projectedSummaries,binMax:hexMax}}return projectedSummaries}function heatmapping(_a){var _b=_a.preprocess,preprocess=_b===void 0?true:_b,_c=_a.processedData,processedData=_c===void 0?false:_c,summaryType=_a.summaryType,baseData=_a.data,_d=_a.finalXExtent,finalXExtent=_d===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x})))]:_d,_e=_a.finalYExtent,finalYExtent=_e===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y})))]:_e,size=_a.size,_f=_a.xScaleType,xScaleType=_f===void 0?linear$1():_f,_g=_a.yScaleType,yScaleType=_g===void 0?linear$1():_g,margin=_a.margin,baseMarkProps=_a.baseMarkProps,styleFn=_a.styleFn,classFn=_a.classFn,renderFn=_a.renderFn,chartSize=_a.chartSize;if(processedData){return baseData[0].coordinates}if(baseData.coordinates&&!baseData._xyfCoordinates){baseData._xyfCoordinates=baseData.coordinates.map(function(d){return[d.x,d.y]})}var data=Array.isArray(baseData)?baseData:[baseData];var projectedSummaries=[];if(!summaryType.type){summaryType={type:summaryType}}var _h=summaryType.binValue,binValue=_h===void 0?function(d){return d.length}:_h,_j=summaryType.xBins,xBins=_j===void 0?summaryType.yBins||.05:_j,_k=summaryType.yBins,yBins=_k===void 0?xBins:_k,_l=summaryType.xCellPx,xCellPx=_l===void 0?!summaryType.xBins&&summaryType.yCellPx:_l,_m=summaryType.yCellPx,yCellPx=_m===void 0?!summaryType.yBins&&xCellPx:_m,customMark=summaryType.customMark,binMax=summaryType.binMax;var xBinPercent=xBins<1?xBins:1/xBins;var yBinPercent=yBins<1?yBins:1/yBins;var heatmapBinXScale=xScaleType.domain(finalXExtent).range([0,size[0]]);var heatmapBinYScale=yScaleType.domain(finalYExtent).range([size[1],0]);var actualResolution=[Math.ceil((xCellPx&&xCellPx/size[0]||xBinPercent)*size[0]*10)/10,Math.ceil((yCellPx&&yCellPx/size[1]||yBinPercent)*size[1]*10)/10];var maxValue=-Infinity;data.forEach(function(heatmapData){var grid=[];var flatGrid=[];var cell;var gridColumn;for(var i=0;i<size[0];i+=actualResolution[0]){var x=heatmapBinXScale.invert(i);var x1=heatmapBinXScale.invert(i+actualResolution[0]);gridColumn=[];grid.push(gridColumn);for(var j=0;j<size[1];j+=actualResolution[1]){var y=heatmapBinYScale.invert(j);var y1=heatmapBinYScale.invert(j+actualResolution[1]);cell={gx:i,gy:j,gw:actualResolution[0],gh:actualResolution[1],x:(x+x1)/2,y:(y+y1)/2,binItems:[],value:0,_xyfCoordinates:[[x,y],[x1,y],[x1,y1],[x,y1]],parentSummary:heatmapData};gridColumn.push(cell);flatGrid.push(cell)}gridColumn.push(cell)}grid.push(gridColumn);heatmapData._xyfCoordinates.forEach(function(d,di){var xCoordinate=Math.floor(heatmapBinXScale(d[0])/actualResolution[0]);var yCoordinate=Math.floor(heatmapBinYScale(d[1])/actualResolution[1]);grid[xCoordinate][yCoordinate].binItems.push(heatmapData.coordinates[di])});flatGrid.forEach(function(d){d.value=binValue(d.binItems);maxValue=Math.max(maxValue,d.value)});flatGrid.forEach(function(d){d.percent=d.value/maxValue;d.customMark=customMark&&React.createElement("g",{transform:"translate("+d.gx+","+d.gy+")"},customMark({d:d,baseMarkProps:baseMarkProps,margin:margin,styleFn:styleFn,classFn:classFn,renderFn:renderFn,chartSize:chartSize,adjustedSize:size}))});projectedSummaries=__spread(projectedSummaries,flatGrid)});if(binMax){binMax(maxValue)}if(preprocess){return{type:"heatmap",processedData:true,coordinates:projectedSummaries,binMax:maxValue}}return projectedSummaries}function trendlining(_a){var _b=_a.preprocess,_c=_a.processedData,processedData=_c===void 0?false:_c,summaryType=_a.summaryType,baseData=_a.data,_d=_a.finalXExtent,finalXExtent=_d===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.x})))]:_d,_e=_a.finalYExtent,finalYExtent=_e===void 0?[Math.min.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y}))),Math.max.apply(Math,__spread(baseData.coordinates.map(function(d){return d.y})))]:_e,size=_a.size,_f=_a.xScaleType,xScaleType=_f===void 0?linear$1():_f,_g=_a.yScaleType,yScaleType=_g===void 0?linear$1():_g,margin=_a.margin,baseMarkProps=_a.baseMarkProps,styleFn=_a.styleFn,classFn=_a.classFn,renderFn=_a.renderFn,chartSize=_a.chartSize;if(processedData){return baseData[0].coordinates}var projectedSummaries=[];if(!summaryType.type){summaryType={type:summaryType}}var _h=summaryType.regressionType,baseRegressionType=_h===void 0?"linear":_h,_j=summaryType.order,order=_j===void 0?2:_j,_k=summaryType.precision,precision=_k===void 0?4:_k,_l=summaryType.controlPoints,controlPoints=_l===void 0?20:_l,_m=summaryType.curve,curve=_m===void 0?curveCardinal:_m;var regressionType=baseRegressionType;if(finalXExtent[0]<0&&(baseRegressionType==="logarithmic"||baseRegressionType==="power"||baseRegressionType==="exponential")){console.error("Cannot use this "+baseRegressionType+" regressionType type with value range that goes below 0, defaulting to linear");regressionType="linear"}if(baseData.coordinates&&!baseData._xyfCoordinates){baseData._xyfCoordinates=baseData.coordinates.map(function(d){return[d.x,d.y]})}var data=Array.isArray(baseData)?baseData:[baseData];var xScale=xScaleType.domain([0,1]).range(finalXExtent);projectedSummaries=[];data.forEach(function(bdata){var regressionLine=regression[regressionType](bdata._xyfCoordinates.map(function(d){return[d[0].getTime?d[0].getTime():d[0],d[1].getTime?d[1].getTime():d[1]]}),{order:order,precision:precision});var controlStep=1/controlPoints;var steps=[0,1];if(regressionType!=="linear"){steps=[];for(var step=0;step<1+controlStep;step+=controlStep){steps.push(step)}}var controlPointArray=[];steps.forEach(function(controlPoint){controlPointArray.push(regressionLine.predict(xScale(controlPoint)))});projectedSummaries.push({centroid:false,customMark:undefined,data:bdata,parentSummary:bdata,value:regressionLine.string,r2:regressionLine.r2,curve:curve,_xyfCoordinates:controlPointArray})});return projectedSummaries}function shapeBounds(coordinates){var left=[Infinity,0];var right=[-Infinity,0];var top=[0,Infinity];var bottom=[0,-Infinity];coordinates.forEach(function(d){left=d[0]<left[0]?d:left;right=d[0]>right[0]?d:right;bottom=d[1]>bottom[1]?d:bottom;top=d[1]<top[1]?d:top});return{center:polylabel_1([coordinates]),top:top,left:left,right:right,bottom:bottom}}var emptyObjectReturnFn=function(){return{}};var twoPI=Math.PI*2;var dedupeRibbonPoints=function(weight){if(weight===void 0){weight=1}return function(p,c){var l=p[p.length-1];if(!l||Math.round(l.x/weight)!==Math.round(c.x/weight)||Math.round(l.y/weight)!==Math.round(c.y/weight)){p.push(c)}return p}};var arcTweener=function(oldProps,newProps){var innerRadiusInterpolator=interpolateNumber(oldProps.innerRadius,newProps.innerRadius);var outerRadiusInterpolator=interpolateNumber(oldProps.outerRadius,newProps.outerRadius);var startAngleInterpolator=interpolateNumber(oldProps.startAngle,newProps.startAngle);var endAngleInterpolator=interpolateNumber(oldProps.endAngle,newProps.endAngle);return function(t){var sliceGenerator=arc$1().innerRadius(innerRadiusInterpolator(t)).outerRadius(outerRadiusInterpolator(t));return sliceGenerator({startAngle:startAngleInterpolator(t),endAngle:endAngleInterpolator(t)})}};var drawAreaConnector=function(_a){var x1=_a.x1,x2=_a.x2,y1=_a.y1,y2=_a.y2,sizeX1=_a.sizeX1,sizeY1=_a.sizeY1,sizeX2=_a.sizeX2,sizeY2=_a.sizeY2;return"M"+x1+","+y1+"L"+x2+","+y2+"L"+(x2+sizeX2)+","+(y2+sizeY2)+"L"+(x1+sizeX1)+","+(y1+sizeY1)+"Z"};var groupBarMark=function(_a){var bins=_a.bins,binMax=_a.binMax,relativeBuckets=_a.relativeBuckets,columnWidth=_a.columnWidth,projection=_a.projection,adjustedSize=_a.adjustedSize,summaryI=_a.summaryI,summary=_a.summary,renderValue=_a.renderValue,summaryStyle=_a.summaryStyle,type=_a.type,baseMarkProps=_a.baseMarkProps;var mappedBins=[];var mappedPoints=[];var actualMax=relativeBuckets&&relativeBuckets[summary.name]||binMax;var summaryElementStylingFn=type.elementStyleFn||emptyObjectReturnFn;var barPadding=type.padding||0;bins.forEach(function(d,i){var opacity=d.value/actualMax;var additionalStyle=summaryElementStylingFn(d.value,opacity,d.pieces);var finalStyle=type.type==="heatmap"?__assign({opacity:opacity,fill:summaryStyle.fill},additionalStyle):__assign({},summaryStyle,additionalStyle);var thickness=Math.max(1,d.y1-barPadding*2);var finalColumnWidth=type.type==="heatmap"?columnWidth:columnWidth*opacity;var yProp=d.y+barPadding;var xProp=type.type==="heatmap"||type.flip?-columnWidth/2:columnWidth/2-finalColumnWidth;var height=thickness;var width=finalColumnWidth;var xOffset=type.type==="heatmap"?finalColumnWidth/2:finalColumnWidth;var yOffset=d.y1/2;if(projection==="horizontal"){yProp=type.type==="heatmap"?-columnWidth/2:type.flip?-columnWidth/2:columnWidth/2-finalColumnWidth;xProp=d.y-d.y1+barPadding;height=finalColumnWidth;width=thickness;yOffset=type.type==="heatmap"?finalColumnWidth/2:finalColumnWidth;xOffset=d.y1/2}else if(projection==="radial"){var arcGenerator=arc$1().innerRadius(d.y/2).outerRadius((d.y+d.y1)/2);var angle=summary.pct-summary.pct_padding;var startAngle=summary.pct_middle-summary.pct_padding;var endAngle=type.type==="heatmap"?startAngle+angle:startAngle+angle*opacity;startAngle*=twoPI;endAngle*=twoPI;var arcAdjustX=adjustedSize[0]/2;var arcAdjustY=adjustedSize[1]/2;var arcTranslate="translate("+arcAdjustX+","+arcAdjustY+")";var arcCenter=arcGenerator.centroid({startAngle:startAngle,endAngle:endAngle});mappedPoints.push({key:summary.name,value:d.value,pieces:d.pieces.map(function(p){return p.piece}),label:"Heatmap",x:arcCenter[0]+arcAdjustX,y:arcCenter[1]+arcAdjustY});mappedBins.push(React.createElement(lib_2,__assign({},baseMarkProps,{markType:"path",transform:arcTranslate,renderMode:renderValue,key:"groupIcon-"+summaryI+"-"+i,d:arcGenerator({startAngle:startAngle,endAngle:endAngle}),style:finalStyle})))}if(projection!=="radial"){mappedPoints.push({key:summary.name,value:d.value,pieces:d.pieces.map(function(p){return p.piece}),label:"Heatmap",x:xProp+xOffset,y:yProp+yOffset});mappedBins.push(React.createElement(lib_2,__assign({},baseMarkProps,{markType:"rect",renderMode:renderValue,key:"groupIcon-"+summaryI+"-"+i,x:xProp,y:yProp,height:height,width:width,style:finalStyle})))}});return{marks:mappedBins,points:mappedPoints}};function linearRibbon(){var _lineConstructor=line$1();var _xAccessor=function(d){return d.x};var _yAccessor=function(d){return d.y};var _rAccessor=function(d){return d.r};var _interpolator=curveLinearClosed;function _ribbon(pathData){if(pathData.multiple){var original_r=_rAccessor;var parallelTotal_1=pathData.multiple.reduce(function(p,c){return p+c.weight},0);_rAccessor=function(){return parallelTotal_1};var totalPoints=buildRibbon(pathData.points);var currentPoints_1=totalPoints.filter(function(d){return d.direction==="forward"}).reduce(dedupeRibbonPoints(),[]);var allRibbons_1=[];pathData.multiple.forEach(function(siblingPath,siblingI){_rAccessor=function(){return siblingPath.weight};var currentRibbon=buildRibbon(currentPoints_1);allRibbons_1.push(currentRibbon);var nextSibling=pathData.multiple[siblingI+1];if(nextSibling){var currentLeftSide=currentRibbon.reverse().filter(function(d){return d.direction==="back"}).reduce(dedupeRibbonPoints(),[]);_rAccessor=function(){return nextSibling.weight};var leftHandInflatedRibbon=buildRibbon(currentLeftSide);currentPoints_1=leftHandInflatedRibbon.reverse().filter(function(d){return d.direction==="back"}).reduce(dedupeRibbonPoints(),[])}});_rAccessor=original_r;return allRibbons_1.map(function(d){return _lineConstructor.x(_xAccessor).y(_yAccessor).curve(_interpolator)(d)})}var bothPoints=buildRibbon(pathData).reduce(dedupeRibbonPoints(),[]);return _lineConstructor.x(_xAccessor).y(_yAccessor).curve(_interpolator)(bothPoints)}_ribbon.x=function(_value){if(!arguments.length)return _xAccessor;_xAccessor=_value;return _ribbon};_ribbon.y=function(_value){if(!arguments.length)return _yAccessor;_yAccessor=_value;return _ribbon};_ribbon.r=function(_value){if(!arguments.length)return _rAccessor;_rAccessor=_value;return _ribbon};_ribbon.interpolate=function(_value){if(!arguments.length)return _interpolator;_interpolator=_value;return _ribbon};return _ribbon;function offsetEdge(d){var diffX=_yAccessor(d.target)-_yAccessor(d.source);var diffY=_xAccessor(d.target)-_xAccessor(d.source);var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0+Math.PI*.5;var angle2=angle0+Math.PI*.5;var x1=_xAccessor(d.source)+_rAccessor(d.source)*Math.cos(angle1);var y1=_yAccessor(d.source)-_rAccessor(d.source)*Math.sin(angle1);var x2=_xAccessor(d.target)+_rAccessor(d.target)*Math.cos(angle2);var y2=_yAccessor(d.target)-_rAccessor(d.target)*Math.sin(angle2);return{x1:x1,y1:y1,x2:x2,y2:y2}}function buildRibbon(points){var bothCode=[];var x=0;var transformedPoints={x1:0,y1:0,x2:0,y2:0};while(x<points.length){if(x!==points.length-1){transformedPoints=offsetEdge({source:points[x],target:points[x+1]});var p1={x:transformedPoints.x1,y:transformedPoints.y1,direction:"forward"};var p2={x:transformedPoints.x2,y:transformedPoints.y2,direction:"forward"};bothCode.push(p1,p2);if(bothCode.length>3){var l=bothCode.length-1;var lineA={a:bothCode[l-3],b:bothCode[l-2]};var lineB={a:bothCode[l-1],b:bothCode[l]};var intersect=findIntersect(lineA.a.x,lineA.a.y,lineA.b.x,lineA.b.y,lineB.a.x,lineB.a.y,lineB.b.x,lineB.b.y);if(intersect.found===true){lineA.b.x=intersect.x;lineA.b.y=intersect.y;lineB.a.x=intersect.x;lineB.a.y=intersect.y}}}x++}x--;while(x>=0){if(x!==0){transformedPoints=offsetEdge({source:points[x],target:points[x-1]});var p1={x:transformedPoints.x1,y:transformedPoints.y1,direction:"back"};var p2={x:transformedPoints.x2,y:transformedPoints.y2,direction:"back"};bothCode.push(p1,p2);if(bothCode.length>3){var l=bothCode.length-1;var lineA={a:bothCode[l-3],b:bothCode[l-2]};var lineB={a:bothCode[l-1],b:bothCode[l]};var intersect=findIntersect(lineA.a.x,lineA.a.y,lineA.b.x,lineA.b.y,lineB.a.x,lineB.a.y,lineB.b.x,lineB.b.y);if(intersect.found===true){lineA.b.x=intersect.x;lineA.b.y=intersect.y;lineB.a.x=intersect.x;lineB.a.y=intersect.y}}}x--}return bothCode}function findIntersect(l1x1,l1y1,l1x2,l1y2,l2x1,l2y1,l2x2,l2y2){var a,b;var result={x:null,y:null,found:false};var d=(l2y2-l2y1)*(l1x2-l1x1)-(l2x2-l2x1)*(l1y2-l1y1);if(d===0){return result}a=l1y1-l2y1;b=l1x1-l2x1;var n1=(l2x2-l2x1)*a-(l2y2-l2y1)*b;var n2=(l1x2-l1x1)*a-(l1y2-l1y1)*b;a=n1/d;b=n2/d;result.x=l1x1+a*(l1x2-l1x1);result.y=l1y1+a*(l1y2-l1y1);if(a>0&&a<1&&(b>0&&b<1)){result.found=true}return result}}function pointOnArcAtAngle(center,angle,distance){var radians=Math.PI*(angle+.75)*2;var xPosition=center[0]+distance*Math.cos(radians);var yPosition=center[1]+distance*Math.sin(radians);return[xPosition,yPosition]}var renderLaidOutPieces=function(_a){var data=_a.data,shouldRender=_a.shouldRender,canvasRender=_a.canvasRender,canvasDrawing=_a.canvasDrawing,styleFn=_a.styleFn,classFn=_a.classFn,baseMarkProps=_a.baseMarkProps,renderKeyFn=_a.renderKeyFn,ariaLabel=_a.ariaLabel,axis=_a.axis;var valueFormat=axis&&axis[0]&&axis[0].tickFormat;if(!shouldRender)return null;var renderedPieces=[];data.forEach(function(d,i){if(canvasRender&&canvasRender(d)===true){var canvasPiece={baseClass:"orframe-piece",tx:d.renderElement.tx||0,ty:d.renderElement.ty||0,d:d.piece,i:i,markProps:d.renderElement||d,styleFn:styleFn,classFn:classFn};canvasDrawing.push(canvasPiece)}else{if(React.isValidElement(d.renderElement||d)){renderedPieces.push(d.renderElement||d)}else{var pieceAriaLabel=d.o+" "+ariaLabel.items+" value "+(valueFormat&&valueFormat(d.piece.value)||d.piece.value);renderedPieces.push(React.createElement(lib_2,__assign({},baseMarkProps,{key:renderKeyFn?renderKeyFn(d.piece):d.renderKey||"piece-render-"+i},d.renderElement||d,{"aria-label":pieceAriaLabel})))}}});return renderedPieces};var extent$1=function(inputArray){return inputArray.reduce(function(p,c){return[0,Math.max(c,p[1])]},[Infinity,-Infinity])};function roundToTenth(number){return Math.round(number*10)/10}var circlePath=function(cx,cy,r){return["M",roundToTenth(cx-r),roundToTenth(cy),"a",r,r,0,1,0,r*2,0,"a",r,r,0,1,0,-(r*2),0].join(" ")+"Z"};var drawMarginPath=function(_a){var margin=_a.margin,size=_a.size,_b=_a.inset,inset=_b===void 0?0:_b;var iSize=[size[0]-inset,size[1]-inset];return"M0,0 h"+size[0]+" v"+size[1]+" h-"+size[0]+"Z M"+(margin.left-inset)+","+(margin.top-inset)+" v"+(size[1]+inset*2-margin.top-margin.bottom)+" h"+(iSize[0]+inset*3-margin.left-margin.right)+" v-"+(iSize[1]+inset*3-margin.top-margin.bottom)+"Z"};var calculateMargin=function(_a){var margin=_a.margin,axes=_a.axes,title=_a.title,oLabel=_a.oLabel,projection=_a.projection,size=_a.size;if(margin!==undefined){if(typeof margin==="function"){margin=margin({size:size})}if(typeof margin!=="object"){return{top:margin,bottom:margin,left:margin,right:margin}}else if(typeof margin==="object"){return Object.assign({top:0,bottom:0,left:0,right:0},margin)}}var finalMargin={top:0,bottom:0,left:0,right:0};var orient="left";if(axes&&projection!=="radial"){axes.forEach(function(axisObj){var axisObjAdditionMargin=axisObj.label?60:50;orient=axisObj.orient;finalMargin[orient]=axisObjAdditionMargin})}if(title.title&&!(typeof title.title==="string"&&title.title.length===0)){var _b=title.orient,orient_1=_b===void 0?"top":_b;finalMargin[orient_1]+=40}if(oLabel&&projection!=="radial"){if(orient==="bottom"||orient==="top"){finalMargin.left+=50}else{finalMargin.bottom+=50}}return finalMargin};function objectifyType(type){if(type instanceof Function||typeof type==="string"){return{type:type}}else if(type===undefined){return{}}return type}function keyAndObjectifyBarData(_a){var data=_a.data,_b=_a.renderKey,renderKey=_b===void 0?function(d,i){return i}:_b,oAccessor=_a.oAccessor,baseRAccessor=_a.rAccessor,originalRAccessor=_a.originalRAccessor,originalOAccessor=_a.originalOAccessor,_c=_a.multiAxis,multiAxis=_c===void 0?false:_c;var rAccessor;var multiExtents;if(multiAxis&&baseRAccessor.length>1){multiExtents=baseRAccessor.map(function(accessor){return extent$1(data.map(accessor))});var rScales=multiExtents.map(function(ext){return linear$1().domain(ext).range([0,1])});rAccessor=rScales.map(function(scale,i){return function(d){return scale(baseRAccessor[i](d))}})}else{rAccessor=baseRAccessor}var decoratedData=[];oAccessor.forEach(function(actualOAccessor,oIndex){rAccessor.forEach(function(actualRAccessor,rIndex){(data||[]).forEach(function(d){var appliedKey=renderKey(d,decoratedData.length);var originalR=originalRAccessor[rIndex];var originalO=originalOAccessor[oIndex];var rName=typeof originalR==="string"?originalR:"function-"+rIndex;var oName=typeof originalO==="string"?originalO:"function-"+oIndex;if(typeof d!=="object"){var expandedData={value:d,renderKey:appliedKey};var value=actualRAccessor(expandedData);decoratedData.push({data:expandedData,value:value,rIndex:rIndex,rName:rName,oIndex:oIndex,oName:oName,column:appliedKey!==undefined&&appliedKey.toString&&appliedKey.toString()||appliedKey,renderKey:appliedKey})}else{var value=actualRAccessor(d);decoratedData.push({renderKey:appliedKey,data:d,rIndex:rIndex,rName:rName,oIndex:oIndex,oName:oName,value:value,column:actualOAccessor(d)})}})})});return{allData:decoratedData,multiExtents:multiExtents}}function adjustedPositionSize(_a){var _b=_a.size,size=_b===void 0?[500,500]:_b,_c=_a.position,position=_c===void 0?[0,0]:_c,margin=_a.margin,projection=_a.projection;var heightAdjust=margin.top+margin.bottom;var widthAdjust=margin.left+margin.right;var adjustedPosition=[position[0],position[1]];var adjustedSize=[size[0]-widthAdjust,size[1]-heightAdjust];if(projection==="radial"){var minSize=Math.min(adjustedSize[0],adjustedSize[1]);adjustedSize=[minSize,minSize]}return{adjustedPosition:adjustedPosition,adjustedSize:adjustedSize}}function generateFrameTitle(_a){var _b=_a.title,rawTitle=_b===void 0?{title:"",orient:"top"}:_b,size=_a.size;var finalTitle=null;var title=rawTitle.title,_c=rawTitle.orient,orient=_c===void 0?"top":_c;var x=0,y=0,transform;switch(orient){case"top":x=size[0]/2;y=25;break;case"bottom":x=size[0]/2;y=size[1]-25;break;case"left":x=25;y=size[1]/2;transform="rotate(-90)";break;case"right":x=size[0]-25;y=size[1]/2;transform="rotate(90)";break}var gTransform="translate("+x+","+y+")";if(typeof title==="string"&&title.length>0){finalTitle=React.createElement("g",{transform:gTransform},React.createElement("text",{className:"frame-title",transform:transform,style:{textAnchor:"middle",pointerEvents:"none"}},title))}else if(title){finalTitle=React.createElement("g",{transform:gTransform},title)}return finalTitle}function orFrameConnectionRenderer(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,projection=_a.projection,canvasRender=_a.canvasRender,canvasDrawing=_a.canvasDrawing,baseMarkProps=_a.baseMarkProps,pieceType=_a.pieceType;var e_1,_b;if(!type.type){return null}var renderedConnectorMarks=[];var radarHash=new Map;if(typeof type.type==="function"){var connectionRule_1=type.type;var keys_1=Object.keys(data);keys_1.forEach(function(key,pieceArrayI){var pieceArray=data[key];var nextColumn=data[keys_1[pieceArrayI+1]];if(nextColumn){var matchArray_1=nextColumn.map(function(d,i){return connectionRule_1(__assign({},d.piece,d.piece.data),i)});pieceArray.forEach(function(piece,pieceI){var thisConnectionPiece=connectionRule_1(__assign({},piece.piece,piece.piece.data),pieceI);var targetMatch=connectionRule_1(__assign({},piece.piece,piece.piece.data),pieceI);var matchingPieceIndex=targetMatch!==undefined&&targetMatch!==false&&matchArray_1.indexOf(targetMatch);if(thisConnectionPiece!==undefined&&thisConnectionPiece!==null&&matchingPieceIndex!==false&&matchingPieceIndex!==-1){var matchingPiece=nextColumn[matchingPieceIndex];var markD=void 0;if(projection==="radial"&&pieceType.type==="point"){if(!radarHash.get(piece)){radarHash.set(piece,[piece])}var thisRadar=radarHash.get(piece);if(thisRadar){thisRadar.push(matchingPiece);radarHash.set(matchingPiece,thisRadar);radarHash.delete(piece)}}else{var xy=piece.xy;var mxy=matchingPiece.xy;var x=xy.x,y=xy.y,_a=xy.height,height=_a===void 0?1:_a,_b=xy.width,width=_b===void 0?1:_b;var mx=mxy.x,my=mxy.y,_c=mxy.height,mheight=_c===void 0?1:_c,_d=mxy.width,mwidth=_d===void 0?1:_d;if(projection==="vertical"){markD=drawAreaConnector({x1:x+width,x2:mx,y1:y,y2:my,sizeX1:0,sizeX2:0,sizeY1:height,sizeY2:mheight})}else if(projection==="horizontal"){markD=drawAreaConnector({x1:x,x2:mx,y1:y+height,y2:my,sizeX1:width,sizeX2:mwidth,sizeY1:0,sizeY2:0})}else if(projection==="radial"){markD=drawAreaConnector({x1:x,x2:mx,y1:y+height,y2:my,sizeX1:width,sizeX2:mwidth,sizeY1:0,sizeY2:0})}var renderValue=renderMode&&renderMode(piece.piece,pieceI);var source=__assign({},piece.piece.data,piece.piece.data);var target=__assign({},matchingPiece.piece,matchingPiece.piece.data);var calculatedStyle=styleFn({source:source,target:target});var eventListeners=eventListenersGenerator({source:source,target:target},pieceI);if(canvasRender&&canvasRender(piece.piece)===true){var canvasConnector={baseClass:"xyframe-line",tx:0,ty:0,d:{source:source,target:target},markProps:{d:markD,markType:"path"},styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasConnector)}else{renderedConnectorMarks.push(React.createElement(lib_2,__assign({},baseMarkProps,eventListeners,{renderMode:renderValue,markType:"path",d:markD,className:classFn?classFn(piece.piece.data,pieceI):"",key:"connector"+piece.piece.renderKey,style:calculatedStyle})))}}}})}});if(radarHash.size>0){try{for(var _c=__values(radarHash.values()),_d=_c.next();!_d.done;_d=_c.next()){var ring=_d.value;var ringPiece=__assign({},ring[0].piece,ring[0].piece.data);var markD="M"+ring.map(function(d){return d.xy.x+","+d.xy.y}).join("L")+"Z";if(canvasRender&&canvasRender(ringPiece)){var canvasRadar={baseClass:"ordinal-radar",tx:0,ty:0,d:{source:ringPiece},markProps:{d:markD,markType:"path"},styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasRadar)}else{renderedConnectorMarks.push(React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode&&renderMode(ringPiece),markType:"path",d:markD,className:classFn?classFn(ringPiece):"",key:"ordinal-ring-"+ringPiece.renderKey,style:styleFn({source:ringPiece})})))}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(_d&&!_d.done&&(_b=_c.return))_b.call(_c)}finally{if(e_1)throw e_1.error}}}}else if(type.type){console.error("Invalid connectorType - Must be a function that takes a data point and determines if it is connected to a data point in the next column")}return renderedConnectorMarks}var summaryRenderHash={contour:contourRenderFn,boxplot:boxplotRenderFn,violin:bucketizedRenderingFn,heatmap:bucketizedRenderingFn,joy:bucketizedRenderingFn,ridgeline:bucketizedRenderingFn,histogram:bucketizedRenderingFn};function orFrameSummaryRenderer(_a){var data=_a.data,type=_a.type,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,positionFn=_a.positionFn,projection=_a.projection,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,baseMarkProps=_a.baseMarkProps,margin=_a.margin;var summaryRenderFn;if(typeof type.type==="function"){summaryRenderFn=type.type}else if(summaryRenderHash[type.type]){summaryRenderFn=summaryRenderHash[type.type]}else{console.error("Invalid summary type: "+type.type+" - Must be a function or one of the following strings: "+Object.keys(summaryRenderHash).join(", "));return}return summaryRenderFn({data:data,type:type,renderMode:renderMode,eventListenersGenerator:eventListenersGenerator,styleFn:styleFn,classFn:classFn,positionFn:positionFn,projection:projection,adjustedSize:adjustedSize,chartSize:chartSize,baseMarkProps:baseMarkProps,margin:margin})}var orFrameAxisGenerator=function(_a){var projection=_a.projection,axis=_a.axis,adjustedSize=_a.adjustedSize,size=_a.size,rScale=_a.rScale,rScaleType=_a.rScaleType,pieceType=_a.pieceType,rExtent=_a.rExtent,data=_a.data,_b=_a.maxColumnValues,maxColumnValues=_b===void 0?1:_b,xyData=_a.xyData,margin=_a.margin;if(!axis)return{axis:undefined,axesTickLines:undefined};var generatedAxis,axesTickLines;if(projection!=="radial"&&axis){axesTickLines=[];var axisPosition_1=[0,0];generatedAxis=axis.map(function(d,i){var axisClassname=d.className||"";var tickValues;var axisDomain=d.extentOverride?d.extentOverride:rScale.domain();var leftRight=["left","right"];var axisScale=leftRight.indexOf(d.orient)===-1&&projection!=="vertical"||leftRight.indexOf(d.orient)!==-1&&projection!=="horizontal"?rScaleType.domain(axisDomain):rScaleType.domain([0,maxColumnValues]);var orient=d.orient;var axisRange=leftRight.indexOf(d.orient)===-1&&projection!=="vertical"||leftRight.indexOf(d.orient)!==-1&&projection!=="horizontal"?rScale.range():[0,projection==="vertical"?adjustedSize[0]:adjustedSize[1]];if(orient==="right"){axisScale.range(axisRange.reverse());axisClassname+=" right y"}else if(orient==="left"){axisClassname+=" left y";axisScale.range(axisRange.reverse())}else if(orient==="top"){axisClassname+=" top x";axisScale.range(axisRange)}else if(orient==="bottom"){axisClassname+=" bottom x";axisScale.range(axisRange)}if(d.tickValues&&Array.isArray(d.tickValues)){tickValues=d.tickValues}else if(d.tickValues instanceof Function){tickValues=d.tickValues(data,size,rScale)}var axisParts=axisPieces({padding:d.padding,tickValues:tickValues,scale:axisScale,ticks:d.ticks,orient:orient,size:adjustedSize,footer:d.footer,tickSize:d.tickSize,jaggedBase:d.jaggedBase});var axisTickLines=axisLines({className:d.className,axisParts:axisParts,orient:orient,baseMarkProps:{},tickLineGenerator:d.tickLineGenerator,jaggedBase:d.jaggedBase,scale:axisScale});axesTickLines.push(axisTickLines);if(d.baseline==="under"){axesTickLines.push(baselineGenerator(d.orient,adjustedSize,d.className))}var marginalSummaryType=typeof d.marginalSummaryType==="string"?{type:d.marginalSummaryType}:d.marginalSummaryType;return React.createElement(Axis,__assign({},d,{key:d.key||"orframe-axis-"+i,axisParts:axisParts,orient:orient,size:adjustedSize,position:axisPosition_1,tickValues:tickValues,scale:axisScale,className:axisClassname,marginalSummaryType:marginalSummaryType,margin:margin,xyPoints:xyData.map(function(d){return{x:projection==="vertical"?0:d.value,y:projection==="vertical"?d.value:0,data:d.data}})}))})}else if(projection==="radial"&&axis){var _c=pieceType.innerRadius,innerRadius_1=_c===void 0?0:_c;var ticks_1=[];axis.forEach(function(axisObj){var _a=axisObj.tickValues,baseTickValues=_a===void 0?rScale.ticks(Math.max(2,(adjustedSize[0]/2-innerRadius_1)/50)):_a,label=axisObj.label,_b=axisObj.tickFormat,tickFormat=_b===void 0?function(d){return d}:_b;var tickScale=rScaleType.domain(rExtent).range([innerRadius_1,adjustedSize[0]/2]);var tickValues=baseTickValues instanceof Function?baseTickValues({orient:axisObj.orient}):baseTickValues;tickValues.forEach(function(t,i){var tickSize=tickScale(t);if(!(innerRadius_1===0&&t===0)){var axisLabel=void 0;var ref="";if(label&&i===tickValues.length-1){var labelSettings=typeof label==="string"?{name:label,locationDistance:15}:label;var _a=labelSettings.locationDistance,locationDistance=_a===void 0?15:_a;ref=Math.random().toString()+" ";axisLabel=React.createElement("g",{className:"axis-label radial",transform:"translate(0,"+locationDistance+")"},React.createElement("text",{textAnchor:"middle"},React.createElement("textPath",{startOffset:tickSize*Math.PI*.5,xlinkHref:"#"+ref},label.name)))}ticks_1.push(React.createElement("g",{key:"orframe-radial-axis-element-"+t,className:"axis axis-label axis-tick radial",transform:"translate(0,0)"},React.createElement("path",{id:ref,d:circlePath(0,0,tickSize),r:tickSize,stroke:"gray",fill:"none"}),React.createElement("text",{y:-tickSize+5,textAnchor:"middle"},tickFormat(t)),axisLabel))}return undefined})});generatedAxis=[React.createElement("g",{key:axis[0].key||"orframe-radial-axis-container",className:"axis-labels",transform:"translate("+adjustedSize[0]/2+","+adjustedSize[1]/2+")"},ticks_1)]}return{axis:generatedAxis,axesTickLines:axesTickLines}};var canvasEvent=function(canvasContext,overlayRegions,canvasMap,e){var interactionContext=canvasContext.getContext("2d");var hoverPoint=interactionContext.getImageData(e.offsetX,e.offsetY,1,1);var mostCommonRGB="rgba("+hoverPoint.data[0]+","+hoverPoint.data[1]+","+hoverPoint.data[2]+",255)";var overlay=overlayRegions[canvasMap.get(mostCommonRGB)];if(!overlay){var hoverArea=interactionContext.getImageData(e.offsetX-2,e.offsetY-2,5,5);var x=0;while(!overlay&&x<100){overlay=overlayRegions[canvasMap.get("rgba("+hoverArea.data[x]+","+hoverArea.data[x+1]+","+hoverArea.data[x+2]+",255)")];x+=4}}return overlay};var curveHash={step:curveStep,stepbefore:stepBefore$1,stepafter:stepAfter$1,cardinal:curveCardinal,basis:curveBasis,linear:curveLinear$1,catmullrom:curveCatmullRom,monotone:monotoneY$1,monotonex:monotoneX$1,monotoney:monotoneY$1,natural:curveNatural};function lineGeneratorDecorator(_a){var generator=_a.generator,projectedCoordinateNames=_a.projectedCoordinateNames,defined=_a.defined,xScale=_a.xScale,yScale=_a.yScale,interpolator=_a.interpolator,simpleLine=_a.simpleLine;var x=projectedCoordinateNames.x,y=projectedCoordinateNames.y,yTop=projectedCoordinateNames.yTop,yBottom=projectedCoordinateNames.yBottom;generator.x(function(d){return xScale(d[x])}).curve(interpolator);if(simpleLine){generator.y(function(d){return yScale(d[y])})}else{generator.y0(function(d){return yScale(d[yBottom])}).y1(function(d){return yScale(d[yTop])})}if(defined){generator.defined(function(p,q){return defined(p,q)})}else{generator.defined(function(p){return!p._xyFrameUndefined})}}function createPoints(_a){var xScale=_a.xScale,yScale=_a.yScale,canvasDrawing=_a.canvasDrawing,data=_a.data,projectedCoordinateNames=_a.projectedCoordinateNames,customMark=_a.customMark,canvasRender=_a.canvasRender,styleFn=_a.styleFn,classFn=_a.classFn,renderKeyFn=_a.renderKeyFn,renderMode=_a.renderMode,baseMarkProps=_a.baseMarkProps,baseShowLinePoints=_a.showLinePoints;var y=projectedCoordinateNames.y,x=projectedCoordinateNames.x,xMiddle=projectedCoordinateNames.xMiddle,yMiddle=projectedCoordinateNames.yMiddle,yTop=projectedCoordinateNames.yTop,yBottom=projectedCoordinateNames.yBottom;var showLinePoints=baseShowLinePoints===true?undefined:baseShowLinePoints;var whichPoints={top:yTop,bottom:yBottom};var whichWay=whichPoints[showLinePoints];var mappedPoints=[];data.forEach(function(d,i){var dX=xScale(d[xMiddle]!==undefined?d[xMiddle]:d[x]);var dY=yScale(d[whichWay]!==undefined?d[whichWay]:d[yMiddle]!==undefined?d[yMiddle]:d[y]);var pointAriaLabel="Point at x "+d.x+" and y "+d.y;var renderedCustomMark=!customMark?undefined:React.isValidElement(customMark)?customMark:customMark({d:d.data,xy:d,i:i,xScale:xScale,yScale:yScale});var markProps=customMark?Object.assign(baseMarkProps,renderedCustomMark.props,{"aria-label":pointAriaLabel}):__assign({},baseMarkProps,{key:"piece-"+i,markType:"circle",r:2,"aria-label":pointAriaLabel});if(renderedCustomMark&&renderedCustomMark.props&&!renderedCustomMark.props.markType&&(!canvasRender||canvasRender(d.data,i)!==true)){mappedPoints.push(React.createElement("g",{transform:"translate("+dX+","+dY+")",key:renderKeyFn?renderKeyFn(d.data,i):"custom-point-mark-"+i,style:styleFn?styleFn(d.data,i):{},className:classFn?classFn(d.data,i):""},renderedCustomMark))}else{if(canvasRender&&canvasRender(d.data,i)===true){var canvasPoint={type:"point",baseClass:"frame-piece",tx:dX,ty:dY,d:d,i:i,markProps:markProps,styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasPoint)}else{var yCoordinates=Array.isArray(d[y])?d[y].map(function(p){return yScale(p)}):[dY];yCoordinates.forEach(function(yc,yi){var xCoordinates=Array.isArray(d[x])?d[x].map(function(p){return xScale(p)}):[dX];xCoordinates.forEach(function(xc,xi){mappedPoints.push(clonedAppliedElement({baseClass:"frame-piece",tx:xc,ty:yc,d:d.data&&__assign({},d,d.data)||d,i:yi===0&&xi===0?i:i+"-"+yi+"-"+xi,markProps:markProps,styleFn:styleFn,renderFn:renderMode,renderKeyFn:renderKeyFn,classFn:classFn,yi:yi}))})})}}});return mappedPoints}function createLines(_a){var xScale=_a.xScale,yScale=_a.yScale,canvasDrawing=_a.canvasDrawing,data=_a.data,projectedCoordinateNames=_a.projectedCoordinateNames,customMark=_a.customMark,canvasRender=_a.canvasRender,styleFn=_a.styleFn,classFn=_a.classFn,renderMode=_a.renderMode,renderKeyFn=_a.renderKeyFn,type=_a.type,defined=_a.defined,baseMarkProps=_a.baseMarkProps,ariaLabel=_a.ariaLabel,_b=_a.axesData,axesData=_b===void 0?[]:_b;var xAxis=axesData.find(function(d){return d.orient==="bottom"||d.orient==="top"});var yAxis=axesData.find(function(d){return d.orient==="left"||d.orient==="right"});var xAxisFormatter=xAxis&&xAxis.tickFormat||function(d){return d};var yAxisFormatter=yAxis&&yAxis.tickFormat||function(d){return d};var customLine=typeof type==="object"?type:{type:type};var interpolator=typeof customLine.interpolator==="string"?curveHash[customLine.interpolator]:customLine.interpolator||curveLinear$1;var lineGenerator=customLine.simpleLine?line$1():area$1();lineGeneratorDecorator({projectedCoordinateNames:projectedCoordinateNames,defined:defined,interpolator:interpolator,generator:lineGenerator,xScale:xScale,yScale:yScale,simpleLine:customLine.simpleLine});var dynamicLineGenerator=interpolator.dynamicInterpolator&&function(d,i){var dynLineGenerator=area$1();lineGeneratorDecorator({projectedCoordinateNames:projectedCoordinateNames,defined:defined,interpolator:interpolator.dynamicInterpolator(d,i),generator:dynLineGenerator,xScale:xScale,yScale:yScale,simpleLine:customLine.simpleLine});return dynLineGenerator}||function(){return lineGenerator};var mappedLines=[];data.forEach(function(d,i){if(customMark&&typeof customMark==="function"){var compatibleData=__assign({},d,{data:d.data.map(function(p){return __assign({},p.data,p)})});mappedLines.push(customMark({d:compatibleData,i:i,xScale:xScale,yScale:yScale,canvasDrawing:canvasDrawing}))}else{var builtInDisplayProps={};if(customLine.simpleLine){builtInDisplayProps.fill="none";builtInDisplayProps.stroke="black"}var pathString=dynamicLineGenerator(d,i)(d.data.map(function(p){return Object.assign({},p.data,p)}));var markProps=__assign({},builtInDisplayProps,baseMarkProps,{markType:"path",d:pathString,"aria-label":d.data&&d.data.length>0&&d.data.length+" point "+ariaLabel.items+" starting value "+yAxisFormatter(d.data[0].y)+" at "+xAxisFormatter(d.data[0].x)+" ending value "+yAxisFormatter(d.data[d.data.length-1].y)+" at "+xAxisFormatter(d.data[d.data.length-1].x)});if(canvasRender&&canvasRender(d,i)===true){var canvasLine={type:"line",baseClass:"xyframe-line",tx:0,ty:0,d:d,i:i,markProps:markProps,styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasLine)}else{mappedLines.push(clonedAppliedElement({baseClass:"xyframe-line",d:d,i:i,markProps:markProps,styleFn:styleFn,renderFn:renderMode,renderKeyFn:renderKeyFn,classFn:classFn}))}}});if(customLine.type==="difference"&&data.length===2){var diffdataA=data[0].data.map(function(basedata,baseI){var linePoint=basedata.yTop>data[1].data[baseI].yTop?basedata.yTop:basedata.yBottom;return{x:basedata.x,y:linePoint,yBottom:linePoint,yTop:linePoint}});var diffdataB=data[0].data.map(function(basedata,baseI){var linePoint=data[1].data[baseI].yTop>basedata.yTop?data[1].data[baseI].yTop:data[1].data[baseI].yBottom;return{x:basedata.x,y:linePoint,yBottom:linePoint,yTop:linePoint}});var doClassname=classFn?"xyframe-line "+classFn(diffdataA):"xyframe-line";var overLine=line$1();lineGeneratorDecorator({projectedCoordinateNames:projectedCoordinateNames,defined:defined,interpolator:interpolator,generator:overLine,xScale:xScale,yScale:yScale,simpleLine:true});var diffOverlayA=React.createElement(lib_2,{key:"xyline-diff-a",className:doClassname+" difference-overlay-a",markType:"path",d:overLine(diffdataA),style:{fill:"none",pointerEvents:"none"}});mappedLines.push(diffOverlayA);var diffOverlayB=React.createElement(lib_2,{key:"xyline-diff-b",className:doClassname+" difference-overlay-b",markType:"path",d:overLine(diffdataB),style:{fill:"none",pointerEvents:"none"}});mappedLines.push(diffOverlayB)}return mappedLines}function createSummaries(_a){var xScale=_a.xScale,yScale=_a.yScale,canvasDrawing=_a.canvasDrawing,data=_a.data,canvasRender=_a.canvasRender,styleFn=_a.styleFn,classFn=_a.classFn,renderKeyFn=_a.renderKeyFn,renderMode=_a.renderMode,baseMarkProps=_a.baseMarkProps,customMark=_a.customMark;var summaryClass=classFn||function(){return""};var summaryStyle=styleFn||function(){return{}};var renderFn=renderMode;if(!Array.isArray(data)){data=[data]}var renderedSummaries=[];data.forEach(function(d,i){var className="xyframe-summary";if(summaryClass){className="xyframe-summary "+summaryClass(d)}var drawD="";var shouldBeValid=false;if(typeof d.customMark==="string"||React.isValidElement(d.customMark)){drawD=d.customMark;shouldBeValid=true}else if(d.type==="MultiPolygon"){var polycoords=d.coordinates;polycoords.forEach(function(coord){coord.forEach(function(c){drawD+="M"+c.map(function(p){return xScale(p[0])+","+yScale(p[1])}).join("L")+"Z "})})}else if(customMark){var xyfCoords=d._xyfCoordinates;var projectedCoordinates=xyfCoords.map(function(p){return[xScale(p[0]),yScale(p[1])]});drawD=customMark({d:d,i:i,classFn:summaryClass,styleFn:summaryStyle,renderFn:renderFn,projectedCoordinates:projectedCoordinates,xScale:xScale,yScale:yScale,bounds:shapeBounds(projectedCoordinates)});shouldBeValid=true}else{var xyfCoords=d._xyfCoordinates;if(d.curve){var lineDrawing=line$1().x(function(d){return xScale(d[0])}).y(function(d){return yScale(d[1])}).curve(d.curve);drawD=lineDrawing(xyfCoords)}else{drawD="M"+xyfCoords.map(function(p){return xScale(p[0])+","+yScale(p[1])}).join("L")+"Z"}}var renderKey=renderKeyFn?renderKeyFn(d,i):"summary-"+i;if(shouldBeValid&&React.isValidElement(drawD)){renderedSummaries.push(drawD)}else if(canvasRender&&canvasRender(d,i)===true){var canvasSummary={type:"summary",baseClass:"xyframe-summary",tx:0,ty:0,d:d,i:i,markProps:{markType:"path",d:drawD},styleFn:summaryStyle,renderFn:renderFn,classFn:function(){return className}};canvasDrawing.push(canvasSummary)}else{renderedSummaries.push(React.createElement(lib_2,__assign({},baseMarkProps,{key:renderKey,forceUpdate:true,renderMode:renderFn?renderFn(d,i):undefined,className:className,markType:"path",d:drawD,style:summaryStyle(d,i)})))}});return renderedSummaries}function clonedAppliedElement(_a){var tx=_a.tx,ty=_a.ty,d=_a.d,i=_a.i,markProps=_a.markProps,styleFn=_a.styleFn,renderFn=_a.renderFn,classFn=_a.classFn,renderKeyFn=_a.renderKeyFn,baseClass=_a.baseClass,yi=_a.yi;markProps.style=styleFn?styleFn(d,i,yi):{};markProps.className=baseClass;markProps.key=renderKeyFn?renderKeyFn(d,i,yi):baseClass+"-"+(d.key===undefined?i:d.key);if(tx||ty){markProps.transform="translate("+(tx||0)+","+(ty||0)+")"}if(classFn){markProps.className=baseClass+" "+classFn(d,i,yi)}if(markProps.style.r){markProps.r=markProps.style.r}if(!markProps.markType){var RenderableMark=markProps;return React.createElement(RenderableMark)}markProps.renderMode=renderFn?renderFn(d,i,yi):undefined;return React.createElement(lib_2,__assign({},markProps))}var contourMap=function(d){return[d.xy.x,d.xy.y]};var verticalXYSorting=function(a,b){return a.xy.y-b.xy.y};var horizontalXYSorting=function(a,b){return b.xy.x-a.xy.x};var emptyObjectReturnFn$1=function(){return{}};function createSummaryAxis(_a){var summary=_a.summary,summaryI=_a.summaryI,axisSettings=_a.axisSettings,axisCreator=_a.axisCreator,projection=_a.projection,actualMax=_a.actualMax,adjustedSize=_a.adjustedSize,columnWidth=_a.columnWidth;var axisTranslate="translate("+summary.x+",0)";var axisDomain=[0,actualMax];if(projection==="horizontal"){axisTranslate="translate("+0+","+summary.x+")";axisDomain=[actualMax,0]}else if(projection==="radial"){axisTranslate="translate(0, 0)"}var axisWidth=projection==="horizontal"?adjustedSize[0]:columnWidth;var axisHeight=projection==="vertical"?adjustedSize[1]:columnWidth;axisSettings.size=[axisWidth,axisHeight];var axisScale=linear$1().domain(axisDomain).range([0,columnWidth]);var renderedSummaryAxis=axisCreator(axisSettings,summaryI,axisScale);return React.createElement("g",{className:"summary-axis",key:"summaryPiece-axis-"+summaryI,transform:axisTranslate},renderedSummaryAxis)}function boxplotRenderFn(_a){var data=_a.data,type=_a.type,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,_b=_a.positionFn,positionFn=_b===void 0?function(position){return position}:_b,projection=_a.projection,adjustedSize=_a.adjustedSize,baseMarkProps=_a.baseMarkProps;var summaryElementStylingFn=type.elementStyleFn||emptyObjectReturnFn$1;var keys=Object.keys(data);var renderedSummaryMarks=[];var summaryXYCoords=[];keys.forEach(function(key,summaryI){var summary=data[key];var eventListeners=eventListenersGenerator(summary,summaryI);var columnWidth=summary.width;var thisSummaryData=summary.pieceData;var calculatedSummaryStyle=styleFn(thisSummaryData[0].data,summaryI);var calculatedSummaryClass=classFn(thisSummaryData[0].data,summaryI);var summaryPositionNest,summaryValueNest,translate,extentlineX1,extentlineX2,extentlineY1,extentlineY2,topLineX1,topLineX2,midLineX1,midLineX2,bottomLineX1,bottomLineX2,rectTopWidth,rectTopHeight,rectTopY,rectTopX,rectBottomWidth,rectBottomHeight,rectBottomY,rectBottomX,rectWholeWidth,rectWholeHeight,rectWholeY,rectWholeX,topLineY1,topLineY2,bottomLineY1,bottomLineY2,midLineY1,midLineY2;var renderValue=renderMode?renderMode(summary,summaryI):undefined;summaryValueNest=thisSummaryData.map(function(p){return p.value}).sort(function(a,b){return a-b});summaryValueNest=[quantile(summaryValueNest,0),quantile(summaryValueNest,.25),quantile(summaryValueNest,.5),quantile(summaryValueNest,.75),quantile(summaryValueNest,1)];if(projection==="vertical"){summaryPositionNest=thisSummaryData.map(function(p){return p.scaledVerticalValue}).sort(function(a,b){return b-a});summaryPositionNest=[quantile(summaryPositionNest,0),quantile(summaryPositionNest,.25),quantile(summaryPositionNest,.5),quantile(summaryPositionNest,.75),quantile(summaryPositionNest,1)];var xPosition=positionFn(summary.middle,key,summaryI);translate="translate("+xPosition+",0)";extentlineX1=0;extentlineX2=0;extentlineY1=summaryPositionNest[0];extentlineY2=summaryPositionNest[4];topLineX1=-columnWidth/2;topLineX2=columnWidth/2;midLineX1=-columnWidth/2;midLineX2=columnWidth/2;bottomLineX1=-columnWidth/2;bottomLineX2=columnWidth/2;rectBottomWidth=columnWidth;rectBottomHeight=summaryPositionNest[1]-summaryPositionNest[2];rectBottomY=summaryPositionNest[2];rectBottomX=-columnWidth/2;rectTopWidth=columnWidth;rectTopHeight=summaryPositionNest[2]-summaryPositionNest[3];rectWholeWidth=columnWidth;rectWholeHeight=summaryPositionNest[1]-summaryPositionNest[3];rectWholeY=summaryPositionNest[3];rectWholeX=-columnWidth/2;rectTopY=summaryPositionNest[3];rectTopX=-columnWidth/2;topLineY1=summaryPositionNest[0];topLineY2=summaryPositionNest[0];bottomLineY1=summaryPositionNest[4];bottomLineY2=summaryPositionNest[4];midLineY1=summaryPositionNest[2];midLineY2=summaryPositionNest[2];summaryXYCoords.push({label:"Maximum",key:key,summaryPieceName:"max",x:xPosition,y:summaryPositionNest[4],value:summaryValueNest[4]},{label:"3rd Quartile",key:key,summaryPieceName:"q3area",x:xPosition,y:summaryPositionNest[3],value:summaryValueNest[3]},{label:"Median",key:key,summaryPieceName:"median",x:xPosition,y:summaryPositionNest[2],value:summaryValueNest[2]},{label:"1st Quartile",key:key,summaryPieceName:"q1area",x:xPosition,y:summaryPositionNest[1],value:summaryValueNest[1]},{label:"Minimum",key:key,summaryPieceName:"min",x:xPosition,y:summaryPositionNest[0],value:summaryValueNest[0]})}else if(projection==="horizontal"){summaryPositionNest=thisSummaryData.map(function(p){return p.scaledValue}).sort(function(a,b){return a-b});summaryPositionNest=[quantile(summaryPositionNest,0),quantile(summaryPositionNest,.25),quantile(summaryPositionNest,.5),quantile(summaryPositionNest,.75),quantile(summaryPositionNest,1)];var yPosition=positionFn(summary.middle,key,summaryI);translate="translate(0,"+yPosition+")";extentlineY1=0;extentlineY2=0;extentlineX1=summaryPositionNest[0];extentlineX2=summaryPositionNest[4];topLineY1=-columnWidth/2;topLineY2=columnWidth/2;midLineY1=-columnWidth/2;midLineY2=columnWidth/2;bottomLineY1=-columnWidth/2;bottomLineY2=columnWidth/2;rectTopHeight=columnWidth;rectTopWidth=summaryPositionNest[3]-summaryPositionNest[2];rectTopX=summaryPositionNest[2];rectTopY=-columnWidth/2;rectBottomHeight=columnWidth;rectBottomWidth=summaryPositionNest[2]-summaryPositionNest[1];rectBottomX=summaryPositionNest[1];rectBottomY=-columnWidth/2;rectWholeHeight=columnWidth;rectWholeWidth=summaryPositionNest[3]-summaryPositionNest[1];rectWholeX=summaryPositionNest[1];rectWholeY=-columnWidth/2;topLineX1=summaryPositionNest[0];topLineX2=summaryPositionNest[0];bottomLineX1=summaryPositionNest[4];bottomLineX2=summaryPositionNest[4];midLineX1=summaryPositionNest[2];midLineX2=summaryPositionNest[2];summaryXYCoords.push({label:"Maximum",key:key,summaryPieceName:"max",x:summaryPositionNest[4],y:yPosition,value:summaryValueNest[4]},{label:"3rd Quartile",key:key,summaryPieceName:"q3area",x:summaryPositionNest[3],y:yPosition,value:summaryValueNest[3]},{label:"Median",key:key,summaryPieceName:"median",x:summaryPositionNest[2],y:yPosition,value:summaryValueNest[2]},{label:"1st Quartile",key:key,summaryPieceName:"q1area",x:summaryPositionNest[1],y:yPosition,value:summaryValueNest[1]},{label:"Minimum",key:key,summaryPieceName:"min",x:summaryPositionNest[0],y:yPosition,value:summaryValueNest[0]})}if(projection==="radial"){summaryPositionNest=thisSummaryData.map(function(p){return p.scaledValue}).sort(function(a,b){return a-b});summaryPositionNest=[quantile(summaryPositionNest,0),quantile(summaryPositionNest,.25),quantile(summaryPositionNest,.5),quantile(summaryPositionNest,.75),quantile(summaryPositionNest,1)];extentlineX1=0;extentlineX2=0;extentlineY1=summaryPositionNest[0];extentlineY2=summaryPositionNest[4];topLineX1=-columnWidth/2;topLineX2=columnWidth/2;midLineX1=-columnWidth/2;midLineX2=columnWidth/2;bottomLineX1=-columnWidth/2;bottomLineX2=columnWidth/2;rectTopWidth=columnWidth;rectTopHeight=summaryPositionNest[1]-summaryPositionNest[3];rectTopY=summaryPositionNest[3];rectTopX=-columnWidth/2;rectBottomWidth=columnWidth;rectBottomHeight=summaryPositionNest[1]-summaryPositionNest[3];rectBottomY=summaryPositionNest[3];rectBottomX=-columnWidth/2;topLineY1=summaryPositionNest[0];topLineY2=summaryPositionNest[0];bottomLineY1=summaryPositionNest[4];bottomLineY2=summaryPositionNest[4];midLineY1=summaryPositionNest[2];midLineY2=summaryPositionNest[2];var twoPI=Math.PI*2;var bottomLineArcGenerator=arc$1().innerRadius(bottomLineY1/2).outerRadius(bottomLineY1/2);var topLineArcGenerator=arc$1().innerRadius(topLineY1/2).outerRadius(topLineY1/2);var midLineArcGenerator=arc$1().innerRadius(midLineY1/2).outerRadius(midLineY1/2);var bodyArcTopGenerator=arc$1().innerRadius(summaryPositionNest[1]/2).outerRadius(midLineY1/2);var bodyArcBottomGenerator=arc$1().innerRadius(midLineY1/2).outerRadius(summaryPositionNest[3]/2);var bodyArcWholeGenerator=arc$1().innerRadius(summaryPositionNest[1]/2).outerRadius(summaryPositionNest[3]/2);var startAngle=summary.pct_start+summary.pct_padding/2;var endAngle=summary.pct+summary.pct_start-summary.pct_padding/2;var midAngle=summary.pct/2+summary.pct_start;startAngle*=twoPI;endAngle*=twoPI;var radialAdjustX=adjustedSize[0]/2;var radialAdjustY=adjustedSize[1]/2;var bottomPoint=pointOnArcAtAngle([0,0],midAngle,summaryPositionNest[4]/2);var topPoint=pointOnArcAtAngle([0,0],midAngle,summaryPositionNest[0]/2);var thirdPoint=pointOnArcAtAngle([0,0],midAngle,summaryPositionNest[3]/2);var midPoint=pointOnArcAtAngle([0,0],midAngle,summaryPositionNest[2]/2);var firstPoint=pointOnArcAtAngle([0,0],midAngle,summaryPositionNest[1]/2);summaryXYCoords.push({label:"Minimum",key:key,summaryPieceName:"min",x:topPoint[0]+radialAdjustX,y:topPoint[1]+radialAdjustY,value:summaryValueNest[0]},{label:"1st Quartile",key:key,summaryPieceName:"q3area",x:firstPoint[0]+radialAdjustX,y:firstPoint[1]+radialAdjustY,value:summaryValueNest[1]},{label:"Median",key:key,summaryPieceName:"median",x:midPoint[0]+radialAdjustX,y:midPoint[1]+radialAdjustY,value:summaryValueNest[2]},{label:"3rd Quartile",key:key,summaryPieceName:"q1area",x:thirdPoint[0]+radialAdjustX,y:thirdPoint[1]+radialAdjustY,value:summaryValueNest[3]},{label:"Maximum",key:key,summaryPieceName:"max",x:bottomPoint[0]+radialAdjustX,y:bottomPoint[1]+radialAdjustY,value:summaryValueNest[4]});translate="translate("+radialAdjustX+","+radialAdjustY+")";renderedSummaryMarks.push(React.createElement("g",__assign({},eventListeners,{className:calculatedSummaryClass,transform:translate,key:"summaryPiece-"+summaryI,role:"img",tabIndex:-1,"data-o":key,"aria-label":key+" boxplot showing "+summaryXYCoords.filter(function(d){return d.key===key}).map(function(d){return d.label+" "+d.value})}),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"line",x1:bottomPoint[0],x2:topPoint[0],y1:bottomPoint[1],y2:topPoint[1],style:Object.assign({strokeWidth:2},calculatedSummaryStyle,summaryElementStylingFn("whisker"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:topLineArcGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({strokeWidth:4},calculatedSummaryStyle,{fill:"none"},summaryElementStylingFn("max"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:midLineArcGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({strokeWidth:4},calculatedSummaryStyle,{fill:"none"},summaryElementStylingFn("median"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:bottomLineArcGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({strokeWidth:4},calculatedSummaryStyle,{fill:"none"},summaryElementStylingFn("min"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:bodyArcWholeGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({strokeWidth:4},calculatedSummaryStyle,summaryElementStylingFn("iqrarea"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:bodyArcTopGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({},calculatedSummaryStyle,{fill:"none",stroke:"none"},summaryElementStylingFn("q3area"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"path",d:bodyArcBottomGenerator({startAngle:startAngle,endAngle:endAngle}),style:Object.assign({},calculatedSummaryStyle,{fill:"none",stroke:"none"},summaryElementStylingFn("q1area"))}))))}else{renderedSummaryMarks.push(React.createElement("g",__assign({},eventListeners,{className:calculatedSummaryClass,transform:translate,key:"summaryPiece-"+summaryI,role:"img",tabIndex:-1,"data-o":key,"aria-label":key+" boxplot showing "+summaryXYCoords.filter(function(d){return d.key===key}).map(function(d){return d.label+" "+d.value}).join(", ")}),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"line",x1:extentlineX1,x2:extentlineX2,y1:extentlineY1,y2:extentlineY2,style:Object.assign({strokeWidth:"2px"},calculatedSummaryStyle,summaryElementStylingFn("whisker"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"line",x1:topLineX1,x2:topLineX2,y1:topLineY1,y2:topLineY2,style:Object.assign({strokeWidth:"2px"},calculatedSummaryStyle,summaryElementStylingFn("min"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"line",x1:bottomLineX1,x2:bottomLineX2,y1:bottomLineY1,y2:bottomLineY2,style:Object.assign({strokeWidth:"2px"},calculatedSummaryStyle,summaryElementStylingFn("max"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"rect",x:rectWholeX,width:rectWholeWidth,y:rectWholeY,height:rectWholeHeight,style:Object.assign({strokeWidth:"1px"},calculatedSummaryStyle,summaryElementStylingFn("iqrarea"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"rect",x:rectTopX,width:rectTopWidth,y:rectTopY,height:rectTopHeight,style:Object.assign({},calculatedSummaryStyle,{fill:"none",stroke:"none"},summaryElementStylingFn("q3area"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"rect",x:rectBottomX,width:rectBottomWidth,y:rectBottomY,height:rectBottomHeight,style:Object.assign({},calculatedSummaryStyle,{fill:"none",stroke:"none"},summaryElementStylingFn("q1area"))})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderValue,markType:"line",x1:midLineX1,x2:midLineX2,y1:midLineY1,y2:midLineY2,style:Object.assign({strokeWidth:"2px"},calculatedSummaryStyle,summaryElementStylingFn("median"))}))))}});return{marks:renderedSummaryMarks,xyPoints:summaryXYCoords}}function contourRenderFn(_a){var data=_a.data,type=_a.type,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,adjustedSize=_a.adjustedSize,baseMarkProps=_a.baseMarkProps;var keys=Object.keys(data);var renderedSummaryMarks=[];var summaryXYCoords=[];keys.forEach(function(key,ordsetI){var ordset=data[key];var renderValue=renderMode&&renderMode(ordset,ordsetI);type.thresholds=type.thresholds||8;type.bandwidth=type.bandwidth||12;type.resolution=type.resolution||1e3;var projectedOrd=[{id:ordset,_xyfCoordinates:ordset.xyData.map(contourMap)}];var oContours=contouring({summaryType:type,data:projectedOrd,finalXExtent:[0,adjustedSize[0]],finalYExtent:[0,adjustedSize[1]]});var contourMarks=[];oContours.forEach(function(d,i){d.coordinates.forEach(function(coords,ii){var eventListeners=eventListenersGenerator(d,i);contourMarks.push(React.createElement(lib_2,__assign({},baseMarkProps,eventListeners,{renderMode:renderValue,simpleInterpolate:true,key:i+"-"+ii,style:styleFn(ordset.pieceData[0].data,ordsetI),className:classFn(ordset.pieceData[0].data,ordsetI),markType:"path",d:"M"+d.coordinates[0].map(function(p){return p.join(",")}).join("L")+"Z"})))})});renderedSummaryMarks.push(React.createElement("g",{key:"contour-container-"+ordsetI,role:"img",tabIndex:-1,"data-o":key,"aria-label":key+" Contour plot"},contourMarks))});return{marks:renderedSummaryMarks,xyPoints:summaryXYCoords}}function axisGenerator(axisProps,i,axisScale){return React.createElement(Axis,{label:axisProps.label,key:axisProps.key||"orframe-summary-axis-"+i,orient:axisProps.orient,size:axisProps.size,ticks:axisProps.ticks,tickSize:axisProps.tickSize,tickFormat:axisProps.tickFormat,tickValues:axisProps.tickValues,rotate:axisProps.rotate,scale:axisScale,className:axisProps.className})}function bucketizedRenderingFn(_a){var data=_a.data,type=_a.type,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,projection=_a.projection,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,baseMarkProps=_a.baseMarkProps;var renderedSummaryMarks=[];var summaryXYCoords=[];var buckets=type.bins||25;var relativeBuckets=type.relative?{}:false;var summaryValueAccessor=type.binValue||function(d){return d.length};var axisCreator;if(type.axis){type.axis.orient=projection==="horizontal"&&["left","right"].indexOf(type.axis.orient)===-1?"left":type.axis.orient;type.axis.orient=projection==="vertical"&&["bottom","top"].indexOf(type.axis.orient)===-1?"bottom":type.axis.orient;axisCreator=axisGenerator;if(projection==="radial"){console.error("Summary axes cannot be drawn for radial histograms");axisCreator=function(){return null}}}var bucketSize=chartSize/buckets;var keys=Object.keys(data);var binMax=0;var calculatedBins=keys.map(function(key,summaryI){var summary=data[key];var thisSummaryData=summary.xyData;var xySorting=projection==="vertical"?verticalXYSorting:horizontalXYSorting;var summaryPositionNest=thisSummaryData.sort(xySorting);var violinHist=histogram();var binDomain=projection==="vertical"?[0,chartSize]:[0,chartSize];var binOffset=0;var binBuckets=[];for(var x=0;x<buckets;x++){binBuckets.push(binDomain[0]+x/buckets*(chartSize-binOffset))}var xyValue=projection==="vertical"?function(p){return p.piece.scaledVerticalValue}:function(p){return p.piece.scaledValue};var keyBins;if(type.useBins===false){var calculatedValues_1=summaryPositionNest.map(function(value){return xyValue(value)});keyBins=summaryPositionNest.map(function(value,i){var bucketArray=[];bucketArray.x0=calculatedValues_1[i]-1;bucketArray.x1=calculatedValues_1[i]+1;bucketArray.push(value);return bucketArray}).sort(function(a,b){return a.x0-b.x0});bucketSize=chartSize/keyBins.length}else{keyBins=violinHist.domain(binDomain).thresholds(binBuckets).value(xyValue)(summaryPositionNest)}keyBins=keyBins.map(function(d){return{y:d.x0,y1:d.x1-d.x0,pieces:d,value:summaryValueAccessor(d.map(function(p){return p.piece.data}))}});if(type.type==="histogram"||type.type==="heatmap"){keyBins=keyBins.filter(function(d){return d.value!==0})}var relativeMax=keyBins.length===0?0:max$2(keyBins.map(function(d){return d.value}));if(relativeBuckets){relativeBuckets[key]=relativeMax}binMax=Math.max(binMax,relativeMax);return{bins:keyBins,summary:summary,summaryI:summaryI,thisSummaryData:thisSummaryData}});calculatedBins.forEach(function(_a){var bins=_a.bins,summary=_a.summary,summaryI=_a.summaryI,thisSummaryData=_a.thisSummaryData;var eventListeners=eventListenersGenerator(summary,summaryI);var columnWidth=summary.width;var renderValue=renderMode&&renderMode(summary,summaryI);var calculatedSummaryStyle=thisSummaryData[0]?styleFn(thisSummaryData[0].piece.data,summaryI):{};var calculatedSummaryClass=thisSummaryData[0]?classFn(thisSummaryData[0].piece.data,summaryI):"";var translate=[summary.middle,0];if(projection==="horizontal"){translate=[bucketSize,summary.middle]}else if(projection==="radial"){translate=[adjustedSize[0]/2,adjustedSize[1]/2]}var actualMax=relativeBuckets&&relativeBuckets[summary.name]||binMax;if(type.type==="heatmap"||type.type==="histogram"){var mappedBars=groupBarMark({bins:bins,binMax:binMax,relativeBuckets:relativeBuckets,columnWidth:columnWidth,projection:projection,adjustedSize:adjustedSize,summaryI:summaryI,summary:summary,renderValue:renderValue,summaryStyle:calculatedSummaryStyle,type:type,baseMarkProps:baseMarkProps});var tiles=mappedBars.marks;if(projection==="radial"){translate=[0,0]}if(type.axis&&type.type==="histogram"){renderedSummaryMarks.push(createSummaryAxis({summary:summary,summaryI:summaryI,axisSettings:type.axis,axisCreator:axisCreator,projection:projection,actualMax:actualMax,adjustedSize:adjustedSize,columnWidth:columnWidth}))}mappedBars.points.forEach(function(d){d.x+=translate[0];d.y+=translate[1]});summaryXYCoords.push.apply(summaryXYCoords,__spread(mappedBars.points));renderedSummaryMarks.push(React.createElement("g",__assign({},eventListeners,{transform:"translate("+translate+")",key:"summaryPiece-"+summaryI,role:"img",tabIndex:-1,"data-o":summary.name,"aria-label":summary.name+" "+type.type}),tiles))}else if(type.type==="violin"){bins[0].y=bins[0].y-bucketSize/2;bins[bins.length-1].y=bins[bins.length-1].y+bucketSize/2;var violinArea=area$1().curve(type.curve||curveCatmullRom);var violinPoints_1=[];if(projection==="horizontal"){bins.forEach(function(summaryPoint){var xValue=summaryPoint.y-bucketSize/2;var yValue=summaryPoint.value/actualMax*columnWidth/2;violinPoints_1.push({x:xValue,y0:-yValue,y1:yValue});summaryXYCoords.push({key:summary.name,x:xValue+translate[0],y:yValue+translate[1],pieces:summaryPoint.pieces.map(function(d){return d.piece}),value:summaryPoint.value})});violinArea.x(function(d){return d.x}).y0(function(d){return d.y0}).y1(function(d){return d.y1}).defined(function(d,i){return d.y0!==0||(violinPoints_1[i-1]&&violinPoints_1[i-1].y0!==0||violinPoints_1[i+1]&&violinPoints_1[i+1].y0!==0)})}else if(projection==="vertical"){bins.forEach(function(summaryPoint){var yValue=summaryPoint.y+bucketSize/2;var xValue=summaryPoint.value/actualMax*columnWidth/2;violinPoints_1.push({y:yValue,x0:-xValue,x1:xValue});summaryXYCoords.push({key:summary.name,x:xValue+translate[0],y:yValue+translate[1],pieces:summaryPoint.pieces.map(function(d){return d.piece}),value:summaryPoint.value})});violinArea.y(function(d){return d.y}).x0(function(d){return d.x0}).x1(function(d){return d.x1}).defined(function(d,i){return d.x0!==0||(violinPoints_1[i-1]&&violinPoints_1[i-1].x0!==0||violinPoints_1[i+1]&&violinPoints_1[i+1].x0!==0)})}else if(projection==="radial"){var angle_1=summary.pct-summary.pct_padding/2;var midAngle_1=summary.pct_middle;violinPoints_1=bins;violinArea=function(inbins){var forward=[];var backward=[];inbins.forEach(function(bin){var outsidePoint=pointOnArcAtAngle([0,0],midAngle_1+angle_1*bin.value/actualMax/2,(bin.y+bin.y1-bucketSize/2)/2);var insidePoint=pointOnArcAtAngle([0,0],midAngle_1-angle_1*bin.value/actualMax/2,(bin.y+bin.y1-bucketSize/2)/2);summaryXYCoords.push({key:summary.name,x:insidePoint[0]+translate[0],y:insidePoint[1]+translate[1],pieces:bin.pieces.map(function(d){return d.piece}),value:bin.value});summaryXYCoords.push({key:summary.name,x:outsidePoint[0]+translate[0],y:outsidePoint[1]+translate[1],pieces:bin.pieces.map(function(d){return d.piece}),value:bin.value});forward.push(outsidePoint);backward.push(insidePoint)});return"M"+forward.map(function(d){return d.join(",")}).join("L")+"L"+backward.reverse().map(function(d){return d.join(",")}).join("L")+"Z"}}renderedSummaryMarks.push(React.createElement(lib_2,__assign({},baseMarkProps,{transform:"translate("+translate+")",key:"summaryPiece-"+summaryI},eventListeners,{renderMode:renderValue,markType:"path",className:calculatedSummaryClass,style:calculatedSummaryStyle,d:violinArea(violinPoints_1),role:"img",tabIndex:-1,"data-o":summary.name,"aria-label":summary.name+" distribution"})))}else if(type.type==="joy"||type.type==="ridgeline"){var zeroedStart=Object.assign({},bins[0],{value:0});var zeroedEnd=Object.assign({},bins[bins.length-1],{value:0});zeroedStart.y=zeroedStart.y-bucketSize/2;zeroedEnd.y=zeroedEnd.y+bucketSize/2;var joyBins_1=__spread([zeroedStart],bins,[zeroedEnd]);var joyPoints_1=[];var interpolatorSetting=type.curve||type.interpolator;var actualInterpolator=typeof interpolatorSetting==="string"?curveHash[interpolatorSetting]:interpolatorSetting;var joyArea=line$1().curve(actualInterpolator||curveCatmullRom).x(function(d){return d.x}).y(function(d){return d.y});var joyHeight_1=type.amplitude||0;if(type.axis&&type.type==="histogram"){renderedSummaryMarks.push(createSummaryAxis({summary:summary,summaryI:summaryI,axisSettings:__assign({baseline:false},type.axis),axisCreator:axisCreator,projection:projection,actualMax:actualMax,adjustedSize:adjustedSize,columnWidth:columnWidth}))}if(projection==="horizontal"){joyBins_1.forEach(function(summaryPoint,i){var xValue=summaryPoint.y-bucketSize/2;var yValue=type.flip?summaryPoint.value/actualMax*(columnWidth+joyHeight_1)-columnWidth/2:-summaryPoint.value/actualMax*(columnWidth+joyHeight_1)+columnWidth/2;joyPoints_1.push({y:yValue,x:xValue});if(i!==0&&i!==joyBins_1.length-1){summaryXYCoords.push({key:summary.name,x:xValue+translate[0],y:yValue+translate[1],pieces:summaryPoint.pieces.map(function(d){return d.piece}),value:summaryPoint.value})}})}else if(projection==="vertical"){joyBins_1.forEach(function(summaryPoint){var yValue=summaryPoint.y+bucketSize/2;var xValue=type.flip===true?summaryPoint.value/actualMax*(columnWidth+joyHeight_1)-columnWidth/2:-summaryPoint.value/actualMax*(columnWidth+joyHeight_1)+columnWidth/2;joyPoints_1.push({y:yValue,x:xValue});summaryXYCoords.push({key:summary.name,x:xValue+translate[0],y:yValue+translate[1],pieces:summaryPoint.pieces.map(function(d){return d.piece}),value:summaryPoint.value})})}else if(projection==="radial"){var angle_2=summary.pct-summary.pct_padding/2;var midAngle_2=summary.pct_start+summary.pct_padding/2;translate=[0,0];joyPoints_1=joyBins_1;joyArea=function(inbins){var forward=[];inbins.forEach(function(bin){var outsidePoint=pointOnArcAtAngle([adjustedSize[0]/2,adjustedSize[1]/2],midAngle_2+angle_2*bin.value/actualMax,(bin.y+bin.y1-bucketSize/2)/2);summaryXYCoords.push({key:summary.name,x:outsidePoint[0]+translate[0],y:outsidePoint[1]+translate[1],pieces:bin.pieces.map(function(d){return d.piece}),value:bin.value});forward.push(outsidePoint)});return"M"+forward.map(function(d){return d.join(",")}).join("L")+"Z"}}if(type.axis){renderedSummaryMarks.push(createSummaryAxis({summary:summary,summaryI:summaryI,axisSettings:type.axis,axisCreator:axisCreator,projection:projection,actualMax:actualMax,adjustedSize:adjustedSize,columnWidth:columnWidth}))}renderedSummaryMarks.push(React.createElement(lib_2,__assign({},baseMarkProps,{transform:"translate("+translate+")",key:"summaryPiece-"+summaryI},eventListeners,{renderMode:renderValue,markType:"path",className:calculatedSummaryClass,style:calculatedSummaryStyle,d:joyArea(joyPoints_1),role:"img",tabIndex:-1,"data-o":summary.name,"aria-label":summary.name+" distribution"})))}});return{marks:renderedSummaryMarks,xyPoints:summaryXYCoords}}var drawSummaries=function(_a){var data=_a.data,type=_a.type,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,classFn=_a.classFn,positionFn=_a.positionFn,projection=_a.projection,adjustedSize=_a.adjustedSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps;if(!type||!type.type)return;type=typeof type==="string"?{type:type}:type;var chartSize=projection==="vertical"?adjustedSize[1]:adjustedSize[0];return orFrameSummaryRenderer({data:data,type:type,renderMode:renderMode,eventListenersGenerator:eventListenersGenerator,styleFn:styleFn,classFn:classFn,positionFn:positionFn,projection:projection,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,baseMarkProps:baseMarkProps})};var renderLaidOutSummaries=function(_a){var data=_a.data;return data};var marginalPointMapper=function(orient,width,data){var xMod=orient==="left"||orient==="right"?width/2:0;var yMod=orient==="bottom"||orient==="top"?width/2:0;return data.map(function(p){return[p.xy.x+xMod,p.xy.y+yMod]})};function formatValue(value,props){if(props.tickFormat){return props.tickFormat(value)}if(value.toString){return value.toString()}return value}var Axis=function(_super){__extends(Axis,_super);function Axis(props){var _this=_super.call(this,props)||this;_this.axisRef=null;_this.boundingBoxMax=function(){if(!_this.axisRef)return 30;var _a=_this.props.orient,orient=_a===void 0?"left":_a;var positionType=orient==="left"||orient==="right"?"width":"height";var axisLabelMax=Math.max.apply(Math,__spread(__spread(_this.axisRef.querySelectorAll(".axis-label")).map(function(l){return l.getBBox&&l.getBBox()||{height:30,width:30}}).map(function(d){return d[positionType]})))+25;return axisLabelMax};_this.state={hoverAnnotation:0};return _this}Axis.prototype.componentDidUpdate=function(){var _a=this.props.label,label=_a===void 0?{position:false}:_a;if(!label.position&&this.props.dynamicLabelPosition){var newBBMax=this.boundingBoxMax();if(newBBMax!==this.state.calculatedLabelPosition){this.setState({calculatedLabelPosition:newBBMax})}}};Axis.prototype.componentDidMount=function(){var _a=this.props.label,label=_a===void 0?{position:false}:_a;if(!label.position&&this.props.dynamicLabelPosition){var newBBMax=this.boundingBoxMax();this.setState({calculatedLabelPosition:newBBMax})}};Axis.prototype.render=function(){var _this=this;var _a=this.props,rotate=_a.rotate,label=_a.label,_b=_a.orient,orient=_b===void 0?"left":_b,marginalSummaryType=_a.marginalSummaryType,_c=_a.tickFormat,tickFormat=_c===void 0?marginalSummaryType?function(){return""}:function(d){return d}:_c,size=_a.size,_d=_a.width,width=_d===void 0?size&&size[0]||0:_d,_e=_a.height,height=_e===void 0?size&&size[1]||0:_e,className=_a.className,padding=_a.padding,tickValues=_a.tickValues,scale=_a.scale,ticks=_a.ticks,footer=_a.footer,tickSize=_a.tickSize,tickLineGenerator=_a.tickLineGenerator,_f=_a.baseline,baseline=_f===void 0?true:_f,_g=_a.margin,margin=_g===void 0?{top:0,bottom:0,left:0,right:0}:_g,_h=_a.center,center=_h===void 0?false:_h;var _j=this.props,axisParts=_j.axisParts,_k=_j.position,position=_k===void 0?[0,0]:_k;var axisTickLines;if(!axisParts){axisParts=axisPieces({padding:padding,tickValues:tickValues,scale:scale,ticks:ticks,orient:orient,size:[width,height],footer:footer,tickSize:tickSize});axisTickLines=React.createElement("g",{className:"axis "+className},axisLines({axisParts:axisParts,orient:orient,tickLineGenerator:tickLineGenerator,className:className,scale:scale}))}if(axisParts.length===0){return null}var hoverWidth=50;var hoverHeight=height;var hoverX=-50;var hoverY=0;var baselineX=0;var baselineY=0;var baselineX2=0;var baselineY2=height;var hoverFunction=function(e){return _this.setState({hoverAnnotation:e.nativeEvent.offsetY})};var circleX=25;var textX=-25;var textY=18;var lineWidth=width+25;var lineHeight=0;var circleY=this.state.hoverAnnotation;var annotationOffset=0;var annotationType="y";switch(orient){case"right":position=[position[0],position[1]];hoverX=width;baselineX2=baselineX=width;annotationOffset=margin.top;lineWidth=-width-25;textX=5;hoverFunction=function(e){return _this.setState({hoverAnnotation:e.nativeEvent.offsetY-annotationOffset})};if(center===true){baselineX2=baselineX=width/2}break;case"top":position=[position[0],0];hoverWidth=width;hoverHeight=50;hoverY=-50;hoverX=0;annotationOffset=margin.left;annotationType="x";baselineX2=width;baselineY2=0;if(center===true){baselineY2=baselineY=height/2}hoverFunction=function(e){return _this.setState({hoverAnnotation:e.nativeEvent.offsetX-annotationOffset})};circleX=this.state.hoverAnnotation;circleY=25;textX=0;textY=-10;lineWidth=0;lineHeight=height+25;break;case"bottom":position=[position[0],0];hoverWidth=width;hoverHeight=50;baselineY=baselineY2=hoverY=height;baselineX=hoverX=0;baselineX2=width;annotationOffset=margin.left;hoverFunction=function(e){return _this.setState({hoverAnnotation:e.nativeEvent.offsetX-annotationOffset})};circleX=this.state.hoverAnnotation;circleY=25;textX=0;textY=15;lineWidth=0;lineHeight=-height-25;annotationType="x";if(center===true){baselineY2=baselineY=height/2}break;default:position=[position[0],position[1]];annotationOffset=margin.top;if(center===true){baselineX2=baselineX=width/2}hoverFunction=function(e){return _this.setState({hoverAnnotation:e.nativeEvent.offsetY-annotationOffset})}}var annotationBrush;if(this.props.annotationFunction){var formattedValue=formatValue(this.props.scale.invert(this.state.hoverAnnotation),this.props);var hoverGlyph=this.props.glyphFunction?this.props.glyphFunction({lineHeight:lineHeight,lineWidth:lineWidth,value:this.props.scale.invert(this.state.hoverAnnotation)}):React.createElement("g",null,React.isValidElement(formattedValue)?React.createElement("g",{transform:"translate("+textX+","+textY+")"},formattedValue):React.createElement("text",{x:textX,y:textY},formattedValue),React.createElement("circle",{r:5}),React.createElement("line",{x1:lineWidth,y1:lineHeight,style:{stroke:"black"}}));var annotationSymbol=this.state.hoverAnnotation?React.createElement("g",{style:{pointerEvents:"none"},transform:"translate("+circleX+","+circleY+")"},hoverGlyph):null;annotationBrush=React.createElement("g",{className:"annotation-brush",transform:"translate("+hoverX+","+hoverY+")"},React.createElement("rect",{style:{fillOpacity:0},height:hoverHeight,width:hoverWidth,onMouseMove:hoverFunction,onClick:function(){return _this.props.annotationFunction({className:"dynamic-axis-annotation",type:annotationType,value:_this.props.scale.invert(_this.state.hoverAnnotation)})},onMouseOut:function(){return _this.setState({hoverAnnotation:undefined})}}),annotationSymbol)}var summaryGraphic;if(marginalSummaryType&&this.props.xyPoints){var summaryWidth=Math.max(margin[orient]-6,5);var decoratedSummaryType_1=typeof marginalSummaryType==="string"?{type:marginalSummaryType}:marginalSummaryType;if(decoratedSummaryType_1.flip===undefined&&(orient==="bottom"||orient==="right")){decoratedSummaryType_1.flip=true}var summaryStyle=decoratedSummaryType_1.summaryStyle?function(){return decoratedSummaryType_1.summaryStyle}:function(){return{fill:"black",fillOpacity:.5,stroke:"black",strokeDasharray:"0"}};var summaryRenderMode=decoratedSummaryType_1.renderMode?function(){return decoratedSummaryType_1.renderMode}:function(){return undefined};var summaryClass=decoratedSummaryType_1.summaryClass?function(){return decoratedSummaryType_1.summaryClass}:function(){return""};var dataFilter_1=decoratedSummaryType_1.filter||function(){return true};var forSummaryData=this.props.xyPoints.filter(function(p){return p.x!==undefined&&p.y!==undefined&&dataFilter_1(p.data)}).map(function(d){return __assign({},d,{xy:{x:orient==="top"||orient==="bottom"?scale(d.x):0,y:orient==="left"||orient==="right"?scale(d.y):0},piece:{scaledVerticalValue:scale(d.y),scaledValue:scale(d.x)},value:orient==="top"||orient==="bottom"?scale(d.y):scale(d.x),scaledValue:scale(d.x),scaledVerticalValue:scale(d.y)})});var renderedSummary=drawSummaries({data:{column:{middle:summaryWidth/2,pieceData:forSummaryData,width:summaryWidth,xyData:forSummaryData}},type:decoratedSummaryType_1,renderMode:summaryRenderMode,eventListenersGenerator:decoratedSummaryType_1.eventListenersGenerator||function(){return{}},styleFn:summaryStyle,classFn:summaryClass,positionFn:function(){return[0,0]},projection:orient==="top"||orient==="bottom"?"horizontal":"vertical",adjustedSize:size,margin:{top:0,bottom:0,left:0,right:0},baseMarkProps:{}});var points=void 0;if(decoratedSummaryType_1.showPoints===true){var mappedPoints=marginalPointMapper(orient,summaryWidth,forSummaryData);points=mappedPoints.map(function(d,i){return React.createElement("circle",{key:"axis-summary-point-"+i,cx:d[0],cy:d[1],r:decoratedSummaryType_1.r||3,style:decoratedSummaryType_1.pointStyle||{fill:"black",fillOpacity:.1}})})}var translation={left:[-margin.left+2,0],right:[size[0]+2,0],top:[0,-margin.top+2],bottom:[0,size[1]+2]};summaryGraphic=React.createElement("g",{transform:"translate("+translation[orient]+")"},React.createElement("g",{transform:"translate("+((decoratedSummaryType_1.type==="contour"||decoratedSummaryType_1.type==="boxplot")&&(orient==="left"||orient==="right")?summaryWidth/2:0)+","+((decoratedSummaryType_1.type==="contour"||decoratedSummaryType_1.type==="boxplot")&&(orient==="top"||orient==="bottom")?summaryWidth/2:0)+")"},renderedSummary.marks),points)}var axisTitle;var axisTickLabels=axisLabels({tickFormat:tickFormat,axisParts:axisParts,orient:orient,rotate:rotate,center:center});if(label){var labelName=label.name||label;var labelPosition=label.position||{};var locationMod=labelPosition.location||"outside";var anchorMod=labelPosition.anchor||"middle";var distance=label.locationDistance||this.state.calculatedLabelPosition;var rotateHash={left:-90,right:90,top:0,bottom:0};var rotation=labelPosition.rotation||rotateHash[orient];var positionHash={left:{start:[0,size[1]],middle:[0,size[1]/2],end:[0,0],inside:[distance||15,0],outside:[-(distance||45),0]},right:{start:[size[0]+0,size[1]],middle:[size[0]+0,size[1]/2],end:[size[0]+0,0],inside:[-(distance||15),0],outside:[distance||45,0]},top:{start:[0,0],middle:[0+size[0]/2,0],end:[0+size[0],0],inside:[0,distance||15],outside:[0,-(distance||40)]},bottom:{start:[0,size[1]],middle:[0+size[0]/2,size[1]],end:[0+size[0],size[1]],inside:[0,-(distance||5)],outside:[0,distance||50]}};var translation=positionHash[orient][anchorMod];var location=positionHash[orient][locationMod];translation[0]=translation[0]+location[0];translation[1]=translation[1]+location[1];if(anchorMod==="start"&&orient==="right"){anchorMod="end"}else if(anchorMod==="end"&&orient==="right"){anchorMod="start"}axisTitle=React.createElement("g",{className:"axis-title "+className,transform:"translate("+[translation[0]+position[0],translation[1]+position[1]]+") rotate("+rotation+")"},React.isValidElement(labelName)?labelName:React.createElement("text",{textAnchor:anchorMod},labelName))}var axisAriaLabel=orient+" axis "+(axisParts&&axisParts.length>0&&"from "+tickFormat(axisParts[0].value,0)+" to "+tickFormat(axisParts[axisParts.length-1].value,axisParts.length-1)||"without ticks");return React.createElement("g",{className:className,"aria-label":axisAriaLabel,ref:function(node){return _this.axisRef=node}},annotationBrush,axisTickLabels,axisTickLines,baseline===true?React.createElement("line",{key:"baseline",className:"axis-baseline "+className,stroke:"black",strokeLinecap:"square",x1:baselineX,x2:baselineX2,y1:baselineY,y2:baselineY2}):null,axisTitle,summaryGraphic)};return Axis}(React.Component);var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var inited=false;function init$1(){inited=true;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63}function toByteArray(b64){if(!inited){init$1()}var i,j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}placeHolders=b64[len-2]==="="?2:b64[len-1]==="="?1:0;arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){if(!inited){init$1()}var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}function read(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)}function write(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}var toString={}.toString;var isArray=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"};var INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT!==undefined?global$1.TYPED_ARRAY_SUPPORT:true;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(internalIsBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}Buffer.isBuffer=isBuffer;function internalIsBuffer(b){return!!(b!=null&&b._isBuffer)}Buffer.compare=function compare(a,b){if(!internalIsBuffer(a)||!internalIsBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!internalIsBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(internalIsBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!internalIsBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!internalIsBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(internalIsBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return fromByteArray(buf)}else{return fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!internalIsBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4)}write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8)}write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=internalIsBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}function isBuffer(obj){return obj!=null&&(!!obj._isBuffer||isFastBuffer(obj)||isSlowBuffer(obj))}function isFastBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isFastBuffer(obj.slice(0,0))}var R=(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))==="object"?Reflect:null;var ReflectApply=R&&typeof R.apply==="function"?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};var ReflectOwnKeys;if(R&&typeof R.ownKeys==="function"){ReflectOwnKeys=R.ownKeys}else if(Object.getOwnPropertySymbols){ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}}else{ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target)}}function ProcessEmitWarning(warning){if(console&&console.warn)console.warn(warning)}var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!==value};function EventEmitter(){EventEmitter.init.call(this)}var events=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function get(){return defaultMaxListeners},set:function set(arg){if(typeof arg!=="number"||arg<0||NumberIsNaN(arg)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".")}defaultMaxListeners=arg}});EventEmitter.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||NumberIsNaN(n)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".")}this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};EventEmitter.prototype.emit=function emit(type){var args=[];for(var i=1;i<arguments.length;i++){args.push(arguments[i])}var doError=type==="error";var events=this._events;if(events!==undefined)doError=doError&&events.error===undefined;else if(!doError)return false;if(doError){var er;if(args.length>0)er=args[0];if(er instanceof Error){throw er}var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));err.context=er;throw err}var handler=events[type];if(handler===undefined)return false;if(typeof handler==="function"){ReflectApply(handler,this,args)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){ReflectApply(listeners[i],this,args)}}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof(listener))}events=target._events;if(events===undefined){events=target._events=Object.create(null);target._eventsCount=0}else{if(events.newListener!==undefined){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(existing===undefined){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else if(prepend){existing.unshift(listener)}else{existing.push(listener)}m=$getMaxListeners(target);if(m>0&&existing.length>m&&!existing.warned){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;ProcessEmitWarning(w)}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;ReflectApply(this.listener,this.target,args)}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=onceWrapper.bind(state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof(listener))}this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof(listener))}this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+_typeof(listener))}events=this._events;if(events===undefined)return this;list=events[type];if(list===undefined)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=Object.create(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else{spliceOne(list,position)}if(list.length===1)events[type]=list[0];if(events.removeListener!==undefined)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(events===undefined)return this;if(events.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(events[type]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete events[type]}return this}if(arguments.length===0){var keys=Object.keys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners!==undefined){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(events===undefined)return[];var evlistener=events[type];if(evlistener===undefined)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events!==undefined){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener!==undefined){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i){copy[i]=arr[i]}return copy}function spliceOne(list,index){for(;index+1<list.length;index++){list[index]=list[index+1]}list.pop()}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}var events_1=events.EventEmitter;var isBuffer$1=function isBuffer(arg){return arg instanceof Buffer};var isBuffer$2=Object.freeze({default:isBuffer$1,__moduleExports:isBuffer$1});var inherits_browser=createCommonjsModule(function(module){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function TempCtor(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}});var inherits_browser$1=Object.freeze({default:inherits_browser,__moduleExports:inherits_browser});var require$$1$a=inherits_browser$1&&inherits_browser||inherits_browser$1;var inherits=createCommonjsModule(function(module){try{var util$1=util;if(typeof util$1.inherits!=="function")throw"";module.exports=util$1.inherits}catch(e){module.exports=require$$1$a}});var inherits$1=Object.freeze({default:inherits,__moduleExports:inherits});var require$$0$3=isBuffer$2&&isBuffer$1||isBuffer$2;var require$$1$b=inherits$1&&inherits||inherits$1;var util=createCommonjsModule(function(module,exports){var getOwnPropertyDescriptors=Object.getOwnPropertyDescriptors||function getOwnPropertyDescriptors(obj){var keys=Object.keys(obj);var descriptors={};for(var i=0;i<keys.length;i++){descriptors[keys[i]]=Object.getOwnPropertyDescriptor(obj,keys[i])}return descriptors};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(typeof process!=="undefined"&&process.noDeprecation===true){return fn}if(typeof process==="undefined"){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}var warned=false;function deprecated(){if(!warned){{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron="";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var length=output.reduce(function(prev,cur){if(cur.indexOf("\n")>=0);return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return _typeof(arg)==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return _typeof(arg)==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||_typeof(arg)==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require$$0$3;function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require$$1$b;exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var kCustomPromisifiedSymbol=typeof Symbol!=="undefined"?Symbol("util.promisify.custom"):undefined;exports.promisify=function promisify(original){if(typeof original!=="function")throw new TypeError('The "original" argument must be of type Function');if(kCustomPromisifiedSymbol&&original[kCustomPromisifiedSymbol]){var fn=original[kCustomPromisifiedSymbol];if(typeof fn!=="function"){throw new TypeError('The "util.promisify.custom" argument must be of type Function')}Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:false,writable:false,configurable:true});return fn}function fn(){var promiseResolve,promiseReject;var promise=new Promise(function(resolve,reject){promiseResolve=resolve;promiseReject=reject});var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}args.push(function(err,value){if(err){promiseReject(err)}else{promiseResolve(value)}});try{original.apply(this,args)}catch(err){promiseReject(err)}return promise}Object.setPrototypeOf(fn,Object.getPrototypeOf(original));if(kCustomPromisifiedSymbol)Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:false,writable:false,configurable:true});return Object.defineProperties(fn,getOwnPropertyDescriptors(original))};exports.promisify.custom=kCustomPromisifiedSymbol;function callbackifyOnRejected(reason,cb){if(!reason){var newReason=new Error("Promise was rejected with a falsy value");newReason.reason=reason;reason=newReason}return cb(reason)}function callbackify(original){if(typeof original!=="function"){throw new TypeError('The "original" argument must be of type Function')}function callbackified(){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}var maybeCb=args.pop();if(typeof maybeCb!=="function"){throw new TypeError("The last argument must be of type Function")}var self=this;var cb=function cb(){return maybeCb.apply(self,arguments)};original.apply(this,args).then(function(ret){nextTick(cb,null,ret)},function(rej){nextTick(callbackifyOnRejected,rej,cb)})}Object.setPrototypeOf(callbackified,Object.getPrototypeOf(original));Object.defineProperties(callbackified,getOwnPropertyDescriptors(original));return callbackified}exports.callbackify=callbackify});var util_1=util.format;var util_2=util.deprecate;var util_3=util.debuglog;var util_4=util.inspect;var util_5=util.isArray;var util_6=util.isBoolean;var util_7=util.isNull;var util_8=util.isNullOrUndefined;var util_9=util.isNumber;var util_10=util.isString;var util_11=util.isSymbol;var util_12=util.isUndefined;var util_13=util.isRegExp;var util_14=util.isObject;var util_15=util.isDate;var util_16=util.isError;var util_17=util.isFunction;var util_18=util.isPrimitive;var util_19=util.isBuffer;var util_20=util.log;var util_21=util.inherits;var util_22=util._extend;var util_23=util.promisify;var util_24=util.callbackify;var byteLength_1=byteLength$1;var toByteArray_1=toByteArray$1;var fromByteArray_1=fromByteArray$1;var lookup$1=[];var revLookup$1=[];var Arr$1=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup$1[i]=code[i];revLookup$1[code.charCodeAt(i)]=i}revLookup$1["-".charCodeAt(0)]=62;revLookup$1["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength$1(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray$1(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr$1(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;for(var i=0;i<len;i+=4){tmp=revLookup$1[b64.charCodeAt(i)]<<18|revLookup$1[b64.charCodeAt(i+1)]<<12|revLookup$1[b64.charCodeAt(i+2)]<<6|revLookup$1[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup$1[b64.charCodeAt(i)]<<2|revLookup$1[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup$1[b64.charCodeAt(i)]<<10|revLookup$1[b64.charCodeAt(i+1)]<<4|revLookup$1[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64$1(num){return lookup$1[num>>18&63]+lookup$1[num>>12&63]+lookup$1[num>>6&63]+lookup$1[num&63]}function encodeChunk$1(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64$1(tmp))}return output.join("")}function fromByteArray$1(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk$1(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup$1[tmp>>2]+lookup$1[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup$1[tmp>>10]+lookup$1[tmp>>4&63]+lookup$1[tmp<<2&63]+"=")}return parts.join("")}var base64Js={byteLength:byteLength_1,toByteArray:toByteArray_1,fromByteArray:fromByteArray_1};var base64Js$1=Object.freeze({default:base64Js,__moduleExports:base64Js,byteLength:byteLength_1,toByteArray:toByteArray_1,fromByteArray:fromByteArray_1});var read$1=function read(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};var write$1=function write(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128};var ieee754={read:read$1,write:write$1};var ieee754$1=Object.freeze({default:ieee754,__moduleExports:ieee754,read:read$1,write:write$1});var toString$1={}.toString;var isarray=Array.isArray||function(arr){return toString$1.call(arr)=="[object Array]"};var isarray$1=Object.freeze({default:isarray,__moduleExports:isarray});var base64=base64Js$1&&base64Js||base64Js$1;var ieee754$2=ieee754$1&&ieee754||ieee754$1;var isArray$1=isarray$1&&isarray||isarray$1;var buffer=createCommonjsModule(function(module,exports){exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=commonjsGlobal.TYPED_ARRAY_SUPPORT!==undefined?commonjsGlobal.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function foo(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray$1(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray$1(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754$2.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754$2.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754$2.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754$2.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4)}ieee754$2.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8)}ieee754$2.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}});var buffer_1=buffer.Buffer;var buffer_2=buffer.SlowBuffer;var buffer_3=buffer.INSPECT_MAX_BYTES;var buffer_4=buffer.kMaxLength;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return buffer_1.alloc(0);if(this.length===1)return this.head.data;var ret=buffer_1.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){p.data.copy(ret,i);i+=p.data.length;p=p.next}return ret};var safeBuffer=createCommonjsModule(function(module,exports){var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}});var safeBuffer_1=safeBuffer.Buffer;var safeBuffer$1=Object.freeze({default:safeBuffer,__moduleExports:safeBuffer,Buffer:safeBuffer_1});var require$$0$4=safeBuffer$1&&safeBuffer||safeBuffer$1;var Buffer$1=require$$0$4.Buffer;var isEncoding=Buffer$1.isEncoding||function(encoding){encoding=""+encoding;switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(enc){if(!enc)return"utf8";var retried;while(true){switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase();retried=true}}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=="string"&&(Buffer$1.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}var StringDecoder_1=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;nb=4;break;case"utf8":this.fillLast=utf8FillLast;nb=4;break;case"base64":this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer$1.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(buf.length===0)return"";var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return"";i=this.lastNeed;this.lastNeed=0}else{i=0}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=127)return 0;else if(byte>>5===6)return 2;else if(byte>>4===14)return 3;else if(byte>>3===30)return 4;return byte>>6===2?-1:-2}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}return nb}return 0}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&192)!==128){self.lastNeed=0;return"�"}if(self.lastNeed>1&&buf.length>1){if((buf[1]&192)!==128){self.lastNeed=1;return"�"}if(self.lastNeed>2&&buf.length>2){if((buf[2]&192)!==128){self.lastNeed=2;return"�"}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+"�";return r}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString("base64",i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}return buf.toString("base64",i,buf.length-n)}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+this.lastChar.toString("base64",0,3-this.lastNeed);return r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}Readable.ReadableState=ReadableState;var debug=util_3("stream");util_21(Readable,events);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(Array.isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function listenerCount$1(emitter,type){return emitter.listeners(type).length}function ReadableState(options,stream){options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){this.decoder=new StringDecoder_1(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;events.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){this._readableState.decoder=new StringDecoder_1(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)process$1.nextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process$1.nextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=!pipeOpts||pipeOpts.end!==false;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process$1.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(listenerCount$1(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&src.listeners("data").length){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var _i=0;_i<len;_i++){dests[_i].emit("unpipe",this)}return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=events.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){process$1.nextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process$1.nextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;process$1.nextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}Writable.WritableState=WritableState;util_21(Writable,events_1);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Object.defineProperty(this,"buffer",{get:util_2(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")});options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};function Writable(options){if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}events_1.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);process$1.nextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(!buffer_1.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);process$1.nextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(buffer_1.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=buffer_1.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(buffer_1.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)process$1.nextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){process$1.nextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process$1.nextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}util_21(Duplex,Readable);var keys$1=Object.keys(Writable.prototype);for(var v=0;v<keys$1.length;v++){var method=keys$1[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process$1.nextTick(onEndNT,this)}function onEndNT(self){self.end()}util_21(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("Not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}util_21(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)};util_21(Stream,events);Stream.Readable=Readable;Stream.Writable=Writable;Stream.Duplex=Duplex;Stream.Transform=Transform;Stream.PassThrough=PassThrough;Stream.Stream=Stream;function Stream(){events.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(events.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest};var _endianness;function endianness(){if(typeof _endianness==="undefined"){var a=new ArrayBuffer(2);var b=new Uint8Array(a);var c=new Uint16Array(a);b[0]=1;b[1]=2;if(c[0]===258){_endianness="BE"}else if(c[0]===513){_endianness="LE"}else{throw new Error("unable to figure out endianess")}}return _endianness}function hostname(){if(typeof global$1.location!=="undefined"){return global$1.location.hostname}else return""}function loadavg(){return[]}function uptime$1(){return 0}function freemem(){return Number.MAX_VALUE}function totalmem(){return Number.MAX_VALUE}function cpus(){return[]}function type(){return"Browser"}function release$1(){if(typeof global$1.navigator!=="undefined"){return global$1.navigator.appVersion}return""}function networkInterfaces(){}function getNetworkInterfaces(){}function tmpDir(){return"/tmp"}var tmpdir=tmpDir;var EOL="\n";var os={EOL:EOL,tmpdir:tmpdir,tmpDir:tmpDir,networkInterfaces:networkInterfaces,getNetworkInterfaces:getNetworkInterfaces,release:release$1,type:type,cpus:cpus,totalmem:totalmem,freemem:freemem,uptime:uptime$1,loadavg:loadavg,hostname:hostname,endianness:endianness};function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck$1(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties$1(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass$1(Constructor,protoProps,staticProps){if(protoProps)_defineProperties$1(Constructor.prototype,protoProps);if(staticProps)_defineProperties$1(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _inherits$1(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf$1(subClass,superClass)}function _getPrototypeOf$1(o){_getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf$1(o)}function _setPrototypeOf$1(o,p){_setPrototypeOf$1=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf$1(o,p)}function _assertThisInitialized$1(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _possibleConstructorReturn$1(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized$1(self)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var commonjsGlobal$1=typeof window!=="undefined"?window:typeof global$1!=="undefined"?global$1:typeof self!=="undefined"?self:{};var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var INFINITY=1/0;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reEscapeChar=/\\(\\)?/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var freeGlobal=_typeof(commonjsGlobal$1)=="object"&&commonjsGlobal$1&&commonjsGlobal$1.Object===Object&&commonjsGlobal$1;var freeSelf=(typeof self==="undefined"?"undefined":_typeof(self))=="object"&&self&&self.Object===Object&&self;var root$1=freeGlobal||freeSelf||Function("return this")();function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=root$1["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=funcProto.toString;var hasOwnProperty$1=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$1).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Symbol$1=root$1.Symbol,splice=arrayProto.splice;var Map$2=getNative(root$1,"Map"),nativeCreate=getNative(Object,"create");var symbolProto=Symbol$1?Symbol$1.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty$1.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty$1.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map$2||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function castPath(value){return isArray$2(value)?value:stringToPath(value)}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function isKey(value,object){if(isArray$2(value)){return false}var type=_typeof(value);if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=_typeof(value);return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var stringToPath=memoize(function(string){string=toString$2(string);var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function memoized(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function eq(value,other){return value===other||value!==value&&other!==other}var isArray$2=Array.isArray;function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=_typeof(value);return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&_typeof(value)=="object"}function isSymbol(value){return _typeof(value)=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toString$2(value){return value==null?"":baseToString(value)}function get$2(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}var lodash_get=get$2;function getProp(obj,path,defaultValue){return obj[path]===undefined?defaultValue:obj[path]}function setProp(obj,path,value){var pathArray=Array.isArray(path)?path:path.split(".");var key=pathArray[0];var newValue=pathArray.length>1?setProp(obj[key]||{},pathArray.slice(1),value):value;return _extends({},obj,_defineProperty({},key,newValue))}function flattenReducer(acc,arr){try{acc.push.apply(acc,_toConsumableArray(arr));return acc}catch(err){return acc.concat(arr)}}function fastJoin(arr,separator){var isFirst=true;return arr.reduce(function(acc,elem){if(elem===null||elem===undefined){elem=""}if(isFirst){isFirst=false;return"".concat(elem)}return"".concat(acc).concat(separator).concat(elem)},"")}var utils={getProp:getProp,setProp:setProp,fastJoin:fastJoin,flattenReducer:flattenReducer};var getProp$1=utils.getProp,setProp$1=utils.setProp,fastJoin$1=utils.fastJoin,flattenReducer$1=utils.flattenReducer;var JSON2CSVBase=function(){function JSON2CSVBase(opts){_classCallCheck$1(this,JSON2CSVBase);this.opts=this.preprocessOpts(opts);this.preprocessRow=this.memoizePreprocessRow()}_createClass$1(JSON2CSVBase,[{key:"preprocessOpts",value:function preprocessOpts(opts){var processedOpts=_extends({},opts);processedOpts.unwind=!Array.isArray(processedOpts.unwind)?processedOpts.unwind?[processedOpts.unwind]:[]:processedOpts.unwind;processedOpts.delimiter=processedOpts.delimiter||",";processedOpts.flattenSeparator=processedOpts.flattenSeparator||".";processedOpts.eol=processedOpts.eol||os.EOL;processedOpts.quote=typeof processedOpts.quote==="string"?opts.quote:'"';processedOpts.doubleQuote=typeof processedOpts.doubleQuote==="string"?processedOpts.doubleQuote:processedOpts.quote+processedOpts.quote;processedOpts.header=processedOpts.header!==false;processedOpts.includeEmptyRows=processedOpts.includeEmptyRows||false;processedOpts.withBOM=processedOpts.withBOM||false;return processedOpts}},{key:"preprocessFieldsInfo",value:function preprocessFieldsInfo(fields){var _this=this;return fields.map(function(fieldInfo){if(typeof fieldInfo==="string"){return{label:fieldInfo,value:fieldInfo.includes(".")||fieldInfo.includes("[")?function(row){return lodash_get(row,fieldInfo,_this.opts.defaultValue)}:function(row){return getProp$1(row,fieldInfo,_this.opts.defaultValue)},stringify:true}}if(_typeof$1(fieldInfo)==="object"){var defaultValue="default"in fieldInfo?fieldInfo.default:_this.opts.defaultValue;if(typeof fieldInfo.value==="string"){return{label:fieldInfo.label||fieldInfo.value,value:fieldInfo.value.includes(".")||fieldInfo.value.includes("[")?function(row){return lodash_get(row,fieldInfo.value,defaultValue)}:function(row){return getProp$1(row,fieldInfo.value,defaultValue)},stringify:fieldInfo.stringify!==undefined?fieldInfo.stringify:true}}if(typeof fieldInfo.value==="function"){var label=fieldInfo.label||fieldInfo.value;var field={label:label,default:defaultValue};return{label:label,value:function value(row){var value=fieldInfo.value(row,field);return value===null||value===undefined?defaultValue:value},stringify:fieldInfo.stringify!==undefined?fieldInfo.stringify:true}}}throw new Error("Invalid field info option. "+JSON.stringify(fieldInfo))})}},{key:"getHeader",value:function getHeader(){var _this2=this;return fastJoin$1(this.opts.fields.map(function(fieldInfo){return _this2.processValue(fieldInfo.label,true)}),this.opts.delimiter)}},{key:"memoizePreprocessRow",value:function memoizePreprocessRow(){if(this.opts.unwind&&this.opts.unwind.length){if(this.opts.flatten){return function(row){var _this3=this;return this.unwindData(row,this.opts.unwind).map(function(row){return _this3.flatten(row,_this3.opts.flattenSeparator)})}}return function(row){return this.unwindData(row,this.opts.unwind)}}if(this.opts.flatten){return function(row){return[this.flatten(row,this.opts.flattenSeparator)]}}return function(row){return[row]}}},{key:"preprocessRow",value:function preprocessRow(){}},{key:"processRow",value:function processRow(row){var _this4=this;if(!row){return undefined}var processedRow=this.opts.fields.map(function(fieldInfo){return _this4.processCell(row,fieldInfo)});if(!this.opts.includeEmptyRows&&processedRow.every(function(field){return field===undefined})){return undefined}return fastJoin$1(processedRow,this.opts.delimiter)}},{key:"processCell",value:function processCell(row,fieldInfo){return this.processValue(fieldInfo.value(row),fieldInfo.stringify)}},{key:"processValue",value:function processValue(value,stringify){if(value===null||value===undefined){return undefined}var valueType=_typeof$1(value);if(valueType!=="boolean"&&valueType!=="number"&&valueType!=="string"){value=JSON.stringify(value);if(value===undefined){return undefined}if(value[0]==='"'){value=value.replace(/^"(.+)"$/,"$1")}}if(typeof value==="string"){if(value.includes(this.opts.quote)){value=value.replace(new RegExp(this.opts.quote,"g"),this.opts.doubleQuote)}if(stringify){value="".concat(this.opts.quote).concat(value).concat(this.opts.quote)}else{value=value.replace(new RegExp("^".concat(this.opts.doubleQuote)),this.opts.quote).replace(new RegExp("".concat(this.opts.doubleQuote,"$")),this.opts.quote)}if(this.opts.excelStrings){value='"="'.concat(value,'""')}}return value}},{key:"flatten",value:function flatten(dataRow,separator){function step(obj,flatDataRow,currentPath){Object.keys(obj).forEach(function(key){var value=obj[key];var newPath=currentPath?"".concat(currentPath).concat(separator).concat(key):key;if(_typeof$1(value)!=="object"||value===null||Array.isArray(value)||Object.prototype.toString.call(value.toJSON)==="[object Function]"||!Object.keys(value).length){flatDataRow[newPath]=value;return}step(value,flatDataRow,newPath)});return flatDataRow}return step(dataRow,{})}},{key:"unwindData",value:function unwindData(dataRow,unwindPaths){var _this5=this;var unwind=function unwind(rows,unwindPath){return rows.map(function(row){var unwindArray=lodash_get(row,unwindPath);if(!Array.isArray(unwindArray)){return row}if(!unwindArray.length){return setProp$1(row,unwindPath,undefined)}return unwindArray.map(function(unwindRow,index){var clonedRow=_this5.opts.unwindBlank&&index>0?{}:row;return setProp$1(clonedRow,unwindPath,unwindRow)})}).reduce(flattenReducer$1,[])};return unwindPaths.reduce(unwind,[dataRow])}}]);return JSON2CSVBase}();var JSON2CSVBase_1=JSON2CSVBase;var fastJoin$2=utils.fastJoin,flattenReducer$2=utils.flattenReducer;var JSON2CSVParser=function(_JSON2CSVBase){_inherits$1(JSON2CSVParser,_JSON2CSVBase);function JSON2CSVParser(opts){var _this;_classCallCheck$1(this,JSON2CSVParser);_this=_possibleConstructorReturn$1(this,_getPrototypeOf$1(JSON2CSVParser).call(this,opts));if(_this.opts.fields){_this.opts.fields=_this.preprocessFieldsInfo(_this.opts.fields)}return _this}_createClass$1(JSON2CSVParser,[{key:"parse",value:function parse(data){var processedData=this.preprocessData(data);if(!this.opts.fields){this.opts.fields=processedData.reduce(function(fields,item){Object.keys(item).forEach(function(field){if(!fields.includes(field)){fields.push(field)}});return fields},[]);this.opts.fields=this.preprocessFieldsInfo(this.opts.fields)}var header=this.opts.header?this.getHeader():"";var rows=this.processData(processedData);var csv=(this.opts.withBOM?"\ufeff":"")+header+(header&&rows?this.opts.eol:"")+rows;return csv}},{key:"preprocessData",value:function preprocessData(data){var _this2=this;var processedData=Array.isArray(data)?data:[data];if(!this.opts.fields&&(processedData.length===0||_typeof$1(processedData[0])!=="object")){throw new Error('Data should not be empty or the "fields" option should be included')}if((!this.opts.unwind||!this.opts.unwind.length)&&!this.opts.flatten){return processedData}return processedData.map(function(row){return _this2.preprocessRow(row)}).reduce(flattenReducer$2,[])}},{key:"processData",value:function processData(data){var _this3=this;return fastJoin$2(data.map(function(row){return _this3.processRow(row)}).filter(function(row){return row}),this.opts.eol)}}]);return JSON2CSVParser}(JSON2CSVBase_1);var JSON2CSVParser_1=JSON2CSVParser;var C$1={};var LEFT_BRACE=C$1.LEFT_BRACE=1;var RIGHT_BRACE=C$1.RIGHT_BRACE=2;var LEFT_BRACKET=C$1.LEFT_BRACKET=3;var RIGHT_BRACKET=C$1.RIGHT_BRACKET=4;var COLON=C$1.COLON=5;var COMMA=C$1.COMMA=6;var TRUE=C$1.TRUE=7;var FALSE=C$1.FALSE=8;var NULL=C$1.NULL=9;var STRING=C$1.STRING=10;var NUMBER=C$1.NUMBER=11;var START=C$1.START=17;var STOP=C$1.STOP=18;var TRUE1=C$1.TRUE1=33;var TRUE2=C$1.TRUE2=34;var TRUE3=C$1.TRUE3=35;var FALSE1=C$1.FALSE1=49;var FALSE2=C$1.FALSE2=50;var FALSE3=C$1.FALSE3=51;var FALSE4=C$1.FALSE4=52;var NULL1=C$1.NULL1=65;var NULL2=C$1.NULL2=66;var NULL3=C$1.NULL3=67;var NUMBER1=C$1.NUMBER1=81;var NUMBER3=C$1.NUMBER3=83;var STRING1=C$1.STRING1=97;var STRING2=C$1.STRING2=98;var STRING3=C$1.STRING3=99;var STRING4=C$1.STRING4=100;var STRING5=C$1.STRING5=101;var STRING6=C$1.STRING6=102;var VALUE=C$1.VALUE=113;var KEY=C$1.KEY=114;var OBJECT=C$1.OBJECT=129;var ARRAY=C$1.ARRAY=130;var BACK_SLASH="\\".charCodeAt(0);var FORWARD_SLASH="/".charCodeAt(0);var BACKSPACE="\b".charCodeAt(0);var FORM_FEED="\f".charCodeAt(0);var NEWLINE="\n".charCodeAt(0);var CARRIAGE_RETURN="\r".charCodeAt(0);var TAB="\t".charCodeAt(0);var STRING_BUFFER_SIZE=64*1024;function Parser(){this.tState=START;this.value=undefined;this.string=undefined;this.stringBuffer=Buffer.alloc?Buffer.alloc(STRING_BUFFER_SIZE):new Buffer(STRING_BUFFER_SIZE);this.stringBufferOffset=0;this.unicode=undefined;this.highSurrogate=undefined;this.key=undefined;this.mode=undefined;this.stack=[];this.state=VALUE;this.bytes_remaining=0;this.bytes_in_sequence=0;this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)};this.offset=-1}Parser.toknam=function(code){var keys=Object.keys(C$1);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];if(C$1[key]===code){return key}}return code&&"0x"+code.toString(16)};var proto$1=Parser.prototype;proto$1.onError=function(err){throw err};proto$1.charError=function(buffer,i){this.tState=STOP;this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(buffer[i]))+" at position "+i+" in state "+Parser.toknam(this.tState)))};proto$1.appendStringChar=function(char){if(this.stringBufferOffset>=STRING_BUFFER_SIZE){this.string+=this.stringBuffer.toString("utf8");this.stringBufferOffset=0}this.stringBuffer[this.stringBufferOffset++]=char};proto$1.appendStringBuf=function(buf,start,end){var size=buf.length;if(typeof start==="number"){if(typeof end==="number"){if(end<0){size=buf.length-start+end}else{size=end-start}}else{size=buf.length-start}}if(size<0){size=0}if(this.stringBufferOffset+size>STRING_BUFFER_SIZE){this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset);this.stringBufferOffset=0}buf.copy(this.stringBuffer,this.stringBufferOffset,start,end);this.stringBufferOffset+=size};proto$1.write=function(buffer){if(typeof buffer==="string")buffer=new Buffer(buffer);var n;for(var i=0,l=buffer.length;i<l;i++){if(this.tState===START){n=buffer[i];this.offset++;if(n===123){this.onToken(LEFT_BRACE,"{")}else if(n===125){this.onToken(RIGHT_BRACE,"}")}else if(n===91){this.onToken(LEFT_BRACKET,"[")}else if(n===93){this.onToken(RIGHT_BRACKET,"]")}else if(n===58){this.onToken(COLON,":")}else if(n===44){this.onToken(COMMA,",")}else if(n===116){this.tState=TRUE1}else if(n===102){this.tState=FALSE1}else if(n===110){this.tState=NULL1}else if(n===34){this.string="";this.stringBufferOffset=0;this.tState=STRING1}else if(n===45){this.string="-";this.tState=NUMBER1}else{if(n>=48&&n<64){this.string=String.fromCharCode(n);this.tState=NUMBER3}else if(n===32||n===9||n===10||n===13);else{return this.charError(buffer,i)}}}else if(this.tState===STRING1){n=buffer[i];if(this.bytes_remaining>0){for(var j=0;j<this.bytes_remaining;j++){this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+j]=buffer[j]}this.appendStringBuf(this.temp_buffs[this.bytes_in_sequence]);this.bytes_in_sequence=this.bytes_remaining=0;i=i+j-1}else if(this.bytes_remaining===0&&n>=128){if(n<=193||n>244){return this.onError(new Error("Invalid UTF-8 character at position "+i+" in state "+Parser.toknam(this.tState)))}if(n>=194&&n<=223)this.bytes_in_sequence=2;if(n>=224&&n<=239)this.bytes_in_sequence=3;if(n>=240&&n<=244)this.bytes_in_sequence=4;if(this.bytes_in_sequence+i>buffer.length){for(var k=0;k<=buffer.length-1-i;k++){this.temp_buffs[this.bytes_in_sequence][k]=buffer[i+k]}this.bytes_remaining=i+this.bytes_in_sequence-buffer.length;i=buffer.length-1}else{this.appendStringBuf(buffer,i,i+this.bytes_in_sequence);i=i+this.bytes_in_sequence-1}}else if(n===34){this.tState=START;this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset);this.stringBufferOffset=0;this.onToken(STRING,this.string);this.offset+=Buffer.byteLength(this.string,"utf8")+1;this.string=undefined}else if(n===92){this.tState=STRING2}else if(n>=32){this.appendStringChar(n)}else{return this.charError(buffer,i)}}else if(this.tState===STRING2){n=buffer[i];if(n===34){this.appendStringChar(n);this.tState=STRING1}else if(n===92){this.appendStringChar(BACK_SLASH);this.tState=STRING1}else if(n===47){this.appendStringChar(FORWARD_SLASH);this.tState=STRING1}else if(n===98){this.appendStringChar(BACKSPACE);this.tState=STRING1}else if(n===102){this.appendStringChar(FORM_FEED);this.tState=STRING1}else if(n===110){this.appendStringChar(NEWLINE);this.tState=STRING1}else if(n===114){this.appendStringChar(CARRIAGE_RETURN);this.tState=STRING1}else if(n===116){this.appendStringChar(TAB);this.tState=STRING1}else if(n===117){this.unicode="";this.tState=STRING3}else{return this.charError(buffer,i)}}else if(this.tState===STRING3||this.tState===STRING4||this.tState===STRING5||this.tState===STRING6){n=buffer[i];if(n>=48&&n<64||n>64&&n<=70||n>96&&n<=102){this.unicode+=String.fromCharCode(n);if(this.tState++===STRING6){var intVal=parseInt(this.unicode,16);this.unicode=undefined;if(this.highSurrogate!==undefined&&intVal>=56320&&intVal<57343+1){this.appendStringBuf(new Buffer(String.fromCharCode(this.highSurrogate,intVal)));this.highSurrogate=undefined}else if(this.highSurrogate===undefined&&intVal>=55296&&intVal<56319+1){this.highSurrogate=intVal}else{if(this.highSurrogate!==undefined){this.appendStringBuf(new Buffer(String.fromCharCode(this.highSurrogate)));this.highSurrogate=undefined}this.appendStringBuf(new Buffer(String.fromCharCode(intVal)))}this.tState=STRING1}}else{return this.charError(buffer,i)}}else if(this.tState===NUMBER1||this.tState===NUMBER3){n=buffer[i];switch(n){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 46:case 101:case 69:case 43:case 45:this.string+=String.fromCharCode(n);this.tState=NUMBER3;break;default:this.tState=START;var result=Number(this.string);if(isNaN(result)){return this.charError(buffer,i)}if(this.string.match(/[0-9]+/)==this.string&&result.toString()!=this.string){this.onToken(STRING,this.string)}else{this.onToken(NUMBER,result)}this.offset+=this.string.length-1;this.string=undefined;i--;break}}else if(this.tState===TRUE1){if(buffer[i]===114){this.tState=TRUE2}else{return this.charError(buffer,i)}}else if(this.tState===TRUE2){if(buffer[i]===117){this.tState=TRUE3}else{return this.charError(buffer,i)}}else if(this.tState===TRUE3){if(buffer[i]===101){this.tState=START;this.onToken(TRUE,true);this.offset+=3}else{return this.charError(buffer,i)}}else if(this.tState===FALSE1){if(buffer[i]===97){this.tState=FALSE2}else{return this.charError(buffer,i)}}else if(this.tState===FALSE2){if(buffer[i]===108){this.tState=FALSE3}else{return this.charError(buffer,i)}}else if(this.tState===FALSE3){if(buffer[i]===115){this.tState=FALSE4}else{return this.charError(buffer,i)}}else if(this.tState===FALSE4){if(buffer[i]===101){this.tState=START;this.onToken(FALSE,false);this.offset+=4}else{return this.charError(buffer,i)}}else if(this.tState===NULL1){if(buffer[i]===117){this.tState=NULL2}else{return this.charError(buffer,i)}}else if(this.tState===NULL2){if(buffer[i]===108){this.tState=NULL3}else{return this.charError(buffer,i)}}else if(this.tState===NULL3){if(buffer[i]===108){this.tState=START;this.onToken(NULL,null);this.offset+=3}else{return this.charError(buffer,i)}}}};proto$1.onToken=function(token,value){};proto$1.parseError=function(token,value){this.tState=STOP;this.onError(new Error("Unexpected "+Parser.toknam(token)+(value?"("+JSON.stringify(value)+")":"")+" in state "+Parser.toknam(this.state)))};proto$1.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})};proto$1.pop=function(){var value=this.value;var parent=this.stack.pop();this.value=parent.value;this.key=parent.key;this.mode=parent.mode;this.emit(value);if(!this.mode){this.state=VALUE}};proto$1.emit=function(value){if(this.mode){this.state=COMMA}this.onValue(value)};proto$1.onValue=function(value){};proto$1.onToken=function(token,value){if(this.state===VALUE){if(token===STRING||token===NUMBER||token===TRUE||token===FALSE||token===NULL){if(this.value){this.value[this.key]=value}this.emit(value)}else if(token===LEFT_BRACE){this.push();if(this.value){this.value=this.value[this.key]={}}else{this.value={}}this.key=undefined;this.state=KEY;this.mode=OBJECT}else if(token===LEFT_BRACKET){this.push();if(this.value){this.value=this.value[this.key]=[]}else{this.value=[]}this.key=0;this.mode=ARRAY;this.state=VALUE}else if(token===RIGHT_BRACE){if(this.mode===OBJECT){this.pop()}else{return this.parseError(token,value)}}else if(token===RIGHT_BRACKET){if(this.mode===ARRAY){this.pop()}else{return this.parseError(token,value)}}else{return this.parseError(token,value)}}else if(this.state===KEY){if(token===STRING){this.key=value;this.state=COLON}else if(token===RIGHT_BRACE){this.pop()}else{return this.parseError(token,value)}}else if(this.state===COLON){if(token===COLON){this.state=VALUE}else{return this.parseError(token,value)}}else if(this.state===COMMA){if(token===COMMA){if(this.mode===ARRAY){this.key++;this.state=VALUE}else if(this.mode===OBJECT){this.state=KEY}}else if(token===RIGHT_BRACKET&&this.mode===ARRAY||token===RIGHT_BRACE&&this.mode===OBJECT){this.pop()}else{return this.parseError(token,value)}}else{return this.parseError(token,value)}};Parser.C=C$1;var jsonparse=Parser;var Transform$1=Stream.Transform;var JSON2CSVTransform=function(_Transform){_inherits$1(JSON2CSVTransform,_Transform);function JSON2CSVTransform(opts,transformOpts){var _this;_classCallCheck$1(this,JSON2CSVTransform);_this=_possibleConstructorReturn$1(this,_getPrototypeOf$1(JSON2CSVTransform).call(this,transformOpts));Object.getOwnPropertyNames(JSON2CSVBase_1.prototype).forEach(function(key){return _this[key]=JSON2CSVBase_1.prototype[key]});_this.opts=_this.preprocessOpts(opts);_this.preprocessRow=_this.memoizePreprocessRow();_this._data="";_this._hasWritten=false;if(_this._readableState.objectMode){_this.initObjectModeParse()}else if(_this.opts.ndjson){_this.initNDJSONParse()}else{_this.initJSONParser()}if(_this.opts.withBOM){_this.push("\ufeff")}if(_this.opts.fields){_this.opts.fields=_this.preprocessFieldsInfo(_this.opts.fields);_this.pushHeader()}return _this}_createClass$1(JSON2CSVTransform,[{key:"initObjectModeParse",value:function initObjectModeParse(){var transform=this;this.parser={write:function write(line){transform.pushLine(line)},getPendingData:function getPendingData(){return undefined}}}},{key:"initNDJSONParse",value:function initNDJSONParse(){var transform=this;this.parser={_data:"",write:function write(chunk){this._data+=chunk.toString();var lines=this._data.split("\n").map(function(line){return line.trim()}).filter(function(line){return line!==""});var pendingData=false;lines.forEach(function(line,i){try{transform.pushLine(JSON.parse(line))}catch(e){if(i===lines.length-1){pendingData=true}else{e.message="Invalid JSON ("+line+")";transform.emit("error",e)}}});this._data=pendingData?this._data.slice(this._data.lastIndexOf("\n")):""},getPendingData:function getPendingData(){return this._data}}}},{key:"initJSONParser",value:function initJSONParser(){var transform=this;this.parser=new jsonparse;this.parser.onValue=function(value){if(this.stack.length!==this.depthToEmit)return;transform.pushLine(value)};this.parser._onToken=this.parser.onToken;this.parser.onToken=function(token,value){transform.parser._onToken(token,value);if(this.stack.length===0&&!transform.opts.fields&&this.mode!==jsonparse.C.ARRAY&&this.mode!==jsonparse.C.OBJECT){this.onError(new Error('Data should not be empty or the "fields" option should be included'))}if(this.stack.length===1){if(this.depthToEmit===undefined){this.depthToEmit=this.mode===jsonparse.C.ARRAY?1:0}if(this.depthToEmit!==0&&this.stack.length===1){this.value=undefined}}};this.parser.getPendingData=function(){return this.value};this.parser.onError=function(err){if(err.message.includes("Unexpected")){err.message="Invalid JSON ("+err.message+")"}transform.emit("error",err)}}},{key:"_transform",value:function _transform(chunk,encoding,done){this.parser.write(chunk);done()}},{key:"_flush",value:function _flush(done){if(this.parser.getPendingData()){done(new Error("Invalid data received from stdin",this.parser.getPendingData()))}done()}},{key:"pushHeader",value:function pushHeader(){if(this.opts.header){var header=this.getHeader();this.emit("header",header);this.push(header);this._hasWritten=true}}},{key:"pushLine",value:function pushLine(data){var _this2=this;var processedData=this.preprocessRow(data);if(!this._hasWritten){this.opts.fields=this.opts.fields||this.preprocessFieldsInfo(Object.keys(processedData[0]));this.pushHeader()}processedData.forEach(function(row){var line=_this2.processRow(row,_this2.opts);if(line===undefined)return;_this2.emit("line",line);_this2.push(_this2._hasWritten?_this2.opts.eol+line:line);_this2._hasWritten=true})}}]);return JSON2CSVTransform}(Transform$1);var JSON2CSVTransform_1=JSON2CSVTransform;var Transform$1$1=Stream.Transform;var fastJoin$3=utils.fastJoin;var JSON2CSVAsyncParser=function(){function JSON2CSVAsyncParser(opts,transformOpts){_classCallCheck$1(this,JSON2CSVAsyncParser);this.input=new Transform$1$1(transformOpts);this.input._read=function(){};this.transform=new JSON2CSVTransform_1(opts,transformOpts);this.processor=this.input.pipe(this.transform)}_createClass$1(JSON2CSVAsyncParser,[{key:"fromInput",value:function fromInput(input){if(this._input){throw new Error("Async parser already has an input.")}this._input=input;this.input=this._input.pipe(this.processor);return this}},{key:"throughTransform",value:function throughTransform(transform){if(this._output){throw new Error("Can't add transforms once an output has been added.")}this.processor=this.processor.pipe(transform);return this}},{key:"toOutput",value:function toOutput(output){if(this._output){throw new Error("Async parser already has an output.")}this._output=output;this.processor=this.processor.pipe(output);return this}},{key:"promise",value:function promise(){var _this=this;return new Promise(function(resolve,reject){var csvBuffer=[];_this.processor.on("data",function(chunk){return csvBuffer.push(chunk.toString())}).on("finish",function(){return resolve(fastJoin$3(csvBuffer,""))}).on("error",function(err){return reject(err)})})}}]);return JSON2CSVAsyncParser}();var Parser$1=JSON2CSVParser_1;var json2csv=new Parser$1;var downloadCSV=function(csvName,data){var CSV=json2csv.parse(data);var blob=new Blob([CSV],{type:"text/csv"});var dlink=document.createElement("a");dlink.download=csvName?csvName.replace(/ /g,"_")+".csv":"vis.csv";dlink.href=window.URL.createObjectURL(blob);dlink.onclick=function(){var revokeFn=function(){window.URL.revokeObjectURL(dlink.href)};setTimeout(revokeFn,1500)};dlink.click();dlink.remove()};var DownloadButton=function(_super){__extends(DownloadButton,_super);function DownloadButton(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.onClick=function(){return downloadCSV(_this.props.csvName,_this.props.data)};return _this}DownloadButton.prototype.render=function(){var _a=this.props,width=_a.width,_b=_a.label,label=_b===void 0?"Download":_b;var style={};if(width){style.width=width+"px"}return React.createElement("div",{className:"download-div",style:style},React.createElement("button",{onClick:this.onClick},React.createElement("a",null,label)))};return DownloadButton}(React.Component);function noevent(){event$1.preventDefault();event$1.stopImmediatePropagation()}function dragDisable(view){var root=view.document.documentElement,selection=select(view).on("dragstart.drag",noevent,true);if("onselectstart"in root){selection.on("selectstart.drag",noevent,true)}else{root.__noselect=root.style.MozUserSelect;root.style.MozUserSelect="none"}}function yesdrag(view,noclick){var root=view.document.documentElement,selection=select(view).on("dragstart.drag",null);if(noclick){selection.on("click.drag",noevent,true);setTimeout(function(){selection.on("click.drag",null)},0)}if("onselectstart"in root){selection.on("selectstart.drag",null)}else{root.style.MozUserSelect=root.__noselect;delete root.__noselect}}function constant$7(x){return function(){return x}}function BrushEvent(target,type,selection){this.target=target;this.type=type;this.selection=selection}function nopropagation(){event$1.stopImmediatePropagation()}function noevent$1(){event$1.preventDefault();event$1.stopImmediatePropagation()}var MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"};var X={name:"x",handles:["e","w"].map(type$1),input:function input(x,e){return x&&[[x[0],e[0][1]],[x[1],e[1][1]]]},output:function output(xy){return xy&&[xy[0][0],xy[1][0]]}};var Y={name:"y",handles:["n","s"].map(type$1),input:function input(y,e){return y&&[[e[0][0],y[0]],[e[1][0],y[1]]]},output:function output(xy){return xy&&[xy[0][1],xy[1][1]]}};var XY={name:"xy",handles:["n","e","s","w","nw","ne","se","sw"].map(type$1),input:function input(xy){return xy},output:function output(xy){return xy}};var cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"};var flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"};var signsX={overlay:+1,selection:+1,n:null,e:+1,s:null,w:-1,nw:-1,ne:+1,se:+1,sw:-1};var signsY={overlay:+1,selection:+1,n:-1,e:null,s:+1,w:null,nw:-1,ne:-1,se:+1,sw:+1};function type$1(t){return{type:t}}function defaultFilter(){return!event$1.button}function defaultExtent(){var svg=this.ownerSVGElement||this;return[[0,0],[svg.width.baseVal.value,svg.height.baseVal.value]]}function local$1(node){while(!node.__brush){if(!(node=node.parentNode))return}return node.__brush}function empty$1(extent){return extent[0][0]===extent[1][0]||extent[0][1]===extent[1][1]}function brushX(){return brush$1(X)}function brushY(){return brush$1(Y)}function brush(){return brush$1(XY)}function brush$1(dim){var extent=defaultExtent,filter=defaultFilter,listeners=dispatch(brush,"start","brush","end"),handleSize=6,touchending;function brush(group){var overlay=group.property("__brush",initialize).selectAll(".overlay").data([type$1("overlay")]);overlay.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(overlay).each(function(){var extent=local$1(this).extent;select(this).attr("x",extent[0][0]).attr("y",extent[0][1]).attr("width",extent[1][0]-extent[0][0]).attr("height",extent[1][1]-extent[0][1])});group.selectAll(".selection").data([type$1("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var handle=group.selectAll(".handle").data(dim.handles,function(d){return d.type});handle.exit().remove();handle.enter().append("rect").attr("class",function(d){return"handle handle--"+d.type}).attr("cursor",function(d){return cursors[d.type]});group.each(redraw).attr("fill","none").attr("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush touchstart.brush",started)}brush.move=function(group,selection){if(group.selection){group.on("start.brush",function(){emitter(this,arguments).beforestart().start()}).on("interrupt.brush end.brush",function(){emitter(this,arguments).end()}).tween("brush",function(){var that=this,state=that.__brush,emit=emitter(that,arguments),selection0=state.selection,selection1=dim.input(typeof selection==="function"?selection.apply(this,arguments):selection,state.extent),i=interpolate(selection0,selection1);function tween(t){state.selection=t===1&&empty$1(selection1)?null:i(t);redraw.call(that);emit.brush()}return selection0&&selection1?tween:tween(1)})}else{group.each(function(){var that=this,args=arguments,state=that.__brush,selection1=dim.input(typeof selection==="function"?selection.apply(that,args):selection,state.extent),emit=emitter(that,args).beforestart();interrupt(that);state.selection=selection1==null||empty$1(selection1)?null:selection1;redraw.call(that);emit.start().brush().end()})}};function redraw(){var group=select(this),selection=local$1(this).selection;if(selection){group.selectAll(".selection").style("display",null).attr("x",selection[0][0]).attr("y",selection[0][1]).attr("width",selection[1][0]-selection[0][0]).attr("height",selection[1][1]-selection[0][1]);group.selectAll(".handle").style("display",null).attr("x",function(d){return d.type[d.type.length-1]==="e"?selection[1][0]-handleSize/2:selection[0][0]-handleSize/2}).attr("y",function(d){return d.type[0]==="s"?selection[1][1]-handleSize/2:selection[0][1]-handleSize/2}).attr("width",function(d){return d.type==="n"||d.type==="s"?selection[1][0]-selection[0][0]+handleSize:handleSize}).attr("height",function(d){return d.type==="e"||d.type==="w"?selection[1][1]-selection[0][1]+handleSize:handleSize})}else{group.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}}function emitter(that,args){return that.__brush.emitter||new Emitter(that,args)}function Emitter(that,args){this.that=that;this.args=args;this.state=that.__brush;this.active=0}Emitter.prototype={beforestart:function beforestart(){if(++this.active===1)this.state.emitter=this,this.starting=true;return this},start:function start(){if(this.starting)this.starting=false,this.emit("start");return this},brush:function brush(){this.emit("brush");return this},end:function end(){if(--this.active===0)delete this.state.emitter,this.emit("end");return this},emit:function emit(type){customEvent(new BrushEvent(brush,type,dim.output(this.state.selection)),listeners.apply,listeners,[type,this.that,this.args])}};function started(){if(event$1.touches){if(event$1.changedTouches.length<event$1.touches.length)return noevent$1()}else if(touchending)return;if(!filter.apply(this,arguments))return;var that=this,type=event$1.target.__data__.type,mode=(event$1.metaKey?type="overlay":type)==="selection"?MODE_DRAG:event$1.altKey?MODE_CENTER:MODE_HANDLE,signX=dim===Y?null:signsX[type],signY=dim===X?null:signsY[type],state=local$1(that),extent=state.extent,selection=state.selection,W=extent[0][0],w0,w1,N=extent[0][1],n0,n1,E=extent[1][0],e0,e1,S=extent[1][1],s0,s1,dx,dy,moving,shifting=signX&&signY&&event$1.shiftKey,lockX,lockY,point0=mouse(that),point=point0,emit=emitter(that,arguments).beforestart();if(type==="overlay"){state.selection=selection=[[w0=dim===Y?W:point0[0],n0=dim===X?N:point0[1]],[e0=dim===Y?E:w0,s0=dim===X?S:n0]]}else{w0=selection[0][0];n0=selection[0][1];e0=selection[1][0];s0=selection[1][1]}w1=w0;n1=n0;e1=e0;s1=s0;var group=select(that).attr("pointer-events","none");var overlay=group.selectAll(".overlay").attr("cursor",cursors[type]);if(event$1.touches){group.on("touchmove.brush",moved,true).on("touchend.brush touchcancel.brush",ended,true)}else{var view=select(event$1.view).on("keydown.brush",keydowned,true).on("keyup.brush",keyupped,true).on("mousemove.brush",moved,true).on("mouseup.brush",ended,true);dragDisable(event$1.view)}nopropagation();interrupt(that);redraw.call(that);emit.start();function moved(){var point1=mouse(that);if(shifting&&!lockX&&!lockY){if(Math.abs(point1[0]-point[0])>Math.abs(point1[1]-point[1]))lockY=true;else lockX=true}point=point1;moving=true;noevent$1();move()}function move(){var t;dx=point[0]-point0[0];dy=point[1]-point0[1];switch(mode){case MODE_SPACE:case MODE_DRAG:if(signX)dx=Math.max(W-w0,Math.min(E-e0,dx)),w1=w0+dx,e1=e0+dx;if(signY)dy=Math.max(N-n0,Math.min(S-s0,dy)),n1=n0+dy,s1=s0+dy;break;case MODE_HANDLE:if(signX<0)dx=Math.max(W-w0,Math.min(E-w0,dx)),w1=w0+dx,e1=e0;else if(signX>0)dx=Math.max(W-e0,Math.min(E-e0,dx)),w1=w0,e1=e0+dx;if(signY<0)dy=Math.max(N-n0,Math.min(S-n0,dy)),n1=n0+dy,s1=s0;else if(signY>0)dy=Math.max(N-s0,Math.min(S-s0,dy)),n1=n0,s1=s0+dy;break;case MODE_CENTER:if(signX)w1=Math.max(W,Math.min(E,w0-dx*signX)),e1=Math.max(W,Math.min(E,e0+dx*signX));if(signY)n1=Math.max(N,Math.min(S,n0-dy*signY)),s1=Math.max(N,Math.min(S,s0+dy*signY));break}if(e1<w1){signX*=-1;t=w0,w0=e0,e0=t;t=w1,w1=e1,e1=t;if(type in flipX)overlay.attr("cursor",cursors[type=flipX[type]])}if(s1<n1){signY*=-1;t=n0,n0=s0,s0=t;t=n1,n1=s1,s1=t;if(type in flipY)overlay.attr("cursor",cursors[type=flipY[type]])}if(state.selection)selection=state.selection;if(lockX)w1=selection[0][0],e1=selection[1][0];if(lockY)n1=selection[0][1],s1=selection[1][1];if(selection[0][0]!==w1||selection[0][1]!==n1||selection[1][0]!==e1||selection[1][1]!==s1){state.selection=[[w1,n1],[e1,s1]];redraw.call(that);emit.brush()}}function ended(){nopropagation();if(event$1.touches){if(event$1.touches.length)return;if(touchending)clearTimeout(touchending);touchending=setTimeout(function(){touchending=null},500);group.on("touchmove.brush touchend.brush touchcancel.brush",null)}else{yesdrag(event$1.view,moving);view.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null)}group.attr("pointer-events","all");overlay.attr("cursor",cursors.overlay);if(state.selection)selection=state.selection;if(empty$1(selection))state.selection=null,redraw.call(that);emit.end()}function keydowned(){switch(event$1.keyCode){case 16:shifting=signX&&signY;break;case 18:if(mode===MODE_HANDLE){if(signX)e0=e1-dx*signX,w0=w1+dx*signX;if(signY)s0=s1-dy*signY,n0=n1+dy*signY;mode=MODE_CENTER;move()}break;case 32:if(mode===MODE_HANDLE||mode===MODE_CENTER){if(signX<0)e0=e1-dx;else if(signX>0)w0=w1-dx;if(signY<0)s0=s1-dy;else if(signY>0)n0=n1-dy;mode=MODE_SPACE;overlay.attr("cursor",cursors.selection);move()}break;default:return}noevent$1()}function keyupped(){switch(event$1.keyCode){case 16:if(shifting){lockX=lockY=shifting=false;move()}break;case 18:if(mode===MODE_CENTER){if(signX<0)e0=e1;else if(signX>0)w0=w1;if(signY<0)s0=s1;else if(signY>0)n0=n1;mode=MODE_HANDLE;move()}break;case 32:if(mode===MODE_SPACE){if(event$1.altKey){if(signX)e0=e1-dx*signX,w0=w1+dx*signX;if(signY)s0=s1-dy*signY,n0=n1+dy*signY;mode=MODE_CENTER}else{if(signX<0)e0=e1;else if(signX>0)w0=w1;if(signY<0)s0=s1;else if(signY>0)n0=n1;mode=MODE_HANDLE}overlay.attr("cursor",cursors[type]);move()}break;default:return}noevent$1()}}function initialize(){var state=this.__brush||{selection:null};state.extent=extent.apply(this,arguments);state.dim=dim;return state}brush.extent=function(_){return arguments.length?(extent=typeof _==="function"?_:constant$7([[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]]),brush):extent};brush.filter=function(_){return arguments.length?(filter=typeof _==="function"?_:constant$7(!!_),brush):filter};brush.handleSize=function(_){return arguments.length?(handleSize=+_,brush):handleSize};brush.on=function(){var value=listeners.on.apply(listeners,arguments);return value===listeners?brush:value};return brush}function constant$8(x){return function(){return x}}function x$2(d){return d[0]}function y$2(d){return d[1]}function RedBlackTree(){this._=null}function RedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}RedBlackTree.prototype={constructor:RedBlackTree,insert:function insert(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L){after=after.L}after.L=node}else{after.R=node}parent=after}else if(this._){after=RedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after}else{node.P=node.N=null;this._=node;parent=null}node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.R){RedBlackRotateLeft(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateRight(this,grandpa)}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa}else{if(after===parent.L){RedBlackRotateRight(this,parent);after=parent;parent=after.U}parent.C=false;grandpa.C=true;RedBlackRotateLeft(this,grandpa)}}parent=after.U}this._.C=false},remove:function remove(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=RedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next}else{this._=next}if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next}else{next.U=parent;parent=next;node=next.R}}else{red=node.C;node=next}if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return}do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateLeft(this,parent);sibling=parent.R}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;RedBlackRotateRight(this,sibling);sibling=parent.R}sibling.C=parent.C;parent.C=sibling.R.C=false;RedBlackRotateLeft(this,parent);node=this._;break}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;RedBlackRotateRight(this,parent);sibling=parent.L}if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;RedBlackRotateLeft(this,sibling);sibling=parent.L}sibling.C=parent.C;parent.C=sibling.L.C=false;RedBlackRotateRight(this,parent);node=this._;break}}sibling.C=true;node=parent;parent=parent.U}while(!node.C);if(node)node.C=false}};function RedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p}function RedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q}else{tree._=q}q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p}function RedBlackFirst(node){while(node.L){node=node.L}return node}function createEdge(left,right,v0,v1){var edge=[null,null],index=edges.push(edge)-1;edge.left=left;edge.right=right;if(v0)setEdgeEnd(edge,left,right,v0);if(v1)setEdgeEnd(edge,right,left,v1);cells[left.index].halfedges.push(index);cells[right.index].halfedges.push(index);return edge}function createBorderEdge(left,v0,v1){var edge=[v0,v1];edge.left=left;return edge}function setEdgeEnd(edge,left,right,vertex){if(!edge[0]&&!edge[1]){edge[0]=vertex;edge.left=left;edge.right=right}else if(edge.left===right){edge[1]=vertex}else{edge[0]=vertex}}function clipEdge(edge,x0,y0,x1,y1){var a=edge[0],b=edge[1],ax=a[0],ay=a[1],bx=b[0],by=b[1],t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r}else if(dx>0){if(r>t1)return;if(r>t0)t0=r}r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r}else if(dx>0){if(r<t0)return;if(r<t1)t1=r}r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r}else if(dy>0){if(r>t1)return;if(r>t0)t0=r}r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r}else if(dy>0){if(r<t0)return;if(r<t1)t1=r}if(!(t0>0)&&!(t1<1))return true;if(t0>0)edge[0]=[ax+t0*dx,ay+t0*dy];if(t1<1)edge[1]=[ax+t1*dx,ay+t1*dy];return true}function connectEdge(edge,x0,y0,x1,y1){var v1=edge[1];if(v1)return true;var v0=edge[0],left=edge.left,right=edge.right,lx=left[0],ly=left[1],rx=right[0],ry=right[1],fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!v0)v0=[fx,y0];else if(v0[1]>=y1)return;v1=[fx,y1]}else{if(!v0)v0=[fx,y1];else if(v0[1]<y0)return;v1=[fx,y0]}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!v0)v0=[(y0-fb)/fm,y0];else if(v0[1]>=y1)return;v1=[(y1-fb)/fm,y1]}else{if(!v0)v0=[(y1-fb)/fm,y1];else if(v0[1]<y0)return;v1=[(y0-fb)/fm,y0]}}else{if(ly<ry){if(!v0)v0=[x0,fm*x0+fb];else if(v0[0]>=x1)return;v1=[x1,fm*x1+fb]}else{if(!v0)v0=[x1,fm*x1+fb];else if(v0[0]<x0)return;v1=[x0,fm*x0+fb]}}}edge[0]=v0;edge[1]=v1;return true}function clipEdges(x0,y0,x1,y1){var i=edges.length,edge;while(i--){if(!connectEdge(edge=edges[i],x0,y0,x1,y1)||!clipEdge(edge,x0,y0,x1,y1)||!(Math.abs(edge[0][0]-edge[1][0])>epsilon$3||Math.abs(edge[0][1]-edge[1][1])>epsilon$3)){delete edges[i]}}}function createCell(site){return cells[site.index]={site:site,halfedges:[]}}function cellHalfedgeAngle(cell,edge){var site=cell.site,va=edge.left,vb=edge.right;if(site===vb)vb=va,va=site;if(vb)return Math.atan2(vb[1]-va[1],vb[0]-va[0]);if(site===va)va=edge[1],vb=edge[0];else va=edge[0],vb=edge[1];return Math.atan2(va[0]-vb[0],vb[1]-va[1])}function cellHalfedgeStart(cell,edge){return edge[+(edge.left!==cell.site)]}function cellHalfedgeEnd(cell,edge){return edge[+(edge.left===cell.site)]}function sortCellHalfedges(){for(var i=0,n=cells.length,cell,halfedges,j,m;i<n;++i){if((cell=cells[i])&&(m=(halfedges=cell.halfedges).length)){var index=new Array(m),array=new Array(m);for(j=0;j<m;++j){index[j]=j,array[j]=cellHalfedgeAngle(cell,edges[halfedges[j]])}index.sort(function(i,j){return array[j]-array[i]});for(j=0;j<m;++j){array[j]=halfedges[index[j]]}for(j=0;j<m;++j){halfedges[j]=array[j]}}}}function clipCells(x0,y0,x1,y1){var nCells=cells.length,iCell,cell,site,iHalfedge,halfedges,nHalfedges,start,startX,startY,end,endX,endY,cover=true;for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;halfedges=cell.halfedges;iHalfedge=halfedges.length;while(iHalfedge--){if(!edges[halfedges[iHalfedge]]){halfedges.splice(iHalfedge,1)}}iHalfedge=0,nHalfedges=halfedges.length;while(iHalfedge<nHalfedges){end=cellHalfedgeEnd(cell,edges[halfedges[iHalfedge]]),endX=end[0],endY=end[1];start=cellHalfedgeStart(cell,edges[halfedges[++iHalfedge%nHalfedges]]),startX=start[0],startY=start[1];if(Math.abs(endX-startX)>epsilon$3||Math.abs(endY-startY)>epsilon$3){halfedges.splice(iHalfedge,0,edges.push(createBorderEdge(site,end,Math.abs(endX-x0)<epsilon$3&&y1-endY>epsilon$3?[x0,Math.abs(startX-x0)<epsilon$3?startY:y1]:Math.abs(endY-y1)<epsilon$3&&x1-endX>epsilon$3?[Math.abs(startY-y1)<epsilon$3?startX:x1,y1]:Math.abs(endX-x1)<epsilon$3&&endY-y0>epsilon$3?[x1,Math.abs(startX-x1)<epsilon$3?startY:y0]:Math.abs(endY-y0)<epsilon$3&&endX-x0>epsilon$3?[Math.abs(startY-y0)<epsilon$3?startX:x0,y0]:null))-1);++nHalfedges}}if(nHalfedges)cover=false}}if(cover){var dx,dy,d2,dc=Infinity;for(iCell=0,cover=null;iCell<nCells;++iCell){if(cell=cells[iCell]){site=cell.site;dx=site[0]-x0;dy=site[1]-y0;d2=dx*dx+dy*dy;if(d2<dc)dc=d2,cover=cell}}if(cover){var v00=[x0,y0],v01=[x0,y1],v11=[x1,y1],v10=[x1,y0];cover.halfedges.push(edges.push(createBorderEdge(site=cover.site,v00,v01))-1,edges.push(createBorderEdge(site,v01,v11))-1,edges.push(createBorderEdge(site,v11,v10))-1,edges.push(createBorderEdge(site,v10,v00))-1)}}for(iCell=0;iCell<nCells;++iCell){if(cell=cells[iCell]){if(!cell.halfedges.length){delete cells[iCell]}}}}var circlePool=[];var firstCircle;function Circle(){RedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null}function attachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite[0],by=cSite[1],ax=lSite[0]-bx,ay=lSite[1]-by,cx=rSite[0]-bx,cy=rSite[1]-by;var d=2*(ax*cy-ay*cx);if(d>=-epsilon2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d;var circle=circlePool.pop()||new Circle;circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=(circle.cy=y+by)+Math.sqrt(x*x+y*y);arc.circle=circle;var before=null,node=circles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break}}else{if(node.R)node=node.R;else{before=node;break}}}circles.insert(before,circle);if(!before)firstCircle=circle}function detachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)firstCircle=circle.N;circles.remove(circle);circlePool.push(circle);RedBlackNode(circle);arc.circle=null}}var beachPool=[];function Beach(){RedBlackNode(this);this.edge=this.site=this.circle=null}function createBeach(site){var beach=beachPool.pop()||new Beach;beach.site=site;return beach}function detachBeach(beach){detachCircle(beach);beaches.remove(beach);beachPool.push(beach);RedBlackNode(beach)}function removeBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex=[x,y],previous=beach.P,next=beach.N,disappearing=[beach];detachBeach(beach);var lArc=previous;while(lArc.circle&&Math.abs(x-lArc.circle.x)<epsilon$3&&Math.abs(y-lArc.circle.cy)<epsilon$3){previous=lArc.P;disappearing.unshift(lArc);detachBeach(lArc);lArc=previous}disappearing.unshift(lArc);detachCircle(lArc);var rArc=next;while(rArc.circle&&Math.abs(x-rArc.circle.x)<epsilon$3&&Math.abs(y-rArc.circle.cy)<epsilon$3){next=rArc.N;disappearing.push(rArc);detachBeach(rArc);rArc=next}disappearing.push(rArc);detachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];setEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex)}lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=createEdge(lArc.site,rArc.site,null,vertex);attachCircle(lArc);attachCircle(rArc)}function addBeach(site){var x=site[0],directrix=site[1],lArc,rArc,dxl,dxr,node=beaches._;while(node){dxl=leftBreakPoint(node,directrix)-x;if(dxl>epsilon$3)node=node.L;else{dxr=x-rightBreakPoint(node,directrix);if(dxr>epsilon$3){if(!node.R){lArc=node;break}node=node.R}else{if(dxl>-epsilon$3){lArc=node.P;rArc=node}else if(dxr>-epsilon$3){lArc=node;rArc=node.N}else{lArc=rArc=node}break}}}createCell(site);var newArc=createBeach(site);beaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){detachCircle(lArc);rArc=createBeach(lArc.site);beaches.insert(newArc,rArc);newArc.edge=rArc.edge=createEdge(lArc.site,newArc.site);attachCircle(lArc);attachCircle(rArc);return}if(!rArc){newArc.edge=createEdge(lArc.site,newArc.site);return}detachCircle(lArc);detachCircle(rArc);var lSite=lArc.site,ax=lSite[0],ay=lSite[1],bx=site[0]-ax,by=site[1]-ay,rSite=rArc.site,cx=rSite[0]-ax,cy=rSite[1]-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex=[(cy*hb-by*hc)/d+ax,(bx*hc-cx*hb)/d+ay];setEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=createEdge(lSite,site,null,vertex);rArc.edge=createEdge(site,rSite,null,vertex);attachCircle(lArc);attachCircle(rArc)}function leftBreakPoint(arc,directrix){var site=arc.site,rfocx=site[0],rfocy=site[1],pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site[0],lfocy=site[1],plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2}function rightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return leftBreakPoint(rArc,directrix);var site=arc.site;return site[1]===directrix?site[0]:Infinity}var epsilon$3=1e-6;var epsilon2=1e-12;var beaches;var cells;var circles;var edges;function triangleArea(a,b,c){return(a[0]-c[0])*(b[1]-a[1])-(a[0]-b[0])*(c[1]-a[1])}function lexicographic(a,b){return b[1]-a[1]||b[0]-a[0]}function Diagram(sites,extent){var site=sites.sort(lexicographic).pop(),x,y,circle;edges=[];cells=new Array(sites.length);beaches=new RedBlackTree;circles=new RedBlackTree;while(true){circle=firstCircle;if(site&&(!circle||site[1]<circle.y||site[1]===circle.y&&site[0]<circle.x)){if(site[0]!==x||site[1]!==y){addBeach(site);x=site[0],y=site[1]}site=sites.pop()}else if(circle){removeBeach(circle.arc)}else{break}}sortCellHalfedges();if(extent){var x0=+extent[0][0],y0=+extent[0][1],x1=+extent[1][0],y1=+extent[1][1];clipEdges(x0,y0,x1,y1);clipCells(x0,y0,x1,y1)}this.edges=edges;this.cells=cells;beaches=circles=edges=cells=null}Diagram.prototype={constructor:Diagram,polygons:function polygons(){var edges=this.edges;return this.cells.map(function(cell){var polygon=cell.halfedges.map(function(i){return cellHalfedgeStart(cell,edges[i])});polygon.data=cell.site.data;return polygon})},triangles:function triangles(){var triangles=[],edges=this.edges;this.cells.forEach(function(cell,i){if(!(m=(halfedges=cell.halfedges).length))return;var site=cell.site,halfedges,j=-1,m,s0,e1=edges[halfedges[m-1]],s1=e1.left===site?e1.right:e1.left;while(++j<m){s0=s1;e1=edges[halfedges[j]];s1=e1.left===site?e1.right:e1.left;if(s0&&s1&&i<s0.index&&i<s1.index&&triangleArea(site,s0,s1)<0){triangles.push([site.data,s0.data,s1.data])}}});return triangles},links:function links(){return this.edges.filter(function(edge){return edge.right}).map(function(edge){return{source:edge.left.data,target:edge.right.data}})},find:function find(x,y,radius){var that=this,i0,i1=that._found||0,n=that.cells.length,cell;while(!(cell=that.cells[i1])){if(++i1>=n)return null}var dx=x-cell.site[0],dy=y-cell.site[1],d2=dx*dx+dy*dy;do{cell=that.cells[i0=i1],i1=null;cell.halfedges.forEach(function(e){var edge=that.edges[e],v=edge.left;if((v===cell.site||!v)&&!(v=edge.right))return;var vx=x-v[0],vy=y-v[1],v2=vx*vx+vy*vy;if(v2<d2)d2=v2,i1=v.index})}while(i1!==null);that._found=i0;return radius==null||d2<=radius*radius?cell.site:null}};function voronoi(){var x=x$2,y=y$2,extent=null;function voronoi(data){return new Diagram(data.map(function(d,i){var s=[Math.round(x(d,i,data)/epsilon$3)*epsilon$3,Math.round(y(d,i,data)/epsilon$3)*epsilon$3];s.index=i;s.data=d;return s}),extent)}voronoi.polygons=function(data){return voronoi(data).polygons()};voronoi.links=function(data){return voronoi(data).links()};voronoi.triangles=function(data){return voronoi(data).triangles()};voronoi.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$8(+_),voronoi):x};voronoi.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$8(+_),voronoi):y};voronoi.extent=function(_){return arguments.length?(extent=_==null?null:[[+_[0][0],+_[0][1]],[+_[1][0],+_[1][1]]],voronoi):extent&&[[extent[0][0],extent[0][1]],[extent[1][0],extent[1][1]]]};voronoi.size=function(_){return arguments.length?(extent=_==null?null:[[0,0],[+_[0],+_[1]]],voronoi):extent&&[extent[1][0]-extent[0][0],extent[1][1]-extent[0][1]]};return voronoi}var flatten=function(list){return list.reduce(function(a,b){return a.concat(Array.isArray(b)?flatten(b.sort(function(a,b){return a-b})):b)},[])};function flatShortArray(array){if(!Array.isArray(array))return"not-array";if(!Array.isArray(array[0])){array=array.sort(function(a,b){return a-b})}var flat=flatten(array);var stringifiedFlattened=flat.map(function(d){return d instanceof Date&&d.toString()||d!==undefined&&d.toFixed&&d.toFixed(2)||"empty"}).toString();return stringifiedFlattened}var Brush=function(_super){__extends(Brush,_super);function Brush(props){var _this=_super.call(this,props)||this;_this.node=null;_this.createBrush=_this.createBrush.bind(_this);return _this}Brush.prototype.componentDidMount=function(){this.createBrush()};Brush.prototype.componentDidUpdate=function(lastProps){if(lastProps.extent&&this.props.extent&&flatShortArray(lastProps.extent)!==flatShortArray(this.props.extent)||(lastProps.selectedExtent&&this.props.selectedExtent&&flatShortArray(lastProps.selectedExtent)!==flatShortArray(this.props.selectedExtent)||!lastProps.selectedExtent&&this.props.selectedExtent||lastProps.selectedExtent&&!this.props.selectedExtent)){this.createBrush()}};Brush.prototype.createBrush=function(){var node=this.node;var brush=this.props.svgBrush;select(node).call(brush);if(this.props.selectedExtent){var selectedExtent=this.props.selectedExtent;if(Array.isArray(this.props.selectedExtent[0])){var sortedY=[selectedExtent[0][1],selectedExtent[1][1]].sort(function(a,b){return a-b});selectedExtent=[[selectedExtent[0][0],sortedY[0]],[selectedExtent[1][0],sortedY[1]]]}select(node).call(brush.move,this.props.selectedExtent)}};Brush.prototype.render=function(){var _this=this;var _a=this.props.position,position=_a===void 0?[0,0]:_a;return React.createElement("g",{transform:"translate("+position+")",ref:function(node){return _this.node=node},className:"xybrush"})};return Brush}(React.Component);var projectedX="x";var projectedY="y";var projectedYMiddle="yMiddle";var projectedYTop="yTop";var projectedYBottom="yBottom";var projectedXMiddle="xMiddle";var projectedXTop="xTop";var projectedXBottom="xBottom";var generateOMappingFn=function(projectedColumns){return function(d){if(d){var columnValues=Object.values(projectedColumns);var foundColumns=columnValues.filter(function(c){return d[1]>=c.x&&d[0]<=c.x+c.width});return foundColumns}return null}};var generateOEndMappingFn=function(projectedColumns){return function(d){if(d&&event$1.sourceEvent&&event$1.sourceEvent.path&&event$1.sourceEvent.path[1]&&event$1.sourceEvent.path[1].classList.contains("xybrush")&&event$1.target.move){var columnValues=Object.values(projectedColumns);var foundColumns=columnValues.filter(function(c){return d[1]>=c.x&&d[0]<=c.x+c.width});var firstColumn=foundColumns[0]||{x:0,width:0};var lastColumn=foundColumns[foundColumns.length-1]||{x:0,width:0};var columnPosition=[firstColumn.x+Math.min(5,firstColumn.width/10),lastColumn.x+lastColumn.width-Math.min(5,lastColumn.width/10)];select(event$1.sourceEvent.path[1]).transition(750).call(event$1.target.move,columnPosition);return foundColumns}return null}};var InteractionLayer=function(_super){__extends(InteractionLayer,_super);function InteractionLayer(props){var _this=_super.call(this,props)||this;_this.generateInteractionCanvas=function(props){return React.createElement("canvas",{className:"frame-canvas-interaction",ref:function(canvasContext){var overlayRegions=_this.state.overlayRegions;var canvasMap=_this.canvasMap;var boundCanvasEvent=canvasEvent.bind(null,canvasContext,overlayRegions,canvasMap);if(canvasContext){canvasContext.onmousemove=function(e){var overlay=boundCanvasEvent(e);if(overlay&&overlay.props){overlay.props.onMouseEnter()}else{_this.changeVoronoi()}};canvasContext.onclick=function(e){var overlay=boundCanvasEvent(e);if(overlay&&overlay.props){overlay.props.onClick()}};canvasContext.ondblclick=function(e){var overlay=boundCanvasEvent(e);if(overlay&&overlay.props){overlay.props.onDoubleClick()}}}_this.interactionContext=canvasContext},style:{position:"absolute",left:"0px",top:"0px",imageRendering:"pixelated",pointerEvents:"all",opacity:0},width:props.svgSize[0],height:props.svgSize[1]})};_this.interactionContext=null;_this.canvasMap=new Map;_this.constructDataObject=function(d){if(d===undefined)return d;var points=_this.props.points;return d&&d.data?__assign({points:points},d.data,d):__assign({points:points},d)};_this.changeVoronoi=function(d,customHoverTypes){var _a=_this.props,customHoverBehavior=_a.customHoverBehavior,voronoiHover=_a.voronoiHover;var dataObject=_this.constructDataObject(d);if(customHoverBehavior)customHoverBehavior(dataObject);if(!d)voronoiHover(null);else if(customHoverTypes===true){var vorD=Object.assign({},dataObject);vorD.type=vorD.type==="column-hover"?"column-hover":"frame-hover";voronoiHover(vorD)}else if(customHoverTypes){var arrayWrappedHoverTypes=Array.isArray(customHoverTypes)?customHoverTypes:[customHoverTypes];var mappedHoverTypes=arrayWrappedHoverTypes.map(function(c){var finalC=typeof c==="function"?c(dataObject):c;if(!finalC)return undefined;return Object.assign({},dataObject,finalC)}).filter(function(d){return d});voronoiHover(mappedHoverTypes)}};_this.clickVoronoi=function(d){var dataObject=_this.constructDataObject(d);if(_this.props.customClickBehavior)_this.props.customClickBehavior(dataObject)};_this.doubleclickVoronoi=function(d){var dataObject=_this.constructDataObject(d);if(_this.props.customDoubleClickBehavior)_this.props.customDoubleClickBehavior(dataObject)};_this.brushStart=function(e,column,data){if(_this.props.interaction&&_this.props.interaction.start)_this.props.interaction.start(e,column,data)};_this.brush=function(e,column,data){if(_this.props.interaction&&_this.props.interaction.during)_this.props.interaction.during(e,column,data)};_this.brushEnd=function(e,column,data){if(_this.props.interaction&&_this.props.interaction.end)_this.props.interaction.end(e,column,data)};_this.createBrush=function(interaction){var semioticBrush,mappingFn,selectedExtent,endMappingFn;var _a=_this.props,xScale=_a.xScale,yScale=_a.yScale,size=_a.size,renderPipeline=_a.renderPipeline;var brushData={};Object.entries(renderPipeline).forEach(function(_a){var _b=__read(_a,2),key=_b[0],value=_b[1];if(value.data&&value.data.length>0){brushData[key]=value.data}});var projection=interaction.projection,projectedColumns=interaction.projectedColumns;var actualBrush=interaction.brush==="oBrush"?projection==="horizontal"?"yBrush":"xBrush":interaction.brush;var _b=interaction.extent,extent=_b===void 0?actualBrush==="xyBrush"?[[xScale.invert(0),yScale.invert(0)],[xScale.invert(size[0]),yScale.invert(size[1])]]:actualBrush==="xBrush"?[xScale.invert(0),xScale.invert(size[0])]:[yScale.invert(0),yScale.invert(size[1])]:_b;if(extent.indexOf&&extent.indexOf(undefined)!==-1){return React.createElement("g",null)}if(actualBrush==="xBrush"){var castExtent=extent;mappingFn=function(d){return!d?null:[xScale.invert(d[0]),xScale.invert(d[1])]};semioticBrush=brushX();selectedExtent=castExtent.map(function(d){return xScale(d)});endMappingFn=mappingFn}else if(actualBrush==="yBrush"){var castExtent=extent;mappingFn=function(d){return!d?null:[yScale.invert(d[0]),yScale.invert(d[1])].sort(function(a,b){return a-b})};semioticBrush=brushY();selectedExtent=castExtent.map(function(d){return yScale(d)}).sort(function(a,b){return a-b});endMappingFn=mappingFn}else{var castExtent=extent;if(castExtent.indexOf(undefined)!==-1||castExtent[0].indexOf(undefined)!==-1||castExtent[1].indexOf(undefined)!==-1){return React.createElement("g",null)}semioticBrush=brush();mappingFn=function(d){if(!d)return null;var yValues=[yScale.invert(d[0][1]),yScale.invert(d[1][1])].sort(function(a,b){return a-b});return[[xScale.invert(d[0][0]),yValues[0]],[xScale.invert(d[1][0]),yValues[1]]]};var yValues_1=[yScale(extent[0][1]),yScale(extent[1][1])].sort(function(a,b){return a-b});selectedExtent=castExtent.map(function(d,i){return[xScale(d[0]),yValues_1[i]]});endMappingFn=mappingFn}if(interaction.brush==="oBrush"){selectedExtent=null;if(interaction.extent){var _c=__read(interaction.extent,2),leftExtent=_c[0],rightExtent=_c[1];if((typeof leftExtent==="string"||typeof leftExtent==="number")&&(typeof rightExtent==="string"||typeof rightExtent==="number")){selectedExtent=[projectedColumns[leftExtent].x,projectedColumns[rightExtent].x+projectedColumns[rightExtent].width]}}mappingFn=generateOMappingFn(projectedColumns);endMappingFn=generateOEndMappingFn(projectedColumns)}semioticBrush.extent([[0,0],[_this.props.size[0],_this.props.size[1]]]).on("start",function(){_this.brushStart(mappingFn(event$1.selection),undefined,brushData)}).on("brush",function(){_this.brush(mappingFn(event$1.selection),undefined,brushData)}).on("end",function(){_this.brushEnd(endMappingFn(event$1.selection),undefined,brushData)});return React.createElement("g",{className:"brush"},React.createElement(Brush,{selectedExtent:selectedExtent,extent:extent,svgBrush:semioticBrush}))};_this.calculateOverlay=function(props){var voronoiPaths=[];var xScale=props.xScale,yScale=props.yScale,points=props.points,projectedX=props.projectedX,showLinePoints=props.showLinePoints,size=props.size,overlay=props.overlay,_a=props.interactionOverflow,interactionOverflow=_a===void 0?{top:0,bottom:0,left:0,right:0}:_a,customClickBehavior=props.customClickBehavior,customDoubleClickBehavior=props.customDoubleClickBehavior,hoverAnnotation=props.hoverAnnotation;var whichPoints={top:projectedYTop,bottom:projectedYBottom};var pointerStyle=customClickBehavior||customDoubleClickBehavior?{cursor:"pointer"}:{};if(points&&hoverAnnotation&&!overlay){var voronoiDataset_1=[];var voronoiUniqueHash_1={};points.forEach(function(d){var xValue=Math.floor(xScale(d[projectedX]));var yValue=Math.floor(yScale(showLinePoints&&d[whichPoints[showLinePoints]]!==undefined?d[whichPoints[showLinePoints]]:d[projectedYMiddle]!==undefined?d[projectedYMiddle]:d[projectedY]));if(xValue>=0&&xValue<=size[0]&&yValue>=0&&yValue<=size[1]&&xValue!==undefined&&yValue!==undefined&&isNaN(xValue)===false&&isNaN(yValue)===false){var pointKey=xValue+","+yValue;if(!voronoiUniqueHash_1[pointKey]){var voronoiPoint=__assign({},d,{coincidentPoints:[d],voronoiX:xValue,voronoiY:yValue});voronoiDataset_1.push(voronoiPoint);voronoiUniqueHash_1[pointKey]=voronoiPoint}else voronoiUniqueHash_1[pointKey].coincidentPoints.push(d)}});var voronoiXExtent=extent(voronoiDataset_1.map(function(d){return d.voronoiX}));var voronoiYExtent=extent(voronoiDataset_1.map(function(d){return d.voronoiY}));var voronoiExtent=[[Math.min(voronoiXExtent[0],-interactionOverflow.left),Math.min(voronoiYExtent[0],-interactionOverflow.top)],[Math.max(voronoiXExtent[1],size[0]+interactionOverflow.right),Math.max(voronoiYExtent[1],size[1]+interactionOverflow.bottom)]];var voronoiDiagram=voronoi().extent(voronoiExtent).x(function(d){return d.voronoiX}).y(function(d){return d.voronoiY});var voronoiData=voronoiDiagram.polygons(voronoiDataset_1);voronoiPaths=voronoiData.map(function(d,i){return React.createElement("path",{onClick:function(){_this.clickVoronoi(voronoiDataset_1[i])},onDoubleClick:function(){_this.doubleclickVoronoi(voronoiDataset_1[i])},onMouseEnter:function(){_this.changeVoronoi(voronoiDataset_1[i],props.hoverAnnotation)},onMouseLeave:function(){_this.changeVoronoi()},key:"interactionVoronoi"+i,d:"M"+d.join("L")+"Z",style:__assign({fillOpacity:0},pointerStyle)})},_this);return voronoiPaths}else if(overlay){var renderedOverlay=overlay.map(function(overlayRegion,i){var overlayData=overlayRegion.overlayData,rest=__rest(overlayRegion,["overlayData"]);if(React.isValidElement(overlayRegion.renderElement)){var overlayProps={key:"overlay-"+i,onMouseEnter:function(){_this.changeVoronoi(overlayData,props.hoverAnnotation)},onMouseLeave:function(){_this.changeVoronoi()},onClick:function(){_this.clickVoronoi(overlayData)},onDoubleClick:function(){_this.doubleclickVoronoi(overlayData)},style:__assign({opacity:0},pointerStyle)};return React.cloneElement(overlayRegion.renderElement,overlayProps)}else{return React.createElement(lib_2,__assign({forceUpdate:true},rest,{key:"overlay-"+i,onMouseEnter:function(){_this.changeVoronoi(overlayData,props.hoverAnnotation)},onMouseLeave:function(){_this.changeVoronoi()},onClick:function(){_this.clickVoronoi(overlayData)},onDoubleClick:function(){_this.doubleclickVoronoi(overlayData)},style:__assign({opacity:0},pointerStyle)}))}});return renderedOverlay}};_this.canvasRendering=function(){if(_this.interactionContext===null||!_this.state.overlayRegions)return;var _a=_this.props,svgSize=_a.svgSize,margin=_a.margin;var overlayRegions=_this.state.overlayRegions;_this.canvasMap.clear();var interactionContext=_this.interactionContext.getContext("2d");interactionContext.imageSmoothingEnabled=false;interactionContext.setTransform(1,0,0,1,margin.left,margin.top);interactionContext.clearRect(-margin.left,-margin.top,svgSize[0],svgSize[1]);interactionContext.lineWidth=1;overlayRegions.forEach(function(overlay,oi){var interactionRGBA="rgba("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+",255)";_this.canvasMap.set(interactionRGBA,oi);interactionContext.fillStyle=interactionRGBA;interactionContext.strokeStyle=interactionRGBA;var p=new Path2D(overlay.props.d);interactionContext.stroke(p);interactionContext.fill(p)})};_this.createColumnsBrush=function(interaction){var _a=_this.props,projection=_a.projection,rScale=_a.rScale,oColumns=_a.oColumns,renderPipeline=_a.renderPipeline;if(!projection||!rScale||!oColumns)return;var brushData={};Object.entries(renderPipeline).forEach(function(_a){var _b=__read(_a,2),key=_b[0],value=_b[1];if(value.data&&value.data.length>0){brushData[key]=value.data}});var semioticBrush,mappingFn;var rScaleReverse=rScale.copy().domain(rScale.domain()).range(rScale.domain().reverse());if(projection&&projection==="horizontal"){mappingFn=function(d){return!d?null:[rScale.invert(d[0]),rScale.invert(d[1])]}}else mappingFn=function(d){return!d?null:[rScaleReverse(rScale.invert(d[1])),rScaleReverse(rScale.invert(d[0]))]};var rRange=rScale.range();var columnHash=oColumns;var brushPosition,selectedExtent;var brushes=Object.keys(columnHash).map(function(c){if(projection&&projection==="horizontal"){selectedExtent=interaction.extent[c]?interaction.extent[c].map(function(d){return rScale(d)}):rRange;brushPosition=[0,columnHash[c].x];semioticBrush=brushX();semioticBrush.extent([[rRange[0],0],[rRange[1],columnHash[c].width]]).on("start",function(){_this.brushStart(mappingFn(event$1.selection),c,brushData)}).on("brush",function(){_this.brush(mappingFn(event$1.selection),c,brushData)}).on("end",function(){_this.brushEnd(mappingFn(event$1.selection),c,brushData)})}else{selectedExtent=interaction.extent[c]?interaction.extent[c].map(function(d){return rRange[1]-rScale(d)}).reverse():rRange;brushPosition=[columnHash[c].x,0];semioticBrush=brushY();semioticBrush.extent([[0,rRange[0]],[columnHash[c].width,rRange[1]]]).on("start",function(){_this.brushStart(mappingFn(event$1.selection),c,brushData)}).on("brush",function(){_this.brush(mappingFn(event$1.selection),c,brushData)}).on("end",function(){_this.brushEnd(mappingFn(event$1.selection),c,brushData)})}return React.createElement("g",{key:"column-brush-"+c,className:"brush"},React.createElement(Brush,{key:"orbrush"+c,selectedExtent:selectedExtent,svgBrush:semioticBrush,position:brushPosition}))});return brushes};_this.state={overlayRegions:_this.calculateOverlay(props),interactionCanvas:_this.generateInteractionCanvas(props)};return _this}InteractionLayer.prototype.componentWillReceiveProps=function(nextProps){if(this.props.overlay!==nextProps.overlay||nextProps.points!==this.props.points||this.props.xScale!==nextProps.xScale||this.props.yScale!==nextProps.yScale||this.props.hoverAnnotation!==nextProps.hoverAnnotation){this.setState({overlayRegions:this.calculateOverlay(nextProps),interactionCanvas:this.generateInteractionCanvas(nextProps)})}};InteractionLayer.prototype.componentDidMount=function(){this.canvasRendering()};InteractionLayer.prototype.componentDidUpdate=function(prevProps,prevState){if(this.state.overlayRegions!==prevState.overlayRegions){this.canvasRendering()}};InteractionLayer.prototype.render=function(){var semioticBrush=null;var _a=this.props,interaction=_a.interaction,svgSize=_a.svgSize,margin=_a.margin,_b=_a.useSpans,useSpans=_b===void 0?false:_b,canvasRendering=_a.canvasRendering,disableCanvasInteraction=_a.disableCanvasInteraction;var overlayRegions=this.state.overlayRegions;var enabled=this.props.enabled;if(interaction&&interaction.brush){enabled=true;semioticBrush=this.createBrush(interaction)}if(interaction&&interaction.columnsBrush){enabled=true;semioticBrush=this.createColumnsBrush(interaction)}if(!overlayRegions&&!semioticBrush){return null}var interactionCanvas=!disableCanvasInteraction&&canvasRendering&&this.state.overlayRegions&&this.state.interactionCanvas;return React.createElement(SpanOrDiv,{span:useSpans,className:"interaction-layer",style:{position:"absolute",background:"none",pointerEvents:"none"}},interactionCanvas||React.createElement("svg",{height:svgSize[1],width:svgSize[0],style:{background:"none",pointerEvents:"none"}},React.createElement("g",{className:"interaction-overlay",transform:"translate("+margin.left+","+margin.top+")",style:{pointerEvents:enabled?"all":"none"}},React.createElement("g",{className:"interaction-regions"},overlayRegions),semioticBrush)))};InteractionLayer.defaultProps={svgSize:[500,500]};return InteractionLayer}(React.Component);var canvas=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.RoughCanvasAsync=exports.RoughCanvas=undefined;var _regenerator2=_interopRequireDefault(_regenerator);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(_typeof(call)==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+_typeof(superClass))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var RoughCanvas=exports.RoughCanvas=function(){function RoughCanvas(canvas,config){_classCallCheck(this,RoughCanvas);this.canvas=canvas;this.ctx=this.canvas.getContext("2d");this._init(config)}_createClass(RoughCanvas,[{key:"_init",value:function _init(config){this.gen=new _generator.RoughGenerator(config,this.canvas)}},{key:"line",value:function line(x1,y1,x2,y2,options){var d=this.gen.line(x1,y1,x2,y2,options);this.draw(d);return d}},{key:"rectangle",value:function rectangle(x,y,width,height,options){var d=this.gen.rectangle(x,y,width,height,options);this.draw(d);return d}},{key:"ellipse",value:function ellipse(x,y,width,height,options){var d=this.gen.ellipse(x,y,width,height,options);this.draw(d);return d}},{key:"circle",value:function circle(x,y,diameter,options){var d=this.gen.circle(x,y,diameter,options);this.draw(d);return d}},{key:"linearPath",value:function linearPath(points,options){var d=this.gen.linearPath(points,options);this.draw(d);return d}},{key:"polygon",value:function polygon(points,options){var d=this.gen.polygon(points,options);this.draw(d);return d}},{key:"arc",value:function arc(x,y,width,height,start,stop,closed,options){var d=this.gen.arc(x,y,width,height,start,stop,closed,options);this.draw(d);return d}},{key:"curve",value:function curve(points,options){var d=this.gen.curve(points,options);this.draw(d);return d}},{key:"path",value:function path(d,options){var drawing=this.gen.path(d,options);this.draw(drawing);return drawing}},{key:"draw",value:function draw(drawable){var sets=drawable.sets||[];var o=drawable.options||this.gen.defaultOptions;var ctx=this.ctx;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=sets[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var drawing=_step.value;switch(drawing.type){case"path":ctx.save();ctx.strokeStyle=o.stroke;ctx.lineWidth=o.strokeWidth;this._drawToContext(ctx,drawing);ctx.restore();break;case"fillPath":ctx.save();ctx.fillStyle=o.fill;this._drawToContext(ctx,drawing,o);ctx.restore();break;case"fillSketch":this._fillSketch(ctx,drawing,o);break;case"path2Dfill":this.ctx.save();this.ctx.fillStyle=o.fill;var p2d=new Path2D(drawing.path);this.ctx.fill(p2d);this.ctx.restore();break;case"path2Dpattern":var size=drawing.size;var hcanvas=document.createElement("canvas");var hcontext=hcanvas.getContext("2d");var bbox=this._computeBBox(drawing.path);if(bbox&&(bbox.width||bbox.height)){hcanvas.width=this.canvas.width;hcanvas.height=this.canvas.height;hcontext.translate(bbox.x||0,bbox.y||0)}else{hcanvas.width=size[0];hcanvas.height=size[1]}this._fillSketch(hcontext,drawing,o);this.ctx.save();this.ctx.fillStyle=this.ctx.createPattern(hcanvas,"repeat");var _p2d=new Path2D(drawing.path);this.ctx.fill(_p2d);this.ctx.restore();break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"_computeBBox",value:function _computeBBox(d){if(self.document){try{var ns="http://www.w3.org/2000/svg";var svg=self.document.createElementNS(ns,"svg");svg.setAttribute("width","0");svg.setAttribute("height","0");var pathNode=self.document.createElementNS(ns,"path");pathNode.setAttribute("d",d);svg.appendChild(pathNode);self.document.body.appendChild(svg);var bbox=pathNode.getBBox();self.document.body.removeChild(svg);return bbox}catch(err){}}return null}},{key:"_fillSketch",value:function _fillSketch(ctx,drawing,o){var fweight=o.fillWeight;if(fweight<0){fweight=o.strokeWidth/2}ctx.save();ctx.strokeStyle=o.fill;ctx.lineWidth=fweight;this._drawToContext(ctx,drawing);ctx.restore()}},{key:"_drawToContext",value:function _drawToContext(ctx,drawing){ctx.beginPath();var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=drawing.ops[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var item=_step2.value;var data=item.data;switch(item.op){case"move":ctx.moveTo(data[0],data[1]);break;case"bcurveTo":ctx.bezierCurveTo(data[0],data[1],data[2],data[3],data[4],data[5]);break;case"qcurveTo":ctx.quadraticCurveTo(data[0],data[1],data[2],data[3]);break;case"lineTo":ctx.lineTo(data[0],data[1]);break}}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}if(drawing.type==="fillPath"){ctx.fill()}else{ctx.stroke()}}},{key:"generator",get:function get(){return this.gen}}],[{key:"createRenderer",value:function createRenderer(){return new _renderer.RoughRenderer}}]);return RoughCanvas}();var RoughCanvasAsync=exports.RoughCanvasAsync=function(_RoughCanvas){_inherits(RoughCanvasAsync,_RoughCanvas);function RoughCanvasAsync(){_classCallCheck(this,RoughCanvasAsync);return _possibleConstructorReturn(this,(RoughCanvasAsync.__proto__||Object.getPrototypeOf(RoughCanvasAsync)).apply(this,arguments))}_createClass(RoughCanvasAsync,[{key:"_init",value:function _init(config){this.gen=new _generator.RoughGeneratorAsync(config,this.canvas)}},{key:"line",value:function(){var _ref=_asyncToGenerator(_regenerator2.default.mark(function _callee(x1,y1,x2,y2,options){var d;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.gen.line(x1,y1,x2,y2,options);case 2:d=_context.sent;this.draw(d);return _context.abrupt("return",d);case 5:case"end":return _context.stop()}}},_callee,this)}));function line(_x,_x2,_x3,_x4,_x5){return _ref.apply(this,arguments)}return line}()},{key:"rectangle",value:function(){var _ref2=_asyncToGenerator(_regenerator2.default.mark(function _callee2(x,y,width,height,options){var d;return _regenerator2.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.gen.rectangle(x,y,width,height,options);case 2:d=_context2.sent;this.draw(d);return _context2.abrupt("return",d);case 5:case"end":return _context2.stop()}}},_callee2,this)}));function rectangle(_x6,_x7,_x8,_x9,_x10){return _ref2.apply(this,arguments)}return rectangle}()},{key:"ellipse",value:function(){var _ref3=_asyncToGenerator(_regenerator2.default.mark(function _callee3(x,y,width,height,options){var d;return _regenerator2.default.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.gen.ellipse(x,y,width,height,options);case 2:d=_context3.sent;this.draw(d);return _context3.abrupt("return",d);case 5:case"end":return _context3.stop()}}},_callee3,this)}));function ellipse(_x11,_x12,_x13,_x14,_x15){return _ref3.apply(this,arguments)}return ellipse}()},{key:"circle",value:function(){var _ref4=_asyncToGenerator(_regenerator2.default.mark(function _callee4(x,y,diameter,options){var d;return _regenerator2.default.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.gen.circle(x,y,diameter,options);case 2:d=_context4.sent;this.draw(d);return _context4.abrupt("return",d);case 5:case"end":return _context4.stop()}}},_callee4,this)}));function circle(_x16,_x17,_x18,_x19){return _ref4.apply(this,arguments)}return circle}()},{key:"linearPath",value:function(){var _ref5=_asyncToGenerator(_regenerator2.default.mark(function _callee5(points,options){var d;return _regenerator2.default.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.gen.linearPath(points,options);case 2:d=_context5.sent;this.draw(d);return _context5.abrupt("return",d);case 5:case"end":return _context5.stop()}}},_callee5,this)}));function linearPath(_x20,_x21){return _ref5.apply(this,arguments)}return linearPath}()},{key:"polygon",value:function(){var _ref6=_asyncToGenerator(_regenerator2.default.mark(function _callee6(points,options){var d;return _regenerator2.default.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this.gen.polygon(points,options);case 2:d=_context6.sent;this.draw(d);return _context6.abrupt("return",d);case 5:case"end":return _context6.stop()}}},_callee6,this)}));function polygon(_x22,_x23){return _ref6.apply(this,arguments)}return polygon}()},{key:"arc",value:function(){var _ref7=_asyncToGenerator(_regenerator2.default.mark(function _callee7(x,y,width,height,start,stop,closed,options){var d;return _regenerator2.default.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return this.gen.arc(x,y,width,height,start,stop,closed,options);case 2:d=_context7.sent;this.draw(d);return _context7.abrupt("return",d);case 5:case"end":return _context7.stop()}}},_callee7,this)}));function arc(_x24,_x25,_x26,_x27,_x28,_x29,_x30,_x31){return _ref7.apply(this,arguments)}return arc}()},{key:"curve",value:function(){var _ref8=_asyncToGenerator(_regenerator2.default.mark(function _callee8(points,options){var d;return _regenerator2.default.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return this.gen.curve(points,options);case 2:d=_context8.sent;this.draw(d);return _context8.abrupt("return",d);case 5:case"end":return _context8.stop()}}},_callee8,this)}));function curve(_x32,_x33){return _ref8.apply(this,arguments)}return curve}()},{key:"path",value:function(){var _ref9=_asyncToGenerator(_regenerator2.default.mark(function _callee9(d,options){var drawing;return _regenerator2.default.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return this.gen.path(d,options);case 2:drawing=_context9.sent;this.draw(drawing);return _context9.abrupt("return",drawing);case 5:case"end":return _context9.stop()}}},_callee9,this)}));function path(_x34,_x35){return _ref9.apply(this,arguments)}return path}()}]);return RoughCanvasAsync}(RoughCanvas)});unwrapExports(canvas);var canvas_1=canvas.RoughCanvasAsync;var canvas_2=canvas.RoughCanvas;var chuckCloseCanvasTransform=function(canvas,context,size,pixelSize){if(pixelSize===void 0){pixelSize=10}var _a=__read(size,2),baseWidth=_a[0],baseHeight=_a[1];var height=baseHeight+(baseHeight%pixelSize===0?0:pixelSize-baseHeight%pixelSize);var width=baseWidth+(baseWidth%pixelSize===0?0:pixelSize-baseWidth%pixelSize);var rgbStep=4*pixelSize;var imageData=context.getImageData(0,0,width,height);var rgbaArray=[];var imageArray=imageData.data;var rgbWidth=width*4;var halfPixelSize=pixelSize/2;for(var i=0;i<imageArray.length;i+=rgbStep){var pixelPoint={};if(pixelSize===1){pixelPoint={r:imageArray[i],g:imageArray[i+1],b:imageArray[i+2],a:imageArray[i+3],x:i/4%width,y:Math.floor(i/4/width)}}else{var rgbHash={};var totalHash=0;for(var p=0;p<pixelSize*4;p+=pixelSize*4){for(var q=0;q<pixelSize*rgbWidth;q+=rgbWidth){if(imageArray[p+i+q+3]!==-1){var hashVal="rgba("+imageArray[p+i+q]+","+imageArray[p+i+q+1]+","+imageArray[p+i+q+2]+","+imageArray[p+i+q+3]+")";rgbHash[hashVal]=rgbHash[hashVal]?rgbHash[hashVal]+1:1;totalHash+=1}}}pixelPoint={rgbEntries:Object.values(rgbHash).sort(function(a,b){return b-a}),totalEntries:totalHash,x:i/4%width,y:Math.floor(i/4/width),rmod:pixelSize}}rgbaArray.push(pixelPoint);if(pixelSize!==1&&(i+rgbStep)%rgbWidth===0){i+=rgbWidth*(pixelSize-1)}}var scale=1;var r=scale/2;context.clearRect(0,0,width,height);var circleArc=2*Math.PI;rgbaArray.forEach(function(point){var currentR=r*pixelSize;var rStep=currentR/point.totalEntries;var baseX=point.x*scale+halfPixelSize;var baseY=point.y*scale+halfPixelSize;point.rgbEntries.forEach(function(e){context.fillStyle=e[0];context.beginPath();context.arc(baseX,baseY,currentR,0,circleArc);context.fill();currentR-=e[1]*rStep})})};var RoughCanvas=canvas_2;var VisualizationLayer=function(_super){__extends(VisualizationLayer,_super);function VisualizationLayer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.piecesGroup={};_this.canvasDrawing=[];_this.state={canvasDrawing:[],dataVersion:"",renderedElements:[],focusedPieceIndex:null,focusedVisualizationGroup:null};_this.updateVisualizationLayer=function(props){var xScale=props.xScale,yScale=props.yScale,dataVersion=props.dataVersion,projectedCoordinateNames=props.projectedCoordinateNames,_a=props.renderPipeline,renderPipeline=_a===void 0?{}:_a,_b=props.baseMarkProps,baseMarkProps=_b===void 0?{}:_b,_c=props.renderOrder,renderOrder=_c===void 0?[]:_c;_this.canvasDrawing=[];var canvasDrawing=_this.canvasDrawing;var renderedElements=[];var renderVizKeys=Object.keys(renderPipeline);var renderKeys=renderOrder.concat(renderVizKeys.filter(function(d){return renderOrder.indexOf(d)===-1}));renderKeys.forEach(function(k){var pipe=renderPipeline[k];if(pipe&&(pipe.data&&typeof pipe.data==="object"&&!Array.isArray(pipe.data)||pipe.data&&pipe.data.length>0)){var renderedPipe=pipe.behavior(__assign({xScale:xScale,yScale:yScale,canvasDrawing:canvasDrawing,projectedCoordinateNames:projectedCoordinateNames,baseMarkProps:Object.assign(baseMarkProps,{"aria-label":pipe.ariaLabel&&pipe.ariaLabel.items||"dataviz-element",role:"img",tabIndex:-1})},pipe));if(renderedPipe&&renderedPipe.length>0){renderedElements.push(React.createElement("g",{key:k,className:k,role:"group",tabIndex:0,"aria-label":pipe.ariaLabel&&renderedPipe.length+" "+pipe.ariaLabel.items+"s in a "+pipe.ariaLabel.chart||k,onKeyDown:function(e){return _this.handleKeyDown(e,k)},onBlur:function(){_this.props.voronoiHover(undefined)},ref:function(thisNode){return thisNode&&(_this.piecesGroup[k]=thisNode.childNodes)}},renderedPipe))}}});_this.setState({renderedElements:renderedElements,dataVersion:dataVersion})};_this.handleKeyDown=function(e,vizgroup){var pushed=e.keyCode;if(pushed!==37&&pushed!==39&&pushed!==13)return;var newPieceIndex=0;var vizGroupSetting={};if(_this.state.focusedPieceIndex===null||pushed===13){vizGroupSetting.focusedVisualizationGroup=vizgroup}else if(pushed===37){newPieceIndex=_this.state.focusedPieceIndex-1}else if(pushed===39){newPieceIndex=_this.state.focusedPieceIndex+1}newPieceIndex=newPieceIndex<0?_this.piecesGroup[vizgroup].length+newPieceIndex:newPieceIndex%_this.piecesGroup[vizgroup].length;var piece=_this.props.renderPipeline[vizgroup].accessibleTransform(_this.props.renderPipeline[vizgroup].data,newPieceIndex,_this.piecesGroup[vizgroup][newPieceIndex]);_this.props.voronoiHover(piece);_this.setState(__assign({focusedPieceIndex:newPieceIndex},vizGroupSetting))};return _this}VisualizationLayer.prototype.componentDidUpdate=function(lp){var _this=this;var np=this.props;var propKeys=Object.keys(np);var update=false;propKeys.forEach(function(key){if(key!=="title"&&lp[key]!==np[key]){update=true}});if(update===false||this.props.disableContext||!this.props.canvasContext||!this.canvasDrawing)return;var size=[this.props.size[0]+this.props.margin.left+this.props.margin.right,this.props.size[1]+this.props.margin.top+this.props.margin.bottom];var rc;var context=this.props.canvasContext.getContext("2d");context.setTransform(1,0,0,1,this.props.margin.left,this.props.margin.top);context.clearRect(-this.props.margin.left,-this.props.margin.top,size[0],size[1]);this.canvasDrawing.forEach(function(piece){var style=piece.styleFn?piece.styleFn(__assign({},piece.d,piece.d.data),piece.i)||{}:{fill:"black",stroke:"black",opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1};var fill=style.fill?style.fill:"black";var stroke=style.stroke?style.stroke:"black";context.setTransform(1,0,0,1,_this.props.margin.left,_this.props.margin.top);context.translate.apply(context,__spread(_this.props.position));context.translate(piece.tx,piece.ty);context.fillStyle=fill;context.strokeStyle=stroke;context.lineWidth=style.strokeWidth?style.strokeWidth:0;var rcSettings={};var renderObject=piece.markProps.renderMode||piece.renderFn&&piece.renderFn(__assign({},piece.d,piece.d.data),piece.i);var actualRenderMode=renderObject&&renderObject.renderMode||renderObject;if(actualRenderMode){rc=rc||new RoughCanvas(_this.props.canvasContext);var rcExtension=typeof renderObject==="object"&&renderObject||{};rcSettings=__assign({fill:fill,stroke:stroke,strokeWidth:context.lineWidth},rcExtension)}if(piece.markProps.markType==="circle"||piece.markProps.markType==="rect"&&piece.markProps.rx>0){var vizX=0,vizY=0,r=style.r||piece.markProps.r;if(piece.markProps.width){var halfWidth=piece.markProps.width/2;vizX=piece.markProps.x+halfWidth;vizY=piece.markProps.y+halfWidth;r=halfWidth}if(actualRenderMode==="sketchy"){if(context.globalAlpha!==0)rc.circle(vizX,vizY,r,rcSettings)}else{context.beginPath();context.arc(vizX,vizY,r,0,2*Math.PI);context.globalAlpha=style.fillOpacity||style.opacity||1;if(style.fill&&style.fill!=="none"&&context.globalAlpha!==0)context.fill();context.globalAlpha=style.strokeOpacity||style.opacity||1;if(style.stroke&&style.stroke!=="none"&&context.globalAlpha!==0)context.stroke()}}else if(piece.markProps.markType==="rect"){if(actualRenderMode==="sketchy"){context.globalAlpha=style.opacity||1;if(context.globalAlpha!==0)rc.rectangle(piece.markProps.x,piece.markProps.y,piece.markProps.width,piece.markProps.height,rcSettings)}else{context.globalAlpha=style.fillOpacity||style.opacity||1;if(style.fill&&style.fill!=="none"&&context.globalAlpha!==0)context.fillRect(piece.markProps.x,piece.markProps.y,piece.markProps.width,piece.markProps.height);context.globalAlpha=style.strokeOpacity||style.opacity||1;if(style.stroke&&style.stroke!=="none"&&context.globalAlpha!==0)context.strokeRect(piece.markProps.x,piece.markProps.y,piece.markProps.width,piece.markProps.height)}}else if(piece.markProps.markType==="path"){if(actualRenderMode==="sketchy"){context.globalAlpha=style.opacity||1;rc.path(piece.markProps.d,rcSettings)}else{var p=new Path2D(piece.markProps.d);context.globalAlpha=style.strokeOpacity||style.opacity||1;if(style.stroke&&style.stroke!=="none"&&context.globalAlpha!==0)context.stroke(p);context.globalAlpha=style.fillOpacity||style.opacity||1;if(style.fill&&style.fill!=="none"&&context.globalAlpha!==0)context.fill(p)}}else{console.error("CURRENTLY UNSUPPORTED MARKTYPE FOR CANVAS RENDERING")}});context.setTransform(1,0,0,1,0,0);context.globalAlpha=1;if(this.props.canvasPostProcess==="chuckClose"){chuckCloseCanvasTransform(this.props.canvasContext,context,size)}else if(typeof this.props.canvasPostProcess==="function"){this.props.canvasPostProcess(this.props.canvasContext,context,size)}if(this.state.focusedVisualizationGroup!==null&&this.piecesGroup[this.state.focusedVisualizationGroup]&&this.state.focusedPieceIndex!==null){var focusElParent=this.piecesGroup[this.state.focusedVisualizationGroup][this.state.focusedPieceIndex];var focusEl=focusElParent&&__spread(focusElParent.childNodes).find(function(child){return child.getAttribute("aria-label")})||focusElParent;focusEl&&focusEl.focus&&focusEl.focus()}};VisualizationLayer.prototype.componentWillMount=function(){this.updateVisualizationLayer(this.props)};VisualizationLayer.prototype.componentWillReceiveProps=function(np){var lp=this.props;var propKeys=Object.keys(np);var update=false;propKeys.forEach(function(key){if(key!=="title"&&lp[key]!==np[key]){update=true}});if(update||np.dataVersion&&np.dataVersion!==this.state.dataVersion){this.updateVisualizationLayer(np)}};VisualizationLayer.prototype.render=function(){var props=this.props;var matte=props.matte,matteClip=props.matteClip,axes=props.axes,_a=props.frameKey,frameKey=_a===void 0?"":_a,margin=props.margin;var renderedElements=this.state.renderedElements;var renderedAxes=axes&&React.createElement("g",{key:"visualization-axis-labels",className:"axis axis-labels"},axes);var ariaLabel="";var title=this.props.title&&this.props.ariaTitle||this.props.title?typeof this.props.title!=="string"&&this.props.title.props&&typeof this.props.title.props.children==="string"?"titled "+this.props.title.props.children:"with a complex title":"with no title";ariaLabel="Visualization "+title+". Use arrow keys to navigate elements.";var renderedDataVisualization=(renderedAxes||renderedElements&&renderedElements.length>0)&&React.createElement("g",{className:"data-visualization",key:"visualization-clip-path","aria-label":ariaLabel,role:"group",clipPath:matteClip&&matte?"url(#matte-clip"+frameKey+")":undefined,transform:"translate("+margin.left+","+margin.top+")"},renderedElements,matte,renderedAxes)||null;return renderedDataVisualization};VisualizationLayer.defaultProps={position:[0,0],margin:{left:0,top:0,right:0,bottom:0}};return VisualizationLayer}(React.PureComponent);var filterDefs=function(_a){var matte=_a.matte,key=_a.key,additionalDefs=_a.additionalDefs;return React.createElement("defs",null,React.createElement("filter",{id:"paintyFilterHeavy"},React.createElement("feGaussianBlur",{id:"gaussblurrer",in:"SourceGraphic",stdDeviation:4,colorInterpolationFilters:"sRGB",result:"blur"}),React.createElement("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 34 -7",result:"gooey"})),React.createElement("filter",{id:"paintyFilterLight"},React.createElement("feGaussianBlur",{id:"gaussblurrer",in:"SourceGraphic",stdDeviation:2,colorInterpolationFilters:"sRGB",result:"blur"}),React.createElement("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 34 -7",result:"gooey"})),React.createElement("clipPath",{id:"matte-clip-"+key},matte),additionalDefs)};var defaultZeroMargin={top:0,bottom:0,left:0,right:0};var Frame=function(_super){__extends(Frame,_super);function Frame(props){var _this=_super.call(this,props)||this;_this.canvasContext=null;_this.setVoronoi=function(d){_this.setState({voronoiHover:d})};_this.state={canvasContext:null,voronoiHover:undefined};return _this}Frame.prototype.componentDidMount=function(){this.setState({canvasContext:this.canvasContext})};Frame.prototype.componentDidUpdate=function(){if(this.canvasContext!==this.state.canvasContext)this.setState({canvasContext:this.canvasContext})};Frame.prototype.render=function(){var _this=this;var _a=this.props,axes=_a.axes,axesTickLines=_a.axesTickLines,_b=_a.className,className=_b===void 0?"":_b,matte=_a.matte,_c=_a.name,name=_c===void 0?"":_c,frameKey=_a.frameKey,projectedCoordinateNames=_a.projectedCoordinateNames,renderPipeline=_a.renderPipeline,size=_a.size,_d=_a.adjustedSize,adjustedSize=_d===void 0?size:_d,title=_a.title,xScale=_a.xScale,yScale=_a.yScale,dataVersion=_a.dataVersion,annotations=_a.annotations,hoverAnnotation=_a.hoverAnnotation,projectedYMiddle=_a.projectedYMiddle,interaction=_a.interaction,customClickBehavior=_a.customClickBehavior,customHoverBehavior=_a.customHoverBehavior,customDoubleClickBehavior=_a.customDoubleClickBehavior,points=_a.points,_e=_a.margin,margin=_e===void 0?defaultZeroMargin:_e,backgroundGraphics=_a.backgroundGraphics,foregroundGraphics=_a.foregroundGraphics,beforeElements=_a.beforeElements,afterElements=_a.afterElements,downloadButton=_a.downloadButton,defaultSVGRule=_a.defaultSVGRule,defaultHTMLRule=_a.defaultHTMLRule,adjustedPosition=_a.adjustedPosition,legendSettings=_a.legendSettings,annotationSettings=_a.annotationSettings,overlay=_a.overlay,columns=_a.columns,rScale=_a.rScale,projection=_a.projection,interactionOverflow=_a.interactionOverflow,canvasPostProcess=_a.canvasPostProcess,baseMarkProps=_a.baseMarkProps,useSpans=_a.useSpans,canvasRendering=_a.canvasRendering,renderOrder=_a.renderOrder,additionalDefs=_a.additionalDefs,showLinePoints=_a.showLinePoints,_f=_a.disableCanvasInteraction,disableCanvasInteraction=_f===void 0?false:_f;var voronoiHover=this.state.voronoiHover;var areaAnnotations=[];var totalAnnotations=annotations?__spread(annotations,areaAnnotations):areaAnnotations;if(voronoiHover){if(Array.isArray(voronoiHover)){totalAnnotations.push.apply(totalAnnotations,__spread(voronoiHover))}else{totalAnnotations.push(voronoiHover)}}var annotationLayer=(totalAnnotations&&totalAnnotations.length>0||legendSettings)&&React.createElement(AnnotationLayer,{legendSettings:legendSettings,margin:margin,axes:axes,voronoiHover:this.setVoronoi,annotationHandling:annotationSettings,pointSizeFunction:annotationSettings.layout&&annotationSettings.layout.pointSizeFunction,labelSizeFunction:annotationSettings.layout&&annotationSettings.layout.labelSizeFunction,annotations:totalAnnotations,svgAnnotationRule:function(d,i,thisALayer){return defaultSVGRule(__assign({d:d,i:i,annotationLayer:thisALayer},renderPipeline))},htmlAnnotationRule:function(d,i,thisALayer){return defaultHTMLRule(__assign({d:d,i:i,annotationLayer:thisALayer},renderPipeline))},useSpans:useSpans,size:adjustedSize,position:[adjustedPosition[0]+margin.left,adjustedPosition[1]+margin.top]});var generatedTitle=generateFrameTitle({title:title,size:size});var marginGraphic;var finalBackgroundGraphics=typeof backgroundGraphics==="function"?backgroundGraphics({size:size,margin:margin}):backgroundGraphics;var finalForegroundGraphics=typeof foregroundGraphics==="function"?foregroundGraphics({size:size,margin:margin}):foregroundGraphics;if(typeof matte==="function"){marginGraphic=matte({size:size,margin:margin})}else if(React.isValidElement(matte)){marginGraphic=matte}else if(matte===true){marginGraphic=React.createElement("path",{fill:"white",transform:"translate("+-margin.left+","+-margin.top+")",d:drawMarginPath({margin:margin,size:size,inset:0}),className:name+"-matte"})}var finalFilterDefs=filterDefs({matte:marginGraphic,key:matte&&(frameKey||name),additionalDefs:additionalDefs});return React.createElement(SpanOrDiv,{span:useSpans,className:className+" frame "+name,style:{background:"none"}},beforeElements&&React.createElement(SpanOrDiv,{span:useSpans,className:name+" frame-before-elements"},beforeElements),React.createElement(SpanOrDiv,{span:useSpans,className:"frame-elements",style:{height:size[1]+"px",width:size[0]+"px"}},React.createElement(SpanOrDiv,{span:useSpans,className:"visualization-layer",style:{position:"absolute"}},(axesTickLines||backgroundGraphics)&&React.createElement("svg",{className:"background-graphics",style:{position:"absolute"},width:size[0],height:size[1]},backgroundGraphics&&React.createElement("g",{"aria-hidden":true,className:"background-graphics"},finalBackgroundGraphics),axesTickLines&&React.createElement("g",{transform:"translate("+margin.left+","+margin.top+")",key:"visualization-tick-lines",className:"axis axis-tick-lines","aria-hidden":true},axesTickLines)),canvasRendering&&React.createElement("canvas",{className:"frame-canvas",ref:function(canvasContext){return _this.canvasContext=canvasContext},style:{position:"absolute",left:"0px",top:"0px"},width:size[0],height:size[1]}),React.createElement("svg",{className:"visualization-layer",style:{position:"absolute"},width:size[0],height:size[1]},finalFilterDefs,React.createElement(VisualizationLayer,{disableContext:this.props.disableContext,renderPipeline:renderPipeline,position:adjustedPosition,size:adjustedSize,projectedCoordinateNames:projectedCoordinateNames,xScale:xScale,yScale:yScale,axes:axes,title:generatedTitle,frameKey:frameKey,canvasContext:this.state.canvasContext,dataVersion:dataVersion,matte:marginGraphic,margin:margin,canvasPostProcess:canvasPostProcess,baseMarkProps:baseMarkProps,voronoiHover:this.setVoronoi,renderOrder:renderOrder}),generatedTitle&&React.createElement("g",{className:"frame-title"},generatedTitle),foregroundGraphics&&React.createElement("g",{"aria-hidden":true,className:"foreground-graphics"},finalForegroundGraphics))),React.createElement(InteractionLayer,{useSpans:useSpans,hoverAnnotation:hoverAnnotation,projectedX:projectedCoordinateNames.x,projectedY:projectedCoordinateNames.y,projectedYMiddle:projectedYMiddle,interaction:interaction,voronoiHover:this.setVoronoi,customClickBehavior:customClickBehavior,customHoverBehavior:customHoverBehavior,customDoubleClickBehavior:customDoubleClickBehavior,points:points,showLinePoints:showLinePoints,canvasRendering:canvasRendering,position:adjustedPosition,margin:margin,size:adjustedSize,svgSize:size,xScale:xScale,yScale:yScale,enabled:true,overlay:overlay,oColumns:columns,rScale:rScale,projection:projection,interactionOverflow:interactionOverflow,disableCanvasInteraction:disableCanvasInteraction,renderPipeline:renderPipeline}),annotationLayer),(downloadButton||afterElements)&&React.createElement(SpanOrDiv,{span:useSpans,className:name+" frame-after-elements"},downloadButton,afterElements))};Frame.defaultProps={annotationSettings:{},adjustedPosition:[0,0],projectedCoordinateNames:{x:"x",y:"y"},renderOrder:[]};return Frame}(React.Component);var rect=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var _ref$width=_ref.width,width=_ref$width===undefined?100:_ref$width,_ref$height=_ref.height,height=_ref$height===undefined?100:_ref$height,editMode=_ref.editMode;var handles=[];var data=[[0,0],[width,0],[width,height],[0,height],[0,0]];var rect=(0,_Builder.lineBuilder)({data:data,className:"subject"});if(editMode){handles=[{x:width,y:height/2,key:"width"},{x:width/2,y:height,key:"height"}]}rect.attrs["fill-opacity"]=.1;return{components:[rect],handles:handles}}});var rect$1=unwrapExports(rect);var rect$2=Object.freeze({default:rect$1,__moduleExports:rect});var require$$1$c=rect$2&&rect$1||rect$2;var SubjectRect_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _rect=_interopRequireDefault(require$$1$c);var _Subject2=_interopRequireDefault(require$$2$4);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var SubjectRect=function(_Subject){_inherits(SubjectRect,_Subject);function SubjectRect(){_classCallCheck(this,SubjectRect);return _possibleConstructorReturn(this,_getPrototypeOf(SubjectRect).apply(this,arguments))}_createClass(SubjectRect,[{key:"getComponents",value:function getComponents(_ref){var _ref$width=_ref.width,width=_ref$width===void 0?100:_ref$width,_ref$height=_ref.height,height=_ref$height===void 0?100:_ref$height,editMode=_ref.editMode;var components=(0,_rect.default)({width:width,height:height,editMode:editMode});components.handleKeys={width:width,height:height};components.handleFunction=function(h,data){return _defineProperty({},h.key,h.key==="width"?width+data.oDeltaX:height+data.oDeltaY)};return components}}]);return SubjectRect}(_Subject2.default);exports.default=SubjectRect;SubjectRect.propTypes={width:_propTypes.default.number,height:_propTypes.default.number,editMode:_propTypes.default.bool}});var SubjectRect=unwrapExports(SubjectRect_1);var SubjectRect$1=Object.freeze({default:SubjectRect,__moduleExports:SubjectRect_1});var require$$0$5=SubjectRect$1&&SubjectRect||SubjectRect$1;var AnnotationCalloutRect_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationCalloutRect;var _SubjectRect=_interopRequireDefault(require$$0$5);var _ConnectorElbow=_interopRequireDefault(require$$1$7);var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationCalloutRect(props){var className=(0,_classnames.default)("callout rect",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorElbow.default,{lineType:"horizontal"},_SubjectRect.default,{width:100,height:100})}});var AnnotationCalloutRect=unwrapExports(AnnotationCalloutRect_1);var threshold$1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(_ref){var x1=_ref.x1,x2=_ref.x2,y1=_ref.y1,y2=_ref.y2,x=_ref.x,y=_ref.y;x1=(x1!==undefined?x1:x)-x;x2=(x2!==undefined?x2:x)-x;y1=(y1!==undefined?y1:y)-y;y2=(y2!==undefined?y2:y)-y;var data=[[x1,y1],[x2,y2]];return{components:[(0,_Builder.lineBuilder)({data:data,className:"subject"})]}}});var threshold$2=unwrapExports(threshold$1);var threshold$3=Object.freeze({default:threshold$2,__moduleExports:threshold$1});var require$$1$d=threshold$3&&threshold$2||threshold$3;var SubjectThreshold_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _threshold=_interopRequireDefault(require$$1$d);var _Subject2=_interopRequireDefault(require$$2$4);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var SubjectThreshold=function(_Subject){_inherits(SubjectThreshold,_Subject);function SubjectThreshold(){_classCallCheck(this,SubjectThreshold);return _possibleConstructorReturn(this,_getPrototypeOf(SubjectThreshold).apply(this,arguments))}_createClass(SubjectThreshold,[{key:"getComponents",value:function getComponents(_ref){var x1=_ref.x1,x2=_ref.x2,y1=_ref.y1,y2=_ref.y2,x=_ref.x,y=_ref.y,editMode=_ref.editMode;return(0,_threshold.default)({x1:x1,x2:x2,y1:y1,y2:y2,x:x,y:y,editMode:editMode})}}]);return SubjectThreshold}(_Subject2.default);exports.default=SubjectThreshold;SubjectThreshold.propTypes={x:_propTypes.default.number,x1:_propTypes.default.number,x2:_propTypes.default.number,y:_propTypes.default.number,y1:_propTypes.default.number,y2:_propTypes.default.number,editMode:_propTypes.default.bool}});var SubjectThreshold=unwrapExports(SubjectThreshold_1);var SubjectThreshold$1=Object.freeze({default:SubjectThreshold,__moduleExports:SubjectThreshold_1});var require$$0$6=SubjectThreshold$1&&SubjectThreshold||SubjectThreshold$1;var AnnotationXYThreshold_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationXYThreshold;var _SubjectThreshold=_interopRequireDefault(require$$0$6);var _ConnectorElbow=_interopRequireDefault(require$$1$7);var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationXYThreshold(props){var className=(0,_classnames.default)("callout xythreshold",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorElbow.default,{lineType:"horizontal"},_SubjectThreshold.default)}});var AnnotationXYThreshold=unwrapExports(AnnotationXYThreshold_1);function defaultSeparation(a,b){return a.parent===b.parent?1:2}function meanX(children){return children.reduce(meanXReduce,0)/children.length}function meanXReduce(x,c){return x+c.x}function maxY(children){return 1+children.reduce(maxYReduce,0)}function maxYReduce(y,c){return Math.max(y,c.y)}function leafLeft(node){var children;while(children=node.children){node=children[0]}return node}function leafRight(node){var children;while(children=node.children){node=children[children.length-1]}return node}function cluster(){var separation=defaultSeparation,dx=1,dy=1,nodeSize=false;function cluster(root){var previousNode,x=0;root.eachAfter(function(node){var children=node.children;if(children){node.x=meanX(children);node.y=maxY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=leafLeft(root),right=leafRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return root.eachAfter(nodeSize?function(node){node.x=(node.x-root.x)*dx;node.y=(root.y-node.y)*dy}:function(node){node.x=(node.x-x0)/(x1-x0)*dx;node.y=(1-(root.y?node.y/root.y:1))*dy})}cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation};cluster.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],cluster):nodeSize?null:[dx,dy]};cluster.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],cluster):nodeSize?[dx,dy]:null};return cluster}function count(node){var sum=0,children=node.children,i=children&&children.length;if(!i)sum=1;else while(--i>=0){sum+=children[i].value}node.value=sum}function node_count(){return this.eachAfter(count)}function node_each(callback){var node=this,current,next=[node],children,i,n;do{current=next.reverse(),next=[];while(node=current.pop()){callback(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){next.push(children[i])}}}while(next.length);return this}function node_eachBefore(callback){var node=this,nodes=[node],children,i;while(node=nodes.pop()){callback(node),children=node.children;if(children)for(i=children.length-1;i>=0;--i){nodes.push(children[i])}}return this}function node_eachAfter(callback){var node=this,nodes=[node],next=[],children,i,n;while(node=nodes.pop()){next.push(node),children=node.children;if(children)for(i=0,n=children.length;i<n;++i){nodes.push(children[i])}}while(node=next.pop()){callback(node)}return this}function node_sum(value){return this.eachAfter(function(node){var sum=+value(node.data)||0,children=node.children,i=children&&children.length;while(--i>=0){sum+=children[i].value}node.value=sum})}function node_sort(compare){return this.eachBefore(function(node){if(node.children){node.children.sort(compare)}})}function node_path(end){var start=this,ancestor=leastCommonAncestor(start,end),nodes=[start];while(start!==ancestor){start=start.parent;nodes.push(start)}var k=nodes.length;while(end!==ancestor){nodes.splice(k,0,end);end=end.parent}return nodes}function leastCommonAncestor(a,b){if(a===b)return a;var aNodes=a.ancestors(),bNodes=b.ancestors(),c=null;a=aNodes.pop();b=bNodes.pop();while(a===b){c=a;a=aNodes.pop();b=bNodes.pop()}return c}function node_ancestors(){var node=this,nodes=[node];while(node=node.parent){nodes.push(node)}return nodes}function node_descendants(){var nodes=[];this.each(function(node){nodes.push(node)});return nodes}function node_leaves(){var leaves=[];this.eachBefore(function(node){if(!node.children){leaves.push(node)}});return leaves}function node_links(){var root=this,links=[];root.each(function(node){if(node!==root){links.push({source:node.parent,target:node})}});return links}function hierarchy(data,children){var root=new Node(data),valued=+data.value&&(root.value=data.value),node,nodes=[root],child,childs,i,n;if(children==null)children=defaultChildren;while(node=nodes.pop()){if(valued)node.value=+node.data.value;if((childs=children(node.data))&&(n=childs.length)){node.children=new Array(n);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new Node(childs[i]));child.parent=node;child.depth=node.depth+1}}}return root.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function defaultChildren(d){return d.children}function copyData(node){node.data=node.data.data}function computeHeight(node){var height=0;do{node.height=height}while((node=node.parent)&&node.height<++height)}function Node(data){this.data=data;this.depth=this.height=0;this.parent=null}Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy};var slice$5=Array.prototype.slice;function shuffle$1(array){var m=array.length,t,i;while(m){i=Math.random()*m--|0;t=array[m];array[m]=array[i];array[i]=t}return array}function packEnclose(circles){var i=0,n=(circles=shuffle$1(slice$5.call(circles))).length,B=[],p,e;while(i<n){p=circles[i];if(e&&enclosesWeak(e,p))++i;else e=encloseBasis(B=extendBasis(B,p)),i=0}return e}function extendBasis(B,p){var i,j;if(enclosesWeakAll(p,B))return[p];for(i=0;i<B.length;++i){if(enclosesNot(p,B[i])&&enclosesWeakAll(encloseBasis2(B[i],p),B)){return[B[i],p]}}for(i=0;i<B.length-1;++i){for(j=i+1;j<B.length;++j){if(enclosesNot(encloseBasis2(B[i],B[j]),p)&&enclosesNot(encloseBasis2(B[i],p),B[j])&&enclosesNot(encloseBasis2(B[j],p),B[i])&&enclosesWeakAll(encloseBasis3(B[i],B[j],p),B)){return[B[i],B[j],p]}}}throw new Error}function enclosesNot(a,b){var dr=a.r-b.r,dx=b.x-a.x,dy=b.y-a.y;return dr<0||dr*dr<dx*dx+dy*dy}function enclosesWeak(a,b){var dr=a.r-b.r+1e-6,dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function enclosesWeakAll(a,B){for(var i=0;i<B.length;++i){if(!enclosesWeak(a,B[i])){return false}}return true}function encloseBasis(B){switch(B.length){case 1:return encloseBasis1(B[0]);case 2:return encloseBasis2(B[0],B[1]);case 3:return encloseBasis3(B[0],B[1],B[2])}}function encloseBasis1(a){return{x:a.x,y:a.y,r:a.r}}function encloseBasis2(a,b){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x21=x2-x1,y21=y2-y1,r21=r2-r1,l=Math.sqrt(x21*x21+y21*y21);return{x:(x1+x2+x21/l*r21)/2,y:(y1+y2+y21/l*r21)/2,r:(l+r1+r2)/2}}function encloseBasis3(a,b,c){var x1=a.x,y1=a.y,r1=a.r,x2=b.x,y2=b.y,r2=b.r,x3=c.x,y3=c.y,r3=c.r,a2=x1-x2,a3=x1-x3,b2=y1-y2,b3=y1-y3,c2=r2-r1,c3=r3-r1,d1=x1*x1+y1*y1-r1*r1,d2=d1-x2*x2-y2*y2+r2*r2,d3=d1-x3*x3-y3*y3+r3*r3,ab=a3*b2-a2*b3,xa=(b2*d3-b3*d2)/(ab*2)-x1,xb=(b3*c2-b2*c3)/ab,ya=(a3*d2-a2*d3)/(ab*2)-y1,yb=(a2*c3-a3*c2)/ab,A=xb*xb+yb*yb-1,B=2*(r1+xa*xb+ya*yb),C=xa*xa+ya*ya-r1*r1,r=-(A?(B+Math.sqrt(B*B-4*A*C))/(2*A):C/B);return{x:x1+xa+xb*r,y:y1+ya+yb*r,r:r}}function place(b,a,c){var dx=b.x-a.x,x,a2,dy=b.y-a.y,y,b2,d2=dx*dx+dy*dy;if(d2){a2=a.r+c.r,a2*=a2;b2=b.r+c.r,b2*=b2;if(a2>b2){x=(d2+b2-a2)/(2*d2);y=Math.sqrt(Math.max(0,b2/d2-x*x));c.x=b.x-x*dx-y*dy;c.y=b.y-x*dy+y*dx}else{x=(d2+a2-b2)/(2*d2);y=Math.sqrt(Math.max(0,a2/d2-x*x));c.x=a.x+x*dx-y*dy;c.y=a.y+x*dy+y*dx}}else{c.x=a.x+c.r;c.y=a.y}}function intersects(a,b){var dr=a.r+b.r-1e-6,dx=b.x-a.x,dy=b.y-a.y;return dr>0&&dr*dr>dx*dx+dy*dy}function score(node){var a=node._,b=node.next._,ab=a.r+b.r,dx=(a.x*b.r+b.x*a.r)/ab,dy=(a.y*b.r+b.y*a.r)/ab;return dx*dx+dy*dy}function Node$1(circle){this._=circle;this.next=null;this.previous=null}function packEnclose$1(circles){if(!(n=circles.length))return 0;var a,b,c,n,aa,ca,i,j,k,sj,sk;a=circles[0],a.x=0,a.y=0;if(!(n>1))return a.r;b=circles[1],a.x=-b.r,b.x=a.r,b.y=0;if(!(n>2))return a.r+b.r;place(b,a,c=circles[2]);a=new Node$1(a),b=new Node$1(b),c=new Node$1(c);a.next=c.previous=b;b.next=a.previous=c;c.next=b.previous=a;pack:for(i=3;i<n;++i){place(a._,b._,c=circles[i]),c=new Node$1(c);j=b.next,k=a.previous,sj=b._.r,sk=a._.r;do{if(sj<=sk){if(intersects(j._,c._)){b=j,a.next=b,b.previous=a,--i;continue pack}sj+=j._.r,j=j.next}else{if(intersects(k._,c._)){a=k,a.next=b,b.previous=a,--i;continue pack}sk+=k._.r,k=k.previous}}while(j!==k.next);c.previous=a,c.next=b,a.next=b.previous=b=c;aa=score(a);while((c=c.next)!==b){if((ca=score(c))<aa){a=c,aa=ca}}b=a.next}a=[b._],c=b;while((c=c.next)!==b){a.push(c._)}c=packEnclose(a);for(i=0;i<n;++i){a=circles[i],a.x-=c.x,a.y-=c.y}return c.r}function packSiblings(circles){packEnclose$1(circles);return circles}function optional(f){return f==null?null:required(f)}function required(f){if(typeof f!=="function")throw new Error;return f}function constantZero(){return 0}function constant$9(x){return function(){return x}}function defaultRadius(d){return Math.sqrt(d.value)}function pack(){var radius=null,dx=1,dy=1,padding=constantZero;function pack(root){root.x=dx/2,root.y=dy/2;if(radius){root.eachBefore(radiusLeaf(radius)).eachAfter(packChildren(padding,.5)).eachBefore(translateChild(1))}else{root.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(padding,root.r/Math.min(dx,dy))).eachBefore(translateChild(Math.min(dx,dy)/(2*root.r)))}return root}pack.radius=function(x){return arguments.length?(radius=optional(x),pack):radius};pack.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],pack):[dx,dy]};pack.padding=function(x){return arguments.length?(padding=typeof x==="function"?x:constant$9(+x),pack):padding};return pack}function radiusLeaf(radius){return function(node){if(!node.children){node.r=Math.max(0,+radius(node)||0)}}}function packChildren(padding,k){return function(node){if(children=node.children){var children,i,n=children.length,r=padding(node)*k||0,e;if(r)for(i=0;i<n;++i){children[i].r+=r}e=packEnclose$1(children);if(r)for(i=0;i<n;++i){children[i].r-=r}node.r=e+r}}}function translateChild(k){return function(node){var parent=node.parent;node.r*=k;if(parent){node.x=parent.x+k*node.x;node.y=parent.y+k*node.y}}}function roundNode(node){node.x0=Math.round(node.x0);node.y0=Math.round(node.y0);node.x1=Math.round(node.x1);node.y1=Math.round(node.y1)}function treemapDice(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(x1-x0)/parent.value;while(++i<n){node=nodes[i],node.y0=y0,node.y1=y1;node.x0=x0,node.x1=x0+=node.value*k}}function partition(){var dx=1,dy=1,padding=0,round=false;function partition(root){var n=root.height+1;root.x0=root.y0=padding;root.x1=dx;root.y1=dy/n;root.eachBefore(positionNode(dy,n));if(round)root.eachBefore(roundNode);return root}function positionNode(dy,n){return function(node){if(node.children){treemapDice(node,node.x0,dy*(node.depth+1)/n,node.x1,dy*(node.depth+2)/n)}var x0=node.x0,y0=node.y0,x1=node.x1-padding,y1=node.y1-padding;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1}}partition.round=function(x){return arguments.length?(round=!!x,partition):round};partition.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],partition):[dx,dy]};partition.padding=function(x){return arguments.length?(padding=+x,partition):padding};return partition}function defaultSeparation$1(a,b){return a.parent===b.parent?1:2}function nextLeft(v){var children=v.children;return children?children[0]:v.t}function nextRight(v){var children=v.children;return children?children[children.length-1]:v.t}function moveSubtree(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift}function executeShifts(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c)}}function nextAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function TreeNode(node,i){this._=node;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=i}TreeNode.prototype=Object.create(Node.prototype);function treeRoot(root){var tree=new TreeNode(root,0),node,nodes=[tree],child,children,i,n;while(node=nodes.pop()){if(children=node._.children){node.children=new Array(n=children.length);for(i=n-1;i>=0;--i){nodes.push(child=node.children[i]=new TreeNode(children[i],i));child.parent=node}}}(tree.parent=new TreeNode(null,0)).children=[tree];return tree}function tree(){var separation=defaultSeparation$1,dx=1,dy=1,nodeSize=null;function tree(root){var t=treeRoot(root);t.eachAfter(firstWalk),t.parent.m=-t.z;t.eachBefore(secondWalk);if(nodeSize)root.eachBefore(sizeNode);else{var left=root,right=root,bottom=root;root.eachBefore(function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node});var s=left===right?1:separation(left,right)/2,tx=s-left.x,kx=dx/(right.x+s+tx),ky=dy/(bottom.depth||1);root.eachBefore(function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky})}return root}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children){executeShifts(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint}else{v.z=midpoint}}else if(w){v.z=w.z+separation(v._,w._)}v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=nextRight(vim),vip=nextLeft(vip),vim&&vip){vom=nextLeft(vom);vop=nextRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){moveSubtree(nextAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift}sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m}if(vim&&!nextRight(vop)){vop.t=vim;vop.m+=sim-sop}if(vip&&!nextLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v}}return ancestor}function sizeNode(node){node.x*=dx;node.y=node.depth*dy}tree.separation=function(x){return arguments.length?(separation=x,tree):separation};tree.size=function(x){return arguments.length?(nodeSize=false,dx=+x[0],dy=+x[1],tree):nodeSize?null:[dx,dy]};tree.nodeSize=function(x){return arguments.length?(nodeSize=true,dx=+x[0],dy=+x[1],tree):nodeSize?[dx,dy]:null};return tree}function treemapSlice(parent,x0,y0,x1,y1){var nodes=parent.children,node,i=-1,n=nodes.length,k=parent.value&&(y1-y0)/parent.value;while(++i<n){node=nodes[i],node.x0=x0,node.x1=x1;node.y0=y0,node.y1=y0+=node.value*k}}var phi=(1+Math.sqrt(5))/2;function squarifyRatio(ratio,parent,x0,y0,x1,y1){var rows=[],nodes=parent.children,row,nodeValue,i0=0,i1=0,n=nodes.length,dx,dy,value=parent.value,sumValue,minValue,maxValue,newRatio,minRatio,alpha,beta;while(i0<n){dx=x1-x0,dy=y1-y0;do{sumValue=nodes[i1++].value}while(!sumValue&&i1<n);minValue=maxValue=sumValue;alpha=Math.max(dy/dx,dx/dy)/(value*ratio);beta=sumValue*sumValue*alpha;minRatio=Math.max(maxValue/beta,beta/minValue);for(;i1<n;++i1){sumValue+=nodeValue=nodes[i1].value;if(nodeValue<minValue)minValue=nodeValue;if(nodeValue>maxValue)maxValue=nodeValue;beta=sumValue*sumValue*alpha;newRatio=Math.max(maxValue/beta,beta/minValue);if(newRatio>minRatio){sumValue-=nodeValue;break}minRatio=newRatio}rows.push(row={value:sumValue,dice:dx<dy,children:nodes.slice(i0,i1)});if(row.dice)treemapDice(row,x0,y0,x1,value?y0+=dy*sumValue/value:y1);else treemapSlice(row,x0,y0,value?x0+=dx*sumValue/value:x1,y1);value-=sumValue,i0=i1}return rows}var squarify=function custom(ratio){function squarify(parent,x0,y0,x1,y1){squarifyRatio(ratio,parent,x0,y0,x1,y1)}squarify.ratio=function(x){return custom((x=+x)>1?x:1)};return squarify}(phi);function treemap(){var tile=squarify,round=false,dx=1,dy=1,paddingStack=[0],paddingInner=constantZero,paddingTop=constantZero,paddingRight=constantZero,paddingBottom=constantZero,paddingLeft=constantZero;function treemap(root){root.x0=root.y0=0;root.x1=dx;root.y1=dy;root.eachBefore(positionNode);paddingStack=[0];if(round)root.eachBefore(roundNode);return root}function positionNode(node){var p=paddingStack[node.depth],x0=node.x0+p,y0=node.y0+p,x1=node.x1-p,y1=node.y1-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;node.x0=x0;node.y0=y0;node.x1=x1;node.y1=y1;if(node.children){p=paddingStack[node.depth+1]=paddingInner(node)/2;x0+=paddingLeft(node)-p;y0+=paddingTop(node)-p;x1-=paddingRight(node)-p;y1-=paddingBottom(node)-p;if(x1<x0)x0=x1=(x0+x1)/2;if(y1<y0)y0=y1=(y0+y1)/2;tile(node,x0,y0,x1,y1)}}treemap.round=function(x){return arguments.length?(round=!!x,treemap):round};treemap.size=function(x){return arguments.length?(dx=+x[0],dy=+x[1],treemap):[dx,dy]};treemap.tile=function(x){return arguments.length?(tile=required(x),treemap):tile};treemap.padding=function(x){return arguments.length?treemap.paddingInner(x).paddingOuter(x):treemap.paddingInner()};treemap.paddingInner=function(x){return arguments.length?(paddingInner=typeof x==="function"?x:constant$9(+x),treemap):paddingInner};treemap.paddingOuter=function(x){return arguments.length?treemap.paddingTop(x).paddingRight(x).paddingBottom(x).paddingLeft(x):treemap.paddingTop()};treemap.paddingTop=function(x){return arguments.length?(paddingTop=typeof x==="function"?x:constant$9(+x),treemap):paddingTop};treemap.paddingRight=function(x){return arguments.length?(paddingRight=typeof x==="function"?x:constant$9(+x),treemap):paddingRight};treemap.paddingBottom=function(x){return arguments.length?(paddingBottom=typeof x==="function"?x:constant$9(+x),treemap):paddingBottom};treemap.paddingLeft=function(x){return arguments.length?(paddingLeft=typeof x==="function"?x:constant$9(+x),treemap):paddingLeft};return treemap}var circle$2=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.circleHandles=undefined;var circleHandles=exports.circleHandles=function circleHandles(_ref){var _ref$cx=_ref.cx,cx=_ref$cx===undefined?0:_ref$cx,_ref$cy=_ref.cy,cy=_ref$cy===undefined?0:_ref$cy,r1=_ref.r1,r2=_ref.r2,padding=_ref.padding;var h={move:{x:cx,y:cy}};if(r1!==undefined){h.r1={x:cx+r1/Math.sqrt(2),y:cy+r1/Math.sqrt(2)}}if(r2!==undefined){h.r2={x:cx+r2/Math.sqrt(2),y:cy+r2/Math.sqrt(2)}}if(padding!==undefined){h.padding={x:cx+r1+padding,y:cy}}return h};exports.default=function(_ref2){var radius=_ref2.radius,radiusPadding=_ref2.radiusPadding,outerRadius=_ref2.outerRadius,innerRadius=_ref2.innerRadius,editMode=_ref2.editMode;var handles=[];var c=(0,_Builder.arcBuilder)({data:{radius:radius,outerRadius:outerRadius,innerRadius:innerRadius},className:"subject"});if(editMode){var h=circleHandles({r1:c.data.outerRadius||c.data.radius,r2:c.data.innerRadius,padding:radiusPadding});var cHandles=[{x:h.r1.x,y:h.r1.y,key:c.data.outerRadius?"outerRadius":"radius"}];if(innerRadius){cHandles.push({x:h.r2.x,y:h.r2.y,key:"innerRadius"})}handles=cHandles}c.attrs["fill-opacity"]=0;return{components:[c],handles:handles}}});var circle$3=unwrapExports(circle$2);var circle_1=circle$2.circleHandles;var circle$4=Object.freeze({default:circle$3,__moduleExports:circle$2,circleHandles:circle_1});var require$$1$e=circle$4&&circle$3||circle$4;var SubjectCircle_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _circle=_interopRequireDefault(require$$1$e);var _Subject2=_interopRequireDefault(require$$2$4);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var SubjectCircle=function(_Subject){_inherits(SubjectCircle,_Subject);function SubjectCircle(){_classCallCheck(this,SubjectCircle);return _possibleConstructorReturn(this,_getPrototypeOf(SubjectCircle).apply(this,arguments))}_createClass(SubjectCircle,[{key:"getComponents",value:function getComponents(_ref){var _ref$radius=_ref.radius,radius=_ref$radius===void 0?20:_ref$radius,innerRadius=_ref.innerRadius,outerRadius=_ref.outerRadius,radiusPadding=_ref.radiusPadding,editMode=_ref.editMode;var components=(0,_circle.default)({radius:radius,radiusPadding:radiusPadding,innerRadius:innerRadius,outerRadius:outerRadius,editMode:editMode});components.handleKeys={radius:radius,innerRadius:innerRadius,outerRadius:outerRadius};components.handleFunction=function(h,data){return _defineProperty({},h.key,components.handleKeys[h.key]+data.oDeltaX*Math.sqrt(2))};return components}}]);return SubjectCircle}(_Subject2.default);exports.default=SubjectCircle;SubjectCircle.propTypes={radius:_propTypes.default.number,innerRadius:_propTypes.default.number,outerRadius:_propTypes.default.number,radiusPadding:_propTypes.default.number,editMode:_propTypes.default.bool}});var SubjectCircle=unwrapExports(SubjectCircle_1);var SubjectCircle$1=Object.freeze({default:SubjectCircle,__moduleExports:SubjectCircle_1});var require$$0$7=SubjectCircle$1&&SubjectCircle||SubjectCircle$1;var AnnotationCalloutCircle_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationCalloutCircle;var _SubjectCircle=_interopRequireDefault(require$$0$7);var _ConnectorElbow=_interopRequireDefault(require$$1$7);var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationCalloutCircle(props){var className=(0,_classnames.default)("callout circle",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorElbow.default,{lineType:"horizontal"},_SubjectCircle.default,{radius:20})}});var AnnotationCalloutCircle=unwrapExports(AnnotationCalloutCircle_1);var SubjectCustom_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _Subject2=_interopRequireDefault(require$$2$4);var _propTypes=_interopRequireDefault(require$$3);var _Handle=_interopRequireDefault(require$$3$1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var SubjectCustom=function(_Subject){_inherits(SubjectCustom,_Subject);function SubjectCustom(){_classCallCheck(this,SubjectCustom);return _possibleConstructorReturn(this,_getPrototypeOf(SubjectCustom).apply(this,arguments))}_createClass(SubjectCustom,[{key:"render",value:function render(){var _this$props=this.props,_this$props$custom=_this$props.custom,custom=_this$props$custom===void 0?"M0,0":_this$props$custom,editMode=_this$props.editMode,transform=_this$props.transform;var handles;if(editMode){handles=_react.default.createElement(_Handle.default,{handleStart:this.props.dragStart,handleStop:this.props.dragEnd,handleDrag:this.props.dragSubject})}return _react.default.createElement("g",{className:"annotation-subject"},_react.default.createElement("g",{transform:transform},typeof custom==="string"?_react.default.createElement("path",{d:custom,pointerEvents:"none"}):_react.default.createElement("g",{pointerEvents:"none"},custom)),handles)}}]);return SubjectCustom}(_Subject2.default);exports.default=SubjectCustom;SubjectCustom.propTypes={editMode:_propTypes.default.bool}});var SubjectCustom=unwrapExports(SubjectCustom_1);var SubjectCustom$1=Object.freeze({default:SubjectCustom,__moduleExports:SubjectCustom_1});var require$$0$8=SubjectCustom$1&&SubjectCustom||SubjectCustom$1;var AnnotationCalloutCustom_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationCalloutCustom;var _SubjectCustom=_interopRequireDefault(require$$0$8);var _ConnectorElbow=_interopRequireDefault(require$$1$7);var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationCalloutCustom(props){var className=(0,_classnames.default)("callout custom",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorElbow.default,{lineType:"horizontal"},_SubjectCustom.default)}});var AnnotationCalloutCustom=unwrapExports(AnnotationCalloutCustom_1);function cross$3(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function lexicographicOrder(a,b){return a[0]-b[0]||a[1]-b[1]}function computeUpperHullIndexes(points){var n=points.length,indexes=[0,1],size=2;for(var i=2;i<n;++i){while(size>1&&cross$3(points[indexes[size-2]],points[indexes[size-1]],points[i])<=0){--size}indexes[size++]=i}return indexes.slice(0,size)}function polygonHull(points){if((n=points.length)<3)return null;var i,n,sortedPoints=new Array(n),flippedPoints=new Array(n);for(i=0;i<n;++i){sortedPoints[i]=[+points[i][0],+points[i][1],i]}sortedPoints.sort(lexicographicOrder);for(i=0;i<n;++i){flippedPoints[i]=[sortedPoints[i][0],-sortedPoints[i][1]]}var upperIndexes=computeUpperHullIndexes(sortedPoints),lowerIndexes=computeUpperHullIndexes(flippedPoints);var skipLeft=lowerIndexes[0]===upperIndexes[0],skipRight=lowerIndexes[lowerIndexes.length-1]===upperIndexes[upperIndexes.length-1],hull=[];for(i=upperIndexes.length-1;i>=0;--i){hull.push(points[sortedPoints[upperIndexes[i]][2]])}for(i=+skipLeft;i<lowerIndexes.length-skipRight;++i){hull.push(points[sortedPoints[lowerIndexes[i]][2]])}return hull}function Edge(current,next){this.current=current;this.next=next;this._inNormal=this.inwardsNormal();this._outNormal=this.outwardsNormal()}Edge.prototype.outwardsNormal=function(){var inwards=this.inwardsNormal();return[-inwards[0],-inwards[1]]};Edge.prototype.inwardsNormal=function(){var dx=this.next[0]-this.current[0],dy=this.next[1]-this.current[1],edgeLength=Math.sqrt(dx*dx+dy*dy);if(edgeLength===0)throw new Error("Vertices overlap");return[-dy/edgeLength,dx/edgeLength]};Edge.prototype.offset=function(dx,dy){return Edge.offsetEdge(this.current,this.next,dx,dy)};Edge.prototype.inverseOffset=function(dx,dy){return Edge.offsetEdge(this.next,this.current,dx,dy)};Edge.offsetEdge=function(current,next,dx,dy){return new Edge([current[0]+dx,current[1]+dy],[next[0]+dx,next[1]+dy])};Edge.prototype.inverse=function(){return new Edge(this.next,this.current)};var edge=Edge;var edge$1=Object.freeze({default:edge,__moduleExports:edge});var edge_type={NORMAL:0,NON_CONTRIBUTING:1,SAME_TRANSITION:2,DIFFERENT_TRANSITION:3};var edge_type_1=edge_type.NORMAL;var edge_type_2=edge_type.NON_CONTRIBUTING;var edge_type_3=edge_type.SAME_TRANSITION;var edge_type_4=edge_type.DIFFERENT_TRANSITION;var edge_type$1=Object.freeze({default:edge_type,__moduleExports:edge_type,NORMAL:edge_type_1,NON_CONTRIBUTING:edge_type_2,SAME_TRANSITION:edge_type_3,DIFFERENT_TRANSITION:edge_type_4});function TreeBase(){}TreeBase.prototype.clear=function(){this._root=null;this.size=0};TreeBase.prototype.find=function(data){var res=this._root;while(res!==null){var c=this._comparator(data,res.data);if(c===0){return res.data}else{res=res.get_child(c>0)}}return null};TreeBase.prototype.findIter=function(data){var res=this._root;var iter=this.iterator();while(res!==null){var c=this._comparator(data,res.data);if(c===0){iter._cursor=res;return iter}else{iter._ancestors.push(res);res=res.get_child(c>0)}}return null};TreeBase.prototype.lowerBound=function(item){var cur=this._root;var iter=this.iterator();var cmp=this._comparator;while(cur!==null){var c=cmp(item,cur.data);if(c===0){iter._cursor=cur;return iter}iter._ancestors.push(cur);cur=cur.get_child(c>0)}for(var i=iter._ancestors.length-1;i>=0;--i){cur=iter._ancestors[i];if(cmp(item,cur.data)<0){iter._cursor=cur;iter._ancestors.length=i;return iter}}iter._ancestors.length=0;return iter};TreeBase.prototype.upperBound=function(item){var iter=this.lowerBound(item);var cmp=this._comparator;while(iter.data()!==null&&cmp(iter.data(),item)===0){iter.next()}return iter};TreeBase.prototype.min=function(){var res=this._root;if(res===null){return null}while(res.left!==null){res=res.left}return res.data};TreeBase.prototype.max=function(){var res=this._root;if(res===null){return null}while(res.right!==null){res=res.right}return res.data};TreeBase.prototype.iterator=function(){return new Iterator(this)};TreeBase.prototype.each=function(cb){var it=this.iterator(),data;while((data=it.next())!==null){if(cb(data)===false){return}}};TreeBase.prototype.reach=function(cb){var it=this.iterator(),data;while((data=it.prev())!==null){if(cb(data)===false){return}}};function Iterator(tree){this._tree=tree;this._ancestors=[];this._cursor=null}Iterator.prototype.data=function(){return this._cursor!==null?this._cursor.data:null};Iterator.prototype.next=function(){if(this._cursor===null){var root=this._tree._root;if(root!==null){this._minNode(root)}}else{if(this._cursor.right===null){var save;do{save=this._cursor;if(this._ancestors.length){this._cursor=this._ancestors.pop()}else{this._cursor=null;break}}while(this._cursor.right===save)}else{this._ancestors.push(this._cursor);this._minNode(this._cursor.right)}}return this._cursor!==null?this._cursor.data:null};Iterator.prototype.prev=function(){if(this._cursor===null){var root=this._tree._root;if(root!==null){this._maxNode(root)}}else{if(this._cursor.left===null){var save;do{save=this._cursor;if(this._ancestors.length){this._cursor=this._ancestors.pop()}else{this._cursor=null;break}}while(this._cursor.left===save)}else{this._ancestors.push(this._cursor);this._maxNode(this._cursor.left)}}return this._cursor!==null?this._cursor.data:null};Iterator.prototype._minNode=function(start){while(start.left!==null){this._ancestors.push(start);start=start.left}this._cursor=start};Iterator.prototype._maxNode=function(start){while(start.right!==null){this._ancestors.push(start);start=start.right}this._cursor=start};var treebase=TreeBase;var treebase$1=Object.freeze({default:treebase,__moduleExports:treebase});var TreeBase$1=treebase$1&&treebase||treebase$1;function Node$2(data){this.data=data;this.left=null;this.right=null;this.red=true}Node$2.prototype.get_child=function(dir){return dir?this.right:this.left};Node$2.prototype.set_child=function(dir,val){if(dir){this.right=val}else{this.left=val}};function RBTree(comparator){this._root=null;this._comparator=comparator;this.size=0}RBTree.prototype=new TreeBase$1;RBTree.prototype.insert=function(data){var ret=false;if(this._root===null){this._root=new Node$2(data);ret=true;this.size++}else{var head=new Node$2(undefined);var dir=0;var last=0;var gp=null;var ggp=head;var p=null;var node=this._root;ggp.right=this._root;while(true){if(node===null){node=new Node$2(data);p.set_child(dir,node);ret=true;this.size++}else if(is_red(node.left)&&is_red(node.right)){node.red=true;node.left.red=false;node.right.red=false}if(is_red(node)&&is_red(p)){var dir2=ggp.right===gp;if(node===p.get_child(last)){ggp.set_child(dir2,single_rotate(gp,!last))}else{ggp.set_child(dir2,double_rotate(gp,!last))}}var cmp=this._comparator(node.data,data);if(cmp===0){break}last=dir;dir=cmp<0;if(gp!==null){ggp=gp}gp=p;p=node;node=node.get_child(dir)}this._root=head.right}this._root.red=false;return ret};RBTree.prototype.remove=function(data){if(this._root===null){return false}var head=new Node$2(undefined);var node=head;node.right=this._root;var p=null;var gp=null;var found=null;var dir=1;while(node.get_child(dir)!==null){var last=dir;gp=p;p=node;node=node.get_child(dir);var cmp=this._comparator(data,node.data);dir=cmp>0;if(cmp===0){found=node}if(!is_red(node)&&!is_red(node.get_child(dir))){if(is_red(node.get_child(!dir))){var sr=single_rotate(node,dir);p.set_child(last,sr);p=sr}else if(!is_red(node.get_child(!dir))){var sibling=p.get_child(!last);if(sibling!==null){if(!is_red(sibling.get_child(!last))&&!is_red(sibling.get_child(last))){p.red=false;sibling.red=true;node.red=true}else{var dir2=gp.right===p;if(is_red(sibling.get_child(last))){gp.set_child(dir2,double_rotate(p,last))}else if(is_red(sibling.get_child(!last))){gp.set_child(dir2,single_rotate(p,last))}var gpc=gp.get_child(dir2);gpc.red=true;node.red=true;gpc.left.red=false;gpc.right.red=false}}}}}if(found!==null){found.data=node.data;p.set_child(p.right===node,node.get_child(node.left===null));this.size--}this._root=head.right;if(this._root!==null){this._root.red=false}return found!==null};function is_red(node){return node!==null&&node.red}function single_rotate(root,dir){var save=root.get_child(!dir);root.set_child(!dir,save.get_child(dir));save.set_child(dir,root);root.red=true;save.red=false;return save}function double_rotate(root,dir){root.set_child(!dir,single_rotate(root.get_child(!dir),!dir));return single_rotate(root,dir)}var rbtree=RBTree;var rbtree$1=Object.freeze({default:rbtree,__moduleExports:rbtree});function Node$3(data){this.data=data;this.left=null;this.right=null}Node$3.prototype.get_child=function(dir){return dir?this.right:this.left};Node$3.prototype.set_child=function(dir,val){if(dir){this.right=val}else{this.left=val}};function BinTree(comparator){this._root=null;this._comparator=comparator;this.size=0}BinTree.prototype=new TreeBase$1;BinTree.prototype.insert=function(data){if(this._root===null){this._root=new Node$3(data);this.size++;return true}var dir=0;var p=null;var node=this._root;while(true){if(node===null){node=new Node$3(data);p.set_child(dir,node);ret=true;this.size++;return true}if(this._comparator(node.data,data)===0){return false}dir=this._comparator(node.data,data)<0;p=node;node=node.get_child(dir)}};BinTree.prototype.remove=function(data){if(this._root===null){return false}var head=new Node$3(undefined);var node=head;node.right=this._root;var p=null;var found=null;var dir=1;while(node.get_child(dir)!==null){p=node;node=node.get_child(dir);var cmp=this._comparator(data,node.data);dir=cmp>0;if(cmp===0){found=node}}if(found!==null){found.data=node.data;p.set_child(p.right===node,node.get_child(node.left===null));this._root=head.right;this.size--;return true}else{return false}};var bintree=BinTree;var bintree$1=Object.freeze({default:bintree,__moduleExports:bintree});var require$$0$9=rbtree$1&&rbtree||rbtree$1;var require$$1$f=bintree$1&&bintree||bintree$1;var bintrees={RBTree:require$$0$9,BinTree:require$$1$f};var bintrees_1=bintrees.RBTree;var bintrees_2=bintrees.BinTree;var bintrees$1=Object.freeze({default:bintrees,__moduleExports:bintrees,RBTree:bintrees_1,BinTree:bintrees_2});var signed_area=function signedArea(p0,p1,p2){return(p0[0]-p2[0])*(p1[1]-p2[1])-(p1[0]-p2[0])*(p0[1]-p2[1])};var signed_area$1=Object.freeze({default:signed_area,__moduleExports:signed_area});var signedArea=signed_area$1&&signed_area||signed_area$1;var edgeType=edge_type$1&&edge_type||edge_type$1;function SweepEvent(point,left,otherEvent,isSubject,edgeType$1){this.left=left;this.point=point;this.otherEvent=otherEvent;this.isSubject=isSubject;this.type=edgeType$1||edgeType.NORMAL;this.inOut=false;this.otherInOut=false;this.prevInResult=null;this.inResult=false;this.resultInOut=false}SweepEvent.prototype={isBelow:function isBelow(p){return this.left?signedArea(this.point,this.otherEvent.point,p)>0:signedArea(this.otherEvent.point,this.point,p)>0},isAbove:function isAbove(p){return!this.isBelow(p)},isVertical:function isVertical(){return this.point[0]===this.otherEvent.point[0]}};var sweep_event=SweepEvent;var sweep_event$1=Object.freeze({default:sweep_event,__moduleExports:sweep_event});var compare_events=function sweepEventsComp(e1,e2){var p1=e1.point;var p2=e2.point;if(p1[0]>p2[0])return 1;if(p1[0]<p2[0])return-1;if(p1[1]!==p2[1])return p1[1]>p2[1]?1:-1;return specialCases(e1,e2,p1)};function specialCases(e1,e2,p1,p2){if(e1.left!==e2.left)return e1.left?1:-1;if(signedArea(p1,e1.otherEvent.point,e2.otherEvent.point)!==0){return!e1.isBelow(e2.otherEvent.point)?1:-1}return!e1.isSubject&&e2.isSubject?1:-1}var compare_events$1=Object.freeze({default:compare_events,__moduleExports:compare_events});var equals=function equals(p1,p2){return p1[0]===p2[0]&&p1[1]===p2[1]};var equals$1=Object.freeze({default:equals,__moduleExports:equals});var compareEvents=compare_events$1&&compare_events||compare_events$1;var equals$2=equals$1&&equals||equals$1;var compare_segments=function compareSegments(le1,le2){if(le1===le2)return 0;if(signedArea(le1.point,le1.otherEvent.point,le2.point)!==0||signedArea(le1.point,le1.otherEvent.point,le2.otherEvent.point)!==0){if(equals$2(le1.point,le2.point))return le1.isBelow(le2.otherEvent.point)?-1:1;if(le1.point[0]===le2.point[0])return le1.point[1]<le2.point[1]?-1:1;if(compareEvents(le1,le2)===1)return le2.isAbove(le1.point)?-1:1;return le1.isBelow(le2.point)?-1:1}if(le1.isSubject===le2.isSubject){if(equals$2(le1.point,le2.point)){if(equals$2(le1.otherEvent.point,le2.otherEvent.point)){return 0}else{return le1.contourId>le2.contourId?1:-1}}}else{return le1.isSubject?-1:1}return compareEvents(le1,le2)===1?1:-1};var compare_segments$1=Object.freeze({default:compare_segments,__moduleExports:compare_segments});var EPSILON=1e-9;function krossProduct(a,b){return a[0]*b[1]-a[1]*b[0]}function dotProduct(a,b){return a[0]*b[0]+a[1]*b[1]}var segment_intersection=function segment_intersection(a1,a2,b1,b2,noEndpointTouch){var va=[a2[0]-a1[0],a2[1]-a1[1]];var vb=[b2[0]-b1[0],b2[1]-b1[1]];function toPoint(p,s,d){return[p[0]+s*d[0],p[1]+s*d[1]]}var e=[b1[0]-a1[0],b1[1]-a1[1]];var kross=krossProduct(va,vb);var sqrKross=kross*kross;var sqrLenA=dotProduct(va,va);var sqrLenB=dotProduct(vb,vb);if(sqrKross>EPSILON*sqrLenA*sqrLenB){var s=krossProduct(e,vb)/kross;if(s<0||s>1){return null}var t=krossProduct(e,va)/kross;if(t<0||t>1){return null}return noEndpointTouch?null:[toPoint(a1,s,va)]}var sqrLenE=dotProduct(e,e);kross=krossProduct(e,va);sqrKross=kross*kross;if(sqrKross>EPSILON*sqrLenA*sqrLenE){return null}var sa=dotProduct(va,e)/sqrLenA;var sb=sa+dotProduct(va,vb)/sqrLenA;var smin=Math.min(sa,sb);var smax=Math.max(sa,sb);if(smin<=1&&smax>=0){if(smin===1){return noEndpointTouch?null:[toPoint(a1,smin>0?smin:0,va)]}if(smax===0){return noEndpointTouch?null:[toPoint(a1,smax<1?smax:1,va)]}if(noEndpointTouch&&smin===0&&smax===1)return null;return[toPoint(a1,smin>0?smin:0,va),toPoint(a1,smax<1?smax:1,va)]}return null};var segment_intersection$1=Object.freeze({default:segment_intersection,__moduleExports:segment_intersection});var require$$0$a=bintrees$1&&bintrees||bintrees$1;var SweepEvent$1=sweep_event$1&&sweep_event||sweep_event$1;var compareSegments=compare_segments$1&&compare_segments||compare_segments$1;var intersection=segment_intersection$1&&segment_intersection||segment_intersection$1;var INTERSECTION=0;var UNION=1;var DIFFERENCE=2;var XOR=3;var EMPTY=[];var Tree=require$$0$a.RBTree;var max$3=Math.max;var min$3=Math.min;function processSegment(s1,s2,isSubject,depth,eventQueue,bbox){var e1=new SweepEvent$1(s1,false,undefined,isSubject);var e2=new SweepEvent$1(s2,false,e1,isSubject);e1.otherEvent=e2;e1.contourId=e2.contourId=depth;if(compareEvents(e1,e2)>0){e2.left=true}else{e1.left=true}bbox[0]=min$3(bbox[0],s1[0]);bbox[1]=min$3(bbox[1],s1[1]);bbox[2]=max$3(bbox[2],s1[0]);bbox[3]=max$3(bbox[3],s1[1]);eventQueue.push(e1);eventQueue.push(e2)}var contourId=0;function processPolygon(polygon,isSubject,depth,queue,bbox){var i,len;if(typeof polygon[0][0]==="number"){for(i=0,len=polygon.length-1;i<len;i++){processSegment(polygon[i],polygon[i+1],isSubject,depth+1,queue,bbox)}}else{for(i=0,len=polygon.length;i<len;i++){contourId++;processPolygon(polygon[i],isSubject,contourId,queue,bbox)}}}function fillQueue(subject,clipping,sbbox,cbbox){var eventQueue=new Queue(null,compareEvents);contourId=0;processPolygon(subject,true,0,eventQueue,sbbox);processPolygon(clipping,false,0,eventQueue,cbbox);return eventQueue}function computeFields(event,prev,sweepLine,operation){if(prev===null){event.inOut=false;event.otherInOut=true}else if(event.isSubject===prev.isSubject){event.inOut=!prev.inOut;event.otherInOut=prev.otherInOut}else{event.inOut=!prev.otherInOut;event.otherInOut=prev.isVertical()?!prev.inOut:prev.inOut}if(prev){event.prevInResult=!inResult(prev,operation)||prev.isVertical()?prev.prevInResult:prev}event.inResult=inResult(event,operation)}function inResult(event,operation){switch(event.type){case edgeType.NORMAL:switch(operation){case INTERSECTION:return!event.otherInOut;case UNION:return event.otherInOut;case DIFFERENCE:return event.isSubject&&event.otherInOut||!event.isSubject&&!event.otherInOut;case XOR:return true}case edgeType.SAME_TRANSITION:return operation===INTERSECTION||operation===UNION;case edgeType.DIFFERENT_TRANSITION:return operation===DIFFERENCE;case edgeType.NON_CONTRIBUTING:return false}return false}function possibleIntersection(se1,se2,queue){var inter=intersection(se1.point,se1.otherEvent.point,se2.point,se2.otherEvent.point);var nintersections=inter?inter.length:0;if(nintersections===0)return 0;if(nintersections===1&&(equals$2(se1.point,se2.point)||equals$2(se1.otherEvent.point,se2.otherEvent.point))){return 0}if(nintersections===2&&se1.isSubject===se2.isSubject){if(se1.contourId===se2.contourId){console.warn("Edges of the same polygon overlap",se1.point,se1.otherEvent.point,se2.point,se2.otherEvent.point)}return 0}if(nintersections===1){if(!equals$2(se1.point,inter[0])&&!equals$2(se1.otherEvent.point,inter[0])){divideSegment(se1,inter[0],queue)}if(!equals$2(se2.point,inter[0])&&!equals$2(se2.otherEvent.point,inter[0])){divideSegment(se2,inter[0],queue)}return 1}var events=[];var leftCoincide=false;var rightCoincide=false;if(equals$2(se1.point,se2.point)){leftCoincide=true}else if(compareEvents(se1,se2)===1){events.push(se2,se1)}else{events.push(se1,se2)}if(equals$2(se1.otherEvent.point,se2.otherEvent.point)){rightCoincide=true}else if(compareEvents(se1.otherEvent,se2.otherEvent)===1){events.push(se2.otherEvent,se1.otherEvent)}else{events.push(se1.otherEvent,se2.otherEvent)}if(leftCoincide&&rightCoincide||leftCoincide){se1.type=edgeType.NON_CONTRIBUTING;se2.type=se1.inOut===se2.inOut?edgeType.SAME_TRANSITION:edgeType.DIFFERENT_TRANSITION;if(leftCoincide&&!rightCoincide){divideSegment(events[0].otherEvent,events[1].point,queue)}return 2}if(rightCoincide){divideSegment(events[0],events[1].point,queue);return 3}if(events[0]!==events[3].otherEvent){divideSegment(events[0],events[1].point,queue);divideSegment(events[1],events[2].point,queue);return 3}divideSegment(events[0],events[1].point,queue);divideSegment(events[3].otherEvent,events[2].point,queue);return 3}function divideSegment(se,p,queue){var r=new SweepEvent$1(p,false,se,se.isSubject);var l=new SweepEvent$1(p,true,se.otherEvent,se.isSubject);if(equals$2(se.point,se.otherEvent.point)){console.warn("what is that?",se)}r.contourId=l.contourId=se.contourId;if(compareEvents(l,se.otherEvent)>0){se.otherEvent.left=true;l.left=false}se.otherEvent.otherEvent=l;se.otherEvent=r;queue.push(l);queue.push(r);return queue}function subdivideSegments(eventQueue,subject,clipping,sbbox,cbbox,operation){var sortedEvents=[];var prev,next;var sweepLine=new Tree(compareSegments);var sortedEvents=[];var rightbound=min$3(sbbox[2],cbbox[2]);var prev,next;while(eventQueue.length){var event=eventQueue.pop();sortedEvents.push(event);if(operation===INTERSECTION&&event.point[0]>rightbound||operation===DIFFERENCE&&event.point[0]>sbbox[2]){break}if(event.left){sweepLine.insert(event);next=sweepLine.findIter(event);prev=sweepLine.findIter(event);event.iterator=sweepLine.findIter(event);if(!prev||!next){console.log("brute");var iterators=findIterBrute(sweepLine);prev=iterators[0];next=iterators[1]}if(prev.data()!==sweepLine.min()){prev.prev()}else{prev=sweepLine.iterator();prev.prev();prev.next()}next.next();computeFields(event,prev.data(),sweepLine,operation);if(next.data()){if(possibleIntersection(event,next.data(),eventQueue)===2){computeFields(event,prev.data(),sweepLine,operation);computeFields(event,next.data(),sweepLine,operation)}}if(prev.data()){if(possibleIntersection(prev.data(),event,eventQueue)===2){var prevprev=sweepLine.findIter(prev.data());if(prevprev.data()!==sweepLine.min()){prevprev.prev()}else{prevprev=sweepLine.findIter(sweepLine.max());prevprev.next()}computeFields(prev.data(),prevprev.data(),sweepLine,operation);computeFields(event,prev.data(),sweepLine,operation)}}}else{event=event.otherEvent;next=sweepLine.findIter(event);prev=sweepLine.findIter(event);if(!(prev&&next))continue;if(prev.data()!==sweepLine.min()){prev.prev()}else{prev=sweepLine.iterator();prev.prev();prev.next()}next.next();sweepLine.remove(event);if(next.data()&&prev.data()){possibleIntersection(prev.data(),next.data(),eventQueue)}}}return sortedEvents}function findIterBrute(sweepLine,q){var prev=sweepLine.iterator();var next=sweepLine.iterator();var it=sweepLine.iterator(),data;while((data=it.next())!==null){prev.next();next.next();if(data===event){break}}return[prev,next]}function swap$1(arr,i,n){var temp=arr[i];arr[i]=arr[n];arr[n]=temp}function changeOrientation(contour){return contour.reverse()}function isArray$3(arr){return Object.prototype.toString.call(arr)==="[object Array]"}function addHole(contour,idx){if(isArray$3(contour[0])&&!isArray$3(contour[0][0])){contour=[contour]}contour[idx]=[];return contour}function orderEvents(sortedEvents){var event,i,len;var resultEvents=[];for(i=0,len=sortedEvents.length;i<len;i++){event=sortedEvents[i];if(event.left&&event.inResult||!event.left&&event.otherEvent.inResult){resultEvents.push(event)}}var sorted=false;while(!sorted){sorted=true;for(i=0,len=resultEvents.length;i<len;i++){if(i+1<len&&compareEvents(resultEvents[i],resultEvents[i+1])===1){swap$1(resultEvents,i,i+1);sorted=false}}}for(i=0,len=resultEvents.length;i<len;i++){resultEvents[i].pos=i}for(i=0,len=resultEvents.length;i<len;i++){if(!resultEvents[i].left){var temp=resultEvents[i].pos;resultEvents[i].pos=resultEvents[i].otherEvent.pos;resultEvents[i].otherEvent.pos=temp}}return resultEvents}function connectEdges(sortedEvents){var i,len;var resultEvents=orderEvents(sortedEvents);var processed=Array(resultEvents.length);var result=[];var depth=[];var holeOf=[];var isHole={};for(i=0,len=resultEvents.length;i<len;i++){if(processed[i])continue;var contour=[];result.push(contour);var ringId=result.length-1;depth.push(0);holeOf.push(-1);if(resultEvents[i].prevInResult){var lowerContourId=resultEvents[i].prevInResult.contourId;if(!resultEvents[i].prevInResult.resultInOut){addHole(result[lowerContourId],ringId);holeOf[ringId]=lowerContourId;depth[ringId]=depth[lowerContourId]+1;isHole[ringId]=true}else if(isHole[lowerContourId]){addHole(result[holeOf[lowerContourId]],ringId);holeOf[ringId]=holeOf[lowerContourId];depth[ringId]=depth[lowerContourId];isHole[ringId]=true}}var pos=i;var initial=resultEvents[i].point;contour.push(initial);while(pos>=i){processed[pos]=true;if(resultEvents[pos].left){resultEvents[pos].resultInOut=false;resultEvents[pos].contourId=ringId}else{resultEvents[pos].otherEvent.resultInOut=true;resultEvents[pos].otherEvent.contourId=ringId}pos=resultEvents[pos].pos;processed[pos]=true;contour.push(resultEvents[pos].point);pos=nextPos(pos,resultEvents,processed)}pos=pos===-1?i:pos;processed[pos]=processed[resultEvents[pos].pos]=true;resultEvents[pos].otherEvent.resultInOut=true;resultEvents[pos].otherEvent.contourId=ringId;if(depth[ringId]&1){changeOrientation(contour)}}return result}function nextPos(pos,resultEvents,processed){var newPos=pos+1;var length=resultEvents.length;while(newPos<length&&equals$2(resultEvents[newPos].point,resultEvents[pos].point)){if(!processed[newPos]){return newPos}else{newPos=newPos+1}}newPos=pos-1;while(processed[newPos]){newPos=newPos-1}return newPos}function trivialOperation(subject,clipping,operation){var result=null;if(subject.length*clipping.length===0){if(operation===INTERSECTION){result=EMPTY}else if(operation===DIFFERENCE){result=subject}else if(operation===UNION||operation===XOR){result=subject.length===0?clipping:subject}}return result}function compareBBoxes(subject,clipping,sbbox,cbbox,operation){var result=null;if(sbbox[0]>cbbox[2]||cbbox[0]>sbbox[2]||sbbox[1]>cbbox[3]||cbbox[1]>sbbox[3]){if(operation===INTERSECTION){result=EMPTY}else if(operation===DIFFERENCE){result=subject}else if(operation===UNION||operation===XOR){result=subject.concat(clipping)}}return result}function boolean(subject,clipping,operation){var trivial=trivialOperation(subject,clipping,operation);if(trivial){return trivial===EMPTY?null:trivial}var sbbox=[Infinity,Infinity,-Infinity,-Infinity];var cbbox=[Infinity,Infinity,-Infinity,-Infinity];var eventQueue=fillQueue(subject,clipping,sbbox,cbbox);trivial=compareBBoxes(subject,clipping,sbbox,cbbox,operation);if(trivial){return trivial===EMPTY?null:trivial}var sortedEvents=subdivideSegments(eventQueue,subject,clipping,sbbox,cbbox,operation);return connectEdges(sortedEvents)}var src$5=boolean;var union=function union(subject,clipping){return boolean(subject,clipping,UNION)};var diff=function diff(subject,clipping){return boolean(subject,clipping,DIFFERENCE)};var xor=function xor(subject,clipping){return boolean(subject,clipping,XOR)};var intersection_1=function intersection_1(subject,clipping){return boolean(subject,clipping,INTERSECTION)};var operations={INTERSECTION:INTERSECTION,DIFFERENCE:DIFFERENCE,UNION:UNION,XOR:XOR};var fillQueue_1=fillQueue;var computeFields_1=computeFields;var subdivideSegments_1=subdivideSegments;var divideSegment_1=divideSegment;var possibleIntersection_1=possibleIntersection;src$5.union=union;src$5.diff=diff;src$5.xor=xor;src$5.intersection=intersection_1;src$5.operations=operations;src$5.fillQueue=fillQueue_1;src$5.computeFields=computeFields_1;src$5.subdivideSegments=subdivideSegments_1;src$5.divideSegment=divideSegment_1;src$5.possibleIntersection=possibleIntersection_1;var src$6=Object.freeze({default:src$5,__moduleExports:src$5,union:union,diff:diff,xor:xor,intersection:intersection_1,operations:operations,fillQueue:fillQueue_1,computeFields:computeFields_1,subdivideSegments:subdivideSegments_1,divideSegment:divideSegment_1,possibleIntersection:possibleIntersection_1});var require$$0$b=src$6&&src$5||src$6;var martinezPolygonClipping=require$$0$b;var martinezPolygonClipping$1=Object.freeze({default:martinezPolygonClipping,__moduleExports:martinezPolygonClipping});var utils$1=createCommonjsModule(function(module){var isArray=module.exports.isArray=Array.isArray||function(arr){return Object.prototype.toString.call(arr)==="[object Array]"};module.exports.equals=function equals(p1,p2){return p1[0]===p2[0]&&p1[1]===p2[1]};module.exports.orientRings=function orientRings(coordinates,depth,isHole){depth=depth||0;var i,len;if(isArray(coordinates)&&typeof coordinates[0][0]==="number"){var area=0;var ring=coordinates;for(i=0,len=ring.length;i<len;i++){var pt1=ring[i];var pt2=ring[(i+1)%len];area+=pt1[0]*pt2[1];area-=pt2[0]*pt1[1]}if(!isHole&&area>0||isHole&&area<0){ring.reverse()}}else{for(i=0,len=coordinates.length;i<len;i++){orientRings(coordinates[i],depth+1,i>0)}}return coordinates}});var utils_1=utils$1.isArray;var utils_2=utils$1.equals;var utils_3=utils$1.orientRings;var utils$2=Object.freeze({default:utils$1,__moduleExports:utils$1,isArray:utils_1,equals:utils_2,orientRings:utils_3});var Edge$1=edge$1&&edge||edge$1;var martinez=martinezPolygonClipping$1&&martinezPolygonClipping||martinezPolygonClipping$1;var utils$3=utils$2&&utils$1||utils$2;var isArray$4=utils$3.isArray;var equals$3=utils$3.equals;var orientRings=utils$3.orientRings;function Offset(vertices,arcSegments){this.vertices=null;this.edges=null;this._closed=false;this._distance=0;if(vertices){this.data(vertices)}this._arcSegments=arcSegments!==undefined?arcSegments:5}Offset.prototype.data=function(vertices){this._edges=[];if(!isArray$4(vertices)){throw new Error("Offset requires at least one coodinate to work with")}if(isArray$4(vertices)&&typeof vertices[0]==="number"){this.vertices=vertices}else{this.vertices=orientRings(vertices);this._processContour(this.vertices,this._edges)}return this};Offset.prototype._processContour=function(contour,edges){var i,len;if(isArray$4(contour[0])&&typeof contour[0][0]==="number"){len=contour.length;if(equals$3(contour[0],contour[len-1])){len-=1}for(i=0;i<len;i++){edges.push(new Edge$1(contour[i],contour[(i+1)%len]))}}else{for(i=0,len=contour.length;i<len;i++){edges.push([]);this._processContour(contour[i],edges[edges.length-1])}}};Offset.prototype.arcSegments=function(arcSegments){this._arcSegments=arcSegments;return this};Offset.prototype.validate=function(vertices){var len=vertices.length;if(typeof vertices[0]==="number")return[vertices];if(vertices[0][0]===vertices[len-1][0]&&vertices[0][1]===vertices[len-1][1]){if(len>1){vertices=vertices.slice(0,len-1);this._closed=true}}return vertices};Offset.prototype.createArc=function(vertices,center,radius,startVertex,endVertex,segments,outwards){var PI2=Math.PI*2,startAngle=Math.atan2(startVertex[1]-center[1],startVertex[0]-center[0]),endAngle=Math.atan2(endVertex[1]-center[1],endVertex[0]-center[0]);if(segments%2===0){segments-=1}if(startAngle<0){startAngle+=PI2}if(endAngle<0){endAngle+=PI2}var angle=startAngle>endAngle?startAngle-endAngle:startAngle+PI2-endAngle,segmentAngle=(outwards?-angle:PI2-angle)/segments;vertices.push(startVertex);for(var i=1;i<segments;++i){angle=startAngle+segmentAngle*i;vertices.push([center[0]+Math.cos(angle)*radius,center[1]+Math.sin(angle)*radius])}vertices.push(endVertex);return vertices};Offset.prototype.distance=function(dist,units){this._distance=dist||0;return this};Offset.degreesToUnits=function(degrees,units){switch(units){case"miles":degrees=degrees/69.047;break;case"feet":degrees=degrees/364568;break;case"kilometers":degrees=degrees/111.12;break;case"meters":case"metres":degrees=degrees/111120;break;case"degrees":case"pixels":default:break}return degrees};Offset.prototype.ensureLastPoint=function(vertices){if(!equals$3(vertices[0],vertices[vertices.length-1])){vertices.push([vertices[0][0],vertices[0][1]])}return vertices};Offset.prototype.offset=function(dist){this.distance(dist);return this._distance===0?this.vertices:this._distance>0?this.margin(this._distance):this.padding(-this._distance)};Offset.prototype._offsetSegment=function(v1,v2,e1,dist){var vertices=[];var offsets=[e1.offset(e1._inNormal[0]*dist,e1._inNormal[1]*dist),e1.inverseOffset(e1._outNormal[0]*dist,e1._outNormal[1]*dist)];for(var i=0,len=2;i<len;i++){var thisEdge=offsets[i],prevEdge=offsets[(i+len-1)%len];this.createArc(vertices,i===0?v1:v2,dist,prevEdge.next,thisEdge.current,this._arcSegments,true)}return vertices};Offset.prototype.margin=function(dist){this.distance(dist);if(typeof this.vertices[0]==="number"){return this.offsetPoint(this._distance)}if(dist===0)return this.vertices;var union=this.offsetLines(this._distance);union=martinez.union(this.vertices,union);return orientRings(union)};Offset.prototype.padding=function(dist){this.distance(dist);if(this._distance===0)return this.ensureLastPoint(this.vertices);if(this.vertices.length===2&&typeof this.vertices[0]==="number"){return this.vertices}var union=this.offsetLines(this._distance);var diff=martinez.diff(this.vertices,union);return orientRings(diff)};Offset.prototype.offsetLine=function(dist){if(dist===0)return this.vertices;return orientRings(this.offsetLines(dist))};Offset.prototype.offsetLines=function(dist){if(dist<0)throw new Error("Cannot apply negative margin to the line");var union;this.distance(dist);if(isArray$4(this.vertices[0])&&typeof this.vertices[0][0]!=="number"){for(var i=0,len=this._edges.length;i<len;i++){union=i===0?this.offsetContour(this.vertices[i],this._edges[i]):martinez.union(union,this.offsetContour(this.vertices[i],this._edges[i]))}}else{union=this.vertices.length===1?this.offsetPoint():this.offsetContour(this.vertices,this._edges)}return union};Offset.prototype.offsetContour=function(curve,edges){var union,i,len;if(isArray$4(curve[0])&&typeof curve[0][0]==="number"){for(i=0,len=curve.length-1;i<len;i++){var segment=this.ensureLastPoint(this._offsetSegment(curve[i],curve[i+1],edges[i],this._distance));union=i===0?[this.ensureLastPoint(segment)]:martinez.union(union,this.ensureLastPoint(segment))}}else{for(i=0,len=edges.length;i<len;i++){union=i===0?this.offsetContour(curve[i],edges[i]):martinez.union(union,this.offsetContour(curve[i],edges[i]))}}return union};Offset.prototype.offsetPoint=function(distance){this.distance(distance);var vertices=this._arcSegments*2;var points=[];var center=this.vertices;var radius=this._distance;var angle=0;if(vertices%2===0)vertices++;for(var i=0;i<vertices;i++){angle+=2*Math.PI/vertices;points.push([center[0]+radius*Math.cos(angle),center[1]+radius*Math.sin(angle)])}return orientRings([this.ensureLastPoint(points)])};Offset.orientRings=orientRings;var offset=Offset;var circleEnclosure=function(_a){var d=_a.d,i=_a.i,circle=_a.circle;var _b=d.padding,padding=_b===void 0?2:_b,_c=d.radiusPadding,radiusPadding=_c===void 0?padding:_c,label=d.label;var noteData=Object.assign({dx:0,dy:0,note:{label:label},connector:{end:"arrow"}},d,{coordinates:undefined,x:circle.x,y:circle.y,type:AnnotationCalloutCircle,subject:{radius:circle.r,radiusPadding:radiusPadding},i:i});if(noteData.rp){switch(noteData.rp){case"top":noteData.dx=0;noteData.dy=-circle.r-noteData.rd;break;case"bottom":noteData.dx=0;noteData.dy=circle.r+noteData.rd;break;case"left":noteData.dx=-circle.r-noteData.rd;noteData.dy=0;break;default:noteData.dx=circle.r+noteData.rd;noteData.dy=0}}return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var rectangleEnclosure=function(_a){var bboxNodes=_a.bboxNodes,d=_a.d,i=_a.i;var _b=d.padding,padding=_b===void 0?0:_b,_c=d.dx,dx=_c===void 0?-25:_c,_d=d.dy,dy=_d===void 0?-25:_d,label=d.label;var bbox=[[Math.min.apply(Math,__spread(bboxNodes.map(function(p){return p.x0})))-padding,Math.min.apply(Math,__spread(bboxNodes.map(function(p){return p.y0})))-padding],[Math.max.apply(Math,__spread(bboxNodes.map(function(p){return p.x1})))+padding,Math.max.apply(Math,__spread(bboxNodes.map(function(p){return p.y1})))+padding]];var noteData=Object.assign({dx:dx,dy:dy,note:{label:label},connector:{end:"arrow"}},d,{type:AnnotationCalloutRect,x:bbox[0][0],y:bbox[0][1],subject:{width:bbox[1][0]-bbox[0][0],height:bbox[1][1]-bbox[0][1]}});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var hullEnclosure=function(_a){var points=_a.points,d=_a.d,i=_a.i;var _b=d.color,color=_b===void 0?"black":_b,_c=d.dx,dx=_c===void 0?-25:_c,_d=d.dy,dy=_d===void 0?-25:_d,label=d.label,_e=d.padding,padding=_e===void 0?10:_e,_f=d.buffer,buffer=_f===void 0?padding:_f,_g=d.strokeWidth,strokeWidth=_g===void 0?10:_g;var hullPoints=polygonHull(points);var offset$1=new offset;var bufferedHull=offset$1.data(__spread(hullPoints,[hullPoints[0]])).margin(buffer)[0];var hullD="M"+bufferedHull.map(function(d){return d.join(",")}).join("L")+"Z";var firstCoord=bufferedHull[0];var _h=d.nx,nx=_h===void 0?firstCoord[0]+dx:_h,_j=d.ny,ny=_j===void 0?firstCoord[1]+dy:_j;var closestCoordinates=bufferedHull.reduce(function(p,c){if(Math.hypot(nx-p[0],ny-p[1])>Math.hypot(nx-c[0],ny-c[1])){p=c}return p},firstCoord);var noteData=Object.assign({dx:dx,dy:dy,note:{label:label},connector:{end:"arrow"}},d,{type:AnnotationCalloutCustom,x:closestCoordinates[0],y:closestCoordinates[1],subject:{custom:[React.createElement("path",{key:"hull-drawing",d:hullD,strokeWidth:strokeWidth,strokeMiterlimit:"10",strokeLinejoin:"miter",strokeLinecap:"butt",fill:"none",stroke:color,transform:"translate("+-closestCoordinates[0]+","+-closestCoordinates[1]+")"})],customID:"hull-annotation"}});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var desaturationLayer=function(_a){var _b=_a.style,style=_b===void 0?{fill:"white",fillOpacity:.5}:_b,size=_a.size,i=_a.i,key=_a.key;return React.createElement("rect",{key:key||"desaturation-"+i,x:-5,y:-5,width:size[0]+10,height:size[1]+10,style:style})};var pointsAlong=function(along){return function(_a){var d=_a.d,lines=_a.lines,points=_a.points,xScale=_a.xScale,yScale=_a.yScale,pointStyle=_a.pointStyle;var alongScale=along==="x"?xScale:yScale;along=along==="yTop"&&d.yMiddle?"yMiddle":along;if(d&&d[along]){var _b=d.threshold,threshold=_b===void 0?1:_b,_c=d.r,r_1=_c===void 0?function(){return 4}:_c,_d=d.styleFn,styleFn_1=_d===void 0?pointStyle:_d;var foundPoints_1=[];var halfThreshold_1=threshold/2;if(lines&&lines.length>0){lines.forEach(function(linedata){var linePoints=linedata.data.filter(function(p){var pAlong=alongScale(p[along]);var dAlong=alongScale(d[along]);return pAlong<=dAlong+halfThreshold_1&&pAlong>=dAlong-halfThreshold_1});foundPoints_1.push.apply(foundPoints_1,__spread(linePoints))})}if(points&&points.length>0){var pointPoints=points.filter(function(p){var pAlong=alongScale(p[along]);var dAlong=alongScale(d[along]);return pAlong<=dAlong+halfThreshold_1&&pAlong>=dAlong-halfThreshold_1});foundPoints_1.push.apply(foundPoints_1,__spread(pointPoints))}return foundPoints_1.map(function(p,i){return React.createElement("circle",{key:"found-circle-"+i,r:r_1(p,i),style:styleFn_1(p,i),cx:xScale(p.xMiddle||p.x),cy:yScale(p.yMiddle||p.yTop)})})}return null}};var svgHorizontalPointsAnnotation=pointsAlong("yTop");var svgVerticalPointsAnnotation=pointsAlong("x");var svgHighlight=function(_a){var d=_a.d,i=_a.i,_b=_a.points,points=_b===void 0?{data:[]}:_b,_c=_a.lines,lines=_c===void 0?{data:[],type:{}}:_c,_d=_a.summaries,summaries=_d===void 0?{data:[]}:_d,idAccessor=_a.idAccessor,xScale=_a.xScale,yScale=_a.yScale,xyFrameRender=_a.xyFrameRender,defined=_a.defined;var dID;var baseID=idAccessor(__assign({},d,d.data),i);if(baseID!==undefined){dID=baseID}else if(d.parentLine&&idAccessor(d.parentLine,i)!==undefined){dID=idAccessor(d.parentLine,i)}else if(d.parentSummary&&idAccessor(d.parentSummary,i)!==undefined){dID=idAccessor(d.parentSummary,i)}var foundPoints=points.data.filter(function(p,q){return idAccessor(__assign({},p,p.data),q)===dID}).map(function(p,q){var baseStyle=xyFrameRender.points.styleFn(__assign({},p,p.data));var highlightStyle=typeof d.style==="function"?d.style(__assign({},p,p.data),q):d.style||{};return React.createElement("circle",{key:"highlight-point-"+q,cx:xScale(p.x),cy:yScale(p.y),r:5,fill:"none",stroke:"black",strokeWidth:2,style:__assign({},baseStyle,highlightStyle),className:"highlight-annotation "+(d.class&&typeof d.class==="function"&&d.class(__assign({},p,p.data),q)||d.class&&d.class||"")})});var lineGenerator=area$1().x(function(p){return xScale(p.x)}).y0(function(p){return yScale(p.yBottom)}).y1(function(p){return yScale(p.yTop)});var interpolatorSetting=lines.type.interpolator||lines.type.curve;var actualInterpolator=typeof interpolatorSetting==="string"?curveHash[interpolatorSetting]:interpolatorSetting;if(actualInterpolator){lineGenerator.curve(actualInterpolator)}if(defined){lineGenerator.defined(function(p,q){return defined(p.data,q)})}var foundLines=lines.data.filter(function(p,q){return idAccessor(p,q)===dID}).map(function(p,q){var baseStyle=xyFrameRender.lines.styleFn(p,q);var highlightStyle=typeof d.style==="function"?d.style(p,q):d.style||{};return React.createElement("path",{className:"highlight-annotation "+(d.class&&typeof d.class==="function"&&d.class(p,q)||d.class&&d.class||""),key:"highlight-summary-"+q,d:lineGenerator(p.data),fill:"none",stroke:"black",strokeWidth:1,style:__assign({},baseStyle,highlightStyle)})});var foundSummaries=summaries.data.filter(function(p,q){return idAccessor(p,q)===dID}).map(function(p,q){var baseStyle=xyFrameRender.summaries.styleFn(p,q);var highlightStyle=typeof d.style==="function"?d.style(p,q):d.style||{};return React.createElement("path",{className:"highlight-annotation "+(d.class&&typeof d.class==="function"&&d.class(p,q)||d.class&&d.class||""),key:"highlight-summary-"+q,d:"M"+p.coordinates.join("L"),fill:"none",stroke:"black",strokeWidth:1,style:__assign({},baseStyle,highlightStyle)})});return __spread(foundSummaries,foundLines,foundPoints)};var svgXYAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,i=_a.i,d=_a.d;var inlineStyle;if(d.color)inlineStyle={fill:d.color};var laLine=React.createElement(lib_2,{className:"annotation "+d.type+" "+(d.className||"")+" ",key:"annotationpoint"+i,markType:"circle",cx:screenCoordinates[0],cy:screenCoordinates[1],forceUpdate:true,style:inlineStyle,fill:"none",stroke:"black",r:5});var laLabel;if(d.type==="xy"){laLabel=React.createElement(lib_2,{markType:"text",key:d.label+"annotationtext"+i,forceUpdate:true,x:screenCoordinates[0],y:10+screenCoordinates[1],className:"annotation annotation-xy-label "+(d.className||"")+" "},d.label)}return[laLine,laLabel]};var basicReactAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,i=_a.i;var noteData=Object.assign({dx:0,dy:0,note:{label:d.label,orientation:d.orientation,align:d.align},connector:{end:"arrow"}},d,{type:d.type,screenCoordinates:screenCoordinates,i:i});noteData.x=noteData.fixedX?noteData.fixedX:screenCoordinates[0];noteData.y=noteData.fixedY?noteData.fixedY:screenCoordinates[1];return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgXAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,i=_a.i,adjustedSize=_a.adjustedSize;var noteData=Object.assign({dx:50,dy:20,y:0,note:{label:d.label},connector:{end:"arrow"}},d,{type:AnnotationXYThreshold,x:screenCoordinates[0],subject:{x:screenCoordinates[0],y1:0,y2:adjustedSize[1]},i:i});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgYAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,i=_a.i,adjustedSize=_a.adjustedSize,adjustedPosition=_a.adjustedPosition;var xPosition=i*25;var noteData=Object.assign({dx:50,dy:-20,x:xPosition,note:{label:d.label},connector:{end:"arrow"}},d,{type:AnnotationXYThreshold,y:screenCoordinates[1],subject:{y:screenCoordinates[1],x1:0,x2:adjustedSize[0]+adjustedPosition[0]},i:i});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgBoundsAnnotation=function(_a){var d=_a.d,i=_a.i,adjustedSize=_a.adjustedSize,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor,xScale=_a.xScale,yScale=_a.yScale;var startXValue=findFirstAccessorValue(xAccessor,d.bounds[0]);var startYValue=findFirstAccessorValue(yAccessor,d.bounds[0]);var endXValue=findFirstAccessorValue(xAccessor,d.bounds[1]);var endYValue=findFirstAccessorValue(yAccessor,d.bounds[1]);var x0Position=startXValue?xScale(startXValue):0;var y0Position=startYValue?yScale(startYValue):adjustedSize[1];var x1Position=endXValue?xScale(endXValue):adjustedSize[0];var y1Position=endYValue?yScale(endYValue):0;var noteData=Object.assign({dx:250,dy:-20,note:{label:d.label},connector:{end:"arrow"}},d,{type:AnnotationCalloutRect,x:Math.min(x0Position,x1Position),y:Math.min(y0Position,y1Position),subject:{width:Math.abs(x1Position-x0Position),height:Math.abs(y0Position-y1Position)},i:i});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgLineAnnotation=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates;var lineGenerator=line$1().x(function(p){return p[0]}).y(function(p){return p[1]});var lineD=lineGenerator(screenCoordinates);var laLine=React.createElement(lib_2,{key:d.label+"annotationline"+i,markType:"path",d:lineD,className:"annotation annotation-line "+(d.className||"")+" "});var laLabel=React.createElement(lib_2,{markType:"text",key:d.label+"annotationlinetext"+i,x:(screenCoordinates[0][0]+screenCoordinates[1][0])/2,y:(screenCoordinates[0][1]+screenCoordinates[1][1])/2,className:"annotation annotation-line-label "+(d.className||"")+" "},d.label);return[laLine,laLabel]};var svgAreaAnnotation=function(_a){var d=_a.d,i=_a.i,xScale=_a.xScale,xAccessor=_a.xAccessor,yScale=_a.yScale,yAccessor=_a.yAccessor,annotationLayer=_a.annotationLayer;var mappedCoordinates="M"+d.coordinates.map(function(p){return[xScale(findFirstAccessorValue(xAccessor,p)),yScale(findFirstAccessorValue(yAccessor,p))]}).join("L")+"Z";var xBounds=extent(d.coordinates.map(function(p){return xScale(findFirstAccessorValue(xAccessor,p))}));var yBounds=extent(d.coordinates.map(function(p){return yScale(findFirstAccessorValue(yAccessor,p))}));var xCenter=(xBounds[0]+xBounds[1])/2;var yCenter=(yBounds[0]+yBounds[1])/2;var laLine=React.createElement(lib_2,{key:d.label+"-annotation-area-"+i,markType:"path",transform:"translate("+annotationLayer.position+")",d:mappedCoordinates,className:"annotation annotation-area "+(d.className||"")+" "});var laLabel=React.createElement(lib_2,{markType:"text",key:d.label+"-annotationtext-"+i,forceUpdate:true,x:xCenter,y:yCenter,transform:"translate("+annotationLayer.position+")",className:"annotation annotation-area-label "+(d.className||"")+" ",style:{textAnchor:"middle"}},d.label);return[laLine,laLabel]};var htmlTooltipAnnotation=function(_a){var content=_a.content,screenCoordinates=_a.screenCoordinates,i=_a.i,d=_a.d,useSpans=_a.useSpans;return React.createElement(SpanOrDiv,{span:useSpans,key:"xylabel-"+i,className:"annotation annotation-xy-label "+(d.className||"")+" ",style:{position:"absolute",top:screenCoordinates[1]+"px",left:screenCoordinates[0]+"px"}},content)};var svgRectEncloseAnnotation=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates;var bboxNodes=screenCoordinates.map(function(p){return{x0:p.x0=p[0],x1:p.x1=p[0],y0:p.y0=p[1],y1:p.y1=p[1]}});return rectangleEnclosure({bboxNodes:bboxNodes,d:d,i:i})};var svgEncloseAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,i=_a.i;var circle=packEnclose(screenCoordinates.map(function(p){return{x:p[0],y:p[1],r:2}}));return circleEnclosure({d:d,circle:circle,i:i})};var svgHullEncloseAnnotation=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,i=_a.i;return hullEnclosure({points:screenCoordinates,d:d,i:i})};var AnnotationCallout_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationCallout;var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);var _ConnectorLine=_interopRequireDefault(require$$2$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationCallout(props){var className=(0,_classnames.default)("callout",props.className);return(0,_Type.default)(_objectSpread({},props,{className:className}),_ConnectorLine.default,{lineType:"horizontal"})}});var AnnotationCallout=unwrapExports(AnnotationCallout_1);var cleanDates=function(value){if(value&&value.toJSON){return value.toJSON()}return value};var xyDownloadMapping=function(_a){var data=_a.data,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor,_b=_a.fields,fields=_b===void 0?[]:_b;var csvData=[];if(!xAccessor){return data}data.forEach(function(datum){if(Array.isArray(datum)){xAccessor.forEach(function(actualXAccessor){yAccessor.forEach(function(actualYAccessor){datum.forEach(function(a){var row={};if(actualXAccessor){row.x=cleanDates(actualXAccessor(a))}else if(a.x){row.x=a.x}if(actualYAccessor){row.y=cleanDates(actualYAccessor(a))}else if(a.y){row.y=a.y}if(datum.id!==undefined)row.id=datum.id;if(fields&&Array.isArray(fields)){fields.forEach(function(f){row[f]=cleanDates(a[f])})}csvData.push(row)})})})}else{xAccessor.forEach(function(actualXAccessor){yAccessor.forEach(function(actualYAccessor){var row={};if(actualXAccessor){row.x=cleanDates(actualXAccessor(datum.data))}else if(datum.x){row.x=datum.x}if(actualYAccessor){row.y=cleanDates(actualYAccessor(datum.data))}else if(datum.y){row.y=datum.y}if(datum.id!==undefined){row.id=datum.id}if(actualXAccessor||actualYAccessor){fields.forEach(function(f){row[f]=datum.data[f]})}else{fields.forEach(function(f){row[f]=datum[f]})}csvData.push(row)})})}});return csvData};var orDownloadMapping=function(_a){var data=_a.data,oAccessor=_a.oAccessor,rAccessor=_a.rAccessor,_b=_a.fields,fields=_b===void 0?[]:_b;var dataKeys=Object.keys(data);var csvData=[];oAccessor.forEach(function(actualOAccessor){rAccessor.forEach(function(actualRAccessor){dataKeys.forEach(function(key){data[key].pieceData.forEach(function(piece){var row={};if(actualOAccessor){row.column=actualOAccessor(piece.data)}else if(piece.x){row.column=piece.x}if(actualRAccessor){row.value=actualRAccessor(piece.data)}else if(piece.renderKey){row.value=piece.renderKey}if(piece.id!==undefined)row.id=piece.id;fields.forEach(function(f){row[f]=cleanDates(piece.data[f])});csvData.push(row)})})})});return csvData};var networkNodeDownloadMapping=function(_a){var data=_a.data,_b=_a.fields,fields=_b===void 0?[]:_b;var csvData=[];data.forEach(function(d){var row={};row.id=d.id;fields.forEach(function(f){row[f]=d[f]});csvData.push(row)});return csvData};var networkEdgeDownloadMapping=function(_a){var data=_a.data,_b=_a.fields,fields=_b===void 0?[]:_b;var csvData=[];data.forEach(function(d){var row={};row.source=d.source.id;row.target=d.target.id;fields.forEach(function(f){row[f]=d[f]});csvData.push(row)});return csvData};var extentValue=function(extent){return extent&&extent.extent||Array.isArray(extent)&&extent||[]};var whichPointsHash={top:projectedYTop,bottom:projectedYBottom,orphan:projectedY};var builtInTransformations={stackedarea:stackedArea,"stackedarea-invert":stackedArea,stackedpercent:stackedArea,"stackedpercent-invert":stackedArea,linepercent:stackedArea,difference:differenceLine,bumparea:bumpChart,bumpline:bumpChart,"bumparea-invert":bumpChart,line:lineChart,area:lineChart,cumulative:cumulativeLine,"cumulative-reverse":cumulativeLine};function stringToFn(accessor,defaultAccessor,raw){if(!accessor&&defaultAccessor){return defaultAccessor}else if(typeof accessor==="object"){return function(){return accessor}}else if(accessor instanceof Function){return accessor}else if(raw===true){var castAccessor_1=accessor;return function(){return castAccessor_1}}else if(typeof accessor==="string"){return function(d){return d[accessor]}}return function(){return undefined}}function stringToArrayFn(accessor,defaultAccessor,raw){if(accessor===undefined){return[stringToFn(undefined,defaultAccessor,raw)]}var arrayOfAccessors=[];if(Array.isArray(accessor)){arrayOfAccessors=accessor}else{arrayOfAccessors=[accessor]}return arrayOfAccessors.map(function(a){return stringToFn(a,defaultAccessor,raw)})}var calculateDataExtent=function(_a){var lineDataAccessor=_a.lineDataAccessor,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor,summaries=_a.summaries,points=_a.points,lines=_a.lines,lineType=_a.lineType,showLinePoints=_a.showLinePoints,showSummaryPoints=_a.showSummaryPoints,xExtent=_a.xExtent,yExtent=_a.yExtent,invertX=_a.invertX,invertY=_a.invertY,summaryDataAccessor=_a.summaryDataAccessor,summaryType=_a.summaryType,size=_a.adjustedSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,summaryStyleFn=_a.summaryStyleFn,summaryClassFn=_a.summaryClassFn,summaryRenderModeFn=_a.summaryRenderModeFn,chartSize=_a.chartSize,filterRenderedLines=_a.filterRenderedLines,filterRenderedSummaries=_a.filterRenderedSummaries,filterRenderedPoints=_a.filterRenderedPoints,_b=_a.defined,defined=_b===void 0?function(){return true}:_b;var fullDataset=[];var initialProjectedLines=[];var projectedPoints=[],projectedLines=[],projectedSummaries=[];if(points){xAccessor.forEach(function(actualXAccessor,xIndex){yAccessor.forEach(function(actualYAccessor,yIndex){points.forEach(function(d,i){var x=actualXAccessor(d,i);var y=actualYAccessor(d,i);var projectedPoint={x:x,y:y,data:d,xIndex:xIndex,yIndex:yIndex};if(Array.isArray(y)){projectedPoint[projectedYBottom]=Math.min.apply(Math,__spread(y));projectedPoint[projectedYTop]=Math.max.apply(Math,__spread(y));projectedPoint[projectedYMiddle]=(projectedPoint[projectedYBottom]+projectedPoint[projectedYTop])/2}if(Array.isArray(x)){projectedPoint[projectedXBottom]=Math.min.apply(Math,__spread(x));projectedPoint[projectedXTop]=Math.max.apply(Math,__spread(x));projectedPoint[projectedXMiddle]=(projectedPoint[projectedXBottom]+projectedPoint[projectedXTop])/2}projectedPoints.push(projectedPoint)})})});fullDataset=__spread(projectedPoints.map(function(d){var _a;return __assign({},d,(_a={},_a[projectedY]=d[projectedYTop]||d[projectedYBottom]||d.y,_a))}))}if(lines){initialProjectedLines=projectLineData({data:lines,lineDataAccessor:lineDataAccessor,xProp:projectedX,yProp:projectedY,yPropTop:projectedYTop,yPropBottom:projectedYBottom,xAccessor:xAccessor,yAccessor:yAccessor});var optionsObject={xProp:projectedX,yProp:projectedY,yPropMiddle:projectedYMiddle,yPropTop:projectedYTop,yPropBottom:projectedYBottom,xPropMiddle:projectedXMiddle,xPropTop:projectedXTop,xPropBottom:projectedXBottom};projectedLines=lineTransformation(lineType,optionsObject)(initialProjectedLines);projectedLines.forEach(function(d){fullDataset=__spread(fullDataset,d.data.filter(function(p,q){return defined(Object.assign({},p.data,p),q)}).map(function(p){var mappedP={parentLine:d,y:p.y,x:p.x,yTop:p.yTop,yMiddle:p.yMiddle,yBottom:p.yBottom,data:p.data};if(p.percent){mappedP.percent=p.percent}return mappedP}))});if(showLinePoints){var whichPoints_1=showLinePoints===true?projectedYMiddle:whichPointsHash[showLinePoints];projectedLines.forEach(function(d){d.data.filter(function(p,q){var isDefined=defined(Object.assign({},p.data,p));if(isDefined){if(showLinePoints==="orphan"){var prePoint=d.data[q-1];var postPoint=d.data[q+1];if((!prePoint||!defined(Object.assign({},prePoint.data,prePoint)))&&(!postPoint||!defined(Object.assign({},postPoint.data,postPoint)))){return true}else{return false}}else{return true}}else{return false}}).forEach(function(p){var _a;projectedPoints.push(__assign({},p,(_a={parentLine:d},_a[projectedY]=p[whichPoints_1]!==undefined?p[whichPoints_1]:p[projectedYMiddle]!==undefined?p[projectedYMiddle]:p[projectedYBottom]!==undefined?p[projectedYBottom]:p.y,_a)))})})}}if(summaries){projectedSummaries=projectSummaryData({data:summaries,summaryDataAccessor:summaryDataAccessor,xAccessor:xAccessor,yAccessor:yAccessor});projectedSummaries.forEach(function(d){var baseData=d._baseData;if(d._xyfCoordinates[0][0][0]){d._xyfCoordinates[0].forEach(function(multi){if(Array.isArray(multi)){multi.map(function(p,q){var _a;return Object.assign({parentSummary:d},baseData[q],(_a={},_a[projectedX]=p[0],_a[projectedY]=p[1],_a))}).forEach(function(e){var _a;if(showSummaryPoints){projectedPoints.push(__assign({x:0},e,(_a={},_a[projectedY]=e[projectedYTop]||e[projectedYBottom]||e[projectedY],_a)))}fullDataset.push(__assign({x:0,y:0},e))})}})}else{if(Array.isArray(d._xyfCoordinates)){var coordArray=d._xyfCoordinates;coordArray.map(function(p,q){var _a;return __assign({parentSummary:d},baseData[q],(_a={},_a[projectedX]=p[0],_a[projectedY]=p[1],_a))}).forEach(function(e){var _a;if(showSummaryPoints){projectedPoints.push(__assign({x:0},e,(_a={},_a[projectedY]=e[projectedYTop]||e[projectedYBottom]||e[projectedY],_a)))}fullDataset.push(__assign({x:0,y:0},e))})}}})}var calculatedXExtent=[min$2(fullDataset.map(function(d){return d[projectedXBottom]===undefined?d[projectedX]:Math.min(d[projectedXTop],d[projectedXBottom])})),max$2(fullDataset.map(function(d){return d[projectedXTop]===undefined?d[projectedX]:Math.max(d[projectedXBottom],d[projectedXTop])}))];var calculatedYExtent=[min$2(fullDataset.map(function(d){return d[projectedYBottom]===undefined?d[projectedY]:Math.min(d[projectedYTop],d[projectedYBottom])})),max$2(fullDataset.map(function(d){return d[projectedYTop]===undefined?d[projectedY]:Math.max(d[projectedYBottom],d[projectedYTop])}))];var actualXExtent=extentValue(xExtent);var actualYExtent=extentValue(yExtent);var xMin=actualXExtent&&actualXExtent[0]!==undefined?actualXExtent[0]:calculatedXExtent[0];var xMax=actualXExtent&&actualXExtent[1]!==undefined?actualXExtent[1]:calculatedXExtent[1];var yMin=actualYExtent&&actualYExtent[0]!==undefined?actualYExtent[0]:calculatedYExtent[0];var yMax=actualYExtent&&actualYExtent[1]!==undefined?actualYExtent[1]:calculatedYExtent[1];var finalYExtent=[yMin,yMax];var finalXExtent=[xMin,xMax];if(invertX&&!(actualXExtent&&actualXExtent.length===2)){finalXExtent=[finalXExtent[1],finalXExtent[0]]}if((lineType.type==="bumpline"||invertY)&&!(actualYExtent&&actualYExtent.length===2)){finalYExtent=[finalYExtent[1],finalYExtent[0]]}if(summaryType.type&&summaryType.type==="contour"){projectedSummaries=contouring({summaryType:summaryType,data:projectedSummaries,finalXExtent:finalXExtent,finalYExtent:finalYExtent})}else if(summaryType.type&&summaryType.type==="hexbin"){projectedSummaries=hexbinning({summaryType:summaryType,data:projectedSummaries,processedData:summaries&&!!summaries[0].processedData,preprocess:false,finalXExtent:finalXExtent,finalYExtent:finalYExtent,size:size,margin:margin,baseMarkProps:baseMarkProps,styleFn:summaryStyleFn,classFn:summaryClassFn,renderFn:summaryRenderModeFn,chartSize:chartSize});fullDataset=__spread(projectedSummaries.map(function(d){return __assign({},d)}),fullDataset.filter(function(d){return!d.parentSummary}))}else if(summaryType.type&&summaryType.type==="heatmap"){projectedSummaries=heatmapping({summaryType:summaryType,data:projectedSummaries,processedData:summaries&&!!summaries[0].processedData,preprocess:false,finalXExtent:finalXExtent,finalYExtent:finalYExtent,size:size,margin:margin,baseMarkProps:baseMarkProps,styleFn:summaryStyleFn,classFn:summaryClassFn,renderFn:summaryRenderModeFn,chartSize:chartSize});fullDataset=__spread(projectedSummaries.map(function(d){return __assign({},d)}),fullDataset.filter(function(d){return!d.parentSummary}))}else if(summaryType.type&&summaryType.type==="trendline"){projectedSummaries=trendlining({summaryType:summaryType,data:projectedSummaries,processedData:summaries&&!!summaries[0].processedData,preprocess:false,finalXExtent:finalXExtent,finalYExtent:finalYExtent,size:size,margin:margin,baseMarkProps:baseMarkProps,styleFn:summaryStyleFn,classFn:summaryClassFn,renderFn:summaryRenderModeFn,chartSize:chartSize});fullDataset=__spread(projectedSummaries.map(function(d){return __assign({},d)}),fullDataset.filter(function(d){return!d.parentSummary}))}if(filterRenderedLines){projectedLines=projectedLines.filter(filterRenderedLines);fullDataset=fullDataset.filter(function(d,i){return!d.parentLine||filterRenderedLines(d.parentLine,i,[])})}if(filterRenderedPoints){fullDataset=fullDataset.filter(filterRenderedPoints)}if(filterRenderedSummaries){projectedSummaries=projectedSummaries.filter(filterRenderedSummaries);fullDataset=fullDataset.filter(function(d,i){return!d.parentSummary||filterRenderedSummaries(d.parentSummary,i,[])})}return{xExtent:finalXExtent,yExtent:finalYExtent,projectedLines:projectedLines,projectedPoints:projectedPoints,projectedSummaries:projectedSummaries,fullDataset:fullDataset,calculatedXExtent:calculatedXExtent,calculatedYExtent:calculatedYExtent}};var differenceCatch=function(olineType,data){return olineType==="difference"&&data.length!==2?"line":olineType};function lineTransformation(lineType,options){return function(data){return builtInTransformations[differenceCatch(lineType.type,data)](__assign({},lineType,options,{data:data}))}}var xyFrameDataProps=["lines","points","areas","summaries","xScaleType","yScaleType","xAccessor","yAccessor","lineDataAccessor","areaDataAccessor","summaryDataAccessor","lineType","showLinePoints","showSummaryPoints","defined","summaryType","areaType"];var xyFrameChangeProps=__spread(xyFrameDataProps,["name","title","margin","axes","position","xExtent","yExtent","invertX","invertY","hoverAnnotation","additionalDefs","defined","lineStyle","pointStyle","areaStyle","summaryStyle","lineClass","pointClass","areaClass","summaryClass","canvasPoints","customPointMark","customLineMark","lineIDAccessor"]);var orFrameChangeProps=["data","name","orient","title","margin","format","position","oScaleType","rScaleType","oExtent","rExtent","invertO","invertR","oAccessor","rAccessor","oPadding","projection","type","summaryType","connectorType","className","additionalDefs","renderKey","dataAccessor","rBaseline","sortO","oSort","dynamicColumnWidth","renderFn","style","connectorStyle","summaryStyle","summaryPosition","oLabel","axis","axes"];var networkFrameChangeProps=["name","graph","nodes","edges","title","margin","position","nodeIDAccessor","sourceAccessor","targetAccessor","nodeSizeAccessor","customNodeIcon","nodeLabels","edgeWidthAccessor","networkType","className","additionalDefs","renderFn","nodeStyle","edgeStyle","edgeType"];var sharedframeproptypes={useSpans:true,title:true,margin:true,name:true,dataVersion:true,frameKey:true,size:true,position:true,canvasPostProcess:true,additionalDefs:true,className:true,customHoverBehavior:true,customClickBehavior:true,customDoubleClickBehavior:true,hoverAnnotation:true,disableContext:true,interaction:true,svgAnnotationRules:true,htmlAnnotationRules:true,tooltipContent:true,annotations:true,baseMarkProps:true,backgroundGraphics:true,foregroundGraphics:true,beforeElements:true,afterElements:true,download:true,downloadFields:true,annotationSettings:true,renderKey:true,renderOrder:true,legend:true,onUnmount:true};var xyframeproptypes=__assign({},sharedframeproptypes,{lines:true,points:true,areas:true,summaries:true,axes:true,matte:true,xScaleType:true,yScaleType:true,xExtent:true,yExtent:true,invertX:true,invertY:true,xAccessor:true,yAccessor:true,lineDataAccessor:true,areaDataAccessor:true,summaryDataAccessor:true,lineType:true,areaType:true,summaryType:true,lineRenderMode:true,pointRenderMode:true,areaRenderMode:true,summaryRenderMode:true,showLinePoints:true,showSummaryPoints:true,defined:true,lineStyle:true,pointStyle:true,areaStyle:true,summaryStyle:true,lineClass:true,pointClass:true,areaClass:true,summaryClass:true,canvasPoints:true,canvasLines:true,canvasAreas:true,canvasSummaries:true,customPointMark:true,customLineMark:true,customAreaMark:true,customSummaryMark:true,lineIDAccessor:true,minimap:true,useAreasAsInteractionLayer:true,useSummariesAsInteractionLayer:true});var ordinalframeproptypes=__assign({},sharedframeproptypes,{data:true,oScaleType:true,rScaleType:true,oExtent:true,rExtent:true,invertO:true,invertR:true,oAccessor:true,rAccessor:true,oPadding:true,projection:true,type:true,summaryType:true,connectorType:true,tooltipContent:true,baseMarkProps:true,dataAccessor:true,rBaseline:true,sortO:true,oSort:true,pixelColumnWidth:true,dynamicColumnWidth:true,renderMode:true,summaryRenderMode:true,connectorRenderMode:true,style:true,connectorStyle:true,summaryStyle:true,canvasPieces:true,canvasConnectors:true,canvasSummaries:true,summaryPosition:true,oLabel:true,pieceIDAccessor:true,pieceHoverAnnotation:true,summaryHoverAnnotation:true,axis:true,axes:true,ordinalAlign:true,multiAxis:true,pieceClass:true,summaryClass:true});var networkframeproptypes=__assign({},sharedframeproptypes,{nodes:true,edges:true,graph:true,nodeIDAccessor:true,sourceAccessor:true,targetAccessor:true,nodeSizeAccessor:true,customNodeIcon:true,customEdgeIcon:true,nodeRenderKey:true,edgeRenderKey:true,edgeRenderMode:true,nodeRenderMode:true,canvasEdges:true,canvasNodes:true,nodeLabels:true,edgeWidthAccessor:true,networkType:true,renderFn:true,nodeStyle:true,edgeStyle:true,edgeType:true,filterRenderedNodes:true});var responsiveprops={responsiveWidth:true,responsiveHeight:true,debounce:true};var naturalLanguageLineType={line:{items:"line",chart:"line chart"},area:{items:"summary",chart:"summary chart"},summary:{items:"summary",chart:"summary chart"},cumulative:{items:"line",chart:"cumulative chart"},"cumulative-reverse":{items:"line",chart:"cumulative chart"},linepercent:{items:"line",chart:"line chart"},stackedarea:{items:"stacked area",chart:"stacked area chart"},"stackedarea-invert":{items:"stacked area",chart:"stacked area chart"},stackedpercent:{items:"stacked area",chart:"stacked area chart"},"stackedpercent-invert":{items:"stacked area",chart:"stacked area chart"},bumparea:{items:"ranked area",chart:"ranked area chart"},"bumparea-invert":{items:"ranked area",chart:"ranked area chart"},bumpline:{items:"ranked line",chart:"ranked line chart"},difference:{items:"line",chart:"difference chart"}};var emptyObjectReturnFunction=function(){return{}};var emptyStringReturnFunction=function(){return""};var xyframeKey="";var chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var i$1=32;i$1>0;--i$1)xyframeKey+=chars[Math.floor(Math.random()*chars.length)];var projectedCoordinateNames={y:projectedY,x:projectedX,yMiddle:projectedYMiddle,yTop:projectedYTop,yBottom:projectedYBottom,xMiddle:projectedXMiddle,xTop:projectedXTop,xBottom:projectedXBottom};function mapParentsToPoints(fullDataset){return fullDataset.map(function(d){if(d.parentLine){return Object.assign({},d.parentLine,d)}if(d.parentSummary){return Object.assign({},d.parentSummary,d)}return d})}var XYFrame=function(_super){__extends(XYFrame,_super);function XYFrame(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={size:[500,500],dataVersion:undefined,lineData:undefined,pointData:undefined,summaryData:undefined,projectedLines:undefined,projectedPoints:undefined,projectedSummaries:undefined,fullDataset:[],adjustedPosition:[0,0],adjustedSize:[500,500],backgroundGraphics:null,foregroundGraphics:null,axesData:undefined,axes:undefined,axesTickLines:undefined,renderNumber:0,margin:{top:0,bottom:0,left:0,right:0},calculatedXExtent:[0,0],calculatedYExtent:[0,0],xAccessor:[function(d){return d.x}],yAccessor:[function(d){return d.y}],xExtent:[0,0],yExtent:[0,0],areaAnnotations:[],xScale:linear$1(),yScale:linear$1(),title:null,legendSettings:undefined,xyFrameRender:{},canvasDrawing:[],annotatedSettings:{xAccessor:undefined,yAccessor:undefined,summaryDataAccessor:undefined,lineDataAccessor:undefined,renderKeyFn:undefined,lineType:undefined,summaryType:undefined,lineIDAccessor:undefined,summaries:undefined,lines:undefined,title:undefined,xExtent:undefined,yExtent:undefined},overlay:undefined};_this.calculateXYFrame=function(currentProps,updateData){var _a,_b,_c,_d;var legend=currentProps.legend,lines=currentProps.lines,lineClass=currentProps.lineClass,pointStyle=currentProps.pointStyle,pointRenderMode=currentProps.pointRenderMode,pointClass=currentProps.pointClass,areaClass=currentProps.areaClass,_e=currentProps.summaryClass,summaryClass=_e===void 0?areaClass:_e,canvasLines=currentProps.canvasLines,canvasPoints=currentProps.canvasPoints,canvasAreas=currentProps.canvasAreas,_f=currentProps.canvasSummaries,canvasSummaries=_f===void 0?canvasAreas:_f,defined=currentProps.defined,size=currentProps.size,renderKey=currentProps.renderKey,lineType=currentProps.lineType,areaType=currentProps.areaType,_g=currentProps.summaryType,summaryType=_g===void 0?areaType:_g,customLineMark=currentProps.customLineMark,customPointMark=currentProps.customPointMark,customAreaMark=currentProps.customAreaMark,_h=currentProps.customSummaryMark,customSummaryMark=_h===void 0?customAreaMark:_h,areaStyle=currentProps.areaStyle,_j=currentProps.summaryStyle,summaryStyle=_j===void 0?areaStyle:_j,areaRenderMode=currentProps.areaRenderMode,_k=currentProps.summaryRenderMode,summaryRenderMode=_k===void 0?areaRenderMode:_k,lineStyle=currentProps.lineStyle,lineRenderMode=currentProps.lineRenderMode,baseXExtent=currentProps.xExtent,baseYExtent=currentProps.yExtent,title=currentProps.title,_l=currentProps.xScaleType,baseXScaleType=_l===void 0?linear$1():_l,_m=currentProps.yScaleType,baseYScaleType=_m===void 0?linear$1():_m,lineIDAccessor=currentProps.lineIDAccessor,invertX=currentProps.invertX,invertY=currentProps.invertY,showLinePoints=currentProps.showLinePoints,showSummaryPoints=currentProps.showSummaryPoints,points=currentProps.points,areas=currentProps.areas,lineDataAccessor=currentProps.lineDataAccessor,areaDataAccessor=currentProps.areaDataAccessor,_o=currentProps.summaryDataAccessor,summaryDataAccessor=_o===void 0?areaDataAccessor:_o,yAccessor=currentProps.yAccessor,xAccessor=currentProps.xAccessor,useSummariesAsInteractionLayer=currentProps.useSummariesAsInteractionLayer,_p=currentProps.useAreasAsInteractionLayer,useAreasAsInteractionLayer=_p===void 0?useSummariesAsInteractionLayer:_p,baseMarkProps=currentProps.baseMarkProps,filterRenderedLines=currentProps.filterRenderedLines,filterRenderedSummaries=currentProps.filterRenderedSummaries,filterRenderedPoints=currentProps.filterRenderedPoints;var projectedLines=currentProps.projectedLines,projectedPoints=currentProps.projectedPoints,_q=currentProps.projectedSummaries,projectedSummaries=_q===void 0?currentProps.projectedAreas:_q,_r=currentProps.summaries,summaries=_r===void 0?areas:_r,fullDataset=currentProps.fullDataset;if(summaryType&&points&&!summaries){summaries=[{coordinates:points}]}var castXScaleType=baseXScaleType;var xScaleType=baseXScaleType.domain?baseXScaleType:castXScaleType();var castYScaleType=baseYScaleType;var yScaleType=baseYScaleType.domain?baseYScaleType:castYScaleType();var annotatedSettings={xAccessor:stringToArrayFn(xAccessor,function(d){return d[0]}),yAccessor:stringToArrayFn(yAccessor,function(d){return d[1]}),summaryDataAccessor:stringToArrayFn(summaryDataAccessor,function(d){return Array.isArray(d)?d:d.coordinates}),lineDataAccessor:stringToArrayFn(lineDataAccessor,function(d){return Array.isArray(d)?d:d.coordinates}),renderKeyFn:stringToFn(renderKey,function(d,i){return"line-"+i},true),lineType:objectifyType(lineType),summaryType:objectifyType(summaryType),lineIDAccessor:stringToFn(lineIDAccessor,function(l){return l.semioticLineID}),summaries:!summaries||Array.isArray(summaries)&&summaries.length===0?undefined:!Array.isArray(summaries)?[summaries]:!summaryDataAccessor&&!summaries[0].coordinates?[{coordinates:summaries}]:summaries,lines:!lines||Array.isArray(lines)&&lines.length===0?undefined:!Array.isArray(lines)?[lines]:!lineDataAccessor&&!lines[0].coordinates?[{coordinates:lines}]:lines,title:typeof title==="object"&&!React.isValidElement(title)&&title!==null?title:{title:title,orient:"top"},xExtent:Array.isArray(baseXExtent)?baseXExtent:!baseXExtent?undefined:baseXExtent.extent,yExtent:Array.isArray(baseYExtent)?baseYExtent:!baseYExtent?undefined:baseYExtent.extent};if(annotatedSettings.lineType.type==="area"){annotatedSettings.lineType.y1=function(){return 0};annotatedSettings.lineType.simpleLine=false}var summaryStyleFn=stringToFn(summaryStyle,emptyObjectReturnFunction,true);var summaryClassFn=stringToFn(summaryClass,emptyStringReturnFunction,true);var summaryRenderModeFn=stringToFn(summaryRenderMode,undefined,true);var generatedAxes=currentProps.axes&&currentProps.axes.map(function(axisFnOrObject){return typeof axisFnOrObject==="function"?axisFnOrObject({size:currentProps.size}):axisFnOrObject});var margin=calculateMargin({margin:currentProps.margin,axes:generatedAxes,title:annotatedSettings.title,size:currentProps.size});var _s=adjustedPositionSize({size:currentProps.size,margin:margin}),adjustedPosition=_s.adjustedPosition,adjustedSize=_s.adjustedSize;var calculatedXExtent=[],calculatedYExtent=[],yExtent,xExtent,xExtentSettings,yExtentSettings;if(typeof baseXExtent==="object"){xExtentSettings=baseXExtent}else{xExtentSettings={extent:baseXExtent}}if(typeof baseYExtent==="object"){yExtentSettings=baseYExtent}else{yExtentSettings={extent:baseYExtent}}var xScale,yScale;if(updateData||currentProps.dataVersion&&currentProps.dataVersion!==_this.state.dataVersion){if(!xExtent||!yExtent||!fullDataset||!projectedLines&&!projectedPoints&&!projectedSummaries){_a=calculateDataExtent({lineDataAccessor:annotatedSettings.lineDataAccessor,summaryDataAccessor:annotatedSettings.summaryDataAccessor,xAccessor:annotatedSettings.xAccessor,yAccessor:annotatedSettings.yAccessor,lineType:annotatedSettings.lineType,summaryType:annotatedSettings.summaryType,summaries:annotatedSettings.summaries,points:points,lines:annotatedSettings.lines,showLinePoints:showLinePoints,showSummaryPoints:showSummaryPoints,xExtent:baseXExtent,yExtent:baseYExtent,invertX:invertX,invertY:invertY,adjustedSize:adjustedSize,margin:margin,baseMarkProps:baseMarkProps,summaryStyleFn:summaryStyleFn,summaryClassFn:summaryClassFn,summaryRenderModeFn:summaryRenderModeFn,chartSize:size,xScaleType:xScaleType,yScaleType:yScaleType,defined:defined,filterRenderedLines:filterRenderedLines,filterRenderedSummaries:filterRenderedSummaries,filterRenderedPoints:filterRenderedPoints}),xExtent=_a.xExtent,yExtent=_a.yExtent,projectedLines=_a.projectedLines,projectedPoints=_a.projectedPoints,projectedSummaries=_a.projectedSummaries,fullDataset=_a.fullDataset,calculatedXExtent=_a.calculatedXExtent,calculatedYExtent=_a.calculatedYExtent}_b=_this.screenScales({xExtent:xExtent,yExtent:yExtent,adjustedSize:adjustedSize,xScaleType:xScaleType.copy(),yScaleType:yScaleType.copy()}),xScale=_b.xScale,yScale=_b.yScale}else{_c=_this.state,xExtent=_c.xExtent,yExtent=_c.yExtent,projectedLines=_c.projectedLines,projectedPoints=_c.projectedPoints,projectedSummaries=_c.projectedSummaries,fullDataset=_c.fullDataset,calculatedXExtent=_c.calculatedXExtent,calculatedYExtent=_c.calculatedYExtent;if(adjustedSize[0]===_this.state.adjustedSize[0]&&adjustedSize[1]===_this.state.adjustedSize[1]){xScale=_this.state.xScale;yScale=_this.state.yScale}else{_d=_this.screenScales({xExtent:xExtent,yExtent:yExtent,adjustedSize:adjustedSize,xScaleType:xScaleType,yScaleType:yScaleType}),xScale=_d.xScale,yScale=_d.yScale}}xExtent=Array.isArray(xExtentSettings.extent)&&xExtentSettings.extent.length===2?xExtentSettings.extent:xExtent;yExtent=Array.isArray(yExtentSettings.extent)&&yExtentSettings.extent.length===2?yExtentSettings.extent:yExtent;var canvasDrawing=[];var axes;var axesTickLines;var existingBaselines={};if(generatedAxes){axesTickLines=[];axes=generatedAxes.map(function(d,i){var axisClassname=d.className||"";axisClassname+=" axis";var axisScale=yScale;if(existingBaselines[d.orient]){d.baseline=d.baseline||false}existingBaselines[d.orient]=true;if(d.orient==="top"||d.orient==="bottom"){axisClassname+=" x";axisScale=xScale}else{axisClassname+=" y"}axisClassname+=" "+d.orient;var tickValues;if(d.tickValues&&Array.isArray(d.tickValues)){tickValues=d.tickValues}else if(d.tickValues instanceof Function){tickValues=d.tickValues(fullDataset,currentProps.size,axisScale)}var axisSize=[adjustedSize[0],adjustedSize[1]];var axisParts=axisPieces({padding:d.padding,tickValues:tickValues,scale:axisScale,ticks:d.ticks,orient:d.orient,size:axisSize,footer:d.footer,tickSize:d.tickSize,jaggedBase:d.jaggedBase});var axisTickLines=React.createElement("g",{key:"axes-tick-lines-"+i,className:"axis "+axisClassname},axisLines({axisParts:axisParts,orient:d.orient,tickLineGenerator:d.tickLineGenerator,baseMarkProps:baseMarkProps,className:axisClassname,jaggedBase:d.jaggedBase,scale:axisScale}),d.baseline==="under"&&baselineGenerator(d.orient,adjustedSize,d.className));axesTickLines.push(axisTickLines);return React.createElement(Axis,__assign({},d,{key:d.key||"axis-"+i,annotationFunction:d.axisAnnotationFunction,axisParts:axisParts,size:axisSize,margin:margin,tickValues:tickValues,scale:axisScale,className:axisClassname,xyPoints:fullDataset}))})}var legendSettings;if(legend){legendSettings=legend===true?{}:legend;if(projectedLines&&!legendSettings.legendGroups){var typeString=annotatedSettings.lineType.type;var type=typeof typeString==="string"&&["stackedarea","stackedpercent","bumparea"].indexOf(typeString)===-1?"line":"fill";var legendGroups=[{styleFn:currentProps.lineStyle,type:type,items:projectedLines.map(function(d){return Object.assign({label:annotatedSettings.lineIDAccessor(d)},d)})}];legendSettings.legendGroups=legendGroups}}var areaAnnotations=[];if(annotatedSettings.summaryType.label&&projectedSummaries){projectedSummaries.forEach(function(d,i){if(d.bounds){var bounds=Array.isArray(d.bounds)?d.bounds:[d.bounds];bounds.forEach(function(labelBounds){var label=typeof annotatedSettings.summaryType.label==="function"?annotatedSettings.summaryType.label(d):annotatedSettings.summaryType.label;if(label&&label!==null){var labelPosition=label.position||"center";var labelCenter=[xScale(labelBounds[labelPosition][0]),yScale(labelBounds[labelPosition][1])]||[xScale(d._xyfCoordinates[0]),yScale(d._xyfCoordinates[1])];var labelContent=label.content||function(p){return p.value||p.id||i};areaAnnotations.push({x:labelCenter[0],y:labelCenter[1],dx:label.dx,dy:label.dy,className:label.className,type:label.type||AnnotationCallout,note:label.note||{title:labelContent(d)},subject:label.subject||{text:labelContent(d)},connector:label.connector})}})}})}var lineAriaLabel=annotatedSettings.lineType.type!==undefined&&typeof annotatedSettings.lineType.type==="string"&&naturalLanguageLineType[annotatedSettings.lineType.type];var xyFrameRender={lines:{accessibleTransform:function(data,i){return __assign({},data[i].data[data[i].data.length-1],{type:"frame-hover"})},data:projectedLines,styleFn:stringToFn(lineStyle,emptyObjectReturnFunction,true),classFn:stringToFn(lineClass,emptyStringReturnFunction,true),renderMode:stringToFn(lineRenderMode,undefined,true),canvasRender:stringToFn(canvasLines,undefined,true),customMark:customLineMark,type:annotatedSettings.lineType,defined:defined,renderKeyFn:annotatedSettings.renderKeyFn,ariaLabel:lineAriaLabel,axesData:generatedAxes,behavior:createLines},summaries:{accessibleTransform:function(data,i){return __assign({},data[i],{type:"frame-hover"})},data:projectedSummaries,styleFn:summaryStyleFn,classFn:summaryClassFn,renderMode:summaryRenderModeFn,canvasRender:stringToFn(canvasSummaries,undefined,true),customMark:customSummaryMark,type:annotatedSettings.summaryType,renderKeyFn:annotatedSettings.renderKeyFn,behavior:createSummaries},points:{accessibleTransform:function(data,i){return __assign({type:"frame-hover"},data[i].data||data[i])},data:projectedPoints,styleFn:stringToFn(pointStyle,emptyObjectReturnFunction,true),classFn:stringToFn(pointClass,emptyStringReturnFunction,true),renderMode:stringToFn(pointRenderMode,undefined,true),canvasRender:stringToFn(canvasPoints,undefined,true),customMark:customPointMark,renderKeyFn:annotatedSettings.renderKeyFn,showLinePoints:showLinePoints,behavior:createPoints}};if(xExtentSettings.onChange&&_this.state.calculatedXExtent.join(",")!==calculatedXExtent.join(",")){xExtentSettings.onChange(calculatedXExtent)}if(yExtentSettings.onChange&&_this.state.calculatedYExtent.join(",")!==calculatedYExtent.join(",")){yExtentSettings.onChange(calculatedYExtent)}var overlay=undefined;if(useAreasAsInteractionLayer&&projectedSummaries){overlay=createSummaries({xScale:xScale,yScale:yScale,data:projectedSummaries}).map(function(m,i){return __assign({},m.props,{style:{fillOpacity:0},overlayData:projectedSummaries&&projectedSummaries[i]})})}_this.setState({lineData:currentProps.lines,pointData:currentProps.points,summaryData:currentProps.summaries||currentProps.areas,dataVersion:currentProps.dataVersion,projectedLines:projectedLines,projectedPoints:projectedPoints,projectedSummaries:projectedSummaries,canvasDrawing:canvasDrawing,fullDataset:fullDataset,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,backgroundGraphics:currentProps.backgroundGraphics,foregroundGraphics:currentProps.foregroundGraphics,axesData:generatedAxes,axes:axes,axesTickLines:axesTickLines,renderNumber:_this.state.renderNumber+1,xScale:xScale,yScale:yScale,xAccessor:annotatedSettings.xAccessor,yAccessor:annotatedSettings.yAccessor,xExtent:[xExtent[0]===undefined?calculatedXExtent[0]:xExtent[0],xExtent[1]===undefined?calculatedXExtent[1]:xExtent[1]],yExtent:[yExtent[0]===undefined?calculatedYExtent[0]:yExtent[0],yExtent[1]===undefined?calculatedYExtent[1]:yExtent[1]],calculatedXExtent:calculatedXExtent,calculatedYExtent:calculatedYExtent,margin:margin,legendSettings:legendSettings,areaAnnotations:areaAnnotations,xyFrameRender:xyFrameRender,size:size,annotatedSettings:annotatedSettings,overlay:overlay})};_this.defaultXYSVGRule=function(_a){var baseD=_a.d,i=_a.i,annotationLayer=_a.annotationLayer,lines=_a.lines,summaries=_a.summaries,points=_a.points;var _b=_this.props,showLinePoints=_b.showLinePoints,defined=_b.defined;var _c=_this.state,xyFrameRender=_c.xyFrameRender,xScale=_c.xScale,yScale=_c.yScale,xAccessor=_c.xAccessor,yAccessor=_c.yAccessor;var screenCoordinates=[];var idAccessor=_this.state.annotatedSettings.lineIDAccessor;if(baseD.type==="highlight"){return svgHighlight({d:baseD,i:i,idAccessor:idAccessor,lines:lines,summaries:summaries,points:points,xScale:xScale,yScale:yScale,xyFrameRender:xyFrameRender,defined:defined})}var d=baseD.coordinates?baseD:findPointByID({point:baseD,idAccessor:idAccessor,lines:lines,xScale:xScale,projectedX:projectedX,xAccessor:xAccessor});if(!d)return null;var margin=calculateMargin({margin:_this.props.margin,axes:_this.state.axesData,title:_this.state.annotatedSettings.title});var _d=adjustedPositionSize({size:_this.props.size,margin:margin}),adjustedPosition=_d.adjustedPosition,adjustedSize=_d.adjustedSize;if(!d.coordinates&&!d.bounds){screenCoordinates=[relativeX({point:d,projectedXMiddle:projectedXMiddle,projectedX:projectedX,xAccessor:xAccessor,xScale:xScale})||0,relativeY({point:d,projectedYMiddle:projectedYMiddle,projectedY:projectedY,yAccessor:yAccessor,yScale:yScale,showLinePoints:showLinePoints})||0]}else if(!d.bounds){screenCoordinates=d.coordinates.reduce(function(coords,p){var xCoordinate=relativeX({point:p,projectedXMiddle:projectedXMiddle,projectedX:projectedX,xAccessor:xAccessor,xScale:xScale});var yCoordinate=relativeY({point:p,projectedYMiddle:projectedYMiddle,projectedY:projectedY,yAccessor:yAccessor,yScale:yScale});if(Array.isArray(yCoordinate)){return __spread(coords,[[xCoordinate,Math.min.apply(Math,__spread(yCoordinate))],[xCoordinate,Math.max.apply(Math,__spread(yCoordinate))]])}else if(Array.isArray(xCoordinate)){return __spread(coords,[[Math.min.apply(Math,__spread(xCoordinate)),yCoordinate],[Math.max.apply(Math,__spread(xCoordinate)),yCoordinate]])}else{return __spread(coords,[[xCoordinate,yCoordinate]])}},[])}var voronoiHover=annotationLayer.voronoiHover;var customSVG=_this.props.svgAnnotationRules&&_this.props.svgAnnotationRules({d:d,i:i,screenCoordinates:screenCoordinates,xScale:xScale,yScale:yScale,xAccessor:xAccessor,yAccessor:yAccessor,xyFrameProps:_this.props,xyFrameState:_this.state,summaries:summaries,points:points,lines:lines,voronoiHover:voronoiHover,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer});if(_this.props.svgAnnotationRules!==undefined&&customSVG!==null){return customSVG}else if(d.type==="desaturation-layer"){return desaturationLayer({style:d.style instanceof Function?d.style(d,i):d.style,size:adjustedSize,i:i,key:d.key})}else if(d.type==="xy"||d.type==="frame-hover"){return svgXYAnnotation({d:d,i:i,screenCoordinates:screenCoordinates})}else if(d.type==="react-annotation"||typeof d.type==="function"){return basicReactAnnotation({d:d,screenCoordinates:screenCoordinates,i:i})}else if(d.type==="enclose"){return svgEncloseAnnotation({d:d,screenCoordinates:screenCoordinates,i:i})}else if(d.type==="enclose-rect"){return svgRectEncloseAnnotation({d:d,screenCoordinates:screenCoordinates,i:i})}else if(d.type==="enclose-hull"){return svgHullEncloseAnnotation({d:d,screenCoordinates:screenCoordinates,i:i})}else if(d.type==="x"){return svgXAnnotation({d:d,screenCoordinates:screenCoordinates,i:i,adjustedSize:adjustedSize})}else if(d.type==="y"){return svgYAnnotation({d:d,screenCoordinates:screenCoordinates,i:i,adjustedSize:adjustedSize,adjustedPosition:adjustedPosition})}else if(d.type==="bounds"){return svgBoundsAnnotation({d:d,i:i,adjustedSize:adjustedSize,xAccessor:xAccessor,yAccessor:yAccessor,xScale:xScale,yScale:yScale})}else if(d.type==="line"){return svgLineAnnotation({d:d,i:i,screenCoordinates:screenCoordinates})}else if(d.type==="area"){return svgAreaAnnotation({d:d,i:i,xScale:xScale,xAccessor:xAccessor,yScale:yScale,yAccessor:yAccessor,annotationLayer:annotationLayer})}else if(d.type==="horizontal-points"){return svgHorizontalPointsAnnotation({d:d,lines:lines.data,points:points.data,xScale:xScale,yScale:yScale,pointStyle:points.styleFn})}else if(d.type==="vertical-points"){return svgVerticalPointsAnnotation({d:d,lines:lines.data,points:points.data,xScale:xScale,yScale:yScale,pointStyle:points.styleFn})}return null};_this.defaultXYHTMLRule=function(_a){var baseD=_a.d,i=_a.i,lines=_a.lines,summaries=_a.summaries,points=_a.points,annotationLayer=_a.annotationLayer;var xAccessor=_this.state.xAccessor;var yAccessor=_this.state.yAccessor;var showLinePoints=_this.props.showLinePoints;var xScale=_this.state.xScale;var yScale=_this.state.yScale;var voronoiHover=annotationLayer.voronoiHover;var screenCoordinates=[];var useSpans=_this.props.useSpans;var idAccessor=_this.state.annotatedSettings.lineIDAccessor;var d=findPointByID({point:baseD,idAccessor:idAccessor,lines:lines,xScale:xScale,projectedX:projectedX,xAccessor:xAccessor});if(!d){return null}var xCoord=d[projectedXMiddle]||d[projectedX]||findFirstAccessorValue(xAccessor,d);var yCoord=d[projectedYMiddle]||d[projectedY]||findFirstAccessorValue(yAccessor,d);var xString=xCoord&&xCoord.toString?xCoord.toString():xCoord;var yString=yCoord&&yCoord.toString?yCoord.toString():yCoord;var margin=calculateMargin({margin:_this.props.margin,axes:_this.state.axesData,title:_this.state.annotatedSettings.title});var _b=adjustedPositionSize({size:_this.props.size,margin:margin}),adjustedPosition=_b.adjustedPosition,adjustedSize=_b.adjustedSize;if(!d.coordinates){screenCoordinates=[xScale(xCoord)||0,relativeY({point:d,projectedYMiddle:projectedYMiddle,projectedY:projectedY,showLinePoints:showLinePoints,yAccessor:yAccessor,yScale:yScale})||0]}else{screenCoordinates=d.coordinates.map(function(p){var foundP=findPointByID({point:__assign({x:0,y:0},p),idAccessor:idAccessor,lines:lines,xScale:xScale,projectedX:projectedX,xAccessor:xAccessor});return[(xScale(findFirstAccessorValue(xAccessor,d))||0)+adjustedPosition[0],(relativeY({point:foundP,projectedYMiddle:projectedYMiddle,projectedY:projectedY,yAccessor:yAccessor,yScale:yScale})||0)+adjustedPosition[1]]})}var customAnnotation=_this.props.htmlAnnotationRules&&_this.props.htmlAnnotationRules({d:d,i:i,screenCoordinates:screenCoordinates,xScale:xScale,yScale:yScale,xAccessor:xAccessor,yAccessor:yAccessor,xyFrameProps:_this.props,xyFrameState:_this.state,summaries:summaries,points:points,lines:lines,voronoiHover:voronoiHover,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer});if(_this.props.htmlAnnotationRules&&customAnnotation!==null){return customAnnotation}if(d.type==="frame-hover"){var content=React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},React.createElement("p",{key:"html-annotation-content-1"},xString),React.createElement("p",{key:"html-annotation-content-2"},yString),d.percent?React.createElement("p",{key:"html-annotation-content-3"},Math.floor(d.percent*1e3)/10,"%"):null);if(d.type==="frame-hover"&&_this.props.tooltipContent){content=_this.props.tooltipContent(d)}return htmlTooltipAnnotation({content:content,screenCoordinates:screenCoordinates,i:i,d:d,useSpans:useSpans})}return null};return _this}XYFrame.prototype.componentWillUnmount=function(){if(this.props.onUnmount){this.props.onUnmount(this.props,this.state)}};XYFrame.prototype.componentWillMount=function(){Object.keys(this.props).forEach(function(d){if(!xyframeproptypes[d]){if(ordinalframeproptypes[d]){console.error(d+" is an OrdinalFrame prop are you sure you're using the right frame?")}else if(networkframeproptypes[d]){console.error(d+" is a NetworkFrame prop are you sure you're using the right frame?")}else{console.error(d+" is not a valid XYFrame prop")}}});this.calculateXYFrame(this.props,true)};XYFrame.prototype.componentWillReceiveProps=function(nextProps){var _this=this;var _a=this.state,_b=_a.xExtent,oldXExtent=_b===void 0?[]:_b,_c=_a.yExtent,oldYExtent=_c===void 0?[]:_c,oldSize=_a.size,oldDataVersion=_a.dataVersion,lineData=_a.lineData,summaryData=_a.summaryData,pointData=_a.pointData;var baseNewXExtent=nextProps.xExtent,baseNewYExtent=nextProps.yExtent,newSize=nextProps.size,newDataVersion=nextProps.dataVersion,newLines=nextProps.lines,areas=nextProps.areas,_d=nextProps.summaries,newSummaries=_d===void 0?areas:_d,newPoints=nextProps.points;var newXExtent=extentValue(baseNewXExtent);var newYExtent=extentValue(baseNewYExtent);var extentChange=oldXExtent[0]!==newXExtent[0]&&newXExtent[0]!==undefined||oldYExtent[0]!==newYExtent[0]&&newYExtent[0]!==undefined||oldXExtent[1]!==newXExtent[1]&&newXExtent[1]!==undefined||oldYExtent[1]!==newYExtent[1]&&newYExtent[1]!==undefined;var lineChange=lineData!==newLines||Array.isArray(lineData)&&Array.isArray(newLines)&&!!lineData.find(function(p){return newLines.indexOf(p)===-1});var summaryChange=summaryData!==newSummaries||Array.isArray(summaryData)&&Array.isArray(newSummaries)&&!!summaryData.find(function(p){return newSummaries.indexOf(p)===-1});var pointChange=pointData!==newPoints||Array.isArray(pointData)&&Array.isArray(newPoints)&&!!pointData.find(function(p){return newPoints.indexOf(p)===-1});if(oldDataVersion&&oldDataVersion!==newDataVersion||!this.state.fullDataset){this.calculateXYFrame(nextProps,true)}else if(lineChange||summaryChange||pointChange||oldSize[0]!==newSize[0]||oldSize[1]!==newSize[1]||extentChange||!oldDataVersion&&xyFrameChangeProps.find(function(d){return _this.props[d]!==nextProps[d]})){var dataChanged=lineChange||summaryChange||pointChange||extentChange||!!xyFrameDataProps.find(function(d){return _this.props[d]!==nextProps[d]});this.calculateXYFrame(nextProps,dataChanged)}};XYFrame.prototype.screenScales=function(_a){var xExtent=_a.xExtent,yExtent=_a.yExtent,adjustedSize=_a.adjustedSize,xScaleType=_a.xScaleType,yScaleType=_a.yScaleType;var xDomain=[0,adjustedSize[0]];var yDomain=[adjustedSize[1],0];var xScale=xScaleType;var yScale=yScaleType;if(xScaleType.domain){xScaleType.domain(xExtent)}if(yScaleType.domain){yScaleType.domain(yExtent)}xScaleType.range(xDomain);yScaleType.range(yDomain);return{xScale:xScale,yScale:yScale}};XYFrame.prototype.render=function(){var _a=this.props,downloadFields=_a.downloadFields,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor,lines=_a.lines,points=_a.points,areas=_a.areas,_b=_a.summaries,summaries=_b===void 0?areas:_b,name=_a.name,download=_a.download,size=_a.size,className=_a.className,annotationSettings=_a.annotationSettings,annotations=_a.annotations,additionalDefs=_a.additionalDefs,hoverAnnotation=_a.hoverAnnotation,interaction=_a.interaction,customClickBehavior=_a.customClickBehavior,customHoverBehavior=_a.customHoverBehavior,customDoubleClickBehavior=_a.customDoubleClickBehavior,canvasPostProcess=_a.canvasPostProcess,baseMarkProps=_a.baseMarkProps,useSpans=_a.useSpans,canvasAreas=_a.canvasAreas,_c=_a.canvasSummaries,canvasSummaries=_c===void 0?canvasAreas:_c,canvasPoints=_a.canvasPoints,canvasLines=_a.canvasLines,afterElements=_a.afterElements,beforeElements=_a.beforeElements,renderOrder=_a.renderOrder,matte=_a.matte,frameKey=_a.frameKey,showLinePoints=_a.showLinePoints;var _d=this.state,backgroundGraphics=_d.backgroundGraphics,foregroundGraphics=_d.foregroundGraphics,adjustedPosition=_d.adjustedPosition,adjustedSize=_d.adjustedSize,margin=_d.margin,axes=_d.axes,axesTickLines=_d.axesTickLines,xScale=_d.xScale,yScale=_d.yScale,dataVersion=_d.dataVersion,fullDataset=_d.fullDataset,areaAnnotations=_d.areaAnnotations,legendSettings=_d.legendSettings,xyFrameRender=_d.xyFrameRender,annotatedSettings=_d.annotatedSettings,overlay=_d.overlay;var downloadButton;if(download&&(points||lines)){var downloadData=download==="points"?mapParentsToPoints(fullDataset):points||lines||summaries||areas;downloadButton=React.createElement(DownloadButton,{csvName:name+"-"+(new Date).toJSON(),width:Math.floor(size[0]),data:xyDownloadMapping({data:downloadData,xAccessor:download==="points"||points?stringToArrayFn(xAccessor):undefined,yAccessor:download==="points"||points?stringToArrayFn(yAccessor):undefined,fields:downloadFields})})}return React.createElement(Frame,{name:"xyframe",renderPipeline:xyFrameRender,adjustedPosition:adjustedPosition,size:size,projectedCoordinateNames:projectedCoordinateNames,xScale:xScale,yScale:yScale,axes:axes,axesTickLines:axesTickLines,title:annotatedSettings.title,dataVersion:dataVersion,matte:matte,className:className,adjustedSize:adjustedSize,frameKey:frameKey||xyframeKey,additionalDefs:additionalDefs,hoverAnnotation:hoverAnnotation,defaultSVGRule:this.defaultXYSVGRule,defaultHTMLRule:this.defaultXYHTMLRule,annotations:areaAnnotations.length>0?__spread(annotations,areaAnnotations):annotations,annotationSettings:annotationSettings,legendSettings:legendSettings,projectedYMiddle:projectedYMiddle,interaction:interaction,customClickBehavior:customClickBehavior,customHoverBehavior:customHoverBehavior,customDoubleClickBehavior:customDoubleClickBehavior,points:fullDataset,showLinePoints:typeof showLinePoints==="string"?showLinePoints:undefined,margin:margin,backgroundGraphics:backgroundGraphics,foregroundGraphics:foregroundGraphics,beforeElements:beforeElements,afterElements:afterElements,downloadButton:downloadButton,disableContext:this.props.disableContext,canvasPostProcess:canvasPostProcess,baseMarkProps:baseMarkProps,useSpans:useSpans,canvasRendering:!!(canvasSummaries||canvasPoints||canvasLines),renderOrder:renderOrder,overlay:overlay})};XYFrame.defaultProps={annotations:[],foregroundGraphics:undefined,size:[500,500],className:"",lineType:"line",name:"xyframe",dataVersion:undefined};XYFrame.displayName="XYFrame";return XYFrame}(React.Component);var bracket=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});function makeCurlyBrace(x1,y1,x2,y2,w,q){var dx=x1-x2;var dy=y1-y2;var len=Math.sqrt(dx*dx+dy*dy);dx=dx/len;dy=dy/len;var qx1=x1+q*w*dy;var qy1=y1-q*w*dx;var qx2=x1-.25*len*dx+(1-q)*w*dy;var qy2=y1-.25*len*dy-(1-q)*w*dx;var tx1=x1-.5*len*dx+w*dy;var ty1=y1-.5*len*dy-w*dx;var qx3=x2+q*w*dy;var qy3=y2-q*w*dx;var qx4=x1-.75*len*dx+(1-q)*w*dy;var qy4=y1-.75*len*dy-(1-q)*w*dx;return"M "+x1+" "+y1+" Q "+qx1+" "+qy1+" "+qx2+" "+qy2+" T "+tx1+" "+ty1+" M "+x2+" "+y2+" Q "+qx3+" "+qy3+" "+qx4+" "+qy4+" T "+tx1+" "+ty1}exports.default=function(_ref){var height=_ref.height,width=_ref.width,depth=_ref.depth,type=_ref.type,editMode=_ref.editMode;var handles=[];var data=void 0;var bracket=void 0;if(type==="square"){if(height){data=[[0,0],[depth,0],[depth,height],[0,height]]}else if(width){data=[[0,0],[0,depth],[width,depth],[width,0]]}bracket=(0,_Builder.lineBuilder)({data:data,className:"subject"})}else if(type==="curly"){bracket=(0,_Builder.pathBuilder)({d:makeCurlyBrace(0,0,width||0,height||0,height&&height>0||width&&width<0?-depth:depth,.55),className:"subject"})}if(editMode){handles=[{x:height?depth:width/2,y:height?height/2:depth,key:"depth",type:height?"X":"Y"},{x:width||0,y:height||0,key:height?"height":"width"}]}bracket.attrs["fill-opacity"]=.1;return{components:[bracket],handles:handles}}});var bracket$1=unwrapExports(bracket);var bracket$2=Object.freeze({default:bracket$1,__moduleExports:bracket});var require$$1$g=bracket$2&&bracket$1||bracket$2;var SubjectBracket_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireDefault(React__default);var _bracket=_interopRequireDefault(require$$1$g);var _Subject2=_interopRequireDefault(require$$2$4);var _propTypes=_interopRequireDefault(require$$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof$1(obj){if(typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"){_typeof$1=function _typeof$1(obj){return _typeof(obj)}}else{_typeof$1=function _typeof$1(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof(obj)}}return _typeof$1(obj)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof$1(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var SubjectBracket=function(_Subject){_inherits(SubjectBracket,_Subject);function SubjectBracket(){_classCallCheck(this,SubjectBracket);return _possibleConstructorReturn(this,_getPrototypeOf(SubjectBracket).apply(this,arguments))}_createClass(SubjectBracket,[{key:"getComponents",value:function getComponents(_ref){var height=_ref.height,width=_ref.width,_ref$depth=_ref.depth,depth=_ref$depth===void 0?20:_ref$depth,_ref$type=_ref.type,type=_ref$type===void 0?"square":_ref$type,editMode=_ref.editMode;var components=(0,_bracket.default)({height:height,width:width,depth:depth,type:type,editMode:editMode});var handleKeys={height:height,width:width,depth:depth};components.handleFunction=function(h,data){if(h.key==="depth"){return{depth:depth+data["oDelta".concat(h.type)]}}else{return _defineProperty({},h.key,handleKeys[h.key]+data[h.key==="width"?"oDeltaX":"oDeltaY"])}};return components}}]);return SubjectBracket}(_Subject2.default);exports.default=SubjectBracket;SubjectBracket.propTypes={width:_propTypes.default.number,height:_propTypes.default.number,depth:_propTypes.default.number,editMode:_propTypes.default.bool}});var SubjectBracket=unwrapExports(SubjectBracket_1);var SubjectBracket$1=Object.freeze({default:SubjectBracket,__moduleExports:SubjectBracket_1});var BracketNote_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=BracketNote;var _react=_interopRequireDefault(React__default);var _Note=_interopRequireDefault(require$$1$8);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}function BracketNote(_ref){var width=_ref.width,height=_ref.height,depth=_ref.depth,rest=_objectWithoutProperties(_ref,["width","height","depth"]);var dx=rest.dx,orientation,align="middle",dy=rest.dy;if(height){if(!dy)dy=height/2;if(!dx)dx=depth;orientation="leftRight"}else if(width){if(!dx)dx=width/2;if(!dy)dy=depth;orientation="topBottom"}return _react.default.createElement(_Note.default,_extends({align:align,orientation:orientation,padding:10},rest,{editMode:false,dx:dx,dy:dy}))}});var BracketNote=unwrapExports(BracketNote_1);var BracketNote$1=Object.freeze({default:BracketNote,__moduleExports:BracketNote_1});var require$$0$c=SubjectBracket$1&&SubjectBracket||SubjectBracket$1;var require$$1$h=BracketNote$1&&BracketNote||BracketNote$1;var AnnotationBracket_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=AnnotationBracket;var _SubjectBracket=_interopRequireDefault(require$$0$c);var _BracketNote=_interopRequireDefault(require$$1$h);var _classnames=_interopRequireDefault(require$$2);var _Type=_interopRequireDefault(require$$3$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function AnnotationBracket(props){var className=(0,_classnames.default)("bracket",props.className);return(0,_Type.default)(_objectSpread({disable:["connector"]},props,{className:className}),null,null,_SubjectBracket.default,{depth:20},_BracketNote.default)}});var AnnotationBracket=unwrapExports(AnnotationBracket_1);function polarToCartesian(centerX,centerY,radius,angleInDegrees){var angleInRadians=(angleInDegrees-90)*Math.PI/180;return{x:centerX+radius*Math.cos(angleInRadians),y:centerY+radius*Math.sin(angleInRadians)}}function pieContentGenerator(_a){var column=_a.column,useSpans=_a.useSpans;return React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},React.createElement("p",{key:"or-annotation-1"},column.name),React.createElement("p",{key:"or-annotation-2"},(column.pct*100).toFixed(0)+"%"))}function arcBracket(_a){var x=_a.x,y=_a.y,radius=_a.radius,startAngle=_a.startAngle,endAngle=_a.endAngle,inset=_a.inset,outset=_a.outset,_b=_a.curly,curly=_b===void 0?true:_b;var start=polarToCartesian(x,y,radius+outset,endAngle);var end=polarToCartesian(x,y,radius+outset,startAngle);var innerStart=polarToCartesian(x,y,radius+outset-inset,endAngle);var innerEnd=polarToCartesian(x,y,radius+outset-inset,startAngle);var angleSize=endAngle-startAngle;var largeArcFlag=angleSize<=180?"0":"1";var d;if(curly){var curlyOffset=Math.min(10,angleSize/4);var middleLeft=polarToCartesian(x,y,radius+outset,(startAngle+endAngle)/2+curlyOffset);var middle=polarToCartesian(x,y,radius+outset+10,(startAngle+endAngle)/2);var middleRight=polarToCartesian(x,y,radius+outset,(startAngle+endAngle)/2-curlyOffset);d=["M",innerStart.x,innerStart.y,"L",start.x,start.y,"A",radius+outset,radius+outset,0,0,0,middleLeft.x,middleLeft.y,"A",radius+outset,radius+outset,1,0,1,middle.x,middle.y,"A",radius+outset,radius+outset,1,0,1,middleRight.x,middleRight.y,"A",radius+outset,radius+outset,0,0,0,end.x,end.y,"L",innerEnd.x,innerEnd.y].join(" ")}else{d=["M",innerStart.x,innerStart.y,"L",start.x,start.y,"A",radius+outset,radius+outset,0,largeArcFlag,0,end.x,end.y,"L",innerEnd.x,innerEnd.y].join(" ")}var midAngle=(startAngle+endAngle)/2;var textOffset,largeTextArcFlag,finalTextEnd,finalTextStart,arcFlip;var lowerArc=midAngle>90&&midAngle<270;if(lowerArc){textOffset=12;largeTextArcFlag=endAngle-startAngle<=180?"0":"1";arcFlip=0}else{largeTextArcFlag=endAngle-startAngle<=180?"0":"1";textOffset=5;arcFlip=1}textOffset+=curly?10:0;var textStart=polarToCartesian(x,y,radius+outset+textOffset,endAngle);var textEnd=polarToCartesian(x,y,radius+outset+textOffset,startAngle);if(lowerArc){finalTextStart=textStart;finalTextEnd=textEnd}else{finalTextStart=textEnd;finalTextEnd=textStart}var textD=["M",finalTextStart.x,finalTextStart.y,"A",radius+outset+textOffset,radius+outset+textOffset,arcFlip,largeTextArcFlag,arcFlip,finalTextEnd.x,finalTextEnd.y].join(" ");return{arcPath:d,textArcPath:textD}}var getColumnScreenCoordinates=function(_a){var d=_a.d,projectedColumns=_a.projectedColumns,oAccessor=_a.oAccessor,summaryType=_a.summaryType,type=_a.type,projection=_a.projection,adjustedPosition=_a.adjustedPosition,adjustedSize=_a.adjustedSize;var _b;var column=d.column||projectedColumns[d.facetColumn]||projectedColumns[findFirstAccessorValue(oAccessor,d)];if(!column){return{coordinates:[0,0],pieces:undefined,column:undefined}}var pieces=column.pieceData||column.pieces;var positionValue=summaryType.type&&summaryType.type!=="none"||["swarm","point","clusterbar"].find(function(p){return p===type.type})?max$2(pieces.map(function(p){return p.scaledValue})):projection==="horizontal"?max$2(pieces.map(function(p){return p.scaledValue+p.bottom})):min$2(pieces.map(function(p){return p.bottom-p.scaledValue}));var xPosition=column.middle+adjustedPosition[0];var yPosition=projection==="horizontal"?adjustedSize[0]-positionValue:summaryType.type&&summaryType.type!=="none"||["swarm","point","clusterbar"].find(function(p){return p===type.type})?adjustedSize[1]-positionValue:positionValue;yPosition+=10;if(projection==="horizontal"){yPosition=column.middle;xPosition=positionValue+adjustedPosition[0]}else if(projection==="radial"){_b=__read(pointOnArcAtAngle([d.arcAngles.translate[0],d.arcAngles.translate[1]],d.arcAngles.midAngle,d.arcAngles.length),2),xPosition=_b[0],yPosition=_b[1];yPosition+=10}return{coordinates:[xPosition,yPosition],pieces:pieces,column:column}};var svgHighlightRule=function(_a){var d=_a.d,pieceIDAccessor=_a.pieceIDAccessor,orFrameRender=_a.orFrameRender,oAccessor=_a.oAccessor;var thisID=pieceIDAccessor(d);var thisO=findFirstAccessorValue(oAccessor,d);var pieces=orFrameRender.pieces;var styleFn=pieces.styleFn;var foundPieces=pieces&&pieces.data.filter(function(p){return(thisID===undefined||pieceIDAccessor(__assign({},p.piece,p.piece.data))===thisID)&&(thisO===undefined||findFirstAccessorValue(oAccessor,p.piece.data)===thisO)}).map(function(p,q){var styleObject={style:styleFn(__assign({},p.piece,p.piece.data))};if(d.style&&typeof d.style==="function"){styleObject={style:__assign({},styleObject,d.style(__assign({},p.piece,p.piece.data)))}}else if(d.style){styleObject={style:__assign({},styleObject,d.style)}}var styledD=__assign({},p.renderElement,styleObject);var className="highlight-annotation "+(d.class&&typeof d.class==="function"&&d.class(p.piece.data,q)||d.class&&d.class||"");if(React.isValidElement(p.renderElement)){return React.cloneElement(p.renderElement,__assign({},styleObject,{className:className}))}return React.createElement(lib_2,__assign({fill:"none",stroke:"black",strokeWidth:"2px",key:"highlight-piece-"+q},styledD,{className:className}))})||[];return __spread(foundPieces)};var findIDPiece=function(pieceIDAccessor,oColumn,d){var foundIDValue=pieceIDAccessor(d);var pieceID=foundIDValue===""&&d.rName?d.rName:foundIDValue;var basePieces=oColumn&&oColumn.pieceData.filter(function(r){return r.rName===pieceID||pieceIDAccessor(r.data)===pieceID});if(pieceID===""||basePieces===undefined||basePieces===false||basePieces.length!==1)return d;var basePiece=basePieces[0];var reactAnnotationProps=["type","label","note","connector","disabled","color","subject"];if(basePiece){reactAnnotationProps.forEach(function(prop){if(d[prop])basePiece[prop]=d[prop]})}return basePiece};var screenProject=function(_a){var p=_a.p,adjustedSize=_a.adjustedSize,rScale=_a.rScale,oColumn=_a.oColumn,rAccessor=_a.rAccessor,idPiece=_a.idPiece,projection=_a.projection,rScaleType=_a.rScaleType;var pValue=findFirstAccessorValue(rAccessor,p)||p.value;var o;if(oColumn){o=oColumn.middle}else{o=0}if(oColumn&&projection==="radial"){return pointOnArcAtAngle([adjustedSize[0]/2,adjustedSize[1]/2],oColumn.pct_middle,idPiece&&(idPiece.x||idPiece.scaledValue)?idPiece.x/2||(idPiece.bottom+idPiece.scaledValue/2)/2:pValue/2)}if(projection==="horizontal"){return[idPiece&&(idPiece.x||idPiece.scaledValue)?idPiece.x===undefined?idPiece.x:idPiece.bottom+idPiece.scaledValue/2:rScale(pValue),o]}var newScale=rScaleType.copy().domain(rScale.domain()).range(rScale.range().reverse());return[o,idPiece&&(idPiece.x||idPiece.scaledValue)?idPiece.y===undefined?idPiece.bottom-idPiece.scaledValue:idPiece.y:newScale(pValue)]};var svgORRule=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates,projection=_a.projection;return React.createElement(lib_2,{markType:"text",key:d.label+"annotationtext"+i,forceUpdate:true,x:screenCoordinates[0]+(projection==="horizontal"?10:0),y:screenCoordinates[1]+(projection==="vertical"?10:0),className:"annotation annotation-or-label "+(d.className||""),textAnchor:"middle"},d.label)};var basicReactAnnotationRule=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates;var noteData=Object.assign({dx:0,dy:0,note:{label:d.label,orientation:d.orientation,align:d.align},connector:{end:"arrow"}},d,{x:screenCoordinates[0],y:screenCoordinates[1],type:typeof d.type==="function"?d.type:undefined,screenCoordinates:screenCoordinates});if(d.fixedX)noteData.x=d.fixedX;if(d.fixedY)noteData.y=d.fixedY;return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgEncloseRule=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates;var circle=packEnclose(screenCoordinates.map(function(p){return{x:p[0],y:p[1],r:2}}));return circleEnclosure({d:d,i:i,circle:circle})};var svgRRule=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates,rScale=_a.rScale,rAccessor=_a.rAccessor,adjustedSize=_a.adjustedSize,adjustedPosition=_a.adjustedPosition,projection=_a.projection;var x,y,xPosition,yPosition,subject,dx,dy;if(projection==="radial"){return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:Object.assign({dx:50,dy:50,note:{label:d.label},connector:{end:"arrow"}},d,{type:AnnotationCalloutCircle,subject:{radius:rScale(findFirstAccessorValue(rAccessor,d))/2,radiusPadding:0},x:adjustedSize[0]/2,y:adjustedSize[1]/2})})}else if(projection==="horizontal"){dx=50;dy=50;yPosition=d.offset||i*25;x=screenCoordinates[0];y=yPosition;subject={x:x,y1:0,y2:adjustedSize[1]+adjustedPosition[1]}}else{dx=50;dy=-20;xPosition=d.offset||i*25;y=screenCoordinates[1];x=xPosition;subject={y:y,x1:0,x2:adjustedSize[0]+adjustedPosition[0]}}var noteData=Object.assign({dx:dx,dy:dy,note:{label:d.label},connector:{end:"arrow"}},d,{type:AnnotationXYThreshold,x:x,y:y,subject:subject});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgCategoryRule=function(_a){var projection=_a.projection,d=_a.d,i=_a.i,categories=_a.categories,adjustedSize=_a.adjustedSize;var _b=d.bracketType,bracketType=_b===void 0?"curly":_b,_c=d.position,position=_c===void 0?projection==="vertical"?"top":"left":_c,_d=d.depth,depth=_d===void 0?30:_d,_e=d.offset,offset=_e===void 0?0:_e,_f=d.padding,padding=_f===void 0?0:_f;var actualCategories=Array.isArray(d.categories)?d.categories:[d.categories];var cats=actualCategories.map(function(c){return categories[c]});if(projection==="radial"){var arcPadding_1=padding/adjustedSize[1];var leftX=min$2(cats.map(function(p){return p.pct_start+p.pct_padding/2+arcPadding_1/2}));var rightX=max$2(cats.map(function(p){return p.pct_start+p.pct-p.pct_padding/2-arcPadding_1/2}));var chartSize=Math.min(adjustedSize[0],adjustedSize[1])/2;var centerX=adjustedSize[0]/2;var centerY=adjustedSize[1]/2;var _g=arcBracket({x:0,y:0,radius:chartSize,startAngle:leftX*360,endAngle:rightX*360,inset:depth,outset:offset,curly:bracketType==="curly"}),arcPath=_g.arcPath,textArcPath=_g.textArcPath;var textPathID="text-path-"+i+"-"+Math.random();return React.createElement("g",{className:"category-annotation annotation",transform:"translate("+centerX+","+centerY+")"},React.createElement("path",{d:arcPath,fill:"none",stroke:"black"}),React.createElement("path",{id:textPathID,d:textArcPath,style:{display:"none"}}),React.createElement("text",{"font-size":"12.5"},React.createElement("textPath",{startOffset:"50%",textAnchor:"middle",xlinkHref:"#"+textPathID},d.label)))}else{var leftX=min$2(cats.map(function(p){return p.x}));var rightX=max$2(cats.map(function(p){return p.x+p.width}));if(projection==="vertical"){var yPosition=position==="top"?0:adjustedSize[1];yPosition+=position==="top"?-offset:offset;var noteData={type:AnnotationBracket,y:yPosition,x:leftX-padding,note:{title:d.title||d.label,label:d.title?d.label:undefined},subject:{type:bracketType,width:rightX-leftX+padding*2,depth:position==="top"?-depth:depth}};return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})}else if(projection==="horizontal"){var yPosition=position==="left"?0:adjustedSize[0];yPosition+=position==="left"?-offset:offset;var noteData={type:AnnotationBracket,x:yPosition,y:leftX-padding,note:{title:d.title||d.label,label:d.title?d.label:undefined},subject:{type:bracketType,height:rightX-leftX+padding*2,depth:position==="left"?-depth:depth}};return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})}}};var htmlFrameHoverRule=function(_a){var d=_a.d,i=_a.i,rAccessor=_a.rAccessor,oAccessor=_a.oAccessor,projection=_a.projection,tooltipContent=_a.tooltipContent,useSpans=_a.useSpans,pieceIDAccessor=_a.pieceIDAccessor,projectedColumns=_a.projectedColumns,adjustedSize=_a.adjustedSize,rScale=_a.rScale,type=_a.type,rScaleType=_a.rScaleType;tooltipContent=tooltipContent==="pie"?function(){return pieContentGenerator({column:d.column,useSpans:useSpans})}:tooltipContent;var contentFill;var pO=findFirstAccessorValue(oAccessor,d)||d.column;var oColumn=projectedColumns[pO];var idPiece=findIDPiece(pieceIDAccessor,oColumn,d);if(!idPiece){return null}var screenCoordinates=(type.type==="clusterbar"||type.type==="point"||type.type==="swarm")&&d.x!==undefined&&d.y!==undefined||d.isSummaryData?[d.x,d.y]:screenProject({p:d,adjustedSize:adjustedSize,rScale:rScale,oColumn:oColumn,rAccessor:rAccessor,idPiece:idPiece,projection:projection,rScaleType:rScaleType});if(d.isSummaryData){var summaryContent_1=d.label;if(d.pieces&&d.pieces.length!==0){if(d.pieces.length===1){summaryContent_1=[];rAccessor.forEach(function(actualRAccessor){summaryContent_1.push(actualRAccessor(d.pieces[0].data))})}else{summaryContent_1=[];rAccessor.forEach(function(actualRAccessor){var pieceData=extent(d.pieces.map(function(p){return p.data}).map(actualRAccessor));summaryContent_1.push("From "+pieceData[0]+" to "+pieceData[1])})}}var summaryLabel=React.createElement("p",{key:"html-annotation-content-2"},summaryContent_1);contentFill=[React.createElement("p",{key:"html-annotation-content-1"},d.key),summaryLabel,React.createElement("p",{key:"html-annotation-content-3"},d.value)]}else if(d.data){contentFill=[];oAccessor.forEach(function(actualOAccessor,i){if(actualOAccessor(idPiece.data))contentFill.push(React.createElement("p",{key:"html-annotation-content-o-"+i},actualOAccessor(idPiece.data).toString()))});rAccessor.forEach(function(actualRAccessor,i){if(actualRAccessor(idPiece.data))contentFill.push(React.createElement("p",{key:"html-annotation-content-r-"+i},actualRAccessor(idPiece.data).toString()))})}else if(d.label){contentFill=d.label}var content=React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},contentFill);if(d.type==="frame-hover"&&tooltipContent&&idPiece){content=tooltipContent(__assign({},idPiece,idPiece.data))}return React.createElement(SpanOrDiv,{span:useSpans,key:"xylabel-"+i,className:"annotation annotation-or-label "+projection+" "+(d.className||""),style:{position:"absolute",top:screenCoordinates[1]+"px",left:screenCoordinates[0]+"px"}},content)};var htmlColumnHoverRule=function(_a){var d=_a.d,i=_a.i,summaryType=_a.summaryType,oAccessor=_a.oAccessor,type=_a.type,adjustedPosition=_a.adjustedPosition,adjustedSize=_a.adjustedSize,projection=_a.projection,tooltipContent=_a.tooltipContent,useSpans=_a.useSpans,projectedColumns=_a.projectedColumns;var _b=getColumnScreenCoordinates({d:d,projectedColumns:projectedColumns,oAccessor:oAccessor,summaryType:summaryType,type:type,projection:projection,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize}),_c=__read(_b.coordinates,2),xPosition=_c[0],yPosition=_c[1],pieces=_b.pieces,column=_b.column;if(column===undefined){return null}var oContent=[];oAccessor.forEach(function(actualOAccessor,i){if(pieces[0].data)oContent.push(React.createElement("p",{key:"or-annotation-o-"+i},actualOAccessor(pieces[0].data).toString()))});var content=React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},oContent,React.createElement("p",{key:"or-annotation-2"},sum$2(pieces.map(function(p){return p.value}).filter(function(p){return p>0}))));if(d.type==="column-hover"&&tooltipContent){if(tooltipContent==="pie"){tooltipContent=pieContentGenerator}content=tooltipContent(__assign({},d,{pieces:pieces.map(function(p){return p.data}),column:column,oAccessor:oAccessor}))}else if(d.label){content=React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},d.label)}return React.createElement(SpanOrDiv,{span:useSpans,key:"orlabel-"+i,className:"annotation annotation-or-label "+projection+" "+(d.className||""),style:{position:"absolute",top:yPosition+"px",left:xPosition+"px"}},content)};var svgRectEncloseRule=function(_a){var d=_a.d,i=_a.i,screenCoordinates=_a.screenCoordinates;var bboxNodes=screenCoordinates.map(function(p){return{x0:p.x0=p[0],x1:p.x1=p[0],y0:p.y0=p[1],y1:p.y1=p[1]}});return rectangleEnclosure({bboxNodes:bboxNodes,d:d,i:i})};var svgOrdinalLine=function(_a){var screenCoordinates=_a.screenCoordinates,d=_a.d,voronoiHover=_a.voronoiHover;var lineGenerator=line$1().x(function(d){return d[0]}).y(function(d){return d[1]});if(d.curve){var interpolator=curveHash[d.curve]||d.curve;lineGenerator.curve(interpolator)}var lineStyle=typeof d.lineStyle==="function"?d.lineStyle(d):d.lineStyle||{};return React.createElement("g",null,React.createElement("path",{stroke:"black",fill:"none",style:lineStyle,d:lineGenerator(screenCoordinates)}),(d.points||d.interactive)&&screenCoordinates.map(function(p,q){var pointStyle=typeof d.pointStyle==="function"?d.pointStyle(d.coordinates[q],q):d.pointStyle||{};return React.createElement("g",{transform:"translate("+p[0]+","+p[1]+")",key:"ordinal-line-point-"+q},d.points&&React.createElement("circle",{style:pointStyle,r:d.radius||5,fill:"black"}),d.interactive&&React.createElement("circle",{style:{pointerEvents:"all"},r:d.hoverRadius||15,fill:"pink",opacity:0,onMouseEnter:function(){return voronoiHover(__assign({type:"frame-hover"},d.coordinates[q],{data:d.coordinates[q]}))},onMouseOut:function(){return voronoiHover()}}),"}")}))};function constant$a(x){return function(){return x}}function jiggle(){return(Math.random()-.5)*1e-6}function tree_add(d){var x=+this._x.call(null,d),y=+this._y.call(null,d);return add(this.cover(x,y),x,y,d)}function add(tree,x,y,d){if(isNaN(x)||isNaN(y))return tree;var parent,node=tree._root,leaf={data:d},x0=tree._x0,y0=tree._y0,x1=tree._x1,y1=tree._y1,xm,ym,xp,yp,right,bottom,i,j;if(!node)return tree._root=leaf,tree;while(node.length){if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym;if(parent=node,!(node=node[i=bottom<<1|right]))return parent[i]=leaf,tree}xp=+tree._x.call(null,node.data);yp=+tree._y.call(null,node.data);if(x===xp&&y===yp)return leaf.next=node,parent?parent[i]=leaf:tree._root=leaf,tree;do{parent=parent?parent[i]=new Array(4):tree._root=new Array(4);if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym}while((i=bottom<<1|right)===(j=(yp>=ym)<<1|xp>=xm));return parent[j]=node,parent[i]=leaf,tree}function addAll(data){var d,i,n=data.length,x,y,xz=new Array(n),yz=new Array(n),x0=Infinity,y0=Infinity,x1=-Infinity,y1=-Infinity;for(i=0;i<n;++i){if(isNaN(x=+this._x.call(null,d=data[i]))||isNaN(y=+this._y.call(null,d)))continue;xz[i]=x;yz[i]=y;if(x<x0)x0=x;if(x>x1)x1=x;if(y<y0)y0=y;if(y>y1)y1=y}if(x1<x0)x0=this._x0,x1=this._x1;if(y1<y0)y0=this._y0,y1=this._y1;this.cover(x0,y0).cover(x1,y1);for(i=0;i<n;++i){add(this,xz[i],yz[i],data[i])}return this}function tree_cover(x,y){if(isNaN(x=+x)||isNaN(y=+y))return this;var x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1;if(isNaN(x0)){x1=(x0=Math.floor(x))+1;y1=(y0=Math.floor(y))+1}else if(x0>x||x>x1||y0>y||y>y1){var z=x1-x0,node=this._root,parent,i;switch(i=(y<(y0+y1)/2)<<1|x<(x0+x1)/2){case 0:do{parent=new Array(4),parent[i]=node,node=parent}while(z*=2,x1=x0+z,y1=y0+z,x>x1||y>y1);break;case 1:do{parent=new Array(4),parent[i]=node,node=parent}while(z*=2,x0=x1-z,y1=y0+z,x0>x||y>y1);break;case 2:do{parent=new Array(4),parent[i]=node,node=parent}while(z*=2,x1=x0+z,y0=y1-z,x>x1||y0>y);break;case 3:do{parent=new Array(4),parent[i]=node,node=parent}while(z*=2,x0=x1-z,y0=y1-z,x0>x||y0>y);break}if(this._root&&this._root.length)this._root=node}else return this;this._x0=x0;this._y0=y0;this._x1=x1;this._y1=y1;return this}function tree_data(){var data=[];this.visit(function(node){if(!node.length)do{data.push(node.data)}while(node=node.next)});return data}function tree_extent(_){return arguments.length?this.cover(+_[0][0],+_[0][1]).cover(+_[1][0],+_[1][1]):isNaN(this._x0)?undefined:[[this._x0,this._y0],[this._x1,this._y1]]}function Quad(node,x0,y0,x1,y1){this.node=node;this.x0=x0;this.y0=y0;this.x1=x1;this.y1=y1}function tree_find(x,y,radius){var data,x0=this._x0,y0=this._y0,x1,y1,x2,y2,x3=this._x1,y3=this._y1,quads=[],node=this._root,q,i;if(node)quads.push(new Quad(node,x0,y0,x3,y3));if(radius==null)radius=Infinity;else{x0=x-radius,y0=y-radius;x3=x+radius,y3=y+radius;radius*=radius}while(q=quads.pop()){if(!(node=q.node)||(x1=q.x0)>x3||(y1=q.y0)>y3||(x2=q.x1)<x0||(y2=q.y1)<y0)continue;if(node.length){var xm=(x1+x2)/2,ym=(y1+y2)/2;quads.push(new Quad(node[3],xm,ym,x2,y2),new Quad(node[2],x1,ym,xm,y2),new Quad(node[1],xm,y1,x2,ym),new Quad(node[0],x1,y1,xm,ym));if(i=(y>=ym)<<1|x>=xm){q=quads[quads.length-1];quads[quads.length-1]=quads[quads.length-1-i];quads[quads.length-1-i]=q}}else{var dx=x-+this._x.call(null,node.data),dy=y-+this._y.call(null,node.data),d2=dx*dx+dy*dy;if(d2<radius){var d=Math.sqrt(radius=d2);x0=x-d,y0=y-d;x3=x+d,y3=y+d;data=node.data}}}return data}function tree_remove(d){if(isNaN(x=+this._x.call(null,d))||isNaN(y=+this._y.call(null,d)))return this;var parent,node=this._root,retainer,previous,next,x0=this._x0,y0=this._y0,x1=this._x1,y1=this._y1,x,y,xm,ym,right,bottom,i,j;if(!node)return this;if(node.length)while(true){if(right=x>=(xm=(x0+x1)/2))x0=xm;else x1=xm;if(bottom=y>=(ym=(y0+y1)/2))y0=ym;else y1=ym;if(!(parent=node,node=node[i=bottom<<1|right]))return this;if(!node.length)break;if(parent[i+1&3]||parent[i+2&3]||parent[i+3&3])retainer=parent,j=i}while(node.data!==d){if(!(previous=node,node=node.next))return this}if(next=node.next)delete node.next;if(previous)return next?previous.next=next:delete previous.next,this;if(!parent)return this._root=next,this;next?parent[i]=next:delete parent[i];if((node=parent[0]||parent[1]||parent[2]||parent[3])&&node===(parent[3]||parent[2]||parent[1]||parent[0])&&!node.length){if(retainer)retainer[j]=node;else this._root=node}return this}function removeAll(data){for(var i=0,n=data.length;i<n;++i){this.remove(data[i])}return this}function tree_root(){return this._root}function tree_size(){var size=0;this.visit(function(node){if(!node.length)do{++size}while(node=node.next)});return size}function tree_visit(callback){var quads=[],q,node=this._root,child,x0,y0,x1,y1;if(node)quads.push(new Quad(node,this._x0,this._y0,this._x1,this._y1));while(q=quads.pop()){if(!callback(node=q.node,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1)&&node.length){var xm=(x0+x1)/2,ym=(y0+y1)/2;if(child=node[3])quads.push(new Quad(child,xm,ym,x1,y1));if(child=node[2])quads.push(new Quad(child,x0,ym,xm,y1));if(child=node[1])quads.push(new Quad(child,xm,y0,x1,ym));if(child=node[0])quads.push(new Quad(child,x0,y0,xm,ym))}}return this}function tree_visitAfter(callback){var quads=[],next=[],q;if(this._root)quads.push(new Quad(this._root,this._x0,this._y0,this._x1,this._y1));while(q=quads.pop()){var node=q.node;if(node.length){var child,x0=q.x0,y0=q.y0,x1=q.x1,y1=q.y1,xm=(x0+x1)/2,ym=(y0+y1)/2;if(child=node[0])quads.push(new Quad(child,x0,y0,xm,ym));if(child=node[1])quads.push(new Quad(child,xm,y0,x1,ym));if(child=node[2])quads.push(new Quad(child,x0,ym,xm,y1));if(child=node[3])quads.push(new Quad(child,xm,ym,x1,y1))}next.push(q)}while(q=next.pop()){callback(q.node,q.x0,q.y0,q.x1,q.y1)}return this}function defaultX$1(d){return d[0]}function tree_x(_){return arguments.length?(this._x=_,this):this._x}function defaultY$1(d){return d[1]}function tree_y(_){return arguments.length?(this._y=_,this):this._y}function quadtree(nodes,x,y){var tree=new Quadtree(x==null?defaultX$1:x,y==null?defaultY$1:y,NaN,NaN,NaN,NaN);return nodes==null?tree:tree.addAll(nodes)}function Quadtree(x,y,x0,y0,x1,y1){this._x=x;this._y=y;this._x0=x0;this._y0=y0;this._x1=x1;this._y1=y1;this._root=undefined}function leaf_copy(leaf){var copy={data:leaf.data},next=copy;while(leaf=leaf.next){next=next.next={data:leaf.data}}return copy}var treeProto=quadtree.prototype=Quadtree.prototype;treeProto.copy=function(){var copy=new Quadtree(this._x,this._y,this._x0,this._y0,this._x1,this._y1),node=this._root,nodes,child;if(!node)return copy;if(!node.length)return copy._root=leaf_copy(node),copy;nodes=[{source:node,target:copy._root=new Array(4)}];while(node=nodes.pop()){for(var i=0;i<4;++i){if(child=node.source[i]){if(child.length)nodes.push({source:child,target:node.target[i]=new Array(4)});else node.target[i]=leaf_copy(child)}}}return copy};treeProto.add=tree_add;treeProto.addAll=addAll;treeProto.cover=tree_cover;treeProto.data=tree_data;treeProto.extent=tree_extent;treeProto.find=tree_find;treeProto.remove=tree_remove;treeProto.removeAll=removeAll;treeProto.root=tree_root;treeProto.size=tree_size;treeProto.visit=tree_visit;treeProto.visitAfter=tree_visitAfter;treeProto.x=tree_x;treeProto.y=tree_y;function x$3(d){return d.x+d.vx}function y$3(d){return d.y+d.vy}function forceCollide(radius){var nodes,radii,strength=1,iterations=1;if(typeof radius!=="function")radius=constant$a(radius==null?1:+radius);function force(){var i,n=nodes.length,tree,node,xi,yi,ri,ri2;for(var k=0;k<iterations;++k){tree=quadtree(nodes,x$3,y$3).visitAfter(prepare);for(i=0;i<n;++i){node=nodes[i];ri=radii[node.index],ri2=ri*ri;xi=node.x+node.vx;yi=node.y+node.vy;tree.visit(apply)}}function apply(quad,x0,y0,x1,y1){var data=quad.data,rj=quad.r,r=ri+rj;if(data){if(data.index>node.index){var x=xi-data.x-data.vx,y=yi-data.y-data.vy,l=x*x+y*y;if(l<r*r){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;l=(r-(l=Math.sqrt(l)))/l*strength;node.vx+=(x*=l)*(r=(rj*=rj)/(ri2+rj));node.vy+=(y*=l)*r;data.vx-=x*(r=1-r);data.vy-=y*r}}return}return x0>xi+r||x1<xi-r||y0>yi+r||y1<yi-r}}function prepare(quad){if(quad.data)return quad.r=radii[quad.data.index];for(var i=quad.r=0;i<4;++i){if(quad[i]&&quad[i].r>quad.r){quad.r=quad[i].r}}}function initialize(){if(!nodes)return;var i,n=nodes.length,node;radii=new Array(n);for(i=0;i<n;++i){node=nodes[i],radii[node.index]=+radius(node,i,nodes)}}force.initialize=function(_){nodes=_;initialize()};force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations};force.strength=function(_){return arguments.length?(strength=+_,force):strength};force.radius=function(_){return arguments.length?(radius=typeof _==="function"?_:constant$a(+_),initialize(),force):radius};return force}function index(d){return d.index}function find(nodeById,nodeId){var node=nodeById.get(nodeId);if(!node)throw new Error("missing: "+nodeId);return node}function forceLink(links){var id=index,strength=defaultStrength,strengths,distance=constant$a(30),distances,nodes,count,bias,iterations=1;if(links==null)links=[];function defaultStrength(link){return 1/Math.min(count[link.source.index],count[link.target.index])}function force(alpha){for(var k=0,n=links.length;k<iterations;++k){for(var i=0,link,source,target,x,y,l,b;i<n;++i){link=links[i],source=link.source,target=link.target;x=target.x+target.vx-source.x-source.vx||jiggle();y=target.y+target.vy-source.y-source.vy||jiggle();l=Math.sqrt(x*x+y*y);l=(l-distances[i])/l*alpha*strengths[i];x*=l,y*=l;target.vx-=x*(b=bias[i]);target.vy-=y*b;source.vx+=x*(b=1-b);source.vy+=y*b}}}function initialize(){if(!nodes)return;var i,n=nodes.length,m=links.length,nodeById=map$1(nodes,id),link;for(i=0,count=new Array(n);i<m;++i){link=links[i],link.index=i;if(_typeof(link.source)!=="object")link.source=find(nodeById,link.source);if(_typeof(link.target)!=="object")link.target=find(nodeById,link.target);count[link.source.index]=(count[link.source.index]||0)+1;count[link.target.index]=(count[link.target.index]||0)+1}for(i=0,bias=new Array(m);i<m;++i){link=links[i],bias[i]=count[link.source.index]/(count[link.source.index]+count[link.target.index])}strengths=new Array(m),initializeStrength();distances=new Array(m),initializeDistance()}function initializeStrength(){if(!nodes)return;for(var i=0,n=links.length;i<n;++i){strengths[i]=+strength(links[i],i,links)}}function initializeDistance(){if(!nodes)return;for(var i=0,n=links.length;i<n;++i){distances[i]=+distance(links[i],i,links)}}force.initialize=function(_){nodes=_;initialize()};force.links=function(_){return arguments.length?(links=_,initialize(),force):links};force.id=function(_){return arguments.length?(id=_,force):id};force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$a(+_),initializeStrength(),force):strength};force.distance=function(_){return arguments.length?(distance=typeof _==="function"?_:constant$a(+_),initializeDistance(),force):distance};return force}function x$4(d){return d.x}function y$4(d){return d.y}var initialRadius=10,initialAngle=Math.PI*(3-Math.sqrt(5));function forceSimulation(_nodes){var simulation,_alpha=1,_alphaMin=.001,_alphaDecay=1-Math.pow(_alphaMin,1/300),_alphaTarget=0,_velocityDecay=.6,forces=map$1(),stepper=timer(step),event=dispatch("tick","end");if(_nodes==null)_nodes=[];function step(){tick();event.call("tick",simulation);if(_alpha<_alphaMin){stepper.stop();event.call("end",simulation)}}function tick(iterations){var i,n=_nodes.length,node;if(iterations===undefined)iterations=1;for(var k=0;k<iterations;++k){_alpha+=(_alphaTarget-_alpha)*_alphaDecay;forces.each(function(force){force(_alpha)});for(i=0;i<n;++i){node=_nodes[i];if(node.fx==null)node.x+=node.vx*=_velocityDecay;else node.x=node.fx,node.vx=0;if(node.fy==null)node.y+=node.vy*=_velocityDecay;else node.y=node.fy,node.vy=0}}return simulation}function initializeNodes(){for(var i=0,n=_nodes.length,node;i<n;++i){node=_nodes[i],node.index=i;if(!isNaN(node.fx))node.x=node.fx;if(!isNaN(node.fy))node.y=node.fy;if(isNaN(node.x)||isNaN(node.y)){var radius=initialRadius*Math.sqrt(i),angle=i*initialAngle;node.x=radius*Math.cos(angle);node.y=radius*Math.sin(angle)}if(isNaN(node.vx)||isNaN(node.vy)){node.vx=node.vy=0}}}function initializeForce(force){if(force.initialize)force.initialize(_nodes);return force}initializeNodes();return simulation={tick:tick,restart:function restart(){return stepper.restart(step),simulation},stop:function stop(){return stepper.stop(),simulation},nodes:function nodes(_){return arguments.length?(_nodes=_,initializeNodes(),forces.each(initializeForce),simulation):_nodes},alpha:function alpha(_){return arguments.length?(_alpha=+_,simulation):_alpha},alphaMin:function alphaMin(_){return arguments.length?(_alphaMin=+_,simulation):_alphaMin},alphaDecay:function alphaDecay(_){return arguments.length?(_alphaDecay=+_,simulation):+_alphaDecay},alphaTarget:function alphaTarget(_){return arguments.length?(_alphaTarget=+_,simulation):_alphaTarget},velocityDecay:function velocityDecay(_){return arguments.length?(_velocityDecay=1-_,simulation):1-_velocityDecay},force:function force(name,_){return arguments.length>1?(_==null?forces.remove(name):forces.set(name,initializeForce(_)),simulation):forces.get(name)},find:function find(x,y,radius){var i=0,n=_nodes.length,dx,dy,d2,node,closest;if(radius==null)radius=Infinity;else radius*=radius;for(i=0;i<n;++i){node=_nodes[i];dx=x-node.x;dy=y-node.y;d2=dx*dx+dy*dy;if(d2<radius)closest=node,radius=d2}return closest},on:function on(name,_){return arguments.length>1?(event.on(name,_),simulation):event.on(name)}}}function forceManyBody(){var nodes,node,alpha,strength=constant$a(-30),strengths,distanceMin2=1,distanceMax2=Infinity,theta2=.81;function force(_){var i,n=nodes.length,tree=quadtree(nodes,x$4,y$4).visitAfter(accumulate);for(alpha=_,i=0;i<n;++i){node=nodes[i],tree.visit(apply)}}function initialize(){if(!nodes)return;var i,n=nodes.length,node;strengths=new Array(n);for(i=0;i<n;++i){node=nodes[i],strengths[node.index]=+strength(node,i,nodes)}}function accumulate(quad){var strength=0,q,c,weight=0,x,y,i;if(quad.length){for(x=y=i=0;i<4;++i){if((q=quad[i])&&(c=Math.abs(q.value))){strength+=q.value,weight+=c,x+=c*q.x,y+=c*q.y}}quad.x=x/weight;quad.y=y/weight}else{q=quad;q.x=q.data.x;q.y=q.data.y;do{strength+=strengths[q.data.index]}while(q=q.next)}quad.value=strength}function apply(quad,x1,_,x2){if(!quad.value)return true;var x=quad.x-node.x,y=quad.y-node.y,w=x2-x1,l=x*x+y*y;if(w*w/theta2<l){if(l<distanceMax2){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;if(l<distanceMin2)l=Math.sqrt(distanceMin2*l);node.vx+=x*quad.value*alpha/l;node.vy+=y*quad.value*alpha/l}return true}else if(quad.length||l>=distanceMax2)return;if(quad.data!==node||quad.next){if(x===0)x=jiggle(),l+=x*x;if(y===0)y=jiggle(),l+=y*y;if(l<distanceMin2)l=Math.sqrt(distanceMin2*l)}do{if(quad.data!==node){w=strengths[quad.data.index]*alpha/l;node.vx+=x*w;node.vy+=y*w}}while(quad=quad.next)}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$a(+_),initialize(),force):strength};force.distanceMin=function(_){return arguments.length?(distanceMin2=_*_,force):Math.sqrt(distanceMin2)};force.distanceMax=function(_){return arguments.length?(distanceMax2=_*_,force):Math.sqrt(distanceMax2)};force.theta=function(_){return arguments.length?(theta2=_*_,force):Math.sqrt(theta2)};return force}function forceX(x){var strength=constant$a(.1),nodes,strengths,xz;if(typeof x!=="function")x=constant$a(x==null?0:+x);function force(alpha){for(var i=0,n=nodes.length,node;i<n;++i){node=nodes[i],node.vx+=(xz[i]-node.x)*strengths[i]*alpha}}function initialize(){if(!nodes)return;var i,n=nodes.length;strengths=new Array(n);xz=new Array(n);for(i=0;i<n;++i){strengths[i]=isNaN(xz[i]=+x(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$a(+_),initialize(),force):strength};force.x=function(_){return arguments.length?(x=typeof _==="function"?_:constant$a(+_),initialize(),force):x};return force}function forceY(y){var strength=constant$a(.1),nodes,strengths,yz;if(typeof y!=="function")y=constant$a(y==null?0:+y);function force(alpha){for(var i=0,n=nodes.length,node;i<n;++i){node=nodes[i],node.vy+=(yz[i]-node.y)*strengths[i]*alpha}}function initialize(){if(!nodes)return;var i,n=nodes.length;strengths=new Array(n);yz=new Array(n);for(i=0;i<n;++i){strengths[i]=isNaN(yz[i]=+y(nodes[i],i,nodes))?0:+strength(nodes[i],i,nodes)}}force.initialize=function(_){nodes=_;initialize()};force.strength=function(_){return arguments.length?(strength=typeof _==="function"?_:constant$a(+_),initialize(),force):strength};force.y=function(_){return arguments.length?(y=typeof _==="function"?_:constant$a(+_),initialize(),force):y};return force}var BoundingBox_1=BoundingBox;function BoundingBox(x1,y1,x2,y2){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.addPoint(x1,y1);this.addPoint(x2,y2)}BoundingBox.prototype={width:function width(){return this.x2-this.x1},height:function height(){return this.y2-this.y1},addPoint:function addPoint(x,y){if(x!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=x;this.x2=x}if(x<this.x1)this.x1=x;if(x>this.x2)this.x2=x}if(y!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=y;this.y2=y}if(y<this.y1)this.y1=y;if(y>this.y2)this.y2=y}},addX:function addX(x){this.addPoint(x,null)},addY:function addY(y){this.addPoint(null,y)},addQuadraticCurve:function addQuadraticCurve(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x);var cp1y=p0y+2/3*(p1y-p0y);var cp2x=cp1x+1/3*(p2x-p0x);var cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},addBezierCurve:function addBezierCurve(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var i,p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];this.addPoint(p0[0],p0[1]);this.addPoint(p3[0],p3[1]);for(i=0;i<=1;i++){var f=function f(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]};var b=6*p0[i]-12*p1[i]+6*p2[i];var a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i];var c=3*p1[i]-3*p0[i];if(a==0){if(b==0)continue;var t=-c/b;if(0<t&&t<1){if(i==0)this.addX(f(t));if(i==1)this.addY(f(t))}continue}var b2ac=Math.pow(b,2)-4*c*a;if(b2ac<0)continue;var t1=(-b+Math.sqrt(b2ac))/(2*a);if(0<t1&&t1<1){if(i==0)this.addX(f(t1));if(i==1)this.addY(f(t1))}var t2=(-b-Math.sqrt(b2ac))/(2*a);if(0<t2&&t2<1){if(i==0)this.addX(f(t2));if(i==1)this.addY(f(t2))}}}};var BoundingBox$1=Object.freeze({default:BoundingBox_1,__moduleExports:BoundingBox_1});var BoundingBoxView_1=BoundingBoxView;function BoundingBoxView(boundingBox){this.x1=this.minX=boundingBox.x1||0;this.y1=this.minY=boundingBox.y1||0;this.x2=this.maxX=boundingBox.x2||0;this.y2=this.maxY=boundingBox.y2||0;this.width=boundingBox.width()||0;this.height=boundingBox.height()||0}BoundingBoxView.prototype={round:function round(precision){precision=precision||0;this.x1=this.minX=+this.x1.toFixed(precision);this.y1=this.minY=+this.y1.toFixed(precision);this.x2=this.maxX=+this.x2.toFixed(precision);this.y2=this.maxY=+this.y2.toFixed(precision);this.width=+this.width.toFixed(precision);this.height=+this.height.toFixed(precision);return this},scale:function scale(_scale){var self=this;_scale=_scale||1;["x1","minX","y1","minY","x2","maxX","y2","maxY","width","height"].forEach(function(name){self[name]=self[name]*_scale});return this},toString:function toString(){return[this.minX,this.minY,this.width,this.height].join(" ")}};var BoundingBoxView$1=Object.freeze({default:BoundingBoxView_1,__moduleExports:BoundingBoxView_1});var paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};var SPECIAL_SPACES=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function isSpace(ch){return ch===10||ch===13||ch===8232||ch===8233||ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&SPECIAL_SPACES.indexOf(ch)>=0}function isCommand(code){switch(code|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return true}return false}function isDigit(code){return code>=48&&code<=57}function isDigitStart(code){return code>=48&&code<=57||code===43||code===45||code===46}function State(path){this.index=0;this.path=path;this.max=path.length;this.result=[];this.param=0;this.err="";this.segmentStart=0;this.data=[]}function skipSpaces(state){while(state.index<state.max&&isSpace(state.path.charCodeAt(state.index))){state.index++}}function scanParam(state){var start=state.index,index=start,max=state.max,zeroFirst=false,hasCeiling=false,hasDecimal=false,hasDot=false,ch;if(index>=max){state.err="SvgPath: missed param (at pos "+index+")";return}ch=state.path.charCodeAt(index);if(ch===43||ch===45){index++;ch=index<max?state.path.charCodeAt(index):0}if(!isDigit(ch)&&ch!==46){state.err="SvgPath: param should start with 0..9 or `.` (at pos "+index+")";return}if(ch!==46){zeroFirst=ch===48;index++;ch=index<max?state.path.charCodeAt(index):0;if(zeroFirst&&index<max){if(ch&&isDigit(ch)){state.err="SvgPath: numbers started with `0` such as `09` are ilegal (at pos "+start+")";return}}while(index<max&&isDigit(state.path.charCodeAt(index))){index++;hasCeiling=true}ch=index<max?state.path.charCodeAt(index):0}if(ch===46){hasDot=true;index++;while(isDigit(state.path.charCodeAt(index))){index++;hasDecimal=true}ch=index<max?state.path.charCodeAt(index):0}if(ch===101||ch===69){if(hasDot&&!hasCeiling&&!hasDecimal){state.err="SvgPath: invalid float exponent (at pos "+index+")";return}index++;ch=index<max?state.path.charCodeAt(index):0;if(ch===43||ch===45){index++}if(index<max&&isDigit(state.path.charCodeAt(index))){while(index<max&&isDigit(state.path.charCodeAt(index))){index++}}else{state.err="SvgPath: invalid float exponent (at pos "+index+")";return}}state.index=index;state.param=parseFloat(state.path.slice(start,index))+0}function finalizeSegment(state){var cmd,cmdLC;cmd=state.path[state.segmentStart];cmdLC=cmd.toLowerCase();var params=state.data;if(cmdLC==="m"&&params.length>2){state.result.push([cmd,params[0],params[1]]);params=params.slice(2);cmdLC="l";cmd=cmd==="m"?"l":"L"}if(cmdLC==="r"){state.result.push([cmd].concat(params))}else{while(params.length>=paramCounts[cmdLC]){state.result.push([cmd].concat(params.splice(0,paramCounts[cmdLC])));if(!paramCounts[cmdLC]){break}}}}function scanSegment(state){var max=state.max,cmdCode,comma_found,need_params,i;state.segmentStart=state.index;cmdCode=state.path.charCodeAt(state.index);if(!isCommand(cmdCode)){state.err="SvgPath: bad command "+state.path[state.index]+" (at pos "+state.index+")";return}need_params=paramCounts[state.path[state.index].toLowerCase()];state.index++;skipSpaces(state);state.data=[];if(!need_params){finalizeSegment(state);return}comma_found=false;for(;;){for(i=need_params;i>0;i--){scanParam(state);if(state.err.length){return}state.data.push(state.param);skipSpaces(state);comma_found=false;if(state.index<max&&state.path.charCodeAt(state.index)===44){state.index++;skipSpaces(state);comma_found=true}}if(comma_found){continue}if(state.index>=state.max){break}if(!isDigitStart(state.path.charCodeAt(state.index))){break}}finalizeSegment(state)}var path_parse=function pathParse(svgPath){var state=new State(svgPath);var max=state.max;skipSpaces(state);while(state.index<max&&!state.err.length){scanSegment(state)}if(state.err.length){state.result=[]}else if(state.result.length){if("mM".indexOf(state.result[0][0])<0){state.err="SvgPath: string should start with `M` or `m`";state.result=[]}else{state.result[0][0]="M"}}return{err:state.err,segments:state.result}};var path_parse$1=Object.freeze({default:path_parse,__moduleExports:path_parse});function combine(m1,m2){return[m1[0]*m2[0]+m1[2]*m2[1],m1[1]*m2[0]+m1[3]*m2[1],m1[0]*m2[2]+m1[2]*m2[3],m1[1]*m2[2]+m1[3]*m2[3],m1[0]*m2[4]+m1[2]*m2[5]+m1[4],m1[1]*m2[4]+m1[3]*m2[5]+m1[5]]}function Matrix(){if(!(this instanceof Matrix)){return new Matrix}this.queue=[];this.cache=null}Matrix.prototype.matrix=function(m){if(m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1&&m[4]===0&&m[5]===0){return this}this.cache=null;this.queue.push(m);return this};Matrix.prototype.translate=function(tx,ty){if(tx!==0||ty!==0){this.cache=null;this.queue.push([1,0,0,1,tx,ty])}return this};Matrix.prototype.scale=function(sx,sy){if(sx!==1||sy!==1){this.cache=null;this.queue.push([sx,0,0,sy,0,0])}return this};Matrix.prototype.rotate=function(angle,rx,ry){var rad,cos,sin;if(angle!==0){this.translate(rx,ry);rad=angle*Math.PI/180;cos=Math.cos(rad);sin=Math.sin(rad);this.queue.push([cos,sin,-sin,cos,0,0]);this.cache=null;this.translate(-rx,-ry)}return this};Matrix.prototype.skewX=function(angle){if(angle!==0){this.cache=null;this.queue.push([1,0,Math.tan(angle*Math.PI/180),1,0,0])}return this};Matrix.prototype.skewY=function(angle){if(angle!==0){this.cache=null;this.queue.push([1,Math.tan(angle*Math.PI/180),0,1,0,0])}return this};Matrix.prototype.toArray=function(){if(this.cache){return this.cache}if(!this.queue.length){this.cache=[1,0,0,1,0,0];return this.cache}this.cache=this.queue[0];if(this.queue.length===1){return this.cache}for(var i=1;i<this.queue.length;i++){this.cache=combine(this.cache,this.queue[i])}return this.cache};Matrix.prototype.calc=function(x,y,isRelative){var m;if(!this.queue.length){return[x,y]}if(!this.cache){this.cache=this.toArray()}m=this.cache;return[x*m[0]+y*m[2]+(isRelative?0:m[4]),x*m[1]+y*m[3]+(isRelative?0:m[5])]};var matrix=Matrix;var matrix$1=Object.freeze({default:matrix,__moduleExports:matrix});var matrix$2=matrix$1&&matrix||matrix$1;var operations$1={matrix:true,scale:true,rotate:true,translate:true,skewX:true,skewY:true};var CMD_SPLIT_RE=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/;var PARAMS_SPLIT_RE=/[\s,]+/;var transform_parse=function transformParse(transformString){var matrix=new matrix$2;var cmd,params;transformString.split(CMD_SPLIT_RE).forEach(function(item){if(!item.length){return}if(typeof operations$1[item]!=="undefined"){cmd=item;return}params=item.split(PARAMS_SPLIT_RE).map(function(i){return+i||0});switch(cmd){case"matrix":if(params.length===6){matrix.matrix(params)}return;case"scale":if(params.length===1){matrix.scale(params[0],params[0])}else if(params.length===2){matrix.scale(params[0],params[1])}return;case"rotate":if(params.length===1){matrix.rotate(params[0],0,0)}else if(params.length===3){matrix.rotate(params[0],params[1],params[2])}return;case"translate":if(params.length===1){matrix.translate(params[0],0)}else if(params.length===2){matrix.translate(params[0],params[1])}return;case"skewX":if(params.length===1){matrix.skewX(params[0])}return;case"skewY":if(params.length===1){matrix.skewY(params[0])}return}});return matrix};var transform_parse$1=Object.freeze({default:transform_parse,__moduleExports:transform_parse});var TAU=Math.PI*2;function vector_angle(ux,uy,vx,vy){var sign=ux*vy-uy*vx<0?-1:1;var umag=Math.sqrt(ux*ux+uy*uy);var vmag=Math.sqrt(ux*ux+uy*uy);var dot=ux*vx+uy*vy;var div=dot/(umag*vmag);if(div>1){div=1}if(div<-1){div=-1}return sign*Math.acos(div)}function get_arc_center(x1,y1,x2,y2,fa,fs,rx,ry,sin_phi,cos_phi){var x1p=cos_phi*(x1-x2)/2+sin_phi*(y1-y2)/2;var y1p=-sin_phi*(x1-x2)/2+cos_phi*(y1-y2)/2;var rx_sq=rx*rx;var ry_sq=ry*ry;var x1p_sq=x1p*x1p;var y1p_sq=y1p*y1p;var radicant=rx_sq*ry_sq-rx_sq*y1p_sq-ry_sq*x1p_sq;if(radicant<0){radicant=0}radicant/=rx_sq*y1p_sq+ry_sq*x1p_sq;radicant=Math.sqrt(radicant)*(fa===fs?-1:1);var cxp=radicant*rx/ry*y1p;var cyp=radicant*-ry/rx*x1p;var cx=cos_phi*cxp-sin_phi*cyp+(x1+x2)/2;var cy=sin_phi*cxp+cos_phi*cyp+(y1+y2)/2;var v1x=(x1p-cxp)/rx;var v1y=(y1p-cyp)/ry;var v2x=(-x1p-cxp)/rx;var v2y=(-y1p-cyp)/ry;var theta1=vector_angle(1,0,v1x,v1y);var delta_theta=vector_angle(v1x,v1y,v2x,v2y);if(fs===0&&delta_theta>0){delta_theta-=TAU}if(fs===1&&delta_theta<0){delta_theta+=TAU}return[cx,cy,theta1,delta_theta]}function approximate_unit_arc(theta1,delta_theta){var alpha=4/3*Math.tan(delta_theta/4);var x1=Math.cos(theta1);var y1=Math.sin(theta1);var x2=Math.cos(theta1+delta_theta);var y2=Math.sin(theta1+delta_theta);return[x1,y1,x1-y1*alpha,y1+x1*alpha,x2+y2*alpha,y2-x2*alpha,x2,y2]}var a2c=function a2c(x1,y1,x2,y2,fa,fs,rx,ry,phi){var sin_phi=Math.sin(phi*TAU/360);var cos_phi=Math.cos(phi*TAU/360);var x1p=cos_phi*(x1-x2)/2+sin_phi*(y1-y2)/2;var y1p=-sin_phi*(x1-x2)/2+cos_phi*(y1-y2)/2;if(x1p===0&&y1p===0){return[]}if(rx===0||ry===0){return[]}rx=Math.abs(rx);ry=Math.abs(ry);var lambda=x1p*x1p/(rx*rx)+y1p*y1p/(ry*ry);if(lambda>1){rx*=Math.sqrt(lambda);ry*=Math.sqrt(lambda)}var cc=get_arc_center(x1,y1,x2,y2,fa,fs,rx,ry,sin_phi,cos_phi);var result=[];var theta1=cc[2];var delta_theta=cc[3];var segments=Math.max(Math.ceil(Math.abs(delta_theta)/(TAU/4)),1);delta_theta/=segments;for(var i=0;i<segments;i++){result.push(approximate_unit_arc(theta1,delta_theta));theta1+=delta_theta}return result.map(function(curve){for(var i=0;i<curve.length;i+=2){var x=curve[i+0];var y=curve[i+1];x*=rx;y*=ry;var xp=cos_phi*x-sin_phi*y;var yp=sin_phi*x+cos_phi*y;curve[i+0]=xp+cc[0];curve[i+1]=yp+cc[1]}return curve})};var a2c$1=Object.freeze({default:a2c,__moduleExports:a2c});var epsilon$4=1e-10;var torad=Math.PI/180;function Ellipse(rx,ry,ax){if(!(this instanceof Ellipse)){return new Ellipse(rx,ry,ax)}this.rx=rx;this.ry=ry;this.ax=ax}Ellipse.prototype.transform=function(m){var c=Math.cos(this.ax*torad),s=Math.sin(this.ax*torad);var ma=[this.rx*(m[0]*c+m[2]*s),this.rx*(m[1]*c+m[3]*s),this.ry*(-m[0]*s+m[2]*c),this.ry*(-m[1]*s+m[3]*c)];var J=ma[0]*ma[0]+ma[2]*ma[2],K=ma[1]*ma[1]+ma[3]*ma[3];var D=((ma[0]-ma[3])*(ma[0]-ma[3])+(ma[2]+ma[1])*(ma[2]+ma[1]))*((ma[0]+ma[3])*(ma[0]+ma[3])+(ma[2]-ma[1])*(ma[2]-ma[1]));var JK=(J+K)/2;if(D<epsilon$4*JK){this.rx=this.ry=Math.sqrt(JK);this.ax=0;return this}var L=ma[0]*ma[1]+ma[2]*ma[3];D=Math.sqrt(D);var l1=JK+D/2,l2=JK-D/2;this.ax=Math.abs(L)<epsilon$4&&Math.abs(l1-K)<epsilon$4?90:Math.atan(Math.abs(L)>Math.abs(l1-K)?(l1-J)/L:L/(l1-K))*180/Math.PI;if(this.ax>=0){this.rx=Math.sqrt(l1);this.ry=Math.sqrt(l2)}else{this.ax+=90;this.rx=Math.sqrt(l2);this.ry=Math.sqrt(l1)}return this};Ellipse.prototype.isDegenerate=function(){return this.rx<epsilon$4*this.ry||this.ry<epsilon$4*this.rx};var ellipse=Ellipse;var ellipse$1=Object.freeze({default:ellipse,__moduleExports:ellipse});var pathParse=path_parse$1&&path_parse||path_parse$1;var transformParse=transform_parse$1&&transform_parse||transform_parse$1;var a2c$2=a2c$1&&a2c||a2c$1;var ellipse$2=ellipse$1&&ellipse||ellipse$1;function SvgPath(path){if(!(this instanceof SvgPath)){return new SvgPath(path)}var pstate=pathParse(path);this.segments=pstate.segments;this.err=pstate.err;this.__stack=[]}SvgPath.prototype.__matrix=function(m){var self=this,i;if(!m.queue.length){return}this.iterate(function(s,index,x,y){var p,result,name,isRelative;switch(s[0]){case"v":p=m.calc(0,s[1],true);result=p[0]===0?["v",p[1]]:["l",p[0],p[1]];break;case"V":p=m.calc(x,s[1],false);result=p[0]===m.calc(x,y,false)[0]?["V",p[1]]:["L",p[0],p[1]];break;case"h":p=m.calc(s[1],0,true);result=p[1]===0?["h",p[0]]:["l",p[0],p[1]];break;case"H":p=m.calc(s[1],y,false);result=p[1]===m.calc(x,y,false)[1]?["H",p[0]]:["L",p[0],p[1]];break;case"a":case"A":var ma=m.toArray();var e=ellipse$2(s[1],s[2],s[3]).transform(ma);if(ma[0]*ma[3]-ma[1]*ma[2]<0){s[5]=s[5]?"0":"1"}p=m.calc(s[6],s[7],s[0]==="a");if(s[0]==="A"&&s[6]===x&&s[7]===y||s[0]==="a"&&s[6]===0&&s[7]===0){result=[s[0]==="a"?"l":"L",p[0],p[1]];break}if(e.isDegenerate()){result=[s[0]==="a"?"l":"L",p[0],p[1]]}else{result=[s[0],e.rx,e.ry,e.ax,s[4],s[5],p[0],p[1]]}break;case"m":isRelative=index>0;p=m.calc(s[1],s[2],isRelative);result=["m",p[0],p[1]];break;default:name=s[0];result=[name];isRelative=name.toLowerCase()===name;for(i=1;i<s.length;i+=2){p=m.calc(s[i],s[i+1],isRelative);result.push(p[0],p[1])}}self.segments[index]=result},true)};SvgPath.prototype.__evaluateStack=function(){var m,i;if(!this.__stack.length){return}if(this.__stack.length===1){this.__matrix(this.__stack[0]);this.__stack=[];return}m=matrix$2();i=this.__stack.length;while(--i>=0){m.matrix(this.__stack[i].toArray())}this.__matrix(m);this.__stack=[]};SvgPath.prototype.toString=function(){var elements=[],skipCmd,cmd;this.__evaluateStack();for(var i=0;i<this.segments.length;i++){cmd=this.segments[i][0];skipCmd=i>0&&cmd!=="m"&&cmd!=="M"&&cmd===this.segments[i-1][0];elements=elements.concat(skipCmd?this.segments[i].slice(1):this.segments[i])}return elements.join(" ").replace(/ ?([achlmqrstvz]) ?/gi,"$1").replace(/ \-/g,"-").replace(/zm/g,"z m")};SvgPath.prototype.translate=function(x,y){this.__stack.push(matrix$2().translate(x,y||0));return this};SvgPath.prototype.scale=function(sx,sy){this.__stack.push(matrix$2().scale(sx,!sy&&sy!==0?sx:sy));return this};SvgPath.prototype.rotate=function(angle,rx,ry){this.__stack.push(matrix$2().rotate(angle,rx||0,ry||0));return this};SvgPath.prototype.skewX=function(degrees){this.__stack.push(matrix$2().skewX(degrees));return this};SvgPath.prototype.skewY=function(degrees){this.__stack.push(matrix$2().skewY(degrees));return this};SvgPath.prototype.matrix=function(m){this.__stack.push(matrix$2().matrix(m));return this};SvgPath.prototype.transform=function(transformString){if(!transformString.trim()){return this}this.__stack.push(transformParse(transformString));return this};SvgPath.prototype.round=function(d){var contourStartDeltaX=0,contourStartDeltaY=0,deltaX=0,deltaY=0,l;d=d||0;this.__evaluateStack();this.segments.forEach(function(s){var isRelative=s[0].toLowerCase()===s[0];switch(s[0]){case"H":case"h":if(isRelative){s[1]+=deltaX}deltaX=s[1]-s[1].toFixed(d);s[1]=+s[1].toFixed(d);return;case"V":case"v":if(isRelative){s[1]+=deltaY}deltaY=s[1]-s[1].toFixed(d);s[1]=+s[1].toFixed(d);return;case"Z":case"z":deltaX=contourStartDeltaX;deltaY=contourStartDeltaY;return;case"M":case"m":if(isRelative){s[1]+=deltaX;s[2]+=deltaY}deltaX=s[1]-s[1].toFixed(d);deltaY=s[2]-s[2].toFixed(d);contourStartDeltaX=deltaX;contourStartDeltaY=deltaY;s[1]=+s[1].toFixed(d);s[2]=+s[2].toFixed(d);return;case"A":case"a":if(isRelative){s[6]+=deltaX;s[7]+=deltaY}deltaX=s[6]-s[6].toFixed(d);deltaY=s[7]-s[7].toFixed(d);s[1]=+s[1].toFixed(d);s[2]=+s[2].toFixed(d);s[3]=+s[3].toFixed(d+2);s[6]=+s[6].toFixed(d);s[7]=+s[7].toFixed(d);return;default:l=s.length;if(isRelative){s[l-2]+=deltaX;s[l-1]+=deltaY}deltaX=s[l-2]-s[l-2].toFixed(d);deltaY=s[l-1]-s[l-1].toFixed(d);s.forEach(function(val,i){if(!i){return}s[i]=+s[i].toFixed(d)});return}});return this};SvgPath.prototype.iterate=function(iterator,keepLazyStack){var segments=this.segments,replacements={},needReplace=false,lastX=0,lastY=0,countourStartX=0,countourStartY=0;var i,j,newSegments;if(!keepLazyStack){this.__evaluateStack()}segments.forEach(function(s,index){var res=iterator(s,index,lastX,lastY);if(Array.isArray(res)){replacements[index]=res;needReplace=true}var isRelative=s[0]===s[0].toLowerCase();switch(s[0]){case"m":case"M":lastX=s[1]+(isRelative?lastX:0);lastY=s[2]+(isRelative?lastY:0);countourStartX=lastX;countourStartY=lastY;return;case"h":case"H":lastX=s[1]+(isRelative?lastX:0);return;case"v":case"V":lastY=s[1]+(isRelative?lastY:0);return;case"z":case"Z":lastX=countourStartX;lastY=countourStartY;return;default:lastX=s[s.length-2]+(isRelative?lastX:0);lastY=s[s.length-1]+(isRelative?lastY:0)}});if(!needReplace){return this}newSegments=[];for(i=0;i<segments.length;i++){if(typeof replacements[i]!=="undefined"){for(j=0;j<replacements[i].length;j++){newSegments.push(replacements[i][j])}}else{newSegments.push(segments[i])}}this.segments=newSegments;return this};SvgPath.prototype.abs=function(){this.iterate(function(s,index,x,y){var name=s[0],nameUC=name.toUpperCase(),i;if(name===nameUC){return}s[0]=nameUC;switch(name){case"v":s[1]+=y;return;case"a":s[6]+=x;s[7]+=y;return;default:for(i=1;i<s.length;i++){s[i]+=i%2?x:y}}},true);return this};SvgPath.prototype.rel=function(){this.iterate(function(s,index,x,y){var name=s[0],nameLC=name.toLowerCase(),i;if(name===nameLC){return}if(index===0&&name==="M"){return}s[0]=nameLC;switch(name){case"V":s[1]-=y;return;case"A":s[6]-=x;s[7]-=y;return;default:for(i=1;i<s.length;i++){s[i]-=i%2?x:y}}},true);return this};SvgPath.prototype.unarc=function(){this.iterate(function(s,index,x,y){var new_segments,nextX,nextY,result=[],name=s[0];if(name!=="A"&&name!=="a"){return null}if(name==="a"){nextX=x+s[6];nextY=y+s[7]}else{nextX=s[6];nextY=s[7]}new_segments=a2c$2(x,y,nextX,nextY,s[4],s[5],s[1],s[2],s[3]);if(new_segments.length===0){return[[s[0]==="a"?"l":"L",s[6],s[7]]]}new_segments.forEach(function(s){result.push(["C",s[2],s[3],s[4],s[5],s[6],s[7]])});return result});return this};SvgPath.prototype.unshort=function(){var segments=this.segments;var prevControlX,prevControlY,prevSegment;var curControlX,curControlY;this.iterate(function(s,idx,x,y){var name=s[0],nameUC=name.toUpperCase(),isRelative;if(!idx){return}if(nameUC==="T"){isRelative=name==="t";prevSegment=segments[idx-1];if(prevSegment[0]==="Q"){prevControlX=prevSegment[1]-x;prevControlY=prevSegment[2]-y}else if(prevSegment[0]==="q"){prevControlX=prevSegment[1]-prevSegment[3];prevControlY=prevSegment[2]-prevSegment[4]}else{prevControlX=0;prevControlY=0}curControlX=-prevControlX;curControlY=-prevControlY;if(!isRelative){curControlX+=x;curControlY+=y}segments[idx]=[isRelative?"q":"Q",curControlX,curControlY,s[1],s[2]]}else if(nameUC==="S"){isRelative=name==="s";prevSegment=segments[idx-1];if(prevSegment[0]==="C"){prevControlX=prevSegment[3]-x;prevControlY=prevSegment[4]-y}else if(prevSegment[0]==="c"){prevControlX=prevSegment[3]-prevSegment[5];prevControlY=prevSegment[4]-prevSegment[6]}else{prevControlX=0;prevControlY=0}curControlX=-prevControlX;curControlY=-prevControlY;if(!isRelative){curControlX+=x;curControlY+=y}segments[idx]=[isRelative?"c":"C",curControlX,curControlY,s[1],s[2],s[3],s[4]]}});return this};var svgpath=SvgPath;var svgpath$1=Object.freeze({default:svgpath,__moduleExports:svgpath});var require$$0$d=svgpath$1&&svgpath||svgpath$1;var svgpath$2=require$$0$d;var svgpath$3=Object.freeze({default:svgpath$2,__moduleExports:svgpath$2});var BoundingBox$2=BoundingBox$1&&BoundingBox_1||BoundingBox$1;var BoundingBoxView$2=BoundingBoxView$1&&BoundingBoxView_1||BoundingBoxView$1;var SvgPath$1=svgpath$3&&svgpath$2||svgpath$3;var Path_1=Path$1;function Path$1(d){this.d=d}Path$1.prototype={getBoundingBox:function getBoundingBox(){var pathDriver,boundingBox;pathDriver=new SvgPath$1(this.d);boundingBox=new BoundingBox$2;pathDriver.abs().unarc().unshort().iterate(function(seg,index,x,y){switch(seg[0]){case"M":case"L":boundingBox.addPoint(seg[1],seg[2]);break;case"H":boundingBox.addX(seg[1]);break;case"V":boundingBox.addY(seg[1]);break;case"Q":boundingBox.addQuadraticCurve(x,y,seg[1],seg[2],seg[3],seg[4]);break;case"C":boundingBox.addBezierCurve(x,y,seg[1],seg[2],seg[3],seg[4],seg[5],seg[6]);break}});return new BoundingBoxView$2(boundingBox)}};var Path$2=Object.freeze({default:Path_1,__moduleExports:Path_1});var Path$3=Path$2&&Path_1||Path$2;var caster_1=caster;function caster(path){return new Path$3(path).getBoundingBox()}caster.Path=Path$3;var caster$1=Object.freeze({default:caster_1,__moduleExports:caster_1});var require$$0$e=caster$1&&caster_1||caster$1;var svgPathBoundingBox=require$$0$e;var twoPI$1=Math.PI*2;var radialBarFeatureGenerator=function(_a){var type=_a.type,ordset=_a.ordset,adjustedSize=_a.adjustedSize,piece=_a.piece,i=_a.i;var innerRadius=type.innerRadius;var _b=type.offsetAngle,offsetAngle=_b===void 0?0:_b,_c=type.angleRange,angleRange=_c===void 0?[0,360]:_c;var offsetPct=offsetAngle/360;var rangePct=angleRange.map(function(d){return d/360});var rangeMod=rangePct[1]-rangePct[0];var adjustedPct=rangeMod<1?linear$1().domain([0,1]).range(rangePct):function(d){return d};var innerSize=type.type==="clusterbar"?0:type.type==="timeline"?piece.scaledValue/2:piece.bottom/2;var outerSize=type.type==="clusterbar"?piece.scaledValue/2:type.type==="timeline"?piece.scaledEndValue/2:piece.scaledValue/2+piece.bottom/2;if(innerRadius){innerRadius=parseInt(innerRadius,10);var canvasRadius=adjustedSize[0]/2;var donutMod=(canvasRadius-innerRadius)/canvasRadius;innerSize=innerSize*donutMod+innerRadius;outerSize=outerSize*donutMod+innerRadius}var arcGenerator=arc$1().innerRadius(innerSize).outerRadius(outerSize);var angle=(type.type==="clusterbar"?(ordset.pct-ordset.pct_padding)/ordset.pieceData.length:ordset.pct)*rangeMod;var startAngle=adjustedPct(type.type==="clusterbar"?ordset.pct_start+i/ordset.pieceData.length*(ordset.pct-ordset.pct_padding):ordset.pct===1?0:ordset.pct_start+offsetPct);var endAngle=ordset.pct===1?rangePct[1]:Math.max(startAngle,startAngle+angle-ordset.pct_padding/2);var startAngleFinal=startAngle*twoPI$1;var endAngleFinal=endAngle*twoPI$1;var markD=arcGenerator({startAngle:startAngleFinal,endAngle:endAngleFinal});var centroid=arcGenerator.centroid({startAngle:startAngleFinal,endAngle:endAngleFinal});var xOffset=adjustedSize[0]/2;var yOffset=adjustedSize[1]/2;var xPosition=centroid[0]+xOffset;var yPosition=centroid[1]+yOffset;var outerPoint=pointOnArcAtAngle$1([0,0],(startAngle+endAngle)/2,piece.scaledValue/2);var xy={arcGenerator:arcGenerator,startAngle:startAngleFinal,endAngle:endAngleFinal,dx:outerPoint[0],dy:outerPoint[1]};var translate="translate("+xOffset+","+yOffset+")";return{xPosition:xPosition,yPosition:yPosition,xy:xy,translate:translate,markProps:{markType:"path",d:markD,tx:xOffset,ty:yOffset,transform:translate,customTween:{fn:arcTweener,props:{startAngle:startAngleFinal,endAngle:endAngleFinal,innerRadius:innerSize,outerRadius:outerSize}}}}};var iconBarCustomMark=function(_a){var type=_a.type,projection=_a.projection,finalHeight=_a.finalHeight,finalWidth=_a.finalWidth,styleFn=_a.styleFn,renderValue=_a.renderValue,classFn=_a.classFn;return function(piece,i,xy){var iconD=typeof type.icon==="string"?type.icon:type.icon(piece.data,i);var _a=type.iconPadding,iconPadding=_a===void 0?1:_a,_b=type.resize,resize=_b===void 0?"auto":_b;var iconBounds=svgPathBoundingBox(iconD);var iconTranslate=[0-iconBounds.x1+iconPadding,0-iconBounds.y1+iconPadding];iconBounds.height+=iconPadding*2;iconBounds.width+=iconPadding*2;var icons=[];var stackedIconSize=iconBounds.height;var stackedIconNumber=1;var iconScale=1;var spaceToUse=projection==="horizontal"?finalHeight:finalWidth;var sizeToFit=projection==="horizontal"?iconBounds.height:iconBounds.width;var sizeToPad=projection==="horizontal"?iconBounds.width:iconBounds.height;var spaceToFill=projection==="horizontal"?xy.width:xy.height;var spaceToStackFill=projection==="horizontal"?xy.height:xy.width;if(resize==="auto"){stackedIconSize=spaceToUse/sizeToFit;if(stackedIconSize<1){iconScale=stackedIconSize}else{stackedIconNumber=Math.floor(stackedIconSize);iconScale=1+(stackedIconSize-stackedIconNumber)/stackedIconNumber}}else if(resize==="fixed"){iconScale=spaceToUse/sizeToFit}var finalIconHeight=iconBounds.height*iconScale;var spaceToStep=sizeToPad*iconScale;var spaceToStackStep=sizeToFit*iconScale;iconTranslate[0]=iconTranslate[0]*iconScale;iconTranslate[1]=iconTranslate[1]*iconScale;var randoClipID="iso-clip-"+i+"-"+Math.random();var clipPath="url(#"+randoClipID+")";if(xy.width>0){icons.push(React.createElement("clipPath",{key:randoClipID,id:randoClipID},React.createElement("rect",{x:0,y:0,width:xy.width,height:xy.height})));var iconPieces=[];var stepStart=projection==="horizontal"?0:xy.height-finalIconHeight;var stepper=projection==="horizontal"?spaceToStep:-spaceToStep;var stepTest=projection==="horizontal"?function(step,spaceToFillValue){return step<spaceToFillValue}:function(step,spaceToFillValue,stepperValue){return step>0+stepperValue};for(var step=stepStart;stepTest(step,spaceToFill,stepper);step+=stepper){for(var stack=0;stack<spaceToStackFill;stack+=spaceToStackStep){var stepX=projection==="horizontal"?step:stack;var stepY=projection==="horizontal"?stack:step;var paddedX=stepX+iconTranslate[0];var paddedY=stepY+iconTranslate[1];iconPieces.push(React.createElement(lib_2,{forceUpdate:true,markType:"path",key:"icon-"+step+"-"+stack,transform:"translate("+paddedX+","+paddedY+") scale("+iconScale+")",vectorEffect:"non-scaling-stroke",d:iconD,style:styleFn(__assign({},piece,piece.data),i),renderMode:renderValue,className:classFn(__assign({},piece,piece.data),i)}))}}icons.push(React.createElement("g",{key:"clipped-region-"+i,clipPath:clipPath},iconPieces))}return icons}};function pointOnArcAtAngle$1(center,angle,distance){var radians=Math.PI*(angle+.75)*2;var xPosition=center[0]+distance*Math.cos(radians);var yPosition=center[1]+distance*Math.sin(radians);return[xPosition,yPosition]}function clusterBarLayout(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,projection=_a.projection,classFn=_a.classFn,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,rScale=_a.rScale;var allCalculatedPieces=[];var keys=Object.keys(data);keys.forEach(function(key,ordsetI){var ordset=data[key];var barColumnWidth=Math.max(ordset.width,1);var clusterWidth=barColumnWidth/ordset.pieceData.length;var currentX=0;var currentY=0;var calculatedPieces=ordset.pieceData.map(function(piece,i){var _a;var renderValue=renderMode&&renderMode(piece.data,i);var xPosition=piece.x;var yPosition=piece.base;var finalWidth=clusterWidth;var finalHeight=piece.scaledValue;var xy={x:0,y:0};if(!piece.negative){yPosition-=piece.scaledValue}if(projection==="horizontal"){yPosition=piece.x;xPosition=piece.base;finalHeight=clusterWidth;finalWidth=piece.scaledValue;xy.x=piece.scaledValue;if(piece.negative){xPosition-=piece.scaledValue;xy.x=xPosition}}var translate,markProps={};if(projection==="radial"){_a=radialBarFeatureGenerator({type:type,ordset:ordset,adjustedSize:adjustedSize,piece:piece,i:i}),xPosition=_a.xPosition,yPosition=_a.yPosition,markProps=_a.markProps,xy=_a.xy;xy.x=xPosition}else{xPosition+=currentX;yPosition+=currentY;markProps={markType:"rect",x:xPosition,y:yPosition,width:Math.max(0,finalWidth),height:Math.max(0,finalHeight),rx:0,ry:0};if(projection==="vertical"){xy.x=xPosition}}var eventListeners=eventListenersGenerator(piece,i);xy.y=yPosition;xy.middle=clusterWidth/2;xy.height=finalHeight;xy.width=finalWidth;if(type.icon&&projection!=="radial"){type.customMark=iconBarCustomMark({type:type,projection:projection,finalHeight:finalHeight,finalWidth:finalWidth,styleFn:styleFn,renderValue:renderValue,classFn:classFn})}else if(type.icon&&projection==="radial"){console.error("Icons are currently unsupported on radial charts")}var renderElementObject=type.customMark?React.createElement("g",{key:"piece-"+piece.renderKey,transform:"translate("+xPosition+","+yPosition+")"},type.customMark(__assign({},piece.data,piece,{x:xPosition,y:yPosition}),i,__assign({},xy,{baseMarkProps:baseMarkProps,renderMode:renderMode,styleFn:styleFn,classFn:classFn,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,rScale:rScale}))):__assign({className:classFn(__assign({},piece,piece.data),i),renderMode:renderValue,key:"piece-"+piece.renderKey,transform:translate,style:styleFn(__assign({},piece,piece.data),ordsetI)},markProps,eventListeners);var calculatedPiece={o:key,xy:xy,piece:piece,renderElement:renderElementObject};if(projection==="horizontal"){currentY+=finalHeight}else{currentX+=finalWidth}return calculatedPiece});allCalculatedPieces=__spread(allCalculatedPieces,calculatedPieces)});return allCalculatedPieces}function barLayout(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,projection=_a.projection,classFn=_a.classFn,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,rScale=_a.rScale;var keys=Object.keys(data);var allCalculatedPieces=[];keys.forEach(function(key,ordsetI){var ordset=data[key];var barColumnWidth=Math.max(ordset.width,1);var calculatedPieces=ordset.pieceData.map(function(piece,i){var _a;var pieceSize=piece.scaledValue;var renderValue=renderMode&&renderMode(piece.data,i);var xPosition=piece.x;var yPosition=piece.bottom;var finalWidth=barColumnWidth;var finalHeight=pieceSize;if(!piece.negative){yPosition-=piece.scaledValue}if(projection==="horizontal"){yPosition=piece.x;xPosition=piece.bottom;finalHeight=barColumnWidth;finalWidth=pieceSize;if(piece.negative){xPosition=piece.bottom-piece.scaledValue}}var markProps;if(projection==="radial"){_a=radialBarFeatureGenerator({type:type,ordset:ordset,adjustedSize:adjustedSize,piece:piece,i:i}),markProps=_a.markProps,xPosition=_a.xPosition,yPosition=_a.yPosition;finalHeight=undefined;finalWidth=undefined}else{markProps={markType:"rect",x:xPosition,y:yPosition,width:Math.max(0,finalWidth),height:Math.max(0,finalHeight),rx:0,ry:0}}var eventListeners=eventListenersGenerator(piece,i);var xy={x:xPosition,y:yPosition,middle:barColumnWidth/2,height:finalHeight,width:finalWidth};if(type.icon&&projection!=="radial"){type.customMark=iconBarCustomMark({type:type,projection:projection,finalHeight:finalHeight,finalWidth:finalWidth,styleFn:styleFn,renderValue:renderValue,classFn:classFn})}else if(type.icon&&projection!=="horizontal"){console.error("Icons are currently unsupported in radial charts")}var renderElementObject=type.customMark?React.createElement("g",{key:"piece-"+piece.renderKey,transform:"translate("+xPosition+","+yPosition+")",role:"img",tabIndex:-1},type.customMark(__assign({},piece.data,piece,{x:xPosition,y:yPosition}),i,__assign({},xy,{baseMarkProps:baseMarkProps,renderMode:renderMode,styleFn:styleFn,classFn:classFn,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,rScale:rScale}))):__assign({className:classFn(__assign({},piece,piece.data),i),renderMode:renderValue,key:"piece-"+piece.renderKey,style:styleFn(__assign({},piece,piece.data),ordsetI)},eventListeners,markProps);var calculatedPiece={o:key,xy:xy,piece:piece,renderElement:renderElementObject};return calculatedPiece});allCalculatedPieces=__spread(allCalculatedPieces,calculatedPieces)});return allCalculatedPieces}function timelineLayout(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,projection=_a.projection,classFn=_a.classFn,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,rScale=_a.rScale;var allCalculatedPieces=[];var keys=Object.keys(data);keys.forEach(function(key,ordsetI){var ordset=data[key];var calculatedPieces=[];ordset.pieceData.forEach(function(piece,i){var renderValue=renderMode&&renderMode(piece.data,i);var xPosition=ordset.x;var height=piece.scaledEndValue-piece.scaledValue;var yPosition=piece.scaledVerticalValue-height;var width=ordset.width;var markProps={markType:"rect",height:height<0?-height:height,width:width,x:xPosition,y:height<0?yPosition+height:yPosition};if(projection==="horizontal"){yPosition=ordset.x;xPosition=piece.scaledValue;width=piece.scaledEndValue-piece.scaledValue;height=ordset.width;markProps={markType:"rect",height:height,width:width<0?-width:width,x:width<0?xPosition+width:xPosition,y:yPosition}}else if(projection==="radial"){markProps=radialBarFeatureGenerator({piece:piece,type:type,ordset:ordset,adjustedSize:adjustedSize,i:i}).markProps}var eventListeners=eventListenersGenerator(piece,i);var xy={x:xPosition,y:yPosition,height:height};var renderElementObject=type.customMark?React.createElement("g",{key:"piece-"+piece.renderKey,transform:"translate("+xPosition+","+(yPosition+height)+")"},type.customMark(__assign({},piece.data,piece,{x:xPosition,y:yPosition}),i,__assign({},xy,{baseMarkProps:baseMarkProps,renderMode:renderMode,styleFn:styleFn,classFn:classFn,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,rScale:rScale}))):__assign({className:classFn(__assign({},piece,piece.data),i),renderMode:renderValue,key:"piece-"+piece.renderKey,style:styleFn(__assign({},piece,piece.data),ordsetI)},markProps,eventListeners);var calculatedPiece={o:key,xy:xy,piece:piece,renderElement:renderElementObject};calculatedPieces.push(calculatedPiece)});allCalculatedPieces=__spread(allCalculatedPieces,calculatedPieces)});return allCalculatedPieces}function pointLayout(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,projection=_a.projection,classFn=_a.classFn,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,rScale=_a.rScale;var circleRadius=type.r||3;var allCalculatedPieces=[];var keys=Object.keys(data);keys.forEach(function(key,ordsetI){var ordset=data[key];var calculatedPieces=[];ordset.pieceData.forEach(function(piece,i){var renderValue=renderMode&&renderMode(piece.data,i);var xPosition=ordset.middle;var yPosition=piece.scaledVerticalValue;if(projection==="horizontal"){yPosition=ordset.middle;xPosition=piece.scaledValue}else if(projection==="radial"){var angle=ordset.pct_middle;var rPosition=piece.scaledValue/2;var baseCentroid=pointOnArcAtAngle$1([adjustedSize[0]/2,adjustedSize[1]/2],angle,rPosition);xPosition=baseCentroid[0];yPosition=baseCentroid[1]}var actualCircleRadius=typeof circleRadius==="function"?circleRadius(piece,i):circleRadius;var eventListeners=eventListenersGenerator(piece,i);var renderElementObject=type.customMark?React.createElement("g",{key:"piece-"+piece.renderKey,transform:"translate("+xPosition+","+yPosition+")"},type.customMark(__assign({},piece.data,piece,{x:xPosition,y:yPosition}),i,{r:circleRadius,x:xPosition,y:yPosition,baseMarkProps:baseMarkProps,renderMode:renderMode,styleFn:styleFn,classFn:classFn,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,rScale:rScale})):__assign({className:classFn(__assign({},piece,piece.data),i),markType:"rect",renderMode:renderValue,key:"piece-"+piece.renderKey,height:actualCircleRadius*2,width:actualCircleRadius*2,x:xPosition-actualCircleRadius,y:yPosition-actualCircleRadius,rx:actualCircleRadius,ry:actualCircleRadius,style:styleFn(__assign({},piece,piece.data),ordsetI)},eventListeners);var calculatedPiece={o:key,xy:{x:xPosition,y:yPosition},piece:piece,renderElement:renderElementObject};calculatedPieces.push(calculatedPiece)});allCalculatedPieces=__spread(allCalculatedPieces,calculatedPieces)});return allCalculatedPieces}function swarmLayout(_a){var type=_a.type,data=_a.data,renderMode=_a.renderMode,eventListenersGenerator=_a.eventListenersGenerator,styleFn=_a.styleFn,projection=_a.projection,classFn=_a.classFn,adjustedSize=_a.adjustedSize,chartSize=_a.chartSize,margin=_a.margin,baseMarkProps=_a.baseMarkProps,rScale=_a.rScale;var allCalculatedPieces=[];var iterations=type.iterations||120;var columnKeys=Object.keys(data);columnKeys.forEach(function(key,ordsetI){var oColumn=data[key];var anglePiece=1/columnKeys.length;var oData=oColumn.pieceData;var adjustedColumnWidth=oColumn.width;var circleRadius=type.r||Math.max(2,Math.min(5,4*adjustedColumnWidth/oData.length));var simulation=forceSimulation(oData).force("y",forceY(function(d){return d.scaledValue}).strength(type.strength||2)).force("x",forceX(oColumn.middle)).force("collide",forceCollide(circleRadius)).stop();if(projection==="vertical"){simulation.force("y",forceY(function(d){return d.scaledVerticalValue}).strength(type.strength||2))}for(var i=0;i<iterations;++i)simulation.tick();var calculatedPieces=oData.map(function(piece,i){var renderValue=renderMode&&renderMode(piece.data,i);var xPosition=piece.x;var yPosition=piece.y;if(projection==="horizontal"){yPosition=piece.x;xPosition=piece.y}else if(projection==="radial"){var angle=oColumn.pct_middle;xPosition=(piece.x-oColumn.middle)/adjustedColumnWidth*anglePiece;var rPosition=piece.scaledValue/2;var xAngle=angle+xPosition;var baseCentroid=pointOnArcAtAngle$1([adjustedSize[0]/2,adjustedSize[1]/2],xAngle,rPosition);xPosition=baseCentroid[0];yPosition=baseCentroid[1]}var actualCircleRadius=typeof circleRadius==="function"?circleRadius(piece,i):circleRadius;var eventListeners=eventListenersGenerator(piece,i);var renderElementObject=type.customMark?React.createElement("g",{key:"piece-"+piece.renderKey,transform:"translate("+xPosition+","+yPosition+")"},type.customMark(__assign({},piece.data,piece,{x:xPosition,y:yPosition}),i,{x:xPosition,y:yPosition,r:circleRadius,baseMarkProps:baseMarkProps,renderMode:renderMode,styleFn:styleFn,classFn:classFn,adjustedSize:adjustedSize,chartSize:chartSize,margin:margin,rScale:rScale})):__assign({className:classFn(__assign({},piece,piece.data),i),markType:"rect",renderMode:renderValue,key:"piece-"+piece.renderKey,height:actualCircleRadius*2,width:actualCircleRadius*2,x:xPosition-actualCircleRadius,y:yPosition-actualCircleRadius,rx:actualCircleRadius,ry:actualCircleRadius,style:styleFn(__assign({},piece,piece.data),ordsetI)},eventListeners);var calculatedPiece={o:key,xy:{x:xPosition,y:yPosition},piece:piece,renderElement:renderElementObject};return calculatedPiece});allCalculatedPieces=__spread(allCalculatedPieces,calculatedPieces)});return allCalculatedPieces}var genericFunction=function(value){return function(){return value}};var xScale=linear$1();var yScale=linear$1();var midMod=function(d){return d.middle?d.middle:0};var zeroFunction=genericFunction(0);var twoPI$2=Math.PI*2;var naturalLanguageTypes={bar:{items:"bar",chart:"bar chart"},clusterbar:{items:"bar",chart:"grouped bar chart"},swarm:{items:"point",chart:"swarm plot"},point:{items:"point",chart:"point plot"},timeline:{items:"bar",chart:"timeline"}};var projectedCoordinatesObject={y:"y",x:"x"};var defaultOverflow={top:0,bottom:0,left:0,right:0};var layoutHash={clusterbar:clusterBarLayout,bar:barLayout,point:pointLayout,swarm:swarmLayout,timeline:timelineLayout};var OrdinalFrame=function(_super){__extends(OrdinalFrame,_super);function OrdinalFrame(props){var _this=_super.call(this,props)||this;_this.calculateOrdinalFrame=function(currentProps){var oLabels;var projectedColumns={};var _a=currentProps.oPadding,padding=_a===void 0?0:_a,baseSummaryType=currentProps.summaryType,baseType=currentProps.type,baseConnectorType=currentProps.connectorType,baseOAccessor=currentProps.oAccessor,baseRAccessor=currentProps.rAccessor,baseConnectorStyle=currentProps.connectorStyle,baseStyle=currentProps.style,baseRExtent=currentProps.rExtent,oSort=currentProps.oSort,_b=currentProps.sortO,sortO=_b===void 0?oSort:_b,basePieceClass=currentProps.pieceClass,baseSummaryStyle=currentProps.summaryStyle,baseSummaryClass=currentProps.summaryClass,dynamicColumnWidth=currentProps.dynamicColumnWidth,projection=currentProps.projection,customHoverBehavior=currentProps.customHoverBehavior,customClickBehavior=currentProps.customClickBehavior,customDoubleClickBehavior=currentProps.customDoubleClickBehavior,size=currentProps.size,pixelColumnWidth=currentProps.pixelColumnWidth,baseTitle=currentProps.title,oLabel=currentProps.oLabel,hoverAnnotation=currentProps.hoverAnnotation,pieceHoverAnnotation=currentProps.pieceHoverAnnotation,summaryHoverAnnotation=currentProps.summaryHoverAnnotation,backgroundGraphics=currentProps.backgroundGraphics,foregroundGraphics=currentProps.foregroundGraphics,oScaleType=currentProps.oScaleType,rScaleType=currentProps.rScaleType,legend=currentProps.legend,baseRenderKey=currentProps.renderKey,data=currentProps.data,baseMargin=currentProps.margin,baseOExtent=currentProps.oExtent,axes=currentProps.axes,_c=currentProps.axis,baseAxis=_c===void 0?axes:_c,basePieceIDAccessor=currentProps.pieceIDAccessor,baseSummaryPosition=currentProps.summaryPosition,multiAxis=currentProps.multiAxis,_d=currentProps.baseMarkProps,baseMarkProps=_d===void 0?{}:_d;var summaryType=objectifyType(baseSummaryType);var pieceType=objectifyType(baseType);var connectorType=objectifyType(baseConnectorType);var oAccessor=stringToArrayFn(baseOAccessor,function(d){return d.renderKey});var rAccessor=stringToArrayFn(baseRAccessor,function(d){return d.value||1});var renderKey=stringToFn(baseRenderKey,function(d,i){return i});var eventListenersGenerator=function(){return{}};var connectorStyle=stringToFn(baseConnectorStyle,function(){return{}},true);var summaryStyle=stringToFn(baseSummaryStyle,function(){return{}},true);var pieceStyle=stringToFn(baseStyle,function(){return{}},true);var pieceClass=stringToFn(basePieceClass,function(){return""},true);var summaryClass=stringToFn(baseSummaryClass,function(){return""},true);var summaryPosition=baseSummaryPosition||function(position){return position};var title=typeof baseTitle==="object"&&!React.isValidElement(baseTitle)&&baseTitle!==null?baseTitle:{title:baseTitle,orient:"top"};var pieceIDAccessor=stringToFn(basePieceIDAccessor,function(){return""});var originalRAccessor=Array.isArray(baseRAccessor)?baseRAccessor:[baseRAccessor];var originalOAccessor=Array.isArray(baseOAccessor)?baseOAccessor:[baseOAccessor];var _e=keyAndObjectifyBarData({data:data,renderKey:renderKey,oAccessor:oAccessor,rAccessor:rAccessor,originalRAccessor:originalRAccessor,originalOAccessor:originalOAccessor,multiAxis:multiAxis}),allData=_e.allData,multiExtents=_e.multiExtents;var arrayWrappedAxis;if(Array.isArray(baseAxis)){arrayWrappedAxis=baseAxis.map(function(axisFnOrObject){return typeof axisFnOrObject==="function"?axisFnOrObject({size:currentProps.size}):axisFnOrObject})}else if(baseAxis){arrayWrappedAxis=[baseAxis].map(function(axisFnOrObject){return typeof axisFnOrObject==="function"?axisFnOrObject({size:currentProps.size}):axisFnOrObject})}if(multiExtents&&baseAxis){arrayWrappedAxis.forEach(function(d,i){d.extentOverride=multiExtents[i]})}var margin=calculateMargin({margin:baseMargin,axes:arrayWrappedAxis,title:title,oLabel:oLabel,projection:projection,size:size});var _f=adjustedPositionSize({size:size,margin:margin,projection:projection}),adjustedPosition=_f.adjustedPosition,adjustedSize=_f.adjustedSize;var oExtentSettings=baseOExtent===undefined||Array.isArray(baseOExtent)?{extent:baseOExtent}:baseOExtent;var calculatedOExtent=allData.reduce(function(p,c){var baseOValue=c.column;var oValue=baseOValue!==undefined?String(baseOValue):baseOValue;if(p.indexOf(oValue)===-1){p.push(oValue)}return p},[]);var oExtent=oExtentSettings.extent||calculatedOExtent;if(pieceType.type==="barpercent"){var oExtentSums_1=oExtent.map(function(d){return allData.filter(function(p){return String(p.column)===d}).reduce(function(p,c){return p+c.value},0)}).reduce(function(p,c,i){p[oExtent[i]]=c;return p},{});allData.forEach(function(d){d.value=oExtentSums_1[d.column]&&d.value/oExtentSums_1[d.column]||0});pieceType.type="bar"}if(pixelColumnWidth){if(projection==="radial"){console.error("pixelColumnWidth is not honored in radial mode")}else if(projection==="vertical"){adjustedSize[0]=oExtent.length*pixelColumnWidth}else{adjustedSize[1]=oExtent.length*pixelColumnWidth}}var oDomain=projection==="vertical"&&[0,adjustedSize[0]]||[0,adjustedSize[1]];var cwHash=oExtent.reduce(function(p,c){p[c]=1/oExtent.length*oDomain[1];p.total+=p[c];return p},{total:0});var castOScaleType=oScaleType;var oScale=dynamicColumnWidth?ordinal():castOScaleType();oScale.domain(oExtent);var maxColumnValues;if(dynamicColumnWidth){var columnValueCreator_1;if(typeof dynamicColumnWidth==="string"){columnValueCreator_1=function(d){return sum$2(d.map(function(p){return p.data[dynamicColumnWidth]}))}}else{columnValueCreator_1=function(d){return dynamicColumnWidth(d.map(function(p){return p.data}))}}var thresholdDomain_1=[0];maxColumnValues=0;var columnValues_1=[];oExtent.forEach(function(d){var oValues=allData.filter(function(p){return p.column===d});var columnValue=columnValueCreator_1(oValues);columnValues_1.push(columnValue);maxColumnValues+=columnValue});cwHash.total=0;oExtent.forEach(function(d,i){var oValue=columnValues_1[i];var stepValue=oValue/maxColumnValues*(oDomain[1]-oDomain[0]);cwHash[d]=stepValue;cwHash.total+=stepValue;if(i!==oExtent.length-1){thresholdDomain_1.push(stepValue+thresholdDomain_1[i])}});oScale.range(thresholdDomain_1)}else{oScale.range(oDomain)}var rExtentSettings=baseRExtent===undefined||Array.isArray(baseRExtent)?{extent:baseRExtent,onChange:undefined}:baseRExtent;var rExtent=rExtentSettings.extent;var subZeroRExtent=[0,0];if(pieceType.type==="bar"&&summaryType.type&&summaryType.type!=="none"){pieceType.type="none"}if(pieceType.type==="timeline"){var rData=allData.map(function(d){return d.value});var leftExtent=extent(rData.map(function(d){return d[0]}));var rightExtent=extent(rData.map(function(d){return d[1]}));rExtent=extent(__spread(leftExtent,rightExtent))}else if(pieceType.type!=="bar"){rExtent=extent(allData,function(d){return d.value})}else{var positiveData=allData.filter(function(d){return d.value>=0});var negativeData=allData.filter(function(d){return d.value<0});var nestedPositiveData=nest().key(function(d){return d.column}).rollup(function(leaves){return sum$2(leaves.map(function(d){return d.value}))}).entries(positiveData);var nestedNegativeData=nest().key(function(d){return d.column}).rollup(function(leaves){return sum$2(leaves.map(function(d){return d.value}))}).entries(negativeData);rExtent=[0,nestedPositiveData.length===0?0:Math.max(max$2(nestedPositiveData,function(d){return d.value}),0)];subZeroRExtent=[0,nestedNegativeData.length===0?0:Math.min(min$2(nestedNegativeData,function(d){return d.value}),0)];rExtent=[subZeroRExtent[1],rExtent[1]]}if((pieceType.type==="clusterbar"||multiAxis)&&rExtent[0]>0){rExtent[0]=0}var calculatedRExtent=rExtent;if(rExtentSettings.extent&&rExtentSettings.extent[0]!==undefined&&rExtentSettings.extent[1]!==undefined){rExtent=rExtentSettings.extent}else{if(rExtentSettings.extent&&rExtentSettings.extent[1]!==undefined&&rExtentSettings.extent[0]===undefined){rExtent[1]=rExtentSettings.extent[1]}if(rExtentSettings.extent&&rExtentSettings.extent[0]!==undefined&&rExtentSettings.extent[1]===undefined){rExtent[0]=rExtentSettings.extent[0]}}if(currentProps.invertR||rExtentSettings.extent&&rExtentSettings.extent[0]>rExtentSettings.extent[1]){rExtent=[rExtent[1],rExtent[0]]}var nestedPieces={};nest().key(function(d){return d.column}).entries(allData).forEach(function(d){nestedPieces[d.key]=d.values});if(sortO!==undefined){oExtent=oExtent.sort(function(a,b){return sortO(a,b,nestedPieces[a].map(function(d){return d.data}),nestedPieces[b].map(function(d){return d.data}))});oScale.domain(oExtent)}var rDomain=projection==="vertical"&&[0,adjustedSize[1]]||[0,adjustedSize[0]];var castRScaleType=rScaleType;var instantiatedRScaleType=rScaleType.domain?rScaleType:castRScaleType();var rScale=instantiatedRScaleType.copy().domain(rExtent).range(rDomain);var rScaleReverse=instantiatedRScaleType.copy().domain(rDomain).range(rDomain.reverse());var rScaleVertical=instantiatedRScaleType.copy().domain(rExtent).range(rDomain);var columnWidth=cwHash?0:oScale.bandwidth();var pieceData=[];var mappedMiddleSize=adjustedSize[1];if(projection==="vertical"){mappedMiddleSize=adjustedSize[0]}var mappedMiddles=_this.mappedMiddles(oScale,mappedMiddleSize,padding);pieceData=oExtent.map(function(d){return nestedPieces[d]?nestedPieces[d]:[]});var zeroValue=projection==="vertical"?rScaleReverse(rScale(0)):rScale(0);oExtent.forEach(function(o,i){projectedColumns[o]={name:o,padding:padding,pieceData:pieceData[i],pieces:pieceData[i]};projectedColumns[o].x=oScale(o)+padding/2;projectedColumns[o].y=0;projectedColumns[o].middle=mappedMiddles[o]+padding/2;var negativeOffset=zeroValue;var positiveOffset=zeroValue;var negativeBaseValue=0;var positiveBaseValue=0;projectedColumns[o].pieceData.forEach(function(piece){var valPosition;if(pieceType.type==="timeline"){piece.scaledValue=rScale(piece.value[0]);piece.scaledEndValue=rScale(piece.value[1]);piece.scaledVerticalValue=rScaleVertical(piece.value[0])}else if(pieceType.type!=="bar"&&pieceType.type!=="clusterbar"){piece.scaledValue=rScale(piece.value);piece.scaledVerticalValue=rScaleVertical(piece.value)}else if(pieceType.type==="clusterbar"){valPosition=projection==="vertical"?rScaleReverse(rScale(piece.value)):rScale(piece.value);piece.scaledValue=Math.abs(zeroValue-valPosition)}piece.x=projectedColumns[o].x;if(piece.value>=0){if(pieceType.type==="bar"){piece.scaledValue=projection==="vertical"?positiveOffset-rScaleReverse(rScale(positiveBaseValue+piece.value)):rScale(positiveBaseValue+piece.value)-positiveOffset;positiveBaseValue+=piece.value}piece.base=zeroValue;piece.bottom=pieceType.type==="bar"?positiveOffset:0;piece.middle=piece.scaledValue/2+positiveOffset;positiveOffset=projection==="vertical"?positiveOffset-piece.scaledValue:positiveOffset+piece.scaledValue;piece.negative=false}else{if(pieceType.type==="bar"){piece.scaledValue=projection==="vertical"?Math.abs(rScale(piece.value)-rScale(0)):Math.abs(rScale(piece.value)-zeroValue);negativeBaseValue+=piece.value}piece.base=zeroValue;piece.bottom=pieceType.type==="bar"?negativeOffset:0;piece.middle=negativeOffset-piece.scaledValue/2;negativeOffset=projection==="vertical"?negativeOffset+piece.scaledValue:negativeOffset-piece.scaledValue;piece.negative=true}});if(cwHash){projectedColumns[o].width=cwHash[o]-padding;if(currentProps.ordinalAlign==="center"){if(i===0){projectedColumns[o].x=projectedColumns[o].x-projectedColumns[o].width/2;projectedColumns[o].middle=projectedColumns[o].middle-projectedColumns[o].width/2}else{projectedColumns[o].x=projectedColumns[oExtent[i-1]].x+projectedColumns[oExtent[i-1]].width;projectedColumns[o].middle=projectedColumns[o].x+projectedColumns[o].width/2}}projectedColumns[o].pct=cwHash[o]/cwHash.total;projectedColumns[o].pct_start=(projectedColumns[o].x-oDomain[0])/cwHash.total;projectedColumns[o].pct_padding=padding/cwHash.total;projectedColumns[o].pct_middle=(projectedColumns[o].middle-oDomain[0])/cwHash.total}else{projectedColumns[o].width=columnWidth-padding;if(currentProps.ordinalAlign==="center"){projectedColumns[o].x=projectedColumns[o].x-projectedColumns[o].width/2;projectedColumns[o].middle=projectedColumns[o].middle-projectedColumns[o].width/2}projectedColumns[o].pct=columnWidth/adjustedSize[1];projectedColumns[o].pct_start=(projectedColumns[o].x-oDomain[0])/adjustedSize[1];projectedColumns[o].pct_padding=padding/adjustedSize[1];projectedColumns[o].pct_middle=(projectedColumns[o].middle-oDomain[0])/adjustedSize[1]}});var labelArray=[];var pieArcs=[];var labelSettings=typeof oLabel==="object"?Object.assign({label:true,padding:5},oLabel):{orient:"default",label:oLabel,padding:5};if(oLabel||hoverAnnotation){var offsetPct_1=pieceType.offsetAngle&&pieceType.offsetAngle/360||0;var rangePct=pieceType.angleRange&&pieceType.angleRange.map(function(d){return d/360})||[0,1];var rangeMod_1=rangePct[1]-rangePct[0];var adjustedPct_1=rangeMod_1<1?linear$1().domain([0,1]).range(rangePct):function(d){return d};oExtent.forEach(function(d){var arcGenerator=arc$1().innerRadius(0).outerRadius(rScale.range()[1]/2);var angle=projectedColumns[d].pct*rangeMod_1;var startAngle=adjustedPct_1(projectedColumns[d].pct_start+offsetPct_1);var endAngle=startAngle+angle;var midAngle=startAngle+angle/2;var markD=arcGenerator({startAngle:startAngle*twoPI$2,endAngle:endAngle*twoPI$2});var translate=[adjustedSize[0]/2,adjustedSize[1]/2];var centroid=arcGenerator.centroid({startAngle:startAngle*twoPI$2,endAngle:endAngle*twoPI$2});var addedPadding=centroid[1]>0&&(!labelSettings.orient||labelSettings.orient==="default"||labelSettings.orient==="edge")?8:0;var outerPoint=pointOnArcAtAngle([0,0],midAngle,rScale.range()[1]/2+labelSettings.padding+addedPadding);pieArcs.push({startAngle:startAngle,endAngle:endAngle,midAngle:midAngle,markD:markD,translate:translate,centroid:centroid,outerPoint:outerPoint})})}if(currentProps.oLabel){var labelingFn_1;if(labelSettings.label===true){var labelStyle_1={textAnchor:"middle"};if(projection==="horizontal"&&labelSettings.orient==="right"){labelStyle_1.textAnchor="start"}else if(projection==="horizontal"){labelStyle_1.textAnchor="end"}labelingFn_1=function(d,p,i){var additionalStyle={};var transformRotate;if(projection==="radial"&&labelSettings.orient==="stem"){transformRotate="rotate("+(pieArcs[i].outerPoint[0]<0?pieArcs[i].midAngle*360+90:pieArcs[i].midAngle*360-90)+")"}else if(projection==="radial"&&labelSettings.orient!=="center"){transformRotate="rotate("+(pieArcs[i].outerPoint[1]<0?pieArcs[i].midAngle*360:pieArcs[i].midAngle*360+180)+")"}if(projection==="radial"&&labelSettings.orient==="stem"&&(pieArcs[i].outerPoint[0]>0&&labelSettings.padding<0||pieArcs[i].outerPoint[0]<0&&labelSettings.padding>=0)){additionalStyle.textAnchor="end"}else if(projection==="radial"&&labelSettings.orient==="stem"){additionalStyle.textAnchor="start"}return React.createElement("text",__assign({},labelStyle_1,additionalStyle,{transform:transformRotate}),d)}}else if(typeof labelSettings.label==="function"){labelingFn_1=labelSettings.label}oExtent.forEach(function(d,i){var xPosition=projectedColumns[d].middle;var yPosition=0;if(projection==="horizontal"){yPosition=projectedColumns[d].middle;if(labelSettings.orient==="right"){xPosition=adjustedSize[0]+3}else{xPosition=-3}}else if(projection==="radial"){if(labelSettings.orient==="center"){xPosition=pieArcs[i].centroid[0]+pieArcs[i].translate[0];yPosition=pieArcs[i].centroid[1]+pieArcs[i].translate[1]}else{xPosition=pieArcs[i].outerPoint[0]+pieArcs[i].translate[0];yPosition=pieArcs[i].outerPoint[1]+pieArcs[i].translate[1]}}var label=labelingFn_1(d,projectedColumns[d].pieceData.map(function(d){return d.data}),i);labelArray.push(React.createElement("g",{key:"olabel-"+i,transform:"translate("+xPosition+","+yPosition+")"},label))});if(projection==="vertical"){var labelY=void 0;if(labelSettings.orient==="top"){labelY=-15}else{labelY=15+rScale.range()[1]}oLabels=React.createElement("g",{key:"ordinalframe-labels-container",className:"ordinal-labels",transform:"translate("+margin.left+","+(labelY+margin.top)+")"},labelArray)}else if(projection==="horizontal"){oLabels=React.createElement("g",{key:"ordinalframe-labels-container",className:"ordinal-labels",transform:"translate("+margin.left+","+margin.top+")"},labelArray)}else if(projection==="radial"){oLabels=React.createElement("g",{key:"ordinalframe-labels-container",className:"ordinal-labels",transform:"translate("+margin.left+","+margin.top+")"},labelArray)}}var columnOverlays;if(currentProps.hoverAnnotation){columnOverlays=oExtent.map(function(d,i){var barColumnWidth=projectedColumns[d].width;var xPosition=projectedColumns[d].x;var yPosition=0;var height=rScale.range()[1];var width=barColumnWidth+padding;if(projection==="horizontal"){yPosition=projectedColumns[d].x;xPosition=0;width=rScale.range()[1];height=barColumnWidth}if(projection==="radial"){var _a=pieArcs[i],markD=_a.markD,centroid=_a.centroid,translate=_a.translate,midAngle=_a.midAngle;var radialMousePackage_1={type:"column-hover",column:projectedColumns[d],pieces:projectedColumns[d].pieceData,summary:projectedColumns[d].pieceData,arcAngles:{centroid:centroid,translate:translate,midAngle:midAngle,length:rScale.range()[1]/2}};return{markType:"path",key:"hover"+d,d:markD,transform:"translate("+translate.join(",")+")",style:{opacity:0,fill:"pink"},overlayData:radialMousePackage_1,onDoubleClick:customDoubleClickBehavior&&function(){customDoubleClickBehavior(radialMousePackage_1)},onClick:customClickBehavior&&function(){customClickBehavior(radialMousePackage_1)},onMouseEnter:customHoverBehavior&&function(){customHoverBehavior(radialMousePackage_1)},onMouseLeave:customHoverBehavior&&function(){customHoverBehavior()}}}var baseMousePackage={type:"column-hover",column:projectedColumns[d],pieces:projectedColumns[d].pieceData,summary:projectedColumns[d].pieceData};return{markType:"rect",key:"hover-"+d,x:xPosition,y:yPosition,height:height,width:width,style:{opacity:0,stroke:"black",fill:"pink"},onDoubleClick:customDoubleClickBehavior&&function(){customDoubleClickBehavior(baseMousePackage)},onClick:customClickBehavior&&function(){customClickBehavior(baseMousePackage)},onMouseEnter:customHoverBehavior&&function(){customHoverBehavior(baseMousePackage)},onMouseLeave:function(){return{}},overlayData:baseMousePackage}})}var renderMode=currentProps.renderMode,canvasSummaries=currentProps.canvasSummaries,summaryRenderMode=currentProps.summaryRenderMode,connectorClass=currentProps.connectorClass,connectorRenderMode=currentProps.connectorRenderMode,canvasConnectors=currentProps.canvasConnectors,canvasPieces=currentProps.canvasPieces;var pieceDataXY;var pieceRenderMode=stringToFn(renderMode,undefined,true);var pieceCanvasRender=stringToFn(canvasPieces,undefined,true);var summaryCanvasRender=stringToFn(canvasSummaries,undefined,true);var connectorCanvasRender=stringToFn(canvasConnectors,undefined,true);var pieceTypeForXY=pieceType.type&&pieceType.type!=="none"?pieceType.type:"point";var pieceTypeLayout=typeof pieceTypeForXY==="function"?pieceTypeForXY:layoutHash[pieceTypeForXY];var calculatedPieceData=pieceTypeLayout({type:pieceType,data:projectedColumns,renderMode:pieceRenderMode,eventListenersGenerator:eventListenersGenerator,styleFn:pieceStyle,projection:projection,classFn:pieceClass,adjustedSize:adjustedSize,chartSize:size,margin:margin,rScale:rScale,baseMarkProps:baseMarkProps});var keyedData=calculatedPieceData.reduce(function(p,c){if(!p[c.o]){p[c.o]=[]}p[c.o].push(c);return p},{});Object.keys(projectedColumns).forEach(function(d){projectedColumns[d].xyData=keyedData[d]||[]});var calculatedSummaries={};if(summaryType.type&&summaryType.type!=="none"){calculatedSummaries=drawSummaries({data:projectedColumns,type:summaryType,renderMode:stringToFn(summaryRenderMode,undefined,true),styleFn:stringToFn(summaryStyle,function(){return{}},true),classFn:stringToFn(summaryClass,function(){return""},true),positionFn:summaryPosition,projection:projection,eventListenersGenerator:eventListenersGenerator,adjustedSize:adjustedSize,baseMarkProps:baseMarkProps,margin:margin});calculatedSummaries.originalData=projectedColumns}var yMod=projection==="horizontal"?midMod:zeroFunction;var xMod=projection==="vertical"?midMod:zeroFunction;var basePieceData=calculatedPieceData.map(function(d){return Object.assign({},d.piece,{type:"frame-hover",x:d.xy.x+xMod(d.xy),y:d.xy.y+yMod(d.xy)})});if(pieceHoverAnnotation&&["bar","clusterbar","timeline"].indexOf(pieceType.type)===-1||summaryHoverAnnotation){if(summaryHoverAnnotation&&calculatedSummaries.xyPoints){pieceDataXY=calculatedSummaries.xyPoints.map(function(d){return Object.assign({},d,{type:"frame-hover",isSummaryData:true,x:d.x,y:d.y})})}else if(pieceHoverAnnotation&&calculatedPieceData){pieceDataXY=basePieceData}}var _g=orFrameAxisGenerator({axis:arrayWrappedAxis,data:allData,projection:projection,adjustedSize:adjustedSize,size:size,rScale:rScale,rScaleType:instantiatedRScaleType.copy(),pieceType:pieceType,rExtent:rExtent,maxColumnValues:maxColumnValues,xyData:basePieceData,margin:margin}),axis=_g.axis,axesTickLines=_g.axesTickLines;if(pieceHoverAnnotation&&["bar","clusterbar","timeline"].indexOf(pieceType.type)!==-1){var yMod_1=projection==="horizontal"?midMod:zeroFunction;var xMod_1=projection==="vertical"?midMod:zeroFunction;columnOverlays=calculatedPieceData.map(function(d,i){var mousePackage=__assign({},d.piece,{x:d.xy.x+xMod_1(d.xy),y:d.xy.y+yMod_1(d.xy)});if(React.isValidElement(d.renderElement)){return{renderElement:d.renderElement,overlayData:mousePackage}}return __assign({},d.renderElement,{key:"hover-"+i,type:"frame-hover",style:{opacity:0,stroke:"black",fill:"pink"},overlayData:mousePackage,onClick:customClickBehavior&&function(){customClickBehavior(mousePackage.data)},onDoubleClick:customDoubleClickBehavior&&function(){customDoubleClickBehavior(mousePackage.data)},onMouseEnter:customHoverBehavior&&function(){customHoverBehavior(mousePackage.data)},onMouseLeave:customHoverBehavior&&function(){customHoverBehavior()}})})}var typeAriaLabel=pieceType.type!==undefined&&typeof pieceType.type!=="function"&&naturalLanguageTypes[pieceType.type]||{items:"piece",chart:"ordinal chart"};var orFrameRender={connectors:{accessibleTransform:function(data,i){return data[i]},projection:projection,data:keyedData,styleFn:stringToFn(connectorStyle,function(){return{}},true),classFn:stringToFn(connectorClass,function(){return""},true),renderMode:stringToFn(connectorRenderMode,undefined,true),canvasRender:connectorCanvasRender,behavior:orFrameConnectionRenderer,type:connectorType,eventListenersGenerator:eventListenersGenerator,pieceType:pieceType},summaries:{accessibleTransform:function(data,i){var columnName=oExtent[i];var summaryPackage={type:"column-hover",column:projectedColumns[columnName],pieces:projectedColumns[columnName].pieceData,summary:projectedColumns[columnName].pieceData,oAccessor:oAccessor};return summaryPackage},data:calculatedSummaries.marks,behavior:renderLaidOutSummaries,canvasRender:summaryCanvasRender,styleFn:stringToFn(summaryStyle,function(){return{}},true),classFn:stringToFn(summaryClass,function(){return""},true)},pieces:{accessibleTransform:function(data,i){return __assign({},data[i].piece?__assign({},data[i].piece,data[i].xy):data[i],{type:"frame-hover"})},shouldRender:pieceType.type&&pieceType.type!=="none",data:calculatedPieceData,behavior:renderLaidOutPieces,canvasRender:pieceCanvasRender,styleFn:stringToFn(pieceStyle,function(){return{}},true),classFn:stringToFn(pieceClass,function(){return""},true),axis:arrayWrappedAxis,ariaLabel:typeAriaLabel}};if(rExtentSettings.onChange&&(_this.state.calculatedRExtent||[]).join(",")!==(calculatedRExtent||[]).join(",")){rExtentSettings.onChange(calculatedRExtent)}if(oExtentSettings.onChange&&(_this.state.calculatedOExtent||[]).join(",")!==(calculatedOExtent||[]).join(",")){oExtentSettings.onChange(calculatedOExtent)}_this.setState({pieceDataXY:pieceDataXY,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,backgroundGraphics:backgroundGraphics,foregroundGraphics:foregroundGraphics,axisData:arrayWrappedAxis,axes:axis,axesTickLines:axesTickLines,oLabels:oLabels,title:title,columnOverlays:columnOverlays,renderNumber:_this.state.renderNumber+1,oAccessor:oAccessor,rAccessor:rAccessor,oScaleType:oScaleType,rScaleType:instantiatedRScaleType,oExtent:oExtent,rExtent:rExtent,oScale:oScale,rScale:rScale,calculatedOExtent:calculatedOExtent,calculatedRExtent:calculatedRExtent,projectedColumns:projectedColumns,margin:margin,legendSettings:legend,orFrameRender:orFrameRender,summaryType:summaryType,type:pieceType,pieceIDAccessor:pieceIDAccessor})};_this.defaultORSVGRule=function(_a){var d=_a.d,i=_a.i,annotationLayer=_a.annotationLayer;var projection=_this.props.projection;var _b=_this.state,adjustedPosition=_b.adjustedPosition,adjustedSize=_b.adjustedSize,oAccessor=_b.oAccessor,rAccessor=_b.rAccessor,oScale=_b.oScale,rScale=_b.rScale,projectedColumns=_b.projectedColumns,orFrameRender=_b.orFrameRender,pieceIDAccessor=_b.pieceIDAccessor,rScaleType=_b.rScaleType;var screenCoordinates=[0,0];if(d.coordinates||d.type==="enclose"&&d.neighbors){screenCoordinates=(d.coordinates||d.neighbors).map(function(p){var pO=findFirstAccessorValue(oAccessor,p)||p.column;var oColumn=projectedColumns[pO];var idPiece=findIDPiece(pieceIDAccessor,oColumn,p);return screenProject({p:p,adjustedSize:adjustedSize,rScale:rScale,rAccessor:rAccessor,idPiece:idPiece,projection:projection,oColumn:oColumn,rScaleType:rScaleType})})}else{var pO=findFirstAccessorValue(oAccessor,d)||d.column;var oColumn=projectedColumns[pO];var idPiece=findIDPiece(pieceIDAccessor,oColumn,d);screenCoordinates=screenProject({p:d,adjustedSize:adjustedSize,rScale:rScale,rAccessor:rAccessor,idPiece:idPiece,projection:projection,oColumn:oColumn,rScaleType:rScaleType})}var voronoiHover=annotationLayer.voronoiHover;var customAnnotation=_this.props.svgAnnotationRules&&_this.props.svgAnnotationRules({d:d,i:i,oScale:oScale,rScale:rScale,oAccessor:oAccessor,rAccessor:rAccessor,orFrameProps:_this.props,orFrameState:_this.state,screenCoordinates:screenCoordinates,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer,categories:_this.state.projectedColumns,voronoiHover:voronoiHover});if(_this.props.svgAnnotationRules&&customAnnotation!==null){return customAnnotation}else if(d.type==="desaturation-layer"){return desaturationLayer({style:d.style instanceof Function?d.style(d,i):d.style,size:adjustedSize,i:i,key:d.key})}else if(d.type==="ordinal-line"){return svgOrdinalLine({d:d,screenCoordinates:screenCoordinates,voronoiHover:voronoiHover})}else if(d.type==="or"){return svgORRule({d:d,i:i,screenCoordinates:screenCoordinates,projection:projection})}else if(d.type==="highlight"){return svgHighlightRule({d:d,pieceIDAccessor:pieceIDAccessor,orFrameRender:orFrameRender,oAccessor:oAccessor})}else if(d.type==="react-annotation"||typeof d.type==="function"){return basicReactAnnotationRule({d:d,i:i,screenCoordinates:screenCoordinates})}else if(d.type==="enclose"){return svgEncloseRule({d:d,i:i,screenCoordinates:screenCoordinates})}else if(d.type==="enclose-rect"){return svgRectEncloseRule({d:d,screenCoordinates:screenCoordinates,i:i})}else if(d.type==="r"){return svgRRule({d:d,i:i,screenCoordinates:screenCoordinates,rScale:rScale,rAccessor:rAccessor,projection:projection,adjustedSize:adjustedSize,adjustedPosition:adjustedPosition})}else if(d.type==="category"){return svgCategoryRule({projection:projection,d:d,i:i,categories:_this.state.projectedColumns,adjustedSize:adjustedSize})}return null};_this.defaultORHTMLRule=function(_a){var d=_a.d,i=_a.i,annotationLayer=_a.annotationLayer;var _b=_this.state,adjustedPosition=_b.adjustedPosition,adjustedSize=_b.adjustedSize,oAccessor=_b.oAccessor,rAccessor=_b.rAccessor,oScale=_b.oScale,rScale=_b.rScale,projectedColumns=_b.projectedColumns,summaryType=_b.summaryType,type=_b.type,pieceIDAccessor=_b.pieceIDAccessor,rScaleType=_b.rScaleType;var _c=_this.props,htmlAnnotationRules=_c.htmlAnnotationRules,tooltipContent=_c.tooltipContent,projection=_c.projection,size=_c.size,useSpans=_c.useSpans;var screenCoordinates=[0,0];var voronoiHover=annotationLayer.voronoiHover;if(d.coordinates||d.type==="enclose"&&d.neighbors){screenCoordinates=(d.coordinates||d.neighbors).map(function(p){var pO=findFirstAccessorValue(oAccessor,p)||p.column;var oColumn=projectedColumns[pO];var idPiece=findIDPiece(pieceIDAccessor,oColumn,p);return screenProject({p:p,adjustedSize:adjustedSize,rScale:rScale,rAccessor:rAccessor,idPiece:idPiece,projection:projection,oColumn:oColumn,rScaleType:rScaleType})})}else if(d.type==="column-hover"){var _d=__read(getColumnScreenCoordinates({d:d,projectedColumns:projectedColumns,oAccessor:oAccessor,summaryType:summaryType,type:type,projection:projection,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize}).coordinates,2),xPosition=_d[0],yPosition=_d[1];screenCoordinates=[xPosition,yPosition]}else{var pO=findFirstAccessorValue(oAccessor,d)||d.column;var oColumn=projectedColumns[pO];var idPiece=findIDPiece(pieceIDAccessor,oColumn,d);screenCoordinates=screenProject({p:d,adjustedSize:adjustedSize,rScale:rScale,rAccessor:rAccessor,idPiece:idPiece,projection:projection,oColumn:oColumn,rScaleType:rScaleType})}var flippedRScale=projection==="vertical"?rScaleType.domain(rScale.domain()).range(rScale.range().reverse()):rScale;var customAnnotation=htmlAnnotationRules&&htmlAnnotationRules({d:d,i:i,oScale:oScale,rScale:flippedRScale,oAccessor:oAccessor,rAccessor:rAccessor,orFrameProps:_this.props,screenCoordinates:screenCoordinates,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer,orFrameState:_this.state,categories:_this.state.projectedColumns,voronoiHover:voronoiHover});if(htmlAnnotationRules&&customAnnotation!==null){return customAnnotation}if(d.type==="frame-hover"){return htmlFrameHoverRule({d:d,i:i,rAccessor:rAccessor,oAccessor:oAccessor,projection:projection,tooltipContent:tooltipContent,projectedColumns:projectedColumns,useSpans:useSpans,pieceIDAccessor:pieceIDAccessor,adjustedSize:adjustedSize,rScale:rScale,type:type,rScaleType:rScaleType})}else if(d.type==="column-hover"){return htmlColumnHoverRule({d:d,i:i,summaryType:summaryType,oAccessor:oAccessor,projectedColumns:projectedColumns,type:type,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,projection:projection,tooltipContent:tooltipContent,useSpans:useSpans})}return null};_this.state={adjustedPosition:[],adjustedSize:[],backgroundGraphics:undefined,foregroundGraphics:undefined,axisData:undefined,renderNumber:0,oLabels:[],oAccessor:stringToArrayFn("renderKey"),rAccessor:stringToArrayFn("value"),oScale:band(),rScale:linear$1(),axes:undefined,calculatedOExtent:[],calculatedRExtent:[0,1],columnOverlays:[],dataVersion:undefined,legendSettings:{},margin:{top:0,bottom:0,left:0,right:0},oExtent:[],oScaleType:band(),orFrameRender:{},pieceDataXY:[],pieceIDAccessor:stringToFn("semioticPieceID"),projectedColumns:{},rExtent:[],rScaleType:linear$1(),summaryType:{type:"none"},title:{},type:{type:"none"}};return _this}OrdinalFrame.prototype.componentWillUnmount=function(){if(this.props.onUnmount){this.props.onUnmount(this.props,this.state)}};OrdinalFrame.prototype.componentWillMount=function(){Object.keys(this.props).forEach(function(d){if(!ordinalframeproptypes[d]){if(xyframeproptypes[d]){console.error(d+" is an XYFrame prop are you sure you're using the right frame?")}else if(networkframeproptypes[d]){console.error(d+" is a NetworkFrame prop are you sure you're using the right frame?")}else{console.error(d+" is not a valid OrdinalFrame prop")}}});this.calculateOrdinalFrame(this.props)};OrdinalFrame.prototype.componentWillReceiveProps=function(nextProps){var _this=this;if(this.state.dataVersion&&this.state.dataVersion!==nextProps.dataVersion||!this.state.projectedColumns){this.calculateOrdinalFrame(nextProps)}else if(this.props.size[0]!==nextProps.size[0]||this.props.size[1]!==nextProps.size[1]||!this.state.dataVersion&&orFrameChangeProps.find(function(d){return _this.props[d]!==nextProps[d]})){this.calculateOrdinalFrame(nextProps)}};OrdinalFrame.prototype.mappedMiddles=function(oScale,middleMax,padding){var oScaleDomainValues=oScale.domain();var mappedMiddles={};oScaleDomainValues.forEach(function(p,q){var base=oScale(p)-padding;var next=oScaleDomainValues[q+1]?oScale(oScaleDomainValues[q+1]):middleMax;var diff=(next-base)/2;mappedMiddles[p]=base+diff});return mappedMiddles};OrdinalFrame.prototype.render=function(){var _a=this.props,className=_a.className,annotationSettings=_a.annotationSettings,downloadFields=_a.downloadFields,rAccessor=_a.rAccessor,oAccessor=_a.oAccessor,name=_a.name,download=_a.download,annotations=_a.annotations,matte=_a.matte,renderKey=_a.renderKey,interaction=_a.interaction,customClickBehavior=_a.customClickBehavior,customHoverBehavior=_a.customHoverBehavior,customDoubleClickBehavior=_a.customDoubleClickBehavior,projection=_a.projection,backgroundGraphics=_a.backgroundGraphics,foregroundGraphics=_a.foregroundGraphics,afterElements=_a.afterElements,beforeElements=_a.beforeElements,disableContext=_a.disableContext,summaryType=_a.summaryType,summaryHoverAnnotation=_a.summaryHoverAnnotation,pieceHoverAnnotation=_a.pieceHoverAnnotation,hoverAnnotation=_a.hoverAnnotation,canvasPostProcess=_a.canvasPostProcess,baseMarkProps=_a.baseMarkProps,useSpans=_a.useSpans,canvasPieces=_a.canvasPieces,canvasSummaries=_a.canvasSummaries,canvasConnectors=_a.canvasConnectors,renderOrder=_a.renderOrder,additionalDefs=_a.additionalDefs;var _b=this.state,orFrameRender=_b.orFrameRender,projectedColumns=_b.projectedColumns,adjustedPosition=_b.adjustedPosition,adjustedSize=_b.adjustedSize,legendSettings=_b.legendSettings,columnOverlays=_b.columnOverlays,axesTickLines=_b.axesTickLines,axes=_b.axes,margin=_b.margin,pieceDataXY=_b.pieceDataXY,oLabels=_b.oLabels,title=_b.title;var downloadButton;var size=[adjustedSize[0]+margin.left+margin.right,adjustedSize[1]+margin.top+margin.bottom];if(download){downloadButton=React.createElement(DownloadButton,{csvName:(name||"orframe")+"-"+(new Date).toJSON(),width:size[0],data:orDownloadMapping({data:projectedColumns,rAccessor:stringToArrayFn(rAccessor),oAccessor:stringToArrayFn(oAccessor),fields:downloadFields})})}var interactionOverflow;if(summaryType&&summaryType.amplitude){if(projection==="horizontal"){interactionOverflow={top:summaryType.amplitude,bottom:0,left:0,right:0}}else if(projection==="radial"){interactionOverflow=defaultOverflow}else{interactionOverflow={top:0,bottom:0,left:summaryType.amplitude,right:0}}}var renderedForegroundGraphics=typeof foregroundGraphics==="function"?foregroundGraphics({size:size,margin:margin}):foregroundGraphics;return React.createElement(Frame,{name:"ordinalframe",renderPipeline:orFrameRender,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,size:size,xScale:xScale,yScale:yScale,axes:axes,useSpans:useSpans,axesTickLines:axesTickLines,title:title,matte:matte,additionalDefs:additionalDefs,className:className+" "+projection,frameKey:"none",renderFn:renderKey,projectedCoordinateNames:projectedCoordinatesObject,defaultSVGRule:this.defaultORSVGRule.bind(this),defaultHTMLRule:this.defaultORHTMLRule.bind(this),hoverAnnotation:summaryHoverAnnotation||pieceHoverAnnotation||hoverAnnotation,annotations:annotations,annotationSettings:annotationSettings,legendSettings:legendSettings,interaction:interaction&&__assign({},interaction,{brush:interaction.columnsBrush!==true&&"oBrush",projection:projection,projectedColumns:projectedColumns}),customClickBehavior:customClickBehavior,customHoverBehavior:customHoverBehavior,customDoubleClickBehavior:customDoubleClickBehavior,points:pieceDataXY,margin:margin,columns:projectedColumns,backgroundGraphics:backgroundGraphics,foregroundGraphics:[renderedForegroundGraphics,oLabels],beforeElements:beforeElements,afterElements:afterElements,downloadButton:downloadButton,overlay:columnOverlays,rScale:this.state.rScale,projection:projection,disableContext:disableContext,interactionOverflow:interactionOverflow,canvasPostProcess:canvasPostProcess,baseMarkProps:baseMarkProps,canvasRendering:!!(canvasPieces||canvasSummaries||canvasConnectors),renderOrder:renderOrder,disableCanvasInteraction:true})};OrdinalFrame.defaultProps={annotations:[],foregroundGraphics:[],annotationSettings:{},projection:"vertical",size:[500,500],className:"",data:[],oScaleType:band,rScaleType:linear$1,type:"none",summaryType:"none",useSpans:false};OrdinalFrame.displayName="OrdinalFrame";return OrdinalFrame}(React.Component);var MiniMap=function(props){var brushStart=props.brushStart,brush=props.brush,brushEnd=props.brushEnd,xBrushable=props.xBrushable,yBrushable=props.yBrushable,yBrushExtent=props.yBrushExtent,xBrushExtent=props.xBrushExtent,rest=__rest(props,["brushStart","brush","brushEnd","xBrushable","yBrushable","yBrushExtent","xBrushExtent"]);var interactivity={start:brushStart,during:brush,end:brushEnd};if(xBrushable&&yBrushable){interactivity.brush="xyBrush";if(xBrushExtent||yBrushExtent){interactivity.extent=[[0,0],__spread(props.size)]}if(xBrushExtent){interactivity.extent[0]=xBrushExtent}if(yBrushExtent){interactivity.extent[1]=yBrushExtent}}else if(xBrushable){interactivity.brush="xBrush";if(xBrushExtent){interactivity.extent=xBrushExtent}}else if(yBrushable){interactivity.brush="yBrush";if(yBrushExtent){interactivity.extent=yBrushExtent}}return React.createElement(XYFrame,__assign({},rest,{interaction:interactivity}))};var MinimapXYFrame=function(_super){__extends(MinimapXYFrame,_super);function MinimapXYFrame(props){var _this=_super.call(this,props)||this;_this.generateMinimap=_this.generateMinimap.bind(_this);return _this}MinimapXYFrame.prototype.generateMinimap=function(){var _a=this.props,xAccessor=_a.xAccessor,yAccessor=_a.yAccessor,points=_a.points,lines=_a.lines,minimap=_a.minimap,areas=_a.areas,_b=_a.summaries,summaries=_b===void 0?"areas"in minimap?minimap.areas:areas:_b,size=_a.size,lineDataAccessor=_a.lineDataAccessor,lineType=_a.lineType,lineStyle=_a.lineStyle,summaryStyle=_a.summaryStyle,pointStyle=_a.pointStyle,lineClass=_a.lineClass,summaryClass=_a.summaryClass,pointClass=_a.pointClass,lineRenderMode=_a.lineRenderMode,pointRenderMode=_a.pointRenderMode,summaryRenderMode=_a.summaryRenderMode,canvasLines=_a.canvasLines,canvasPoints=_a.canvasPoints,canvasSummaries=_a.canvasSummaries,axes=_a.axes,margin=_a.margin,useSpans=_a.useSpans,name=_a.name,annotations=_a.annotations,areaType=_a.areaType,summaryType=_a.summaryType;var miniDefaults={position:[0,0],size:[size[0],size[1]*.25],xAccessor:xAccessor,yAccessor:yAccessor,points:points,lines:lines,summaries:summaries,lineDataAccessor:lineDataAccessor,xBrushable:true,yBrushable:true,brushStart:function(){},brush:function(){},brushEnd:function(){},lineType:lineType,lineStyle:lineStyle,summaryStyle:summaryStyle,pointStyle:pointStyle,lineClass:lineClass,summaryClass:summaryClass,pointClass:pointClass,lineRenderMode:lineRenderMode,pointRenderMode:pointRenderMode,summaryRenderMode:summaryRenderMode,canvasLines:canvasLines,canvasPoints:canvasPoints,canvasSummaries:canvasSummaries,axes:axes,margin:margin,useSpans:useSpans,name:name,annotations:annotations,areaType:areaType,summaryType:summaryType};var combinedOptions=__assign({},miniDefaults,minimap,{hoverAnnotation:false});return React.createElement(MiniMap,__assign({},combinedOptions))};MinimapXYFrame.prototype.render=function(){var miniMap=this.generateMinimap();var options={};var _a=this.props,minimap=_a.minimap,renderBefore=_a.renderBefore,rest=__rest(_a,["minimap","renderBefore"]);if(renderBefore){options.beforeElements=miniMap}else{options.afterElements=miniMap}return React.createElement(XYFrame,__assign({},rest,options))};MinimapXYFrame.displayName="MinimapXYFrame";return MinimapXYFrame}(React.Component);function bboxCollide(bbox){function x(d){return d.x+d.vx}function y(d){return d.y+d.vy}function constant(x){return function(){return x}}var nodes,boundingBoxes,strength=1,iterations=1;if(typeof bbox!=="function"){bbox=constant(bbox===null?[[0,0][1]]:bbox)}function force(){var i,tree,node,xi,yi,bbi,nx1,ny1,nx2,ny2;var cornerNodes=[];nodes.forEach(function(d,i){cornerNodes.push({node:d,vx:d.vx,vy:d.vy,x:d.x+(boundingBoxes[i][1][0]+boundingBoxes[i][0][0])/2,y:d.y+(boundingBoxes[i][0][1]+boundingBoxes[i][1][1])/2});cornerNodes.push({node:d,vx:d.vx,vy:d.vy,x:d.x+boundingBoxes[i][0][0],y:d.y+boundingBoxes[i][0][1]});cornerNodes.push({node:d,vx:d.vx,vy:d.vy,x:d.x+boundingBoxes[i][0][0],y:d.y+boundingBoxes[i][1][1]});cornerNodes.push({node:d,vx:d.vx,vy:d.vy,x:d.x+boundingBoxes[i][1][0],y:d.y+boundingBoxes[i][0][1]});cornerNodes.push({node:d,vx:d.vx,vy:d.vy,x:d.x+boundingBoxes[i][1][0],y:d.y+boundingBoxes[i][1][1]})});var cn=cornerNodes.length;for(var k=0;k<iterations;++k){tree=quadtree(cornerNodes,x,y).visitAfter(prepareCorners);for(i=0;i<cn;++i){var nodeI=~~(i/5);node=nodes[nodeI];bbi=boundingBoxes[nodeI];xi=node.x+node.vx;yi=node.y+node.vy;nx1=xi+bbi[0][0];ny1=yi+bbi[0][1];nx2=xi+bbi[1][0];ny2=yi+bbi[1][1];tree.visit(apply)}}function apply(quad,x0,y0,x1,y1){var data=quad.data;if(data){var bWidth=bbLength(bbi,0),bHeight=bbLength(bbi,1);if(data.node.index!==nodeI){var dataNode=data.node;var bbj=boundingBoxes[dataNode.index],dnx1=dataNode.x+dataNode.vx+bbj[0][0],dny1=dataNode.y+dataNode.vy+bbj[0][1],dnx2=dataNode.x+dataNode.vx+bbj[1][0],dny2=dataNode.y+dataNode.vy+bbj[1][1],dWidth=bbLength(bbj,0),dHeight=bbLength(bbj,1);if(nx1<=dnx2&&dnx1<=nx2&&ny1<=dny2&&dny1<=ny2){var xSize=[Math.min.apply(null,[dnx1,dnx2,nx1,nx2]),Math.max.apply(null,[dnx1,dnx2,nx1,nx2])];var ySize=[Math.min.apply(null,[dny1,dny2,ny1,ny2]),Math.max.apply(null,[dny1,dny2,ny1,ny2])];var xOverlap=bWidth+dWidth-(xSize[1]-xSize[0]);var yOverlap=bHeight+dHeight-(ySize[1]-ySize[0]);var xBPush=xOverlap*strength*(yOverlap/bHeight);var yBPush=yOverlap*strength*(xOverlap/bWidth);var xDPush=xOverlap*strength*(yOverlap/dHeight);var yDPush=yOverlap*strength*(xOverlap/dWidth);if((nx1+nx2)/2<(dnx1+dnx2)/2){node.vx-=xBPush;dataNode.vx+=xDPush}else{node.vx+=xBPush;dataNode.vx-=xDPush}if((ny1+ny2)/2<(dny1+dny2)/2){node.vy-=yBPush;dataNode.vy+=yDPush}else{node.vy+=yBPush;dataNode.vy-=yDPush}}}return}return x0>nx2||x1<nx1||y0>ny2||y1<ny1}}function prepareCorners(quad){if(quad.data){return quad.bb=boundingBoxes[quad.data.node.index]}quad.bb=[[0,0],[0,0]];for(var i=0;i<4;++i){if(quad[i]&&quad[i].bb[0][0]<quad.bb[0][0]){quad.bb[0][0]=quad[i].bb[0][0]}if(quad[i]&&quad[i].bb[0][1]<quad.bb[0][1]){quad.bb[0][1]=quad[i].bb[0][1]}if(quad[i]&&quad[i].bb[1][0]>quad.bb[1][0]){quad.bb[1][0]=quad[i].bb[1][0]}if(quad[i]&&quad[i].bb[1][1]>quad.bb[1][1]){quad.bb[1][1]=quad[i].bb[1][1]}}}function bbLength(bbox,heightWidth){return bbox[1][heightWidth]-bbox[0][heightWidth]}force.initialize=function(_){var i,n=(nodes=_).length;boundingBoxes=new Array(n);for(i=0;i<n;++i){boundingBoxes[i]=bbox(nodes[i],i,nodes)}};force.iterations=function(_){return arguments.length?(iterations=+_,force):iterations};force.strength=function(_){return arguments.length?(strength=+_,force):strength};force.bbox=function(_){return arguments.length?(bbox=typeof _==="function"?_:constant(+_),force):bbox};return force}function arrowHead(d,nodeTargetSize,bodySize,headSize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var headDistance=headSize*3;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var x1=d.source.x+headSize*Math.cos(angle1);var y1=d.source.y-headSize*Math.sin(angle1);var x2=d.source.x+headSize*Math.cos(angle2);var y2=d.source.y-headSize*Math.sin(angle2);var x3=d.target.x-headSize*Math.cos(angle1);var y3=d.target.y+headSize*Math.sin(angle1);var x4=d.target.x-headSize*Math.cos(angle2);var y4=d.target.y+headSize*Math.sin(angle2);var mx1=d.source.x+bodySize*Math.cos(angle1);var my1=d.source.y-bodySize*Math.sin(angle1);var mx2=d.source.x+bodySize*Math.cos(angle2);var my2=d.source.y-bodySize*Math.sin(angle2);var mx3=d.target.x+bodySize*Math.cos(angle1);var my3=d.target.y-bodySize*Math.sin(angle1);var mx4=d.target.x+bodySize*Math.cos(angle2);var my4=d.target.y-bodySize*Math.sin(angle2);var dY=d.source.y-d.target.y;var dX=d.source.x-d.target.x;var midDiffY1=my1-my3;var midDiffX1=mx1-mx3;var midDiffY2=my2-my4;var midDiffX2=mx2-mx4;var diffY1=y1-y3;var diffX1=x1-x3;var diffY2=y2-y4;var diffX2=x2-x4;var pythag=Math.sqrt(midDiffX1*midDiffX1+midDiffY1*midDiffY1);var pythag2=Math.sqrt(dX*dX+dY*dY);var adjX1=mx2-midDiffX1*(pythag-headDistance-nodeTargetSize)/pythag;var adjY1=my2-midDiffY1*(pythag-headDistance-nodeTargetSize)/pythag;var adjX2=mx1-midDiffX2*(pythag-headDistance-nodeTargetSize)/pythag;var adjY2=my1-midDiffY2*(pythag-headDistance-nodeTargetSize)/pythag;var headX2=x1-diffX2*(pythag-headDistance-nodeTargetSize)/pythag;var headY2=y1-diffY2*(pythag-headDistance-nodeTargetSize)/pythag;var headX1=x2-diffX1*(pythag-headDistance-nodeTargetSize)/pythag;var headY1=y2-diffY1*(pythag-headDistance-nodeTargetSize)/pythag;var tipX=d.source.x-dX*(pythag2-nodeTargetSize)/pythag2;var tipY=d.source.y-dY*(pythag2-nodeTargetSize)/pythag2;return"M"+mx2+","+my2+"L"+adjX1+","+adjY1+"L"+headX1+","+headY1+"L"+tipX+","+tipY+"L"+headX2+","+headY2+"L"+adjX2+","+adjY2+"L"+mx1+","+my1+"z"}function comet(d,nodeSize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var x1=d.target.x+nodeSize*Math.cos(angle1);var y1=d.target.y-nodeSize*Math.sin(angle1);var x2=d.target.x+nodeSize*Math.cos(angle2);var y2=d.target.y-nodeSize*Math.sin(angle2);return"M"+x1+","+y1+"L"+x2+","+y2+" L "+d.source.x+","+d.source.y+"z"}function nail(d,nodeSize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var x1=d.source.x+nodeSize*Math.cos(angle1);var y1=d.source.y-nodeSize*Math.sin(angle1);var x2=d.source.x+nodeSize*Math.cos(angle2);var y2=d.source.y-nodeSize*Math.sin(angle2);return"M"+x1+","+y1+"L"+x2+","+y2+" L "+d.target.x+","+d.target.y+"z"}function taffy(d,nodeSourceSize,nodeTargetSize,midpointSize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var x1=d.source.x+nodeSourceSize*Math.cos(angle1);var y1=d.source.y-nodeSourceSize*Math.sin(angle1);var x2=d.source.x+nodeSourceSize*Math.cos(angle2);var y2=d.source.y-nodeSourceSize*Math.sin(angle2);var x3=d.target.x+nodeTargetSize*Math.cos(angle2);var y3=d.target.y-nodeTargetSize*Math.sin(angle2);var x4=d.target.x+nodeTargetSize*Math.cos(angle1);var y4=d.target.y-nodeTargetSize*Math.sin(angle1);var mx1=d.source.x+midpointSize*Math.cos(angle1);var my1=d.source.y-midpointSize*Math.sin(angle1);var mx2=d.source.x+midpointSize*Math.cos(angle2);var my2=d.source.y-midpointSize*Math.sin(angle2);var mx3=d.target.x+midpointSize*Math.cos(angle1);var my3=d.target.y-midpointSize*Math.sin(angle1);var mx4=d.target.x+midpointSize*Math.cos(angle2);var my4=d.target.y-midpointSize*Math.sin(angle2);var midY2=(my1+my3)/2;var midX2=(mx1+mx3)/2;var midY1=(my2+my4)/2;var midX1=(mx2+mx4)/2;return"M"+x1+","+y1+"L"+x2+","+y2+" L "+midX1+","+midY1+" L "+x3+","+y3+" L "+x4+","+y4+" L "+midX2+","+midY2+"z"}function ribbon(d,bodySize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var mx1=d.source.x+bodySize*Math.cos(angle1);var my1=d.source.y-bodySize*Math.sin(angle1);var mx2=d.source.x+bodySize*Math.cos(angle2);var my2=d.source.y-bodySize*Math.sin(angle2);var mx3=d.target.x-bodySize*Math.cos(angle1);var my3=d.target.y+bodySize*Math.sin(angle1);var mx4=d.target.x-bodySize*Math.cos(angle2);var my4=d.target.y+bodySize*Math.sin(angle2);return"M"+mx1+","+my1+"L"+mx2+","+my2+"L"+mx3+","+my3+"L"+mx4+","+my4+"z"}function lineArc(d){var dx=d.target.x-d.source.x,dy=d.target.y-d.source.y,dr=Math.sqrt(dx*dx+dy*dy);return"M"+d.source.x+","+d.source.y+"A"+dr+","+dr+" 0 0,1 "+d.target.x+","+d.target.y}function halfArrow(d,nodeTargetSize,bodySize,headSize){var diffX=d.target.y-d.source.y;var diffY=d.target.x-d.source.x;var headDistance=headSize*3;var angle0=Math.atan2(diffY,diffX)+Math.PI/2;var angle1=angle0-Math.PI/2;var angle2=angle0+Math.PI/2;var x1=d.source.x+headSize*Math.cos(angle1);var y1=d.source.y-headSize*Math.sin(angle1);var x2=d.source.x+headSize*Math.cos(angle2);var y2=d.source.y-headSize*Math.sin(angle2);var x3=d.target.x-headSize*Math.cos(angle1);var y3=d.target.y+headSize*Math.sin(angle1);var mx1=d.source.x+bodySize*Math.cos(angle1);var my1=d.source.y-bodySize*Math.sin(angle1);var mx2=d.source.x+bodySize*Math.cos(angle2);var my2=d.source.y-bodySize*Math.sin(angle2);var mx3=d.target.x+bodySize*Math.cos(angle1);var my3=d.target.y-bodySize*Math.sin(angle1);var dY=d.source.y-d.target.y;var dX=d.source.x-d.target.x;var midDiffY1=my1-my3;var midDiffX1=mx1-mx3;var diffY1=y1-y3;var diffX1=x1-x3;var pythag=Math.sqrt(midDiffX1*midDiffX1+midDiffY1*midDiffY1);var pythag2=Math.sqrt(dX*dX+dY*dY);var adjX1=mx2-midDiffX1*(pythag-headDistance-nodeTargetSize)/pythag;var adjY1=my2-midDiffY1*(pythag-headDistance-nodeTargetSize)/pythag;var headX1=x2-diffX1*(pythag-headDistance-nodeTargetSize)/pythag;var headY1=y2-diffY1*(pythag-headDistance-nodeTargetSize)/pythag;var tipX=d.source.x-dX*(pythag2-nodeTargetSize)/pythag2;var tipY=d.source.y-dY*(pythag2-nodeTargetSize)/pythag2;return"M"+d.source.x+","+d.source.y+"L"+mx2+","+my2+"L"+adjX1+","+adjY1+"L"+headX1+","+headY1+"L"+tipX+","+tipY+"L"+d.source.x+","+d.source.y+"z"}var d={arrowHead:arrowHead,comet:comet,nail:nail,taffy:taffy,ribbon:ribbon,lineArc:lineArc,halfArrow:halfArrow};var horizontalDagreLineGenerator=line$1().curve(monotoneX$1).x(function(d){return d.x}).y(function(d){return d.y});var verticalDagreLineGenerator=line$1().curve(monotoneY$1).x(function(d){return d.x}).y(function(d){return d.y});function sankeyEdgeSort(a,b,direction){if(a.circular&&!b.circular)return-1;if(b.circular&&!a.circular)return 1;var first=direction==="down"?"y":"x";var second=direction==="down"?"x":"y";return a.source[first]===b.source[first]?a.sankeyWidth===b.sankeyWidth?a.source[second]-b.source[second]:b.sankeyWidth-a.sankeyWidth:a.source[first]-b.source[first]}var sigmoidLinks={horizontal:linkHorizontal().x(function(d){return d.x}).y(function(d){return d.y}),vertical:linkVertical().x(function(d){return d.x}).y(function(d){return d.y}),radial:d.lineArc};var customEdgeHashD={curve:function(d,projection){if(projection===void 0){projection="vertical"}return sigmoidLinks[projection](d)},linearc:function(d$1){return d.lineArc(d$1)},ribbon:function(d$1){return d.ribbon(d$1,d$1.width)},arrowhead:function(d$1){return d.arrowHead(d$1,d$1.target.nodeSize,d$1.width,d$1.width*1.5)},halfarrow:function(d$1){return d.halfArrow(d$1,d$1.target.nodeSize,d$1.width,d$1.width*1.5)},nail:function(d$1){return d.nail(d$1,d$1.source.nodeSize)},comet:function(d$1){return d.comet(d$1,d$1.target.nodeSize)},taffy:function(d$1){return d.taffy(d$1,d$1.source.nodeSize/2,d$1.target.nodeSize/2,(d$1.source.nodeSize+d$1.target.nodeSize)/4)}};var circleNodeGenerator=function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,transform=_a.transform,baseMarkProps=_a.baseMarkProps;return React.createElement(lib_2,__assign({},baseMarkProps,{key:key,transform:transform,markType:"rect",width:d.nodeSize*2,height:d.nodeSize*2,ry:d.nodeSize*2,rx:d.nodeSize*2,x:-d.nodeSize,y:-d.nodeSize,style:styleFn(d,i),renderMode:renderMode?renderMode(d,i):undefined,className:className,"aria-label":"Node "+d.id,tabIndex:-1}))};var matrixEdgeGenerator=function(size,nodes){return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;var gridSize=Math.min.apply(Math,__spread(size))/nodes.length;return React.createElement("g",{key:key},React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,simpleInterpolate:true,transform:"translate("+d.source.y+","+d.target.y+")",markType:"rect",x:-gridSize/2,y:-gridSize/2,width:gridSize,height:gridSize,style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1})),React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key+"-mirror",className:className,simpleInterpolate:true,transform:"translate("+d.target.y+","+d.source.y+")",markType:"rect",x:-gridSize/2,y:-gridSize/2,width:gridSize,height:gridSize,style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1})))}};var arcEdgeGenerator=function(size){var yAdjust=size[1]/size[0];function arcDiagramArc(d){var draw=line$1().curve(curveBasis);var midX=(d.source.x+d.target.x)/2;var midY=d.source.x-d.target.x;return draw([[d.source.x,0],[midX,midY*yAdjust],[d.target.x,0]])}return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,simpleInterpolate:true,markType:"path",transform:"translate(0,"+size[1]/2+")",d:arcDiagramArc(d),style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1}))}};var chordEdgeGenerator=function(size){return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,simpleInterpolate:true,transform:"translate("+size[0]/2+","+size[1]/2+")",markType:"path",d:d.d,style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1}))}};var dagreEdgeGenerator=function(direction){var dagreLineGenerator=direction==="LR"||direction==="RL"?horizontalDagreLineGenerator:verticalDagreLineGenerator;return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;if(d.ribbon||d.parallelEdges){var ribbonGenerator=linearRibbon();ribbonGenerator.x(function(p){return p.x});ribbonGenerator.y(function(p){return p.y});ribbonGenerator.r(function(){return d.weight||1});if(d.parallelEdges){var sortedParallelEdges_1=d.parallelEdges.sort(function(a,b){return b.weight-a.weight});return React.createElement("g",{key:""+key},ribbonGenerator({points:d.points,multiple:d.parallelEdges}).map(function(ribbonD,ribbonI){return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key+"-"+ribbonI,className:className,simpleInterpolate:true,markType:"path",d:ribbonD,style:styleFn(sortedParallelEdges_1[ribbonI],i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1}))}))}return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,simpleInterpolate:true,markType:"path",d:ribbonGenerator(d.points),style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1}))}return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,simpleInterpolate:true,markType:"path",d:dagreLineGenerator(d.points),style:styleFn(d,i),"aria-label":"Connection from "+d.source.id+" to "+d.target.id,tabIndex:-1}))}};var wordcloudNodeGenerator=function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,key=_a.key,className=_a.className,transform=_a.transform;var textStyle=styleFn(d,i);textStyle.fontSize=d.fontSize+"px";textStyle.fontWeight=d.fontWeight;textStyle.textAnchor="middle";var textTransform,textY,textX;textTransform="scale("+d.scale+")";if(!d.rotate){textY=d.textHeight/4;textTransform="scale("+d.scale+")"}else{textTransform="rotate(90) scale("+d.scale+")";textY=d.textHeight/4}return React.createElement("g",{key:key,transform:transform},React.createElement("text",{style:textStyle,y:textY,x:textX,transform:textTransform,className:className+" wordcloud","aria-label":d._NWFText,role:"img",tabIndex:-1},d._NWFText))};var sankeyNodeGenerator=function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,transform=_a.transform,baseMarkProps=_a.baseMarkProps;var height=d.direction!=="down"?d.height:d.width;var width=d.direction!=="down"?d.width:d.height;return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,transform:transform,markType:"rect",height:height,width:width,x:-width/2,y:-height/2,rx:0,ry:0,style:styleFn(d),"aria-label":"Node "+d.id,tabIndex:-1}))};var chordNodeGenerator=function(size){return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;return React.createElement(lib_2,__assign({},baseMarkProps,{renderMode:renderMode?renderMode(d,i):undefined,key:key,className:className,transform:"translate("+size[0]/2+","+size[1]/2+")",markType:"path",d:d.d,style:styleFn(d,i),"aria-label":"Node "+d.id,tabIndex:-1}))}};var matrixNodeGenerator=function(size,nodes){var gridSize=Math.min.apply(Math,__spread(size));var stepSize=gridSize/(nodes.length+1);return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;var showText=stepSize>6;var showLine=stepSize>3;var showRect=stepSize>.5;var textProps={textAnchor:"end",fontSize:stepSize/2+"px"};var style=styleFn(d,i);var renderModeValue=renderMode?renderMode(d,i):undefined;return React.createElement("g",{key:key,className:className},showRect&&React.createElement(lib_2,{markType:"rect",x:stepSize/2,y:d.y-stepSize/2,width:gridSize-stepSize,height:stepSize,style:__assign({},style,{stroke:"none"}),renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showRect&&React.createElement(lib_2,{markType:"rect",y:stepSize/2,x:d.y-stepSize/2,height:gridSize-stepSize,width:stepSize,style:__assign({},style,{stroke:"none"}),renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showLine&&React.createElement(lib_2,{markType:"line",stroke:"black",x1:0,x2:gridSize-stepSize/2,y1:d.y-stepSize/2,y2:d.y-stepSize/2,style:style,renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showLine&&React.createElement(lib_2,{markType:"line",stroke:"black",y1:0,y2:gridSize-stepSize/2,x1:d.y-stepSize/2,x2:d.y-stepSize/2,style:style,renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showLine&&i===nodes.length-1&&React.createElement(lib_2,{markType:"line",stroke:"black",x1:0,x2:gridSize-stepSize/2,y1:d.y+stepSize/2,y2:d.y+stepSize/2,style:style,renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showLine&&i===nodes.length-1&&React.createElement(lib_2,{markType:"line",stroke:"black",y1:0,y2:gridSize-stepSize/2,x1:d.y+stepSize/2,x2:d.y+stepSize/2,style:style,renderMode:renderModeValue,forceUpdate:true,baseMarkProps:baseMarkProps}),showText&&React.createElement("text",__assign({x:0,y:d.y+stepSize/5},textProps),d.id),showText&&React.createElement("text",__assign({transform:"translate("+d.y+") rotate(90) translate(0,"+stepSize/5+")"},textProps,{y:0}),d.id))}};var radialRectNodeGenerator=function(size,center,type){var radialArc=arc$1();var _a=type.angleRange,angleRange=_a===void 0?[0,360]:_a;var rangePct=angleRange.map(function(d){return d/360});var rangeMod=rangePct[1]-rangePct[0];var adjustedPct=rangeMod<1?linear$1().domain([0,1]).range(rangePct):function(d){return d};return function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;radialArc.innerRadius(d.y0/2).outerRadius(d.y1/2);return React.createElement(lib_2,__assign({},baseMarkProps,{key:key,transform:"translate("+center+")",markType:"path",d:radialArc({startAngle:adjustedPct(d.x0/size[0])*Math.PI*2,endAngle:adjustedPct(d.x1/size[0])*Math.PI*2}),customTween:{fn:arcTweener,props:{startAngle:adjustedPct(d.x0/size[0])*Math.PI*2,endAngle:adjustedPct(d.x1/size[0])*Math.PI*2,innerRadius:d.y0/2,outerRadius:d.y1/2}},style:styleFn(d,i),renderMode:renderMode?renderMode(d,i):undefined,className:className,"aria-label":"Node "+d.id,tabIndex:-1}))}};var radialLabelGenerator=function(node,nodei,nodeIDAccessor,size){var anglePct=(node.x1+node.x0)/2/size[0];var nodeLabel=nodeIDAccessor(node,nodei);var labelRotate=anglePct>.5?anglePct*360+90:anglePct*360-90;return React.createElement("g",{transform:"rotate("+labelRotate+")"},typeof nodeLabel==="string"?React.createElement("text",{textAnchor:"middle",y:5},nodeLabel):nodeLabel)};var hierarchicalRectNodeGenerator=function(_a){var d=_a.d,i=_a.i,styleFn=_a.styleFn,renderMode=_a.renderMode,key=_a.key,className=_a.className,baseMarkProps=_a.baseMarkProps;return React.createElement(lib_2,__assign({},baseMarkProps,{key:key,transform:"translate(0,0)",markType:"rect",width:d.x1-d.x0,height:d.y1-d.y0,x:d.x0,y:d.y0,rx:0,ry:0,style:styleFn(d,i),renderMode:renderMode?renderMode(d,i):undefined,className:className,"aria-label":"Node "+d.id,tabIndex:-1}))};var genericLineGenerator=function(d){return"M"+d.source.x+","+d.source.y+"L"+d.target.x+","+d.target.y};var drawNodes=function(_a){var data=_a.data,renderKeyFn=_a.renderKeyFn,customMark=_a.customMark,styleFn=_a.styleFn,classFn=_a.classFn,renderMode=_a.renderMode,canvasDrawing=_a.canvasDrawing,canvasRenderFn=_a.canvasRenderFn,baseMarkProps=_a.baseMarkProps;var markGenerator=customMark;var renderedData=[];if(customMark&&canvasRenderFn){console.error("canvas rendering currently only supports generic circle nodes based on nodeSize")}data.forEach(function(d,i){if(canvasRenderFn&&canvasRenderFn(d,i)===true){var canvasNode={baseClass:"frame-piece",tx:d.x,ty:d.y,d:d,i:i,markProps:{markType:"circle",r:d.nodeSize},styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasNode)}else{renderedData.push(markGenerator({d:d,i:i,renderKeyFn:renderKeyFn,styleFn:styleFn,classFn:classFn,renderMode:renderMode,key:renderKeyFn?renderKeyFn(d,i):d.id||"node-"+i,className:"node "+classFn(d,i),transform:"translate("+d.x+","+d.y+")",baseMarkProps:baseMarkProps}))}});return renderedData};var drawEdges=function(_a){var baseData=_a.data,renderKeyFn=_a.renderKeyFn,customMark=_a.customMark,styleFn=_a.styleFn,classFn=_a.classFn,renderMode=_a.renderMode,canvasRenderFn=_a.canvasRenderFn,canvasDrawing=_a.canvasDrawing,type=_a.type,baseMarkProps=_a.baseMarkProps,networkType=_a.networkType,direction=_a.direction,projection=_a.projection;var data=networkType==="sankey"?baseData.sort(function(a,b){return sankeyEdgeSort(a,b,direction)}):baseData;var dGenerator=genericLineGenerator;var renderedData=[];if(customMark){data.forEach(function(d,i){var renderedCustomMark=customMark({d:d,i:i,renderKeyFn:renderKeyFn,styleFn:styleFn,classFn:classFn,renderMode:renderMode,key:renderKeyFn?renderKeyFn(d,i):"edge-"+i,className:classFn(d,i)+" edge",transform:"translate("+d.x+","+d.y+")",baseMarkProps:baseMarkProps});if(renderedCustomMark&&renderedCustomMark.props&&(renderedCustomMark.props.markType!=="path"||renderedCustomMark.props.d)){renderedData.push(renderedCustomMark)}})}else{if(type){if(typeof type==="function"){dGenerator=type}else if(customEdgeHashD[type]){dGenerator=function(d){return customEdgeHashD[type](d,projection)}}}data.forEach(function(d,i){var renderedD=dGenerator(d);if(renderedD&&canvasRenderFn&&canvasRenderFn(d,i)===true){var canvasEdge={baseClass:"frame-piece",tx:d.x,ty:d.y,d:d,i:i,markProps:{markType:"path",d:renderedD},styleFn:styleFn,renderFn:renderMode,classFn:classFn};canvasDrawing.push(canvasEdge)}else if(renderedD){renderedData.push(React.createElement(lib_2,__assign({},baseMarkProps,{key:renderKeyFn?renderKeyFn(d,i):"edge-"+i,markType:"path",renderMode:renderMode?renderMode(d,i):undefined,className:classFn(d)+" edge",d:renderedD,style:styleFn(d,i),tabIndex:-1,role:"img","aria-label":"connection from "+d.source.id+" to "+d.target.id})))}})}return renderedData};function topologicalSort(nodesArray,edgesArray){var nodes=[];var nodeHash={};edgesArray.forEach(function(edge){if(!edge.source.id||!edge.target.id){return false}if(!nodeHash[edge.source.id]){nodeHash[edge.source.id]={_id:edge.source.id,links:[]};nodes.push(nodeHash[edge.source.id])}if(!nodeHash[edge.target.id]){nodeHash[edge.target.id]={_id:edge.target.id,links:[]};nodes.push(nodeHash[edge.target.id])}nodeHash[edge.source.id].links.push(edge.target.id)});function hasIncomingEdge(list,node){for(var i=0,l=list.length;i<l;++i){if(list[i].links.indexOf(node._id)!==-1){return true}}return false}var L=[],S=nodes.filter(function(node){return!hasIncomingEdge(nodes,node)});var n=null;while(S.length){n=S.pop();L.push(n);var i=n.links.length;while(i--){var m=nodes[nodes.map(function(d){return d._id}).indexOf(n.links[i])];n.links.pop();if(!hasIncomingEdge(nodes,m)){S.push(m)}}}var nodeWithEdge=nodes.find(function(node){return node.links.length!==0});return nodeWithEdge?null:L}var curvature=.5;var ribbonLink=function(d){var diff=d.direction==="down"?Math.abs(d.target.y-d.source.y):Math.abs(d.source.x-d.target.x);var testCoordinates=d.direction==="down"?[{x:d.y0,y:d.source.y},{x:d.y0,y:d.source.y+diff/3},{x:d.y1,y:d.target.y-diff/3},{x:d.y1,y:d.target.y}]:[{x:d.source.x0,y:d.y0},{x:d.source.x0+diff/3,y:d.y0},{x:d.target.x0-diff/3,y:d.y1},{x:d.target.x0,y:d.y1}];var linkGenerator=linearRibbon();linkGenerator.x(function(d){return d.x});linkGenerator.y(function(d){return d.y});linkGenerator.r(function(){return d.sankeyWidth/2});return linkGenerator(testCoordinates)};var areaLink=function(d){var x0,x1,x2,x3,y0,y1,xi,y2,y3;if(d.direction==="down"){x0=d.y0-d.sankeyWidth/2;x1=d.y1-d.sankeyWidth/2;x2=d.y1+d.sankeyWidth/2;x3=d.y0+d.sankeyWidth/2;y0=d.source.y1;y1=d.target.y0;xi=interpolateNumber(y0,y1);y2=xi(curvature);y3=xi(1-curvature);return"M"+x0+","+y0+"C"+x0+","+y2+" "+x1+","+y3+" "+x1+","+y1+"L"+x2+","+y1+"C"+x2+","+y3+" "+x3+","+y2+" "+x3+","+y0+"Z"}x0=d.source.x1,x1=d.target.x0,xi=interpolateNumber(x0,x1),x2=xi(curvature),x3=xi(1-curvature),y0=d.y0-d.sankeyWidth/2,y1=d.y1-d.sankeyWidth/2,y2=d.y1+d.sankeyWidth/2,y3=d.y0+d.sankeyWidth/2;return"M"+x0+","+y0+"C"+x2+","+y0+" "+x3+","+y1+" "+x1+","+y1+"L"+x1+","+y2+"C"+x3+","+y2+" "+x2+","+y3+" "+x0+","+y3+"Z"};function circularAreaLink(link){var linkGenerator=linearRibbon();linkGenerator.x(function(d){return d.x});linkGenerator.y(function(d){return d.y});linkGenerator.r(function(){return link.sankeyWidth/2});var xyForLink=link.direction==="down"?[{x:link.circularPathData.sourceY,y:link.circularPathData.sourceX},{x:link.circularPathData.sourceY,y:link.circularPathData.leftFullExtent},{x:link.circularPathData.verticalFullExtent,y:link.circularPathData.leftFullExtent},{x:link.circularPathData.verticalFullExtent,y:link.circularPathData.rightFullExtent},{x:link.circularPathData.targetY,y:link.circularPathData.rightFullExtent},{x:link.circularPathData.targetY,y:link.circularPathData.targetX}]:[{x:link.circularPathData.sourceX,y:link.circularPathData.sourceY},{x:link.circularPathData.leftFullExtent,y:link.circularPathData.sourceY},{x:link.circularPathData.leftFullExtent,y:link.circularPathData.verticalFullExtent},{x:link.circularPathData.rightFullExtent,y:link.circularPathData.verticalFullExtent},{x:link.circularPathData.rightFullExtent,y:link.circularPathData.targetY},{x:link.circularPathData.targetX,y:link.circularPathData.targetY}];return linkGenerator(xyForLink)}var hierarchyDecorator=function(hierarchy,hashEntries,nodeIDAccessor,nodes){if(hierarchy.children){hierarchy.children.forEach(function(child){var theseEntries=hashEntries.filter(function(entry){return entry[1]===child.id});theseEntries.forEach(function(entry){var idNode=nodes.find(function(node){return nodeIDAccessor(node)===entry[0]})||{};child.childHash[entry[0]]=__assign({id:entry[0],children:[],childHash:{}},idNode);child.children.push(child.childHash[entry[0]])});if(child.children.length>0){hierarchyDecorator(child,hashEntries,nodeIDAccessor,nodes)}})}};var softStack=function(edges,nodes,sourceAccessor,targetAccessor,nodeIDAccessor){var hierarchy={id:"root-generated",children:[],childHash:{}};var discoveredHierarchyHash={};var targetToSourceHash={};var hasLogicalRoot=true;var isHierarchical=true;for(var i=0;i<edges.length;i++){var edge=edges[i];var source=sourceAccessor(edge);var target=targetAccessor(edge);var sourceID=typeof source==="object"?nodeIDAccessor(source):source;var targetID=typeof target==="object"?nodeIDAccessor(target):target;targetToSourceHash[targetID]=sourceID;if(!discoveredHierarchyHash[sourceID]){discoveredHierarchyHash[sourceID]=targetID}else{isHierarchical=false;break}}if(isHierarchical){var hashEntries=Object.values(discoveredHierarchyHash);hashEntries.forEach(function(entry){var target=entry;if(!discoveredHierarchyHash[target]){discoveredHierarchyHash[target]="root-generated";var idNode=nodes.find(function(node){return nodeIDAccessor(node)===target})||{};hierarchy.childHash[target]=__assign({id:target,children:[],childHash:{}},idNode);hierarchy.children.push(hierarchy.childHash[target])}});hierarchyDecorator(hierarchy,hashEntries,nodeIDAccessor,nodes);nodes.forEach(function(node){var nodeID=nodeIDAccessor(node);if(!discoveredHierarchyHash[nodeID]&&!targetToSourceHash[nodeID]){hierarchy.children.push(__assign({id:nodeID,children:[],childHash:{}},node))}});if(hierarchy.children.length===1){hierarchy=hierarchy.children[0];hasLogicalRoot=false}return{hierarchy:hierarchy,isHierarchical:true,hasLogicalRoot:hasLogicalRoot}}return{hierarchy:{},isHierarchical:false,hasLogicalRoot:false}};var align=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.left=left;exports.right=right;exports.justify=justify;exports.center=center;function targetDepth(d){return d.target.depth}function left(node){return node.depth}function right(node,n){return n-1-node.height}function justify(node,n){return node.sourceLinks.length?node.depth:n-1}function center(node){return node.targetLinks.length?node.depth:node.sourceLinks.length?(0,src$1.min)(node.sourceLinks,targetDepth)-1:0}});var align$1=unwrapExports(align);var align_1=align.left;var align_2=align.right;var align_3=align.justify;var align_4=align.center;var align$2=Object.freeze({default:align$1,__moduleExports:align,left:align_1,right:align_2,justify:align_3,center:align_4});var constant_1=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=constant;function constant(x){return function(){return x}}});var constant$b=unwrapExports(constant_1);var constant$c=Object.freeze({default:constant$b,__moduleExports:constant_1});var _align=align$2&&align$1||align$2;var _constant=constant$c&&constant$b||constant$c;var sankeyCircular=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var x0=0,y0=0,x1=1,y1=1,dx=24,py,id=defaultId,align=_align.justify,nodes=defaultNodes,links=defaultLinks,iterations=32,circularLinkGap=2,paddingRatio;function sankeyCircular(){var graph={nodes:nodes.apply(null,arguments),links:links.apply(null,arguments)};computeNodeLinks(graph);identifyCircles(graph,id);computeNodeValues(graph);computeNodeDepths(graph);selectCircularLinkTypes(graph,id);computeNodeBreadths(graph,iterations,id);computeLinkBreadths(graph);var linkSortingIterations=4;for(var iteration=0;iteration<linkSortingIterations;iteration++){sortSourceLinks(graph,y1,id);sortTargetLinks(graph,y1,id);resolveNodeLinkOverlaps(graph,y0,y1,id);sortSourceLinks(graph,y1,id);sortTargetLinks(graph,y1,id)}fillHeight(graph,y0,y1);addCircularPathData(graph,circularLinkGap,y1,id);return graph}sankeyCircular.nodeId=function(_){return arguments.length?(id=typeof _==="function"?_:(0,_constant2.default)(_),sankeyCircular):id};sankeyCircular.nodeAlign=function(_){return arguments.length?(align=typeof _==="function"?_:(0,_constant2.default)(_),sankeyCircular):align};sankeyCircular.nodeWidth=function(_){return arguments.length?(dx=+_,sankeyCircular):dx};sankeyCircular.nodePadding=function(_){return arguments.length?(py=+_,sankeyCircular):py};sankeyCircular.nodes=function(_){return arguments.length?(nodes=typeof _==="function"?_:(0,_constant2.default)(_),sankeyCircular):nodes};sankeyCircular.links=function(_){return arguments.length?(links=typeof _==="function"?_:(0,_constant2.default)(_),sankeyCircular):links};sankeyCircular.size=function(_){return arguments.length?(x0=y0=0,x1=+_[0],y1=+_[1],sankeyCircular):[x1-x0,y1-y0]};sankeyCircular.extent=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],sankeyCircular):[[x0,y0],[x1,y1]]};sankeyCircular.iterations=function(_){return arguments.length?(iterations=+_,sankeyCircular):iterations};sankeyCircular.circularLinkGap=function(_){return arguments.length?(circularLinkGap=+_,sankeyCircular):circularLinkGap};sankeyCircular.nodePaddingRatio=function(_){return arguments.length?(paddingRatio=+_,sankeyCircular):paddingRatio};function computeNodeLinks(graph){graph.nodes.forEach(function(node,i){node.index=i;node.sourceLinks=[];node.targetLinks=[]});var nodeById=(0,src$4.map)(graph.nodes,id);graph.links.forEach(function(link,i){link.index=i;var source=link.source;var target=link.target;if(_typeof(source)!=="object"){source=link.source=find(nodeById,source)}if(_typeof(target)!=="object"){target=link.target=find(nodeById,target)}source.sourceLinks.push(link);target.targetLinks.push(link)})}function computeNodeValues(graph){graph.nodes.forEach(function(node){node.partOfCycle=false;node.value=Math.max((0,src$1.sum)(node.sourceLinks,value),(0,src$1.sum)(node.targetLinks,value));node.sourceLinks.forEach(function(link){if(link.circular){node.partOfCycle=true;node.circularLinkType=link.circularLinkType}});node.targetLinks.forEach(function(link){if(link.circular){node.partOfCycle=true;node.circularLinkType=link.circularLinkType}})})}function getCircleMargins(graph){var totalTopLinksWidth=0,totalBottomLinksWidth=0,totalRightLinksWidth=0,totalLeftLinksWidth=0;var maxColumn=(0,src$1.max)(graph.nodes,function(node){return node.column});graph.links.forEach(function(link){if(link.circular){if(link.circularLinkType=="top"){totalTopLinksWidth=totalTopLinksWidth+link.width}else{totalBottomLinksWidth=totalBottomLinksWidth+link.width}if(link.target.column==0){totalLeftLinksWidth=totalLeftLinksWidth+link.width}if(link.source.column==maxColumn){totalRightLinksWidth=totalRightLinksWidth+link.width}}});totalTopLinksWidth=totalTopLinksWidth>0?totalTopLinksWidth+verticalMargin+baseRadius:totalTopLinksWidth;totalBottomLinksWidth=totalBottomLinksWidth>0?totalBottomLinksWidth+verticalMargin+baseRadius:totalBottomLinksWidth;totalRightLinksWidth=totalRightLinksWidth>0?totalRightLinksWidth+verticalMargin+baseRadius:totalRightLinksWidth;totalLeftLinksWidth=totalLeftLinksWidth>0?totalLeftLinksWidth+verticalMargin+baseRadius:totalLeftLinksWidth;return{top:totalTopLinksWidth,bottom:totalBottomLinksWidth,left:totalLeftLinksWidth,right:totalRightLinksWidth}}function scaleSankeySize(graph,margin){var maxColumn=(0,src$1.max)(graph.nodes,function(node){return node.column});var currentWidth=x1-x0;var currentHeight=y1-y0;var newWidth=currentWidth+margin.right+margin.left;var newHeight=currentHeight+margin.top+margin.bottom;var scaleX=currentWidth/newWidth;var scaleY=currentHeight/newHeight;x0=x0*scaleX+margin.left;x1=margin.right==0?x1:x1*scaleX;y0=y0*scaleY+margin.top;y1=y1*scaleY;graph.nodes.forEach(function(node){node.x0=x0+node.column*((x1-x0-dx)/maxColumn);node.x1=node.x0+dx});return scaleY}function computeNodeDepths(graph){var nodes,next,x;for(nodes=graph.nodes,next=[],x=0;nodes.length;++x,nodes=next,next=[]){nodes.forEach(function(node){node.depth=x;node.sourceLinks.forEach(function(link){if(next.indexOf(link.target)<0&&!link.circular){next.push(link.target)}})})}for(nodes=graph.nodes,next=[],x=0;nodes.length;++x,nodes=next,next=[]){nodes.forEach(function(node){node.height=x;node.targetLinks.forEach(function(link){if(next.indexOf(link.source)<0&&!link.circular){next.push(link.source)}})})}graph.nodes.forEach(function(node){node.column=Math.floor(align.call(null,node,x))})}function computeNodeBreadths(graph,iterations,id){var columns=(0,src$4.nest)().key(function(d){return d.column}).sortKeys(src$1.ascending).entries(graph.nodes).map(function(d){return d.values});initializeNodeBreadth(id);resolveCollisions();for(var alpha=1,n=iterations;n>0;--n){relaxLeftAndRight(alpha*=.99,id);resolveCollisions()}function initializeNodeBreadth(id){if(paddingRatio){var padding=Infinity;columns.forEach(function(nodes){var thisPadding=y1*paddingRatio/(nodes.length+1);padding=thisPadding<padding?thisPadding:padding});py=padding}var ky=(0,src$1.min)(columns,function(nodes){return(y1-y0-(nodes.length-1)*py)/(0,src$1.sum)(nodes,value)});ky=ky*scale;graph.links.forEach(function(link){link.width=link.value*ky});var margin=getCircleMargins(graph);var ratio=scaleSankeySize(graph,margin);ky=ky*ratio;graph.links.forEach(function(link){link.width=link.value*ky});columns.forEach(function(nodes){var nodesLength=nodes.length;nodes.forEach(function(node,i){if(node.depth==columns.length-1&&nodesLength==1){node.y0=y1/2-node.value*ky;node.y1=node.y0+node.value*ky}else if(node.depth==0&&nodesLength==1){node.y0=y1/2-node.value*ky;node.y1=node.y0+node.value*ky}else if(node.partOfCycle){if(numberOfNonSelfLinkingCycles(node,id)==0){node.y0=y1/2+i;node.y1=node.y0+node.value*ky}else if(node.circularLinkType=="top"){node.y0=y0+i;node.y1=node.y0+node.value*ky}else{node.y0=y1-node.value*ky-i;node.y1=node.y0+node.value*ky}}else{if(margin.top==0||margin.bottom==0){node.y0=(y1-y0)/nodesLength*i;node.y1=node.y0+node.value*ky}else{node.y0=(y1-y0)/2-nodesLength/2+i;node.y1=node.y0+node.value*ky}}})})}function relaxLeftAndRight(alpha,id){var columnsLength=columns.length;columns.forEach(function(nodes,i){var n=nodes.length;var depth=nodes[0].depth;nodes.forEach(function(node){if(node.sourceLinks.length||node.targetLinks.length){if(node.partOfCycle&&numberOfNonSelfLinkingCycles(node,id)>0);else if(depth==0&&n==1){var nodeHeight=node.y1-node.y0;node.y0=y1/2-nodeHeight/2;node.y1=y1/2+nodeHeight/2}else if(depth==columnsLength-1&&n==1){var nodeHeight=node.y1-node.y0;node.y0=y1/2-nodeHeight/2;node.y1=y1/2+nodeHeight/2}else{var avg=0;var avgTargetY=(0,src$1.mean)(node.sourceLinks,linkTargetCenter);var avgSourceY=(0,src$1.mean)(node.targetLinks,linkSourceCenter);if(avgTargetY&&avgSourceY){avg=(avgTargetY+avgSourceY)/2}else{avg=avgTargetY||avgSourceY}var dy=(avg-nodeCenter(node))*alpha;node.y0+=dy;node.y1+=dy}}})})}function resolveCollisions(){columns.forEach(function(nodes){var node,dy,y=y0,n=nodes.length,i;nodes.sort(ascendingBreadth);for(i=0;i<n;++i){node=nodes[i];dy=y-node.y0;if(dy>0){node.y0+=dy;node.y1+=dy}y=node.y1+py}dy=y-py-y1;if(dy>0){y=node.y0-=dy,node.y1-=dy;for(i=n-2;i>=0;--i){node=nodes[i];dy=node.y1+py-y;if(dy>0)node.y0-=dy,node.y1-=dy;y=node.y0}}})}}function computeLinkBreadths(graph){graph.nodes.forEach(function(node){node.sourceLinks.sort(ascendingTargetBreadth);node.targetLinks.sort(ascendingSourceBreadth)});graph.nodes.forEach(function(node){var y0=node.y0;var y1=y0;var y0cycle=node.y1;var y1cycle=y0cycle;node.sourceLinks.forEach(function(link){if(link.circular){link.y0=y0cycle-link.width/2;y0cycle=y0cycle-link.width}else{link.y0=y0+link.width/2;y0+=link.width}});node.targetLinks.forEach(function(link){if(link.circular){link.y1=y1cycle-link.width/2;y1cycle=y1cycle-link.width}else{link.y1=y1+link.width/2;y1+=link.width}})})}return sankeyCircular};var _constant2=_interopRequireDefault(_constant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ascendingSourceBreadth(a,b){return ascendingBreadth(a.source,b.source)||a.index-b.index}function ascendingTargetBreadth(a,b){return ascendingBreadth(a.target,b.target)||a.index-b.index}function ascendingBreadth(a,b){if(a.partOfCycle===b.partOfCycle){return a.y0-b.y0}else{if(a.circularLinkType==="top"||b.circularLinkType==="bottom"){return-1}else{return 1}}}function value(d){return d.value}function nodeCenter(node){return(node.y0+node.y1)/2}function linkSourceCenter(link){return nodeCenter(link.source)}function linkTargetCenter(link){return nodeCenter(link.target)}function defaultId(d){return d.index}function defaultNodes(graph){return graph.nodes}function defaultLinks(graph){return graph.links}function find(nodeById,id){var node=nodeById.get(id);if(!node)throw new Error("missing: "+id);return node}function getNodeID(node,id){return id(node)}var verticalMargin=25;var baseRadius=10;var scale=.3;function identifyCircles(graph,id){var addedLinks=[];var circularLinkID=0;graph.links.forEach(function(link){if(createsCycle(link.source,link.target,addedLinks,id)){link.circular=true;link.circularLinkID=circularLinkID;circularLinkID=circularLinkID+1}else{link.circular=false;addedLinks.push(link)}})}function selectCircularLinkTypes(graph,id){var numberOfTops=0;var numberOfBottoms=0;graph.links.forEach(function(link){if(link.circular){if(link.source.circularLinkType||link.target.circularLinkType){link.circularLinkType=link.source.circularLinkType?link.source.circularLinkType:link.target.circularLinkType}else{link.circularLinkType=numberOfTops<numberOfBottoms?"top":"bottom"}if(link.circularLinkType=="top"){numberOfTops=numberOfTops+1}else{numberOfBottoms=numberOfBottoms+1}graph.nodes.forEach(function(node){if(getNodeID(node,id)==getNodeID(link.source,id)||getNodeID(node,id)==getNodeID(link.target,id)){node.circularLinkType=link.circularLinkType}})}});graph.links.forEach(function(link){if(link.circular){if(link.source.circularLinkType==link.target.circularLinkType){link.circularLinkType=link.source.circularLinkType}if(selfLinking(link,id)){link.circularLinkType=link.source.circularLinkType}}})}function createsCycle(originalSource,nodeToCheck,graph,id){if(getNodeID(originalSource,id)==getNodeID(nodeToCheck,id)){return true}if(graph.length==0){return false}var nextLinks=findLinksOutward(nodeToCheck,graph);if(nextLinks.length==0){return false}for(var i=0;i<nextLinks.length;i++){var nextLink=nextLinks[i];if(nextLink.target===originalSource){return true}if(createsCycle(originalSource,nextLink.target,graph,id)){return true}}return false}function findLinksOutward(node,graph){var children=[];for(var i=0;i<graph.length;i++){if(node==graph[i].source){children.push(graph[i])}}return children}function linkAngle(link){var adjacent=Math.abs(link.y1-link.y0);var opposite=Math.abs(link.target.x0-link.source.x1);return Math.atan(opposite/adjacent)}function circularLinksCross(link1,link2){if(link1.source.column<link2.target.column){return false}else if(link1.target.column>link2.source.column){return false}else{return true}}function numberOfNonSelfLinkingCycles(node,id){var sourceCount=0;node.sourceLinks.forEach(function(l){sourceCount=l.circular&&!selfLinking(l,id)?sourceCount+1:sourceCount});var targetCount=0;node.targetLinks.forEach(function(l){targetCount=l.circular&&!selfLinking(l,id)?targetCount+1:targetCount});return sourceCount+targetCount}function onlyCircularLink(link){var nodeSourceLinks=link.source.sourceLinks;var sourceCount=0;nodeSourceLinks.forEach(function(l){sourceCount=l.circular?sourceCount+1:sourceCount});var nodeTargetLinks=link.target.targetLinks;var targetCount=0;nodeTargetLinks.forEach(function(l){targetCount=l.circular?targetCount+1:targetCount});if(sourceCount>1||targetCount>1){return false}else{return true}}function calcVerticalBuffer(links,circularLinkGap,id){links.sort(sortLinkColumnAscending);links.forEach(function(link,i){var buffer=0;if(selfLinking(link,id)&&onlyCircularLink(link)){link.circularPathData.verticalBuffer=buffer+link.width/2}else{var j=0;for(j;j<i;j++){if(circularLinksCross(links[i],links[j])){var bufferOverThisLink=links[j].circularPathData.verticalBuffer+links[j].width/2+circularLinkGap;buffer=bufferOverThisLink>buffer?bufferOverThisLink:buffer}}link.circularPathData.verticalBuffer=buffer+link.width/2}});return links}function addCircularPathData(graph,circularLinkGap,y1,id){var buffer=5;var minY=(0,src$1.min)(graph.links,function(link){return link.source.y0});graph.links.forEach(function(link){if(link.circular){link.circularPathData={}}});var topLinks=graph.links.filter(function(l){return l.circularLinkType=="top"});topLinks=calcVerticalBuffer(topLinks,circularLinkGap,id);var bottomLinks=graph.links.filter(function(l){return l.circularLinkType=="bottom"});bottomLinks=calcVerticalBuffer(bottomLinks,circularLinkGap,id);graph.links.forEach(function(link){if(link.circular){link.circularPathData.arcRadius=link.width+baseRadius;link.circularPathData.leftNodeBuffer=buffer;link.circularPathData.rightNodeBuffer=buffer;link.circularPathData.sourceWidth=link.source.x1-link.source.x0;link.circularPathData.sourceX=link.source.x0+link.circularPathData.sourceWidth;link.circularPathData.targetX=link.target.x0;link.circularPathData.sourceY=link.y0;link.circularPathData.targetY=link.y1;if(selfLinking(link,id)&&onlyCircularLink(link)){link.circularPathData.leftSmallArcRadius=baseRadius+link.width/2;link.circularPathData.leftLargeArcRadius=baseRadius+link.width/2;link.circularPathData.rightSmallArcRadius=baseRadius+link.width/2;link.circularPathData.rightLargeArcRadius=baseRadius+link.width/2;if(link.circularLinkType=="bottom"){link.circularPathData.verticalFullExtent=link.source.y1+verticalMargin+link.circularPathData.verticalBuffer;link.circularPathData.verticalLeftInnerExtent=link.circularPathData.verticalFullExtent-link.circularPathData.leftLargeArcRadius;link.circularPathData.verticalRightInnerExtent=link.circularPathData.verticalFullExtent-link.circularPathData.rightLargeArcRadius}else{link.circularPathData.verticalFullExtent=link.source.y0-verticalMargin-link.circularPathData.verticalBuffer;link.circularPathData.verticalLeftInnerExtent=link.circularPathData.verticalFullExtent+link.circularPathData.leftLargeArcRadius;link.circularPathData.verticalRightInnerExtent=link.circularPathData.verticalFullExtent+link.circularPathData.rightLargeArcRadius}}else{var thisColumn=link.source.column;var thisCircularLinkType=link.circularLinkType;var sameColumnLinks=graph.links.filter(function(l){return l.source.column==thisColumn&&l.circularLinkType==thisCircularLinkType});if(link.circularLinkType=="bottom"){sameColumnLinks.sort(sortLinkSourceYDescending)}else{sameColumnLinks.sort(sortLinkSourceYAscending)}var radiusOffset=0;sameColumnLinks.forEach(function(l,i){if(l.circularLinkID==link.circularLinkID){link.circularPathData.leftSmallArcRadius=baseRadius+link.width/2+radiusOffset;link.circularPathData.leftLargeArcRadius=baseRadius+link.width/2+i*circularLinkGap+radiusOffset}radiusOffset=radiusOffset+l.width});thisColumn=link.target.column;sameColumnLinks=graph.links.filter(function(l){return l.target.column==thisColumn&&l.circularLinkType==thisCircularLinkType});if(link.circularLinkType=="bottom"){sameColumnLinks.sort(sortLinkTargetYDescending)}else{sameColumnLinks.sort(sortLinkTargetYAscending)}radiusOffset=0;sameColumnLinks.forEach(function(l,i){if(l.circularLinkID==link.circularLinkID){link.circularPathData.rightSmallArcRadius=baseRadius+link.width/2+radiusOffset;link.circularPathData.rightLargeArcRadius=baseRadius+link.width/2+i*circularLinkGap+radiusOffset}radiusOffset=radiusOffset+l.width});if(link.circularLinkType=="bottom"){link.circularPathData.verticalFullExtent=y1+verticalMargin+link.circularPathData.verticalBuffer;link.circularPathData.verticalLeftInnerExtent=link.circularPathData.verticalFullExtent-link.circularPathData.leftLargeArcRadius;link.circularPathData.verticalRightInnerExtent=link.circularPathData.verticalFullExtent-link.circularPathData.rightLargeArcRadius}else{link.circularPathData.verticalFullExtent=minY-verticalMargin-link.circularPathData.verticalBuffer;link.circularPathData.verticalLeftInnerExtent=link.circularPathData.verticalFullExtent+link.circularPathData.leftLargeArcRadius;link.circularPathData.verticalRightInnerExtent=link.circularPathData.verticalFullExtent+link.circularPathData.rightLargeArcRadius}}link.circularPathData.leftInnerExtent=link.circularPathData.sourceX+link.circularPathData.leftNodeBuffer;link.circularPathData.rightInnerExtent=link.circularPathData.targetX-link.circularPathData.rightNodeBuffer;link.circularPathData.leftFullExtent=link.circularPathData.sourceX+link.circularPathData.leftLargeArcRadius+link.circularPathData.leftNodeBuffer;link.circularPathData.rightFullExtent=link.circularPathData.targetX-link.circularPathData.rightLargeArcRadius-link.circularPathData.rightNodeBuffer}if(link.circular){link.path=createCircularPathString(link)}else{var normalPath=(0,src.linkHorizontal)().source(function(d){var x=d.source.x0+(d.source.x1-d.source.x0);var y=d.y0;return[x,y]}).target(function(d){var x=d.target.x0;var y=d.y1;return[x,y]});link.path=normalPath(link)}})}function createCircularPathString(link){var pathString="";if(link.circularLinkType=="top"){pathString="M"+link.circularPathData.sourceX+" "+link.circularPathData.sourceY+" "+"L"+link.circularPathData.leftInnerExtent+" "+link.circularPathData.sourceY+" "+"A"+link.circularPathData.leftLargeArcRadius+" "+link.circularPathData.leftSmallArcRadius+" 0 0 0 "+link.circularPathData.leftFullExtent+" "+(link.circularPathData.sourceY-link.circularPathData.leftSmallArcRadius)+" "+"L"+link.circularPathData.leftFullExtent+" "+link.circularPathData.verticalLeftInnerExtent+" "+"A"+link.circularPathData.leftLargeArcRadius+" "+link.circularPathData.leftLargeArcRadius+" 0 0 0 "+link.circularPathData.leftInnerExtent+" "+link.circularPathData.verticalFullExtent+" "+"L"+link.circularPathData.rightInnerExtent+" "+link.circularPathData.verticalFullExtent+" "+"A"+link.circularPathData.rightLargeArcRadius+" "+link.circularPathData.rightLargeArcRadius+" 0 0 0 "+link.circularPathData.rightFullExtent+" "+link.circularPathData.verticalRightInnerExtent+" "+"L"+link.circularPathData.rightFullExtent+" "+(link.circularPathData.targetY-link.circularPathData.rightSmallArcRadius)+" "+"A"+link.circularPathData.rightLargeArcRadius+" "+link.circularPathData.rightSmallArcRadius+" 0 0 0 "+link.circularPathData.rightInnerExtent+" "+link.circularPathData.targetY+" "+"L"+link.circularPathData.targetX+" "+link.circularPathData.targetY}else{pathString="M"+link.circularPathData.sourceX+" "+link.circularPathData.sourceY+" "+"L"+link.circularPathData.leftInnerExtent+" "+link.circularPathData.sourceY+" "+"A"+link.circularPathData.leftLargeArcRadius+" "+link.circularPathData.leftSmallArcRadius+" 0 0 1 "+link.circularPathData.leftFullExtent+" "+(link.circularPathData.sourceY+link.circularPathData.leftSmallArcRadius)+" "+"L"+link.circularPathData.leftFullExtent+" "+link.circularPathData.verticalLeftInnerExtent+" "+"A"+link.circularPathData.leftLargeArcRadius+" "+link.circularPathData.leftLargeArcRadius+" 0 0 1 "+link.circularPathData.leftInnerExtent+" "+link.circularPathData.verticalFullExtent+" "+"L"+link.circularPathData.rightInnerExtent+" "+link.circularPathData.verticalFullExtent+" "+"A"+link.circularPathData.rightLargeArcRadius+" "+link.circularPathData.rightLargeArcRadius+" 0 0 1 "+link.circularPathData.rightFullExtent+" "+link.circularPathData.verticalRightInnerExtent+" "+"L"+link.circularPathData.rightFullExtent+" "+(link.circularPathData.targetY+link.circularPathData.rightSmallArcRadius)+" "+"A"+link.circularPathData.rightLargeArcRadius+" "+link.circularPathData.rightSmallArcRadius+" 0 0 1 "+link.circularPathData.rightInnerExtent+" "+link.circularPathData.targetY+" "+"L"+link.circularPathData.targetX+" "+link.circularPathData.targetY}return pathString}function sortLinkColumnAscending(link1,link2){if(linkColumnDistance(link1)==linkColumnDistance(link2)){return link1.circularLinkType=="bottom"?sortLinkSourceYDescending(link1,link2):sortLinkSourceYAscending(link1,link2)}else{return linkColumnDistance(link2)-linkColumnDistance(link1)}}function sortLinkSourceYAscending(link1,link2){return link1.y0-link2.y0}function sortLinkSourceYDescending(link1,link2){return link2.y0-link1.y0}function sortLinkTargetYAscending(link1,link2){return link1.y1-link2.y1}function sortLinkTargetYDescending(link1,link2){return link2.y1-link1.y1}function linkColumnDistance(link){return link.target.column-link.source.column}function linkXLength(link){return link.target.x0-link.source.x1}function linkPerpendicularYToLinkSource(longerLink,shorterLink){var angle=linkAngle(longerLink);var heightFromY1ToPependicular=linkXLength(shorterLink)/Math.tan(angle);var yPerpendicular=incline(longerLink)=="up"?longerLink.y1+heightFromY1ToPependicular:longerLink.y1-heightFromY1ToPependicular;return yPerpendicular}function linkPerpendicularYToLinkTarget(longerLink,shorterLink){var angle=linkAngle(longerLink);var heightFromY1ToPependicular=linkXLength(shorterLink)/Math.tan(angle);var yPerpendicular=incline(longerLink)=="up"?longerLink.y1-heightFromY1ToPependicular:longerLink.y1+heightFromY1ToPependicular;return yPerpendicular}function resolveNodeLinkOverlaps(graph,y0,y1,id){graph.links.forEach(function(link){if(link.circular){return}if(link.target.column-link.source.column>1){var columnToTest=link.source.column+1;var maxColumnToTest=link.target.column-1;var i=1;var numberOfColumnsToTest=maxColumnToTest-columnToTest+1;for(i=1;columnToTest<=maxColumnToTest;columnToTest++,i++){graph.nodes.forEach(function(node){if(node.column==columnToTest){var t=i/(numberOfColumnsToTest+1);var B0_t=Math.pow(1-t,3);var B1_t=3*t*Math.pow(1-t,2);var B2_t=3*Math.pow(t,2)*(1-t);var B3_t=Math.pow(t,3);var py_t=B0_t*link.y0+B1_t*link.y0+B2_t*link.y1+B3_t*link.y1;var linkY0AtColumn=py_t-link.width/2;var linkY1AtColumn=py_t+link.width/2;if(linkY0AtColumn>node.y0&&linkY0AtColumn<node.y1){var dy=node.y1-linkY0AtColumn+10;dy=node.circularLinkType=="bottom"?dy:-dy;node=adjustNodeHeight(node,dy,y0,y1);graph.nodes.forEach(function(otherNode){if(getNodeID(otherNode,id)==getNodeID(node,id)||otherNode.column!=node.column){return}if(nodesOverlap(node,otherNode)){adjustNodeHeight(otherNode,dy,y0,y1)}})}else if(linkY1AtColumn>node.y0&&linkY1AtColumn<node.y1){var dy=linkY1AtColumn-node.y0+10;node=adjustNodeHeight(node,dy,y0,y1);graph.nodes.forEach(function(otherNode){if(getNodeID(otherNode,id)==getNodeID(node,id)||otherNode.column!=node.column){return}if(otherNode.y0<node.y1&&otherNode.y1>node.y1){adjustNodeHeight(otherNode,dy,y0,y1)}})}else if(linkY0AtColumn<node.y0&&linkY1AtColumn>node.y1){var dy=linkY1AtColumn-node.y0+10;node=adjustNodeHeight(node,dy,y0,y1);graph.nodes.forEach(function(otherNode){if(getNodeID(otherNode,id)==getNodeID(node,id)||otherNode.column!=node.column){return}if(otherNode.y0<node.y1&&otherNode.y1>node.y1){adjustNodeHeight(otherNode,dy,y0,y1)}})}}})}}})}function nodesOverlap(nodeA,nodeB){if(nodeA.y0>nodeB.y0&&nodeA.y0<nodeB.y1){return true}else if(nodeA.y1>nodeB.y0&&nodeA.y1<nodeB.y1){return true}else if(nodeA.y0<nodeB.y0&&nodeA.y1>nodeB.y1){return true}else{return false}}function adjustNodeHeight(node,dy,sankeyY0,sankeyY1){if(node.y0+dy>=sankeyY0&&node.y1+dy<=sankeyY1){node.y0=node.y0+dy;node.y1=node.y1+dy;node.targetLinks.forEach(function(l){l.y1=l.y1+dy});node.sourceLinks.forEach(function(l){l.y0=l.y0+dy})}return node}function sortSourceLinks(graph,y1,id){graph.nodes.forEach(function(node){if(node.y+(node.y1-node.y0)>y1){node.y=node.y-(node.y+(node.y1-node.y0)-y1)}var nodesSourceLinks=graph.links.filter(function(l){return getNodeID(l.source,id)==getNodeID(node,id)});var nodeSourceLinksLength=nodesSourceLinks.length;if(nodeSourceLinksLength>1){nodesSourceLinks.sort(function(link1,link2){if(!link1.circular&&!link2.circular){if(link1.target.column==link2.target.column){return link1.y1-link2.y1}else if(!sameInclines(link1,link2)){return link1.y1-link2.y1}else{if(link1.target.column>link2.target.column){var link2Adj=linkPerpendicularYToLinkTarget(link2,link1);return link1.y1-link2Adj}if(link2.target.column>link1.target.column){var link1Adj=linkPerpendicularYToLinkTarget(link1,link2);return link1Adj-link2.y1}}}if(link1.circular&&!link2.circular){return link1.circularLinkType=="top"?-1:1}else if(link2.circular&&!link1.circular){return link2.circularLinkType=="top"?1:-1}if(link1.circular&&link2.circular){if(link1.circularLinkType===link2.circularLinkType&&link1.circularLinkType=="top"){if(link1.target.column===link2.target.column){return link1.target.y1-link2.target.y1}else{return link2.target.column-link1.target.column}}else if(link1.circularLinkType===link2.circularLinkType&&link1.circularLinkType=="bottom"){if(link1.target.column===link2.target.column){return link2.target.y1-link1.target.y1}else{return link1.target.column-link2.target.column}}else{return link1.circularLinkType=="top"?-1:1}}})}var ySourceOffset=node.y0;nodesSourceLinks.forEach(function(link){link.y0=ySourceOffset+link.width/2;ySourceOffset=ySourceOffset+link.width});nodesSourceLinks.forEach(function(link,i){if(link.circularLinkType=="bottom"){var j=i+1;var offsetFromBottom=0;for(j;j<nodeSourceLinksLength;j++){offsetFromBottom=offsetFromBottom+nodesSourceLinks[j].width}link.y0=node.y1-offsetFromBottom-link.width/2}})})}function sortTargetLinks(graph,y1,id){graph.nodes.forEach(function(node){var nodesTargetLinks=graph.links.filter(function(l){return getNodeID(l.target,id)==getNodeID(node,id)});var nodesTargetLinksLength=nodesTargetLinks.length;if(nodesTargetLinksLength>1){nodesTargetLinks.sort(function(link1,link2){if(!link1.circular&&!link2.circular){if(link1.source.column==link2.source.column){return link1.y0-link2.y0}else if(!sameInclines(link1,link2)){return link1.y0-link2.y0}else{if(link2.source.column<link1.source.column){var link2Adj=linkPerpendicularYToLinkSource(link2,link1);return link1.y0-link2Adj}if(link1.source.column<link2.source.column){var link1Adj=linkPerpendicularYToLinkSource(link1,link2);return link1Adj-link2.y0}}}if(link1.circular&&!link2.circular){return link1.circularLinkType=="top"?-1:1}else if(link2.circular&&!link1.circular){return link2.circularLinkType=="top"?1:-1}if(link1.circular&&link2.circular){if(link1.circularLinkType===link2.circularLinkType&&link1.circularLinkType=="top"){if(link1.source.column===link2.source.column){return link1.source.y1-link2.source.y1}else{return link1.source.column-link2.source.column}}else if(link1.circularLinkType===link2.circularLinkType&&link1.circularLinkType=="bottom"){if(link1.source.column===link2.source.column){return link1.source.y1-link2.source.y1}else{return link2.source.column-link1.source.column}}else{return link1.circularLinkType=="top"?-1:1}}})}var yTargetOffset=node.y0;nodesTargetLinks.forEach(function(link){link.y1=yTargetOffset+link.width/2;yTargetOffset=yTargetOffset+link.width});nodesTargetLinks.forEach(function(link,i){if(link.circularLinkType=="bottom"){var j=i+1;var offsetFromBottom=0;for(j;j<nodesTargetLinksLength;j++){offsetFromBottom=offsetFromBottom+nodesTargetLinks[j].width}link.y1=node.y1-offsetFromBottom-link.width/2}})})}function sameInclines(link1,link2){return incline(link1)==incline(link2)}function incline(link){return link.y0-link.y1>0?"up":"down"}function selfLinking(link,id){return getNodeID(link.source,id)==getNodeID(link.target,id)}function fillHeight(graph,y0,y1){var nodes=graph.nodes;var links=graph.links;var top=false;var bottom=false;links.forEach(function(link){if(link.circularLinkType=="top"){top=true}else if(link.circularLinkType=="bottom"){bottom=true}});if(top==false||bottom==false){var minY0=(0,src$1.min)(nodes,function(node){return node.y0});var maxY1=(0,src$1.max)(nodes,function(node){return node.y1});var currentHeight=maxY1-minY0;var chartHeight=y1-y0;var ratio=chartHeight/currentHeight;nodes.forEach(function(node){var nodeHeight=(node.y1-node.y0)*ratio;node.y0=(node.y0-minY0)*ratio;node.y1=node.y0+nodeHeight});links.forEach(function(link){link.y0=(link.y0-minY0)*ratio;link.y1=(link.y1-minY0)*ratio;link.width=link.width*ratio})}}});var sankeyCircular$1=unwrapExports(sankeyCircular);var sankeyCircular$2=Object.freeze({default:sankeyCircular$1,__moduleExports:sankeyCircular});var _sankeyCircular=sankeyCircular$2&&sankeyCircular$1||sankeyCircular$2;var dist=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"sankeyCircular",{enumerable:true,get:function get(){return _interopRequireDefault(_sankeyCircular).default}});Object.defineProperty(exports,"sankeyCenter",{enumerable:true,get:function get(){return _align.center}});Object.defineProperty(exports,"sankeyLeft",{enumerable:true,get:function get(){return _align.left}});Object.defineProperty(exports,"sankeyRight",{enumerable:true,get:function get(){return _align.right}});Object.defineProperty(exports,"sankeyJustify",{enumerable:true,get:function get(){return _align.justify}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}});unwrapExports(dist);var dist_1=dist.sankeyCircular;var dist_2=dist.sankeyLeft;var dist_3=dist.sankeyCenter;var dist_4=dist.sankeyRight;var dist_5=dist.sankeyJustify;var cos$2=Math.cos;var sin$2=Math.sin;var pi$4=Math.PI;var halfPi$2=pi$4/2;var tau$4=pi$4*2;var max$4=Math.max;function compareValue(compare){return function(a,b){return compare(a.source.value+a.target.value,b.source.value+b.target.value)}}function chord(){var padAngle=0,sortGroups=null,sortSubgroups=null,sortChords=null;function chord(matrix){var n=matrix.length,groupSums=[],groupIndex=range(n),subgroupIndex=[],chords=[],groups=chords.groups=new Array(n),subgroups=new Array(n*n),k,x,x0,dx,i,j;k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j]}groupSums.push(x);subgroupIndex.push(range(n));k+=x}if(sortGroups)groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])});if(sortSubgroups)subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})});k=max$4(0,tau$4-padAngle*n)/k;dx=k?padAngle:tau$4/n;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[dj*n+di]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]};x+=dx}i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[j*n+i],target=subgroups[i*n+j];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}}}return sortChords?chords.sort(sortChords):chords}chord.padAngle=function(_){return arguments.length?(padAngle=max$4(0,_),chord):padAngle};chord.sortGroups=function(_){return arguments.length?(sortGroups=_,chord):sortGroups};chord.sortSubgroups=function(_){return arguments.length?(sortSubgroups=_,chord):sortSubgroups};chord.sortChords=function(_){return arguments.length?(_==null?sortChords=null:(sortChords=compareValue(_))._=_,chord):sortChords&&sortChords._};return chord}var slice$6=Array.prototype.slice;function constant$d(x){return function(){return x}}function defaultSource(d){return d.source}function defaultTarget(d){return d.target}function defaultRadius$1(d){return d.radius}function defaultStartAngle(d){return d.startAngle}function defaultEndAngle(d){return d.endAngle}function ribbon$1(){var source=defaultSource,target=defaultTarget,radius=defaultRadius$1,startAngle=defaultStartAngle,endAngle=defaultEndAngle,context=null;function ribbon(){var buffer,argv=slice$6.call(arguments),s=source.apply(this,argv),t=target.apply(this,argv),sr=+radius.apply(this,(argv[0]=s,argv)),sa0=startAngle.apply(this,argv)-halfPi$2,sa1=endAngle.apply(this,argv)-halfPi$2,sx0=sr*cos$2(sa0),sy0=sr*sin$2(sa0),tr=+radius.apply(this,(argv[0]=t,argv)),ta0=startAngle.apply(this,argv)-halfPi$2,ta1=endAngle.apply(this,argv)-halfPi$2;if(!context)context=buffer=path();context.moveTo(sx0,sy0);context.arc(0,0,sr,sa0,sa1);if(sa0!==ta0||sa1!==ta1){context.quadraticCurveTo(0,0,tr*cos$2(ta0),tr*sin$2(ta0));context.arc(0,0,tr,ta0,ta1)}context.quadraticCurveTo(0,0,sx0,sy0);context.closePath();if(buffer)return context=null,buffer+""||null}ribbon.radius=function(_){return arguments.length?(radius=typeof _==="function"?_:constant$d(+_),ribbon):radius};ribbon.startAngle=function(_){return arguments.length?(startAngle=typeof _==="function"?_:constant$d(+_),ribbon):startAngle};ribbon.endAngle=function(_){return arguments.length?(endAngle=typeof _==="function"?_:constant$d(+_),ribbon):endAngle};ribbon.source=function(_){return arguments.length?(source=_,ribbon):source};ribbon.target=function(_){return arguments.length?(target=_,ribbon):target};ribbon.context=function(_){return arguments.length?(context=_==null?null:_,ribbon):context};return ribbon}var htmlFrameHoverRule$1=function(_a){var baseD=_a.d,i=_a.i,tooltipContent=_a.tooltipContent,useSpans=_a.useSpans,nodes=_a.nodes,edges=_a.edges,nodeIDAccessor=_a.nodeIDAccessor;var d=baseD.x&&baseD.y?baseD:baseD.edge?__assign({},edges.find(function(p){return nodeIDAccessor(p.source)===nodeIDAccessor(baseD.source)&&nodeIDAccessor(p.target)===nodeIDAccessor(baseD.target)})||{},baseD):nodes.find(function(p){return nodeIDAccessor(p)===baseD.id});if(!d)return null;var content=d.edge?React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},React.createElement("p",{key:"html-annotation-content-1"},(d.source||d.edge.source).id," to ",(d.target||d.edge.target).id)):React.createElement(SpanOrDiv,{span:useSpans,className:"tooltip-content"},React.createElement("p",{key:"html-annotation-content-1"},d.id),React.createElement("p",{key:"html-annotation-content-2"},"Degree: ",d.degree));if(d.type==="frame-hover"&&tooltipContent){content=tooltipContent(d)}return React.createElement(SpanOrDiv,{span:useSpans,key:"network-annotation-label-"+i,className:"annotation annotation-network-label "+(d.className||""),style:{position:"absolute",top:d.y+"px",left:d.x+"px"}},content)};var svgNodeRule=function(_a){var d=_a.d,i=_a.i,nodeSizeAccessor=_a.nodeSizeAccessor;if(!d){return null}var noteData=Object.assign({dx:d.dx||-25,dy:d.dy||-25,x:d.x,y:d.y,note:{label:d.label,orientation:d.orientation,align:d.align},connector:{end:"arrow"}},d,{type:AnnotationCalloutCircle,subject:{radius:d.radius||d.radius||nodeSizeAccessor(d)}});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgReactAnnotationRule=function(_a){var d=_a.d,i=_a.i,projectedNodes=_a.projectedNodes,nodeIDAccessor=_a.nodeIDAccessor;var selectedNode=d.x&&d.y?d:projectedNodes.find(function(p){return nodeIDAccessor(p)===d.id});if(!selectedNode){return null}var noteData=Object.assign({dx:0,dy:0,x:selectedNode.x,y:selectedNode.y,note:{label:d.label},connector:{end:"arrow"}},d,{type:typeof d.type==="function"?d.type:undefined});return React.createElement(SemioticAnnotation,{key:d.key||"annotation-"+i,noteData:noteData})};var svgEncloseRule$1=function(_a){var d=_a.d,i=_a.i,projectedNodes=_a.projectedNodes,nodeIDAccessor=_a.nodeIDAccessor,nodeSizeAccessor=_a.nodeSizeAccessor;var selectedNodes=projectedNodes.filter(function(p){return d.ids.indexOf(nodeIDAccessor(p))!==-1});if(selectedNodes.length===0){return null}var circle=packEnclose(selectedNodes.map(function(p){return{x:p.x,y:p.y,r:nodeSizeAccessor(p)}}));return circleEnclosure({circle:circle,d:d,i:i})};var svgRectEncloseRule$1=function(_a){var d=_a.d,i=_a.i,projectedNodes=_a.projectedNodes,nodeIDAccessor=_a.nodeIDAccessor,nodeSizeAccessor=_a.nodeSizeAccessor;var selectedNodes=projectedNodes.filter(function(p){return d.ids.indexOf(nodeIDAccessor(p))!==-1});if(selectedNodes.length===0){return null}var bboxNodes=selectedNodes.map(function(p){if(p.shapeNode){return{x0:p.x0,x1:p.x1,y0:p.y0,y1:p.y1}}var nodeSize=nodeSizeAccessor(p);return{x0:p.x-nodeSize,x1:p.x+nodeSize,y0:p.y-nodeSize,y1:p.y+nodeSize}});return rectangleEnclosure({bboxNodes:bboxNodes,d:d,i:i})};var svgHullEncloseRule=function(_a){var d=_a.d,i=_a.i,projectedNodes=_a.projectedNodes,nodeIDAccessor=_a.nodeIDAccessor,nodeSizeAccessor=_a.nodeSizeAccessor;var selectedNodes=projectedNodes.filter(function(p){return d.ids.indexOf(nodeIDAccessor(p))!==-1});if(selectedNodes.length===0){return null}var projectedPoints=[];selectedNodes.forEach(function(p){if(p.shapeNode){projectedPoints.push({x:p.x0,y:p.y0});projectedPoints.push({x:p.x0,y:p.y1});projectedPoints.push({x:p.x1,y:p.y0});projectedPoints.push({x:p.x1,y:p.y1})}else{var nodeSize=nodeSizeAccessor(p);projectedPoints.push({x:p.x-nodeSize,y:p.y-nodeSize});projectedPoints.push({x:p.x+nodeSize,y:p.y-nodeSize});projectedPoints.push({x:p.x-nodeSize,y:p.y+nodeSize});projectedPoints.push({x:p.x+nodeSize,y:p.y+nodeSize})}});return hullEnclosure({points:projectedPoints.map(function(d){return[d.x,d.y]}),d:d,i:i})};var svgHighlightRule$1=function(_a){var d=_a.d,networkFrameRender=_a.networkFrameRender;var nodes=networkFrameRender.nodes;var customMark=nodes.customMark,baseStyle=nodes.styleFn;var styleFn=baseStyle;if(d.style&&typeof d.style==="function"){styleFn=function(d){return __assign({},baseStyle(d),d.style(d))}}else if(d.style){styleFn=function(d){return __assign({},baseStyle(d),d.style)}}var transform="translate("+d.x+","+d.y+")";var baseMarkProps={forceUpdate:true};var HighlightMark=customMark({d:d,styleFn:styleFn,transform:transform,baseMarkProps:baseMarkProps});return HighlightMark};function recursiveIDAccessor(idAccessor,node,accessorString){if(node.parent){accessorString=accessorString+"-"+recursiveIDAccessor(idAccessor,__assign({},node.parent,node.parent.data),accessorString)}return accessorString+"-"+idAccessor(__assign({},node,node.data))}var nodesEdgesFromHierarchy=function(baseRootNode,idAccessor){if(idAccessor===void 0){idAccessor=function(d){return d.id||d.descendantIndex}}var edges=[];var nodes=[];var rootNode=baseRootNode.descendants?baseRootNode:hierarchy(baseRootNode);var descendants=rootNode.descendants();descendants.forEach(function(d,i){d.descendantIndex=i});descendants.forEach(function(node,i){var generatedID=idAccessor(__assign({},node,node.data))+"-"+(node.parent&&recursiveIDAccessor(idAccessor,__assign({},node.parent,node.parent.data),"")||"root");var dataD=Object.assign(node,node.data||{},{hierarchicalID:generatedID});nodes.push(dataD);if(node.parent!==null){var dataParent=Object.assign(node.parent,node.parent.data||{});edges.push({source:dataParent,target:dataD,depth:node.depth,weight:1,value:1,_NWFEdgeKey:generatedID})}});return{edges:edges,nodes:nodes}};var emptyArray=[];var matrixRenderOrder=["nodes","edges"];var generalRenderOrder=["edges","nodes"];var baseNodeProps={id:undefined,degree:0,inDegree:0,outDegree:0,x:0,y:0,x1:0,x0:0,y1:0,y0:0,height:0,width:0,radius:0,r:0,direction:undefined,textHeight:0,textWidth:0,fontSize:0,scale:1,nodeSize:0,component:-99,shapeNode:false};var baseNetworkSettings={iterations:500,hierarchicalNetwork:false};var baseGraphSettings={nodeHash:new Map,edgeHash:new Map,nodes:[],edges:[],hierarchicalNetwork:false,type:"force"};var basicMiddle=function(d){return{edge:d,x:(d.source.x+d.target.x)/2,y:(d.source.y+d.target.y)/2}};var edgePointHash={sankey:function(d){return{edge:d,x:(d.source.x1+d.target.x0)/2,y:d.circularPathData?d.circularPathData.verticalFullExtent:((d.y0+d.y1)/2+(d.y0+d.y1)/2)/2}},force:basicMiddle,tree:basicMiddle,cluster:basicMiddle};var hierarchicalTypeHash={dendrogram:tree,tree:tree,circlepack:pack,cluster:cluster,treemap:treemap,partition:partition};var hierarchicalProjectable={partition:true,cluster:true,tree:true,dendrogram:true};var radialProjectable={partition:true,cluster:true,tree:true,dendrogram:true};function determineNodeIcon(baseCustomNodeIcon,networkSettings,size,nodes){if(baseCustomNodeIcon)return baseCustomNodeIcon;var center=[size[0]/2,size[1]/2];switch(networkSettings.type){case"sankey":return sankeyNodeGenerator;case"partition":return networkSettings.projection==="radial"?radialRectNodeGenerator(size,center,networkSettings):hierarchicalRectNodeGenerator;case"treemap":return networkSettings.projection==="radial"?radialRectNodeGenerator(size,center,networkSettings):hierarchicalRectNodeGenerator;case"circlepack":return circleNodeGenerator;case"wordcloud":return wordcloudNodeGenerator;case"chord":return chordNodeGenerator(size);case"dagre":return hierarchicalRectNodeGenerator;case"matrix":return matrixNodeGenerator(size,nodes)}return circleNodeGenerator}function determineEdgeIcon(_a){var baseCustomEdgeIcon=_a.baseCustomEdgeIcon,networkSettings=_a.networkSettings,size=_a.size,graph=_a.graph,nodes=_a.nodes;if(baseCustomEdgeIcon)return baseCustomEdgeIcon;switch(networkSettings.type){case"partition":return function(){return null};case"treemap":return function(){return null};case"circlepack":return function(){return null};case"wordcloud":return function(){return null};case"chord":return chordEdgeGenerator(size);case"matrix":return matrixEdgeGenerator(size,nodes);case"arc":return arcEdgeGenerator(size);case"dagre":if(graph)return dagreEdgeGenerator(graph.graph().rankdir)}return undefined}function breadthFirstCompontents(baseNodes,hash){var componentHash={0:{componentNodes:[],componentEdges:[]}};var components=[componentHash["0"]];var componentID=0;traverseNodesBF(baseNodes,true);function traverseNodesBF(nodes,top){nodes.forEach(function(node){var _a;var hashNode=hash.get(node);if(!hashNode){componentHash["0"].componentNodes.push(node)}else if(hashNode.component===-99){if(top===true){componentID++;componentHash[componentID]={componentNodes:[],componentEdges:[]};components.push(componentHash[componentID])}hashNode.component=componentID;componentHash[componentID].componentNodes.push(node);(_a=componentHash[componentID].componentEdges).push.apply(_a,__spread(hashNode.edges));var traversibleNodes=__spread(hashNode.connectedNodes);traverseNodesBF(traversibleNodes,hash)}})}return components.sort(function(a,b){return b.componentNodes.length-a.componentNodes.length})}var projectedCoordinateNames$1={y:"y",x:"x"};var sankeyOrientHash={left:dist_2,right:dist_4,center:dist_3,justify:dist_5};var xScale$1=linear$1();var yScale$1=linear$1();var matrixify=function(_a){var edgeHash=_a.edgeHash,nodes=_a.nodes,edgeWidthAccessor=_a.edgeWidthAccessor,nodeIDAccessor=_a.nodeIDAccessor;var matrix=[];nodes.forEach(function(nodeSource){var nodeSourceID=nodeIDAccessor(nodeSource);var sourceRow=[];matrix.push(sourceRow);nodes.forEach(function(nodeTarget){var nodeTargetID=nodeIDAccessor(nodeTarget);var theEdge=edgeHash.get(nodeSourceID+"|"+nodeTargetID);if(theEdge){sourceRow.push(edgeWidthAccessor(theEdge))}else{sourceRow.push(0)}})});return matrix};var NetworkFrame=function(_super){__extends(NetworkFrame,_super);function NetworkFrame(props){var _this=_super.call(this,props)||this;_this.defaultNetworkSVGRule=function(_a){var baseD=_a.d,i=_a.i,annotationLayer=_a.annotationLayer;var _b=_this.state,projectedNodes=_b.projectedNodes,projectedEdges=_b.projectedEdges,nodeIDAccessor=_b.nodeIDAccessor,nodeSizeAccessor=_b.nodeSizeAccessor,networkFrameRender=_b.networkFrameRender,adjustedSize=_b.adjustedSize,adjustedPosition=_b.adjustedPosition;var svgAnnotationRules=_this.props.svgAnnotationRules;var d=baseD.ids?baseD:baseD.edge?__assign({},projectedEdges.find(function(p){return nodeIDAccessor(p.source)===nodeIDAccessor(baseD.source)&&nodeIDAccessor(p.target)===nodeIDAccessor(baseD.target)})||{},baseD):__assign({},projectedNodes.find(function(p){return nodeIDAccessor(p)===baseD.id})||{},baseD);var voronoiHover=annotationLayer.voronoiHover;if(svgAnnotationRules){var customAnnotation=svgAnnotationRules({d:d,i:i,networkFrameProps:_this.props,networkFrameState:_this.state,nodes:projectedNodes,edges:projectedEdges,voronoiHover:voronoiHover,screenCoordinates:[d.x,d.y],adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer});if(customAnnotation!==null){return customAnnotation}}if(d.type==="node"){return svgNodeRule({d:d,i:i,nodeSizeAccessor:nodeSizeAccessor})}else if(d.type==="desaturation-layer"){return desaturationLayer({style:d.style instanceof Function?d.style(d,i):d.style,size:adjustedSize,i:i,key:d.key})}else if(d.type==="basic-node-label"){return React.createElement("g",{key:d.key||"basic-"+i,transform:"translate("+d.x+","+d.y+")"},baseD.element||baseD.label)}else if(d.type==="react-annotation"||typeof d.type==="function"){return svgReactAnnotationRule({d:d,i:i,projectedNodes:projectedNodes,nodeIDAccessor:nodeIDAccessor})}else if(d.type==="enclose"){return svgEncloseRule$1({d:d,i:i,projectedNodes:projectedNodes,nodeIDAccessor:nodeIDAccessor,nodeSizeAccessor:nodeSizeAccessor})}else if(d.type==="enclose-rect"){return svgRectEncloseRule$1({d:d,i:i,projectedNodes:projectedNodes,nodeIDAccessor:nodeIDAccessor,nodeSizeAccessor:nodeSizeAccessor})}else if(d.type==="enclose-hull"){return svgHullEncloseRule({d:d,i:i,projectedNodes:projectedNodes,nodeIDAccessor:nodeIDAccessor,nodeSizeAccessor:nodeSizeAccessor})}else if(d.type==="highlight"){return svgHighlightRule$1({d:d,networkFrameRender:networkFrameRender})}return null};_this.defaultNetworkHTMLRule=function(_a){var baseD=_a.d,i=_a.i,annotationLayer=_a.annotationLayer;var _b=_this.props,tooltipContent=_b.tooltipContent,size=_b.size,useSpans=_b.useSpans;var _c=_this.state,projectedNodes=_c.projectedNodes,projectedEdges=_c.projectedEdges,nodeIDAccessor=_c.nodeIDAccessor,adjustedSize=_c.adjustedSize,adjustedPosition=_c.adjustedPosition;var voronoiHover=annotationLayer.voronoiHover;var d=baseD.ids?baseD:baseD.edge?__assign({},projectedEdges.find(function(p){return nodeIDAccessor(p.source)===nodeIDAccessor(baseD.source)&&nodeIDAccessor(p.target)===nodeIDAccessor(baseD.target)})||{},baseD):__assign({},projectedNodes.find(function(p){return nodeIDAccessor(p)===baseD.id})||{},baseD);if(_this.props.htmlAnnotationRules){var customAnnotation=_this.props.htmlAnnotationRules({d:d,i:i,networkFrameProps:_this.props,networkFrameState:_this.state,nodes:projectedNodes,edges:projectedEdges,voronoiHover:voronoiHover,screenCoordinates:[d.x,d.y],adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,annotationLayer:annotationLayer});if(customAnnotation!==null){return customAnnotation}}if(d.type==="frame-hover"){return htmlFrameHoverRule$1({d:d,i:i,tooltipContent:tooltipContent,useSpans:useSpans,nodes:projectedNodes,edges:projectedEdges,nodeIDAccessor:nodeIDAccessor})}return null};_this.state={dataVersion:undefined,nodeData:[],edgeData:[],adjustedPosition:[],adjustedSize:[],backgroundGraphics:null,foregroundGraphics:null,projectedNodes:[],projectedEdges:[],renderNumber:0,nodeLabelAnnotations:[],graphSettings:{type:"empty-start",nodes:[],edges:[],nodeHash:new Map,edgeHash:new Map,hierarchicalNetwork:false},edgeWidthAccessor:stringToFn("weight"),legendSettings:{},margin:{top:0,left:0,right:0,bottom:0},networkFrameRender:{},nodeIDAccessor:stringToFn("id"),nodeSizeAccessor:genericFunction(5),overlay:[],projectedXYPoints:[],sourceAccessor:stringToFn("source"),targetAccessor:stringToFn("target"),title:{title:undefined}};return _this}NetworkFrame.prototype.componentWillUnmount=function(){if(this.props.onUnmount){this.props.onUnmount(this.props,this.state)}};NetworkFrame.prototype.componentWillMount=function(){Object.keys(this.props).forEach(function(d){if(!networkframeproptypes[d]){if(xyframeproptypes[d]){console.error(d+" is an XYFrame prop are you sure you're using the right frame?")}else if(ordinalframeproptypes[d]){console.error(d+" is an OrdinalFrame prop are you sure you're using the right frame?")}else{console.error(d+" is not a valid NetworkFrame prop")}}});this.calculateNetworkFrame(this.props)};NetworkFrame.prototype.componentWillReceiveProps=function(nextProps){var _this=this;if(this.state.dataVersion&&this.state.dataVersion!==nextProps.dataVersion||!this.state.projectedNodes&&!this.state.projectedEdges){this.calculateNetworkFrame(nextProps)}else if(this.props.size[0]!==nextProps.size[0]||this.props.size[1]!==nextProps.size[1]||!this.state.dataVersion&&networkFrameChangeProps.find(function(d){return _this.props[d]!==nextProps[d]})){this.calculateNetworkFrame(nextProps)}};NetworkFrame.prototype.onNodeClick=function(d,i){if(this.props.onNodeClick){this.props.onNodeClick(d,i)}};NetworkFrame.prototype.onNodeEnter=function(d,i){if(this.props.onNodeEnter){this.props.onNodeEnter(d,i)}};NetworkFrame.prototype.onNodeOut=function(d,i){if(this.props.onNodeOut){this.props.onNodeOut(d,i)}};NetworkFrame.prototype.calculateNetworkFrame=function(currentProps){var _this=this;var graph=currentProps.graph,_a=currentProps.nodes,nodes=_a===void 0?Array.isArray(graph)||typeof graph==="function"?emptyArray:graph&&graph.nodes||emptyArray:_a,_b=currentProps.edges,edges=_b===void 0?typeof graph==="function"?emptyArray:Array.isArray(graph)?graph:graph&&graph.edges||emptyArray:_b,networkType=currentProps.networkType,size=currentProps.size,nodeStyle=currentProps.nodeStyle,nodeClass=currentProps.nodeClass,canvasNodes=currentProps.canvasNodes,edgeStyle=currentProps.edgeStyle,edgeClass=currentProps.edgeClass,canvasEdges=currentProps.canvasEdges,nodeRenderMode=currentProps.nodeRenderMode,edgeRenderMode=currentProps.edgeRenderMode,nodeLabels=currentProps.nodeLabels,baseTitle=currentProps.title,baseMargin=currentProps.margin,hoverAnnotation=currentProps.hoverAnnotation,baseCustomNodeIcon=currentProps.customNodeIcon,baseCustomEdgeIcon=currentProps.customEdgeIcon,filterRenderedNodes=currentProps.filterRenderedNodes;var edgeType=currentProps.edgeType;var networkSettings;var nodeHierarchicalIDFill={};var networkSettingsKeys=["type"];if(typeof networkType==="string"){networkSettings=__assign({type:networkType},baseNetworkSettings,{graphSettings:baseGraphSettings})}else{if(networkType)networkSettingsKeys=Object.keys(networkType);networkSettings=__assign({type:"force"},baseNetworkSettings,networkType,{graphSettings:baseGraphSettings})}if(networkSettings.projection==="vertical"&&networkSettings.type==="sankey"){networkSettings.direction="down"}networkSettingsKeys.push("height","width");var title=typeof baseTitle==="object"&&!React.isValidElement(baseTitle)&&baseTitle!==null?baseTitle:{title:baseTitle,orient:"top"};var margin=calculateMargin({margin:baseMargin,title:title});var _c=adjustedPositionSize({size:size,margin:margin}),adjustedPosition=_c.adjustedPosition,adjustedSize=_c.adjustedSize;networkSettings.graphSettings.nodes=nodes;networkSettings.graphSettings.edges=edges;var _d=networkSettings.graphSettings,edgeHash=_d.edgeHash,nodeHash=_d.nodeHash;var createPointLayer=networkSettings.type==="treemap"||networkSettings.type==="partition"||networkSettings.type==="sankey";var nodeIDAccessor=stringToFn(currentProps.nodeIDAccessor,function(d){return d.id});var sourceAccessor=stringToFn(currentProps.sourceAccessor,function(d){return d.source});var targetAccessor=stringToFn(currentProps.targetAccessor,function(d){return d.target});var nodeSizeAccessor=typeof currentProps.nodeSizeAccessor==="number"?genericFunction(currentProps.nodeSizeAccessor):stringToFn(currentProps.nodeSizeAccessor,function(d){return d.r||5});var edgeWidthAccessor=stringToFn(currentProps.edgeWidthAccessor,function(d){return d.weight||1});var nodeStyleFn=stringToFn(nodeStyle,function(){return{}},true);var nodeClassFn=stringToFn(nodeClass,function(){return""},true);var nodeRenderModeFn=stringToFn(nodeRenderMode,undefined,true);var nodeCanvasRenderFn=canvasNodes&&stringToFn(canvasNodes,undefined,true);var _e=this.state,projectedNodes=_e.projectedNodes,projectedEdges=_e.projectedEdges;var isHierarchical=typeof networkSettings.type==="string"&&hierarchicalTypeHash[networkSettings.type];var changedData=!this.state.projectedNodes||!this.state.projectedEdges||this.state.graphSettings.nodes!==nodes||this.state.graphSettings.edges!==edges||isHierarchical;if(networkSettings.type==="dagre"){var dagreGraph_1=graph;var dagreNodeHash_1={};projectedNodes=dagreGraph_1.nodes().map(function(n){var baseNode=dagreGraph_1.node(n);dagreNodeHash_1[n]=__assign({},baseNode,{x0:baseNode.x-baseNode.width/2,x1:baseNode.x+baseNode.width/2,y0:baseNode.y-baseNode.height/2,y1:baseNode.y+baseNode.height/2,id:n,shapeNode:true,sourceLinks:[],targetLinks:[]});return dagreNodeHash_1[n]});projectedEdges=dagreGraph_1.edges().map(function(e){var dagreEdge=dagreGraph_1.edge(e);var baseEdge=__assign({},dagreEdge,{points:dagreEdge.points.map(function(d){return __assign({},d)})});baseEdge.source=projectedNodes.find(function(p){return p.id===e.v});baseEdge.target=projectedNodes.find(function(p){return p.id===e.w});baseEdge.points.unshift({x:baseEdge.source.x,y:baseEdge.source.y});baseEdge.points.push({x:baseEdge.target.x,y:baseEdge.target.y});dagreNodeHash_1[e.v].targetLinks.push(baseEdge);dagreNodeHash_1[e.w].sourceLinks.push(baseEdge);return baseEdge})}else if(changedData){edgeHash=new Map;nodeHash=new Map;networkSettings.graphSettings.edgeHash=edgeHash;networkSettings.graphSettings.nodeHash=nodeHash;projectedNodes=[];projectedEdges=[];nodes.forEach(function(node){var projectedNode=__assign({},node);var id=nodeIDAccessor(projectedNode);nodeHash.set(id,projectedNode);nodeHash.set(node,projectedNode);projectedNodes.push(projectedNode);projectedNode.id=id;projectedNode.inDegree=0;projectedNode.outDegree=0;projectedNode.degree=0});var operationalEdges=edges;var baseEdges=edges;if(isHierarchical&&Array.isArray(edges)){var createdHierarchicalData=softStack(edges,projectedNodes,sourceAccessor,targetAccessor,nodeIDAccessor);if(createdHierarchicalData.isHierarchical){baseEdges=createdHierarchicalData.hierarchy;projectedNodes=[]}else{console.error("You've sent an edge list that is not strictly hierarchical (there are nodes with multiple parents) defaulting to force-directed network layout");networkSettings.type="force"}}if(!Array.isArray(baseEdges)){networkSettings.hierarchicalNetwork=true;var rootNode=hierarchy(baseEdges,networkSettings.hierarchyChildren);rootNode.sum(networkSettings.hierarchySum||function(d){return d.value});if(isHierarchical){var layout=networkSettings.layout||isHierarchical;var hierarchicalLayout_1=layout();var networkSettingKeys=Object.keys(networkSettings);if((networkSettings.type==="dendrogram"||networkSettings.type==="tree"||networkSettings.type==="cluster")&&hierarchicalLayout_1.separation){hierarchicalLayout_1.separation(function(a,b){return(nodeSizeAccessor(__assign({},a,a.data))||1)+(networkSettings.nodePadding||0)+(nodeSizeAccessor(__assign({},b,b.data))||1)})}networkSettingKeys.forEach(function(key){if(hierarchicalLayout_1[key]){hierarchicalLayout_1[key](networkSettings[key])}});var layoutSize=networkSettings.projection==="horizontal"&&isHierarchical?[adjustedSize[1],adjustedSize[0]]:adjustedSize;if(!networkSettings.nodeSize&&hierarchicalLayout_1.size){hierarchicalLayout_1.size(layoutSize)}hierarchicalLayout_1(rootNode)}operationalEdges=nodesEdgesFromHierarchy(rootNode,nodeIDAccessor).edges}baseNodeProps.shapeNode=createPointLayer;if(Array.isArray(operationalEdges)){operationalEdges.forEach(function(edge){var source=sourceAccessor(edge);var target=targetAccessor(edge);var sourceTarget=[source,target];sourceTarget.forEach(function(nodeDirection){if(!nodeHash.get(nodeDirection)){var nodeObject=typeof nodeDirection==="object"?__assign({},baseNodeProps,nodeDirection):__assign({},baseNodeProps,{id:nodeDirection,createdByFrame:true});var nodeIDValue=nodeObject.id||nodeIDAccessor(nodeObject);nodeHierarchicalIDFill[nodeIDValue]?nodeHierarchicalIDFill[nodeIDValue]+=1:nodeHierarchicalIDFill[nodeIDValue]=1;if(!nodeObject.id){var nodeSuffix=nodeHierarchicalIDFill[nodeIDValue]===1?"":"-"+nodeHierarchicalIDFill[nodeIDValue];nodeObject.id=""+nodeIDValue+nodeSuffix}nodeHash.set(nodeDirection,nodeObject);projectedNodes.push(nodeObject)}});var edgeWeight=edge.weight||1;var sourceNode=nodeHash.get(source);var targetNode=nodeHash.get(target);targetNode.inDegree+=edgeWeight;sourceNode.outDegree+=edgeWeight;targetNode.degree+=edgeWeight;sourceNode.degree+=edgeWeight;var edgeKey=(nodeIDAccessor(sourceNode)||source)+"|"+(nodeIDAccessor(targetNode)||target);var newEdge=Object.assign({},edge,{source:nodeHash.get(source),target:nodeHash.get(target)});edgeHash.set(edgeKey,newEdge);projectedEdges.push(newEdge)})}}else{edgeHash=new Map;networkSettings.graphSettings.edgeHash=edgeHash;projectedEdges.forEach(function(edge){var edgeSource=typeof edge.source==="string"?edge.source:nodeIDAccessor(edge.source);var edgeTarget=typeof edge.target==="string"?edge.target:nodeIDAccessor(edge.target);var edgeKey=edgeSource+"|"+edgeTarget;edgeHash.set(edgeKey,edge)})}var customNodeIcon=determineNodeIcon(baseCustomNodeIcon,networkSettings,adjustedSize,projectedNodes);var customEdgeIcon=determineEdgeIcon({baseCustomEdgeIcon:baseCustomEdgeIcon,networkSettings:networkSettings,size:adjustedSize,nodes:projectedNodes,graph:graph});if((networkSettings.type==="sankey"||networkSettings.type==="flowchart")&&topologicalSort(projectedNodes,projectedEdges)===null){networkSettings.customSankey=dist_1}networkSettings.width=size[0];networkSettings.height=size[1];var networkSettingsChanged=false;networkSettingsKeys.forEach(function(key){if(key!=="edgeType"&&key!=="graphSettings"&&networkSettings[key]!==_this.state.graphSettings[key]){networkSettingsChanged=true}});if(networkSettings.type==="sankey"){edgeType=function(d){return d.circular?circularAreaLink(d):edgeType==="angled"?ribbonLink(d):areaLink(d)}}else if(isHierarchical){projectedNodes.forEach(function(node){if(createPointLayer){node.x=(node.x0+node.x1)/2;node.y=(node.y0+node.y1)/2}if(typeof networkSettings.type==="string"&&hierarchicalProjectable[networkSettings.type]&&networkSettings.projection==="horizontal"){var ox=node.x;node.x=node.y;node.y=ox;if(createPointLayer){var ox0=node.x0;var ox1=node.x1;node.x0=node.y0;node.x1=node.y1;node.y0=ox0;node.y1=ox1}}else if(typeof networkSettings.type==="string"&&radialProjectable[networkSettings.type]&&networkSettings.projection==="radial"){var radialPoint=node.depth===0?[adjustedSize[0]/2,adjustedSize[1]/2]:pointOnArcAtAngle([adjustedSize[0]/2,adjustedSize[1]/2],node.x/adjustedSize[0],node.y/2);node.x=radialPoint[0];node.y=radialPoint[1]}else{node.x=node.x;node.y=node.y;if(createPointLayer){node.x0=node.x0;node.x1=node.x1;node.y0=node.y0;node.y1=node.y1}}})}if(networkSettings.type!=="static"&&(changedData||networkSettingsChanged)){var components=[{componentNodes:projectedNodes,componentEdges:projectedEdges}];if(networkSettings.type==="chord"){var radius=adjustedSize[1]/2;var _f=networkSettings.groupWidth,groupWidth=_f===void 0?20:_f,_g=networkSettings.padAngle,padAngle=_g===void 0?.01:_g,sortGroups=networkSettings.sortGroups;var arcGenerator_1=arc$1().innerRadius(radius-groupWidth).outerRadius(radius);var ribbonGenerator_1=ribbon$1().radius(radius-groupWidth);var matrixifiedNetwork=matrixify({edgeHash:edgeHash,nodes:projectedNodes,edgeWidthAccessor:edgeWidthAccessor,nodeIDAccessor:nodeIDAccessor});var chordLayout=chord().padAngle(padAngle);if(sortGroups){chordLayout.sortGroups(sortGroups)}var chords=chordLayout(matrixifiedNetwork);var groups=chords.groups;groups.forEach(function(group){var groupCentroid=arcGenerator_1.centroid(group);var groupD=arcGenerator_1(group);var groupNode=projectedNodes[group.index];groupNode.d=groupD;groupNode.index=group.index;groupNode.x=groupCentroid[0]+adjustedSize[0]/2;groupNode.y=groupCentroid[1]+adjustedSize[1]/2});chords.forEach(function(generatedChord){var chordD=ribbonGenerator_1(generatedChord);var nodeSourceID=nodeIDAccessor(projectedNodes[generatedChord.source.index]);var nodeTargetID=nodeIDAccessor(projectedNodes[generatedChord.target.index]);var chordEdge=edgeHash.get(nodeSourceID+"|"+nodeTargetID);chordEdge.d=chordD;var chordBounds=svgPathBoundingBox(chordD);chordEdge.x=adjustedSize[0]/2+(chordBounds.x1+chordBounds.x2)/2;chordEdge.y=adjustedSize[1]/2+(chordBounds.y1+chordBounds.y2)/2})}else if(networkSettings.type==="sankey"||networkSettings.type==="flowchart"){var _h=networkSettings.orient,orient=_h===void 0?"center":_h,_j=networkSettings.iterations,iterations=_j===void 0?100:_j,nodePadding=networkSettings.nodePadding,_k=networkSettings.nodePaddingRatio,nodePaddingRatio=_k===void 0?nodePadding?undefined:.5:_k,_l=networkSettings.nodeWidth,nodeWidth=_l===void 0?networkSettings.type==="flowchart"?2:24:_l,customSankey=networkSettings.customSankey,_m=networkSettings.direction,direction_1=_m===void 0?"right":_m;var sankeyOrient=sankeyOrientHash[orient];var actualSankey=customSankey||dist_1;var frameExtent=[[0,0],adjustedSize];if(networkSettings.direction==="up"||networkSettings.direction==="down"){frameExtent=[[0,0],[adjustedSize[1],adjustedSize[0]]]}var frameSankey=actualSankey().extent(frameExtent).links(projectedEdges).nodes(projectedNodes).nodeAlign(sankeyOrient).nodeId(nodeIDAccessor).nodeWidth(nodeWidth).iterations(iterations);if(frameSankey.nodePaddingRatio&&nodePaddingRatio){frameSankey.nodePaddingRatio(nodePaddingRatio)}else if(nodePadding){frameSankey.nodePadding(nodePadding)}frameSankey();projectedNodes.forEach(function(d){d.height=d.y1-d.y0;d.width=d.x1-d.x0;d.x=d.x0+d.width/2;d.y=d.y0+d.height/2;d.radius=d.height/2;d.direction=direction_1});projectedEdges.forEach(function(d){d.sankeyWidth=d.width;d.direction=direction_1;d.width=undefined})}else if(networkSettings.type==="wordcloud"){var _o=networkSettings.iterations,iterations=_o===void 0?500:_o,_p=networkSettings.fontSize,fontSize_1=_p===void 0?18:_p,rotate_1=networkSettings.rotate,_q=networkSettings.fontWeight,fontWeight_1=_q===void 0?300:_q,_r=networkSettings.textAccessor,textAccessor_1=_r===void 0?function(d){return d.text}:_r;var fontWeightMod=(fontWeight_1/300-1)/5+1;var fontWidth_1=fontSize_1/1.5*fontWeightMod;projectedNodes.forEach(function(d,i){var calcualatedNodeSize=nodeSizeAccessor(d);d._NWFText=textAccessor_1(d)||"";var textWidth=fontWidth_1*d._NWFText.length*calcualatedNodeSize*1.4;var textHeight=fontSize_1*calcualatedNodeSize;d.textHeight=textHeight+4;d.textWidth=textWidth+4;d.rotate=rotate_1?rotate_1(d,i):0;d.fontSize=fontSize_1*calcualatedNodeSize;d.fontWeight=fontWeight_1;d.radius=d.r=textWidth/2});projectedNodes.sort(function(a,b){return b.textWidth-a.textWidth});packSiblings(projectedNodes);var collide=bboxCollide(function(d){if(d.rotate){return[[-d.textHeight/2,-d.textWidth/2],[d.textHeight/2,d.textWidth/2]]}return[[-d.textWidth/2,-d.textHeight/2],[d.textWidth/2,d.textHeight/2]]}).iterations(1);var xCenter=size[0]/2;var yCenter=size[1]/2;var simulation=forceSimulation(projectedNodes).velocityDecay(.6).force("x",forceX(xCenter).strength(1.2)).force("y",forceY(yCenter).strength(1.2)).force("collide",collide);simulation.stop();for(var i=0;i<iterations;++i)simulation.tick();var xMin=min$2(projectedNodes.map(function(p){return p.x-(p.rotate?p.textHeight/2:p.textWidth/2)}));var xMax=max$2(projectedNodes.map(function(p){return p.x+(p.rotate?p.textHeight/2:p.textWidth/2)}));var yMin=min$2(projectedNodes.map(function(p){return p.y-(p.rotate?p.textWidth/2:p.textHeight/2)}));var yMax=max$2(projectedNodes.map(function(p){return p.y+(p.rotate?p.textWidth/2:p.textHeight/2)}));var projectionScaleX_1=linear$1().domain([xMin,xMax]).range([0,adjustedSize[0]]);var projectionScaleY_1=linear$1().domain([yMin,yMax]).range([0,adjustedSize[1]]);var xMod_1=adjustedSize[0]/xMax;var yMod_1=adjustedSize[1]/yMax;var sizeMod_1=Math.min(xMod_1,yMod_1)*1.2;projectedNodes.forEach(function(node){node.x=projectionScaleX_1(node.x);node.y=projectionScaleY_1(node.y);node.fontSize=node.fontSize*sizeMod_1;node.scale=1;node.radius=node.r=Math.max(node.textHeight/4*yMod_1,node.textWidth/4*xMod_1)})}else if(networkSettings.type==="force"){var _s=networkSettings.iterations,iterations=_s===void 0?500:_s,_t=networkSettings.edgeStrength,edgeStrength_1=_t===void 0?.1:_t,_u=networkSettings.distanceMax,distanceMax=_u===void 0?Infinity:_u,edgeDistance=networkSettings.edgeDistance;var linkForce=forceLink().strength(function(d){return Math.min(2.5,d.weight?d.weight*edgeStrength_1:edgeStrength_1)});if(edgeDistance){linkForce.distance(edgeDistance)}var simulation=networkSettings.simulation||forceSimulation().force("charge",forceManyBody().distanceMax(distanceMax).strength(networkSettings.forceManyBody||function(d){return-25*nodeSizeAccessor(d)}));simulation.nodes(projectedNodes);var forceMod=adjustedSize[1]/adjustedSize[0];if(!simulation.force("x")){simulation.force("x",forceX(adjustedSize[0]/2).strength(forceMod*.1))}if(!simulation.force("y")){simulation.force("y",forceY(adjustedSize[1]/2).strength(.1))}if(projectedEdges.length!==0&&!simulation.force("link")){simulation.force("link",linkForce);simulation.force("link").links(projectedEdges)}if(simulation.alpha()<.1){simulation.alpha(1)}simulation.stop();for(var i=0;i<iterations;++i)simulation.tick()}else if(networkSettings.type==="motifs"){var componentHash_1=new Map;projectedEdges.forEach(function(edge){[edge.source,edge.target].forEach(function(node){if(!componentHash_1.get(node)){componentHash_1.set(node,{node:node,component:-99,connectedNodes:[],edges:[]})}});componentHash_1.get(edge.source).connectedNodes.push(edge.target);componentHash_1.get(edge.target).connectedNodes.push(edge.source);componentHash_1.get(edge.source).edges.push(edge)});components=breadthFirstCompontents(projectedNodes,componentHash_1);var largestComponent_1=Math.max(projectedNodes.length/3,components[0].componentNodes.length);var layoutSize_1=size[0]>size[1]?size[1]:size[0];var layoutDirection_1=size[0]>size[1]?"horizontal":"vertical";var _v=networkSettings.iterations,iterations_1=_v===void 0?500:_v,_w=networkSettings.edgeStrength,edgeStrength_2=_w===void 0?.1:_w,edgeDistance_1=networkSettings.edgeDistance,_x=networkSettings.padding,padding_1=_x===void 0?0:_x;var currentX_1=padding_1;var currentY_1=padding_1;components.forEach(function(_a){var componentNodes=_a.componentNodes,componentEdges=_a.componentEdges;var linkForce=forceLink().strength(function(d){return Math.min(2.5,d.weight?d.weight*edgeStrength_2:edgeStrength_2)});if(edgeDistance_1){linkForce.distance(edgeDistance_1)}var componentLayoutSize=Math.max(componentNodes.length/largestComponent_1,.2)*layoutSize_1;var xBound=componentLayoutSize+currentX_1;var yBound=componentLayoutSize+currentY_1;if(layoutDirection_1==="horizontal"){if(yBound>size[1]){currentX_1=componentLayoutSize+currentX_1+padding_1;currentY_1=componentLayoutSize+padding_1}else{currentY_1=componentLayoutSize+currentY_1+padding_1}}else{if(xBound>size[0]){currentY_1=componentLayoutSize+currentY_1+padding_1;currentX_1=componentLayoutSize+padding_1}else{currentX_1=componentLayoutSize+currentX_1+padding_1}}var xCenter=currentX_1-componentLayoutSize/2;var yCenter=currentY_1-componentLayoutSize/2;var simulation=forceSimulation().force("charge",forceManyBody().strength(networkSettings.forceManyBody||function(d){return-25*nodeSizeAccessor(d)})).force("link",linkForce);simulation.force("x",forceX(xCenter)).force("y",forceY(yCenter)).nodes(componentNodes);simulation.force("link").links(componentEdges);simulation.stop();for(var i=0;i<iterations_1;++i)simulation.tick();var maxX=max$2(componentNodes.map(function(d){return d.x}));var maxY=max$2(componentNodes.map(function(d){return d.y}));var minX=min$2(componentNodes.map(function(d){return d.x}));var minY=min$2(componentNodes.map(function(d){return d.y}));var resetX=linear$1().domain([minX,maxX]).range([currentX_1-componentLayoutSize,currentX_1-20]);var resetY=linear$1().domain([minY,maxY]).range([currentY_1-componentLayoutSize,currentY_1-20]);componentNodes.forEach(function(node){node.x=resetX(node.x);node.y=resetY(node.y)})})}else if(networkSettings.type==="matrix"){if(networkSettings.sort){projectedNodes=projectedNodes.sort(networkSettings.sort)}var gridSize=Math.min.apply(Math,__spread(adjustedSize));var stepSize_1=gridSize/(projectedNodes.length+1);projectedNodes.forEach(function(node,index){node.x=0;node.y=(index+1)*stepSize_1})}else if(networkSettings.type==="arc"){if(networkSettings.sort){projectedNodes=projectedNodes.sort(networkSettings.sort)}var stepSize_2=adjustedSize[0]/(projectedNodes.length+2);projectedNodes.forEach(function(node,index){node.x=(index+1)*stepSize_2;node.y=adjustedSize[1]/2})}else if(typeof networkSettings.type==="function"){networkSettings.type({nodes:projectedNodes,edges:projectedEdges})}else{projectedNodes.forEach(function(node){node.x=node.x===undefined?(node.x0+node.x1)/2:node.x;node.y=node.y===undefined?node.y0:node.y})}this.state.graphSettings.nodes=currentProps.nodes;this.state.graphSettings.edges=currentProps.edges}projectedNodes=projectedNodes.filter(filterRenderedNodes);projectedEdges=projectedEdges.filter(function(d){return projectedNodes.indexOf(d.target)!==-1&&projectedNodes.indexOf(d.source)!==-1});if(networkSettings.direction==="flip"){projectedNodes.forEach(function(node){node.x=adjustedSize[0]-node.x;node.y=adjustedSize[1]-node.y})}else if(networkSettings.direction==="up"||networkSettings.direction==="down"){var mod_1=networkSettings.direction==="up"?function(value){return adjustedSize[1]-value}:function(value){return value};projectedNodes.forEach(function(node){var ox=node.x;var ox0=node.x0;var ox1=node.x1;node.x=mod_1(node.y);node.x0=mod_1(node.y0);node.x1=mod_1(node.y1);node.y=ox;node.y0=ox0;node.y1=ox1})}else if(networkSettings.direction==="left"){projectedNodes.forEach(function(node){node.x=adjustedSize[0]-node.x;node.x0=adjustedSize[0]-node.x0;node.x1=adjustedSize[0]-node.x1})}if(typeof networkSettings.zoom==="function"){networkSettings.zoom(projectedNodes,adjustedSize)}else if(networkSettings.zoom!==false&&networkSettings.type!=="matrix"&&networkSettings.type!=="wordcloud"&&networkSettings.type!=="chord"&&networkSettings.type!=="sankey"&&networkSettings.type!=="partition"&&networkSettings.type!=="treemap"&&networkSettings.type!=="circlepack"&&networkSettings.type!=="dagre"){var xMin=min$2(projectedNodes.map(function(p){return p.x-nodeSizeAccessor(p)}));var xMax=max$2(projectedNodes.map(function(p){return p.x+nodeSizeAccessor(p)}));var yMin=min$2(projectedNodes.map(function(p){return p.y-nodeSizeAccessor(p)}));var yMax=max$2(projectedNodes.map(function(p){return p.y+nodeSizeAccessor(p)}));var xSize=Math.abs(xMax-xMin);var ySize=Math.abs(yMax-yMin);var networkAspectRatio=xSize/ySize;var baseAspectRatio=adjustedSize[0]/adjustedSize[1];var yMod=void 0,xMod=void 0;if(networkSettings.zoom==="stretch"){yMod=0;xMod=0}else if(xSize>ySize){if(networkAspectRatio>baseAspectRatio){xMod=0;yMod=(adjustedSize[1]-adjustedSize[0]/xSize*ySize)/2}else{yMod=0;xMod=(adjustedSize[0]-adjustedSize[1]/ySize*xSize)/2}}else{if(networkAspectRatio>baseAspectRatio){xMod=0;yMod=(adjustedSize[1]-adjustedSize[0]/xSize*ySize)/2}else{yMod=0;xMod=(adjustedSize[0]-adjustedSize[1]/ySize*xSize)/2}}var projectionScaleX_2=linear$1().domain([xMin,xMax]).range([xMod,adjustedSize[0]-xMod]);var projectionScaleY_2=linear$1().domain([yMin,yMax]).range([yMod,adjustedSize[1]-yMod]);projectedNodes.forEach(function(node){node.x=projectionScaleX_2(node.x);node.y=projectionScaleY_2(node.y)})}else if(networkSettings.zoom!==false&&networkSettings.projection!=="radial"&&(networkSettings.type==="partition"||networkSettings.type==="treemap"||networkSettings.type==="dagre")){var xMin=min$2(projectedNodes.map(function(p){return p.x0}));var xMax=max$2(projectedNodes.map(function(p){return p.x1}));var yMin=min$2(projectedNodes.map(function(p){return p.y0}));var yMax=max$2(projectedNodes.map(function(p){return p.y1}));var projectionScaleX_3=linear$1().domain([xMin,xMax]).range([margin.left,adjustedSize[0]-margin.right]);var projectionScaleY_3=linear$1().domain([yMin,yMax]).range([margin.top,adjustedSize[1]-margin.bottom]);projectedNodes.forEach(function(node){node.x=projectionScaleX_3(node.x);node.y=projectionScaleY_3(node.y);node.x0=projectionScaleX_3(node.x0);node.y0=projectionScaleY_3(node.y0);node.x1=projectionScaleX_3(node.x1);node.y1=projectionScaleY_3(node.y1);node.zoomedHeight=node.y1-node.y0;node.zoomedWidth=node.x1-node.x0});projectedEdges.forEach(function(edge){if(edge.points){edge.points.forEach(function(p){p.x=projectionScaleX_3(p.x);p.y=projectionScaleY_3(p.y)})}})}projectedNodes.forEach(function(node){node.nodeSize=nodeSizeAccessor(node)});projectedEdges.forEach(function(edge){edge.width=edgeWidthAccessor(edge)});var legendSettings;if(currentProps.legend){legendSettings=currentProps.legend;if(!legendSettings.legendGroups){var legendGroups=[{styleFn:currentProps.nodeStyle,type:"fill",items:[]}];legendSettings.legendGroups=legendGroups}}var networkFrameRender={edges:{accessibleTransform:function(data,i){var edgeX=(data[i].source.x+data[i].target.x)/2;var edgeY=(data[i].source.y+data[i].target.y)/2;return __assign({type:"frame-hover"},data[i],{x:edgeX,y:edgeY})},data:projectedEdges,styleFn:stringToFn(edgeStyle,function(){return{}},true),classFn:stringToFn(edgeClass,function(){return""},true),renderMode:stringToFn(edgeRenderMode,undefined,true),canvasRenderFn:canvasEdges&&stringToFn(canvasEdges,undefined,true),renderKeyFn:currentProps.edgeRenderKey?currentProps.edgeRenderKey:function(d){return d._NWFEdgeKey||d.source.id+"-"+d.target.id},behavior:drawEdges,projection:networkSettings.projection,type:edgeType,customMark:customEdgeIcon,networkType:networkSettings.type,direction:networkSettings.direction},nodes:{accessibleTransform:function(data,i){return __assign({type:"frame-hover"},data[i],data[i].data||{})},data:projectedNodes,styleFn:nodeStyleFn,classFn:nodeClassFn,renderMode:nodeRenderModeFn,canvasRenderFn:nodeCanvasRenderFn,customMark:customNodeIcon,behavior:drawNodes,renderKeyFn:currentProps.nodeRenderKey}};var nodeLabelAnnotations=[];if(currentProps.nodeLabels&&projectedNodes){projectedNodes.forEach(function(node,nodei){var feasibleLabel=nodeLabels&&nodeLabels!==true&&nodeLabels(node);if(nodeLabels===true||feasibleLabel){var actualLabel=networkSettings.projection==="radial"&&node.depth!==0?radialLabelGenerator(node,nodei,nodeLabels===true?nodeIDAccessor:nodeLabels,adjustedSize):nodeLabels===true?nodeIDAccessor(node,nodei):feasibleLabel;var nodeLabel=void 0;if(React.isValidElement(actualLabel)){nodeLabel={key:"node-label-"+nodei,type:"basic-node-label",x:node.x,y:node.y,element:actualLabel}}else{nodeLabel={key:"node-label-"+nodei,className:"node-label",dx:0,dy:0,x:node.x,y:node.y,note:{label:actualLabel},connector:{end:"none"},type:AnnotationLabel,subject:{radius:nodeSizeAccessor(node)+2}}}nodeLabelAnnotations.push(nodeLabel)}})}var projectedXYPoints;var overlay=[];var areaBasedTypes=["circlepack","treemap","partition","chord"];if(hoverAnnotation&&areaBasedTypes.find(function(d){return d===networkSettings.type})||hoverAnnotation==="area"){if(hoverAnnotation!=="edge"){var renderedNodeOverlays=projectedNodes.map(function(d,i){return __assign({overlayData:d},customNodeIcon({d:d,i:i,transform:"translate("+d.x+","+d.y+")",styleFn:function(){return{fill:"pink",opacity:0}}}).props)});overlay.push.apply(overlay,__spread(renderedNodeOverlays))}if(hoverAnnotation!=="node"){projectedEdges.forEach(function(d,i){var generatedIcon=customEdgeIcon({d:d,i:i,transform:"translate("+d.x+","+d.y+")",styleFn:function(){return{fill:"pink",opacity:0}}});if(generatedIcon){overlay.push(__assign({overlayData:__assign({},d,{x:d.x||(d.source.x+d.target.x)/2,y:d.y||(d.source.y+d.target.y)/2,edge:true})},generatedIcon.props))}})}}else if(hoverAnnotation==="edge"&&typeof networkSettings.type==="string"&&edgePointHash[networkSettings.type]){projectedXYPoints=projectedEdges.map(edgePointHash[networkSettings.type])}else if(Array.isArray(hoverAnnotation)||hoverAnnotation===true||hoverAnnotation==="node"){projectedXYPoints=projectedNodes;if(changedData||networkSettingsChanged)projectedXYPoints=__spread(projectedNodes)}else if(hoverAnnotation==="all"&&typeof networkSettings.type==="string"){projectedXYPoints=__spread(projectedEdges.map(edgePointHash[networkSettings.type]),projectedNodes)}this.setState({adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,backgroundGraphics:currentProps.backgroundGraphics,foregroundGraphics:currentProps.foregroundGraphics,title:title,renderNumber:this.state.renderNumber+1,projectedNodes:projectedNodes,projectedEdges:projectedEdges,projectedXYPoints:projectedXYPoints,overlay:overlay,nodeIDAccessor:nodeIDAccessor,sourceAccessor:sourceAccessor,targetAccessor:targetAccessor,nodeSizeAccessor:nodeSizeAccessor,edgeWidthAccessor:edgeWidthAccessor,margin:margin,legendSettings:legendSettings,networkFrameRender:networkFrameRender,nodeLabelAnnotations:nodeLabelAnnotations,graphSettings:__assign({},networkSettings.graphSettings,networkSettings)})};NetworkFrame.prototype.render=function(){var _a=this.props,annotations=_a.annotations,annotationSettings=_a.annotationSettings,className=_a.className,customClickBehavior=_a.customClickBehavior,customDoubleClickBehavior=_a.customDoubleClickBehavior,customHoverBehavior=_a.customHoverBehavior,size=_a.size,matte=_a.matte,hoverAnnotation=_a.hoverAnnotation,beforeElements=_a.beforeElements,afterElements=_a.afterElements,interaction=_a.interaction,disableContext=_a.disableContext,canvasPostProcess=_a.canvasPostProcess,baseMarkProps=_a.baseMarkProps,useSpans=_a.useSpans,canvasNodes=_a.canvasNodes,canvasEdges=_a.canvasEdges,name=_a.name,downloadFields=_a.downloadFields,download=_a.download,additionalDefs=_a.additionalDefs,_b=_a.renderOrder,renderOrder=_b===void 0?this.state.graphSettings&&this.state.graphSettings.type==="matrix"?matrixRenderOrder:generalRenderOrder:_b;var _c=this.state,backgroundGraphics=_c.backgroundGraphics,foregroundGraphics=_c.foregroundGraphics,projectedXYPoints=_c.projectedXYPoints,margin=_c.margin,legendSettings=_c.legendSettings,adjustedPosition=_c.adjustedPosition,adjustedSize=_c.adjustedSize,networkFrameRender=_c.networkFrameRender,nodeLabelAnnotations=_c.nodeLabelAnnotations,overlay=_c.overlay,projectedNodes=_c.projectedNodes,projectedEdges=_c.projectedEdges,title=_c.title;var downloadButton=[];if(download&&projectedNodes.length>0){downloadButton.push(React.createElement(DownloadButton,{key:"network-download-nodes",csvName:name+"-"+(new Date).toJSON(),width:size[0],label:"Download Node List",data:networkNodeDownloadMapping({data:projectedNodes,fields:downloadFields})}))}if(download&&projectedEdges.length>0){downloadButton.push(React.createElement(DownloadButton,{key:"network-download-edges",csvName:name+"-"+(new Date).toJSON(),width:size[0],label:"Download Edge List",data:networkEdgeDownloadMapping({data:projectedEdges,fields:downloadFields})}))}var formattedOverlay;if(overlay&&overlay.length>0){formattedOverlay=overlay}return React.createElement(Frame,{name:"networkframe",renderPipeline:networkFrameRender,adjustedPosition:adjustedPosition,adjustedSize:adjustedSize,size:size,xScale:xScale$1,yScale:yScale$1,title:title,matte:matte,className:className,additionalDefs:additionalDefs,frameKey:"none",projectedCoordinateNames:projectedCoordinateNames$1,defaultSVGRule:this.defaultNetworkSVGRule,defaultHTMLRule:this.defaultNetworkHTMLRule,hoverAnnotation:Array.isArray(hoverAnnotation)?hoverAnnotation:!!hoverAnnotation,annotations:__spread(annotations,nodeLabelAnnotations),annotationSettings:annotationSettings,legendSettings:legendSettings,interaction:interaction,customClickBehavior:customClickBehavior,customHoverBehavior:customHoverBehavior,customDoubleClickBehavior:customDoubleClickBehavior,points:projectedXYPoints,margin:margin,overlay:formattedOverlay,backgroundGraphics:backgroundGraphics,foregroundGraphics:foregroundGraphics,beforeElements:beforeElements,afterElements:afterElements,downloadButton:downloadButton,disableContext:disableContext,canvasPostProcess:canvasPostProcess,baseMarkProps:baseMarkProps,useSpans:!!useSpans,canvasRendering:!!(canvasNodes||canvasEdges),renderOrder:renderOrder,disableCanvasInteraction:true})};NetworkFrame.defaultProps={annotations:[],foregroundGraphics:[],annotationSettings:{},size:[500,500],className:"",name:"networkframe",networkType:{type:"force",iterations:500},filterRenderedNodes:function(d){return d.id!=="root-generated"}};NetworkFrame.displayName="NetworkFrame";return NetworkFrame}(React.Component);var MinimapNetworkFrame=function(_NetworkFrame){_inherits(MinimapNetworkFrame,_NetworkFrame);function MinimapNetworkFrame(props){var _this;_classCallCheck(this,MinimapNetworkFrame);_this=_possibleConstructorReturn(this,_getPrototypeOf(MinimapNetworkFrame).call(this,props));_this.generateMinimap=_this.generateMinimap.bind(_assertThisInitialized(_this));return _this}_createClass(MinimapNetworkFrame,[{key:"generateMinimap",value:function generateMinimap(){var miniDefaults={title:"",position:[0,0],size:[this.props.size[0]*5,this.props.size[1]*5],edges:this.props.edges,nodes:this.props.nodes,xBrushable:true,yBrushable:true,brushStart:function brushStart(){},brush:function brush(){},brushEnd:function brushEnd(){}};var combinedOptions=_extends(miniDefaults,this.props.minimap);combinedOptions.hoverAnnotation=false;return React.createElement(MiniMap,combinedOptions)}},{key:"render",value:function render(){var miniMap=this.generateMinimap();if(this.props.renderBefore);return React.createElement("div",null,"Build out NetworkFrameMinimap Soon")}}]);return MinimapNetworkFrame}(NetworkFrame);var simpleIsEqual=function simpleIsEqual(a,b){return a===b};function index$1(resultFn){var isEqual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:simpleIsEqual;var lastThis=void 0;var lastArgs=[];var lastResult=void 0;var calledOnce=false;var isNewArgEqualToLast=function isNewArgEqualToLast(newArg,index){return isEqual(newArg,lastArgs[index])};var result=function result(){for(var _len=arguments.length,newArgs=Array(_len),_key=0;_key<_len;_key++){newArgs[_key]=arguments[_key]}if(calledOnce&&lastThis===this&&newArgs.length===lastArgs.length&&newArgs.every(isNewArgEqualToLast)){return lastResult}calledOnce=true;lastThis=this;lastArgs=newArgs;lastResult=resultFn.apply(this,newArgs);return lastResult};return result}var framePropHash={NetworkFrame:networkframeproptypes,XYFrame:xyframeproptypes,OrdinalFrame:ordinalframeproptypes,ResponsiveNetworkFrame:__assign({},networkframeproptypes,responsiveprops),ResponsiveXYFrame:__assign({},xyframeproptypes,responsiveprops),ResponsiveOrdinalFrame:__assign({},ordinalframeproptypes,responsiveprops),SparkNetworkFrame:__assign({},networkframeproptypes),SparkXYFrame:__assign({},xyframeproptypes),SparkOrdinalFrame:__assign({},ordinalframeproptypes)};var buildNewState=function(prevState,extentValue,extentType,extentPosition){var _a,_b;var oldExtents=prevState.rawExtents[extentType]||{};oldExtents[extentPosition]=extentValue;var extentMinMaxValues=Object.values(oldExtents).flat().filter(function(d){return d!==undefined&&d!==null&&!isNaN(d)});return{extents:__assign({},prevState.extents,(_a={},_a[extentType]=extentMinMaxValues.length===0?undefined:[Math.min.apply(Math,__spread(extentMinMaxValues)),Math.max.apply(Math,__spread(extentMinMaxValues))],_a)),rawExtents:__assign({},prevState.rawExtents,(_b={},_b[extentType]=oldExtents,_b))}};function validFrameProps(originalProps,frameType){var newProps={};var frameProps=framePropHash[frameType];Object.keys(originalProps).forEach(function(key){if(frameProps[key]){newProps[key]=originalProps[key]}});return newProps}var FacetController=function(_super){__extends(FacetController,_super);function FacetController(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={extents:{},rawExtents:{},facetHover:undefined};_this.createExtent=function(extentType,state,index){return state.extents&&state.extents[extentType]?{onChange:_this.extentHandler(extentType,index),extent:state.extents[extentType]}:{onChange:_this.extentHandler(extentType,index)}};_this.extentHandler=function(extentType,extentPosition){return function(extentValue){_this.setState(function(prevState){return buildNewState(prevState,extentValue,extentType,extentPosition)});return extentValue}};_this.generateChildAnnotations=function(_a){var originalAnnotations=_a.originalAnnotations,state=_a.state;var annotationBase=state.facetHoverAnnotations;var annotationSettings=_this.props.hoverAnnotation||_this.props.pieceHoverAnnotation;if(!annotationSettings||!annotationBase){return[]}if(state.facetHover){var annotations=__spread(originalAnnotations);if(annotationSettings===true){annotationBase=[__assign({},state.facetHover)]}else{var annotationMap=annotationSettings;annotationBase=annotationMap.map(function(annotation){var decoratedAnnotation=typeof annotation==="function"?annotation(state.facetHover):__assign({},state.facetHover,annotation);return decoratedAnnotation})}if(Array.isArray(annotationBase)){annotationBase.forEach(function(annotation){if(typeof annotation!=="function"){if(annotation.type==="column-hover"){annotation.facetColumn=annotation.column.name;annotation.column=undefined}else{if(!annotation.type){annotation.type="frame-hover"}annotation.y=undefined;annotation.yBottom=undefined;annotation.yMiddle=undefined;annotation.yTop=undefined}}});annotations.push.apply(annotations,__spread(annotationBase))}return annotations}return originalAnnotations};_this.mapChildrenWithAppropriateProps=function(_a){var child=_a.child,index=_a.index,originalAnnotations=_a.originalAnnotations,props=_a.props,state=_a.state;var childType=child.type;var frameType=childType.displayName;var annotations=_this.generateChildAnnotations({state:state,originalAnnotations:originalAnnotations});var customProps=__assign({},props,{annotations:annotations});if(!framePropHash[frameType]){return React.cloneElement(child,{facetprops:customProps})}if(props.hoverAnnotation||props.pieceHoverAnnotation){customProps.customHoverBehavior=function(d){return _this.setState({facetHover:d,facetHoverAnnotations:props.hoverAnnotation||props.pieceHoverAnnotation})}}if((frameType==="OrdinalFrame"||frameType==="ResponsiveOrdinalFrame"||frameType==="SparkOrdinalFrame")&&props.sharedRExtent===true){customProps.rExtent=_this.createExtent("rExtent",state,index);customProps.onUnmount=function(){_this.setState(function(prevState){return buildNewState(prevState,[],"rExtent",index)})}}if((frameType==="XYFrame"||frameType==="ResponsiveXYFrame"||frameType==="SparkXYFrame")&&props.sharedXExtent===true){customProps.xExtent=_this.createExtent("xExtent",state,index);customProps.onUnmount=function(){_this.setState(function(prevState){return buildNewState(prevState,[],"xExtent",index)})}}if((frameType==="XYFrame"||frameType==="ResponsiveXYFrame"||frameType==="SparkXYFrame")&&props.sharedYExtent===true){customProps.yExtent=_this.createExtent("yExtent",state,index);customProps.onUnmount=function(){_this.setState(function(prevState){return buildNewState(prevState,[],"yExtent",index)})}}if(customProps.pieceHoverAnnotation){customProps.pieceHoverAnnotation=[]}else if(customProps.hoverAnnotation){customProps.hoverAnnotation=[]}return React.cloneElement(child,validFrameProps(customProps,frameType))};_this.processFacetController=index$1(function(props,state){return React.Children.map(props.children,function(child,index){if(!child)return null;return _this.mapChildrenWithAppropriateProps({child:child,index:index,originalAnnotations:child.props.annotations||[],props:props,state:state})})});return _this}FacetController.prototype.render=function(){var Wrapper=this.props.react15Wrapper;if(Wrapper){return React.cloneElement(Wrapper,undefined,this.processFacetController(this.props,this.state))}return React.createElement(React.Fragment,null,this.processFacetController(this.props,this.state))};return FacetController}(React.Component);function elementResizeEvent(element,fn){var window=typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof this!=="undefined"?this:{document:{}};var document=window.document;var isIE;var requestFrame;var attachEvent=document.attachEvent;if(typeof navigator!=="undefined"){isIE=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)}requestFrame=function(){var raf=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function fallbackRAF(func){return window.setTimeout(func,20)};return function requestFrameFunction(func){return raf(func)}}();var cancelFrame=function(){var cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function cancelFrameFunction(id){return cancel(id)}}();function resizeListener(e){var win=e.target||e.srcElement;if(win.__resizeRAF__){cancelFrame(win.__resizeRAF__)}win.__resizeRAF__=requestFrame(function(){var trigger=win.__resizeTrigger__;if(trigger!==undefined){trigger.__resizeListeners__.forEach(function(fn){fn.call(trigger,e)})}})}function objectLoad(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__;this.contentDocument.defaultView.addEventListener("resize",resizeListener)}if(!element.__resizeListeners__){element.__resizeListeners__=[];if(attachEvent){element.__resizeTrigger__=element;element.attachEvent("onresize",resizeListener)}else{if(getComputedStyle(element).position==="static"){element.style.position="relative"}var obj=element.__resizeTrigger__=document.createElement("object");obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -1; opacity: 0;");obj.setAttribute("class","resize-sensor");obj.setAttribute("tabIndex","-1");obj.__resizeElement__=element;obj.onload=objectLoad;obj.type="text/html";if(isIE){element.appendChild(obj)}obj.data="about:blank";if(!isIE){element.appendChild(obj)}}}element.__resizeListeners__.push(fn)}elementResizeEvent.unbind=function(element,fn){element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn),1);if(!element.__resizeListeners__.length){element.__resizeTrigger__=!element.removeChild(element.__resizeTrigger__)}};var createResponsiveFrame=function(Frame){var _a;return _a=function(_super){__extends(ResponsiveFrame,_super);function ResponsiveFrame(props){var _this=_super.call(this,props)||this;_this.node=null;_this.isResizing=undefined;_this._onResize=function(width,height){_this.setState({containerHeight:height,containerWidth:width})};_this.state={containerHeight:undefined,containerWidth:undefined};return _this}ResponsiveFrame.prototype.componentDidMount=function(){var _this=this;var element=this.node;elementResizeEvent(element,function(){window.clearTimeout(_this.isResizing);_this.isResizing=setTimeout(function(){_this.isResizing=false;_this.setState({containerHeight:element.offsetHeight,containerWidth:element.offsetWidth})},_this.props.debounce)});this.setState({containerHeight:element.offsetHeight,containerWidth:element.offsetWidth})};ResponsiveFrame.prototype.render=function(){var _this=this;var _a=this.props,responsiveWidth=_a.responsiveWidth,responsiveHeight=_a.responsiveHeight,size=_a.size,dataVersion=_a.dataVersion,debounce=_a.debounce,gridDisplay=_a.gridDisplay,rest=__rest(_a,["responsiveWidth","responsiveHeight","size","dataVersion","debounce","gridDisplay"]);var _b=this.state,containerHeight=_b.containerHeight,containerWidth=_b.containerWidth;var actualSize=__spread(size);var returnEmpty=false;if(responsiveWidth){if(!containerWidth)returnEmpty=true;actualSize[0]=containerWidth}if(responsiveHeight){if(!containerHeight)returnEmpty=true;actualSize[1]=containerHeight}var dataVersionWithSize=dataVersion+actualSize.toString()+debounce;return React.createElement("div",{className:"responsive-container",style:gridDisplay?{minWidth:"0px",minHeight:"0px"}:{height:"100%",width:"100%"},ref:function(node){return _this.node=node}},!returnEmpty&&React.createElement(Frame,__assign({},rest,{size:actualSize,dataVersion:dataVersion?dataVersionWithSize:undefined})))};return ResponsiveFrame}(React.Component),_a.defaultProps={size:[500,500],debounce:200},_a.displayName="Responsive"+Frame.displayName,_a};var ResponsiveNetworkFrame=createResponsiveFrame(NetworkFrame);var ResponsiveMinimapXYFrame=createResponsiveFrame(MinimapXYFrame);var ResponsiveXYFrame=createResponsiveFrame(XYFrame);var ResponsiveOrdinalFrame=createResponsiveFrame(OrdinalFrame);var allFrameDefaults={margin:0};function sparkNetworkSettings(originalSettings){if(originalSettings===void 0){originalSettings="force"}var finalSettings={};if(originalSettings){finalSettings=originalSettings;if(originalSettings==="force")finalSettings={type:"force"};return __assign({edgeStrength:2,edgeDistance:5,nodePadding:1,nodeWidth:5,groupWidth:4},finalSettings)}return originalSettings}var createSparkFrame=function(Frame,defaults,frameName){var _a;return _a=function(_super){__extends(SparkFrame,_super);function SparkFrame(props){var _this=_super.call(this,props)||this;_this.node=null;_this._onResize=function(width,height){_this.setState({containerHeight:height,containerWidth:width})};_this.state={containerHeight:props.size[1],containerWidth:props.size[0]};return _this}SparkFrame.prototype.componentDidMount=function(){var element=this.node;var lineHeight=+window.getComputedStyle(element).lineHeight.split("px")[0]-5;this.setState({containerHeight:isNaN(lineHeight)?element.offsetHeight:lineHeight,containerWidth:element.offsetWidth})};SparkFrame.prototype.render=function(){var _this=this;var _a=this.props,size=_a.size,_b=_a.style,style=_b===void 0?{}:_b;var _c=this.state.containerHeight,containerHeight=_c===void 0?30:_c;var actualSize=[];actualSize[0]=typeof size==="number"?size:size[0]?size[0]:containerHeight;actualSize[1]=containerHeight;return React.createElement("span",{style:Object.assign({width:actualSize[0]+"px",height:actualSize[1]+"px",display:"inline-block",marginLeft:"5px",marginRight:"5px"},style),ref:function(node){return _this.node=node}},React.createElement(Frame,__assign({},defaults(this.props),{size:actualSize,useSpans:true})))};return SparkFrame}(React.Component),_a.displayName=frameName,_a.defaultProps={size:[]},_a};var axisDefaults={tickFormat:function(){return""},baseline:false};var xyFrameDefaults=function(props){return __assign({},allFrameDefaults,props,{hoverAnnotation:props.hoverAnnotation,axes:props.axes?props.axes.map(function(a){return __assign({},axisDefaults,a)}):props.axes})};var ordinalFrameDefaults=function(props){return __assign({},allFrameDefaults,props,{hoverAnnotation:props.hoverAnnotation,axis:props.axis?__assign({axisDefaults:axisDefaults},props.axis):props.axis})};var networkFrameDefaults=function(props){return __assign({},allFrameDefaults,{nodeSizeAccessor:2},props,{networkType:sparkNetworkSettings(props.networkType)})};var SparkXYFrame=createSparkFrame(XYFrame,xyFrameDefaults,"SparkXYFrame");var SparkOrdinalFrame=createSparkFrame(OrdinalFrame,ordinalFrameDefaults,"SparkOrdinalFrame");var SparkNetworkFrame=createSparkFrame(NetworkFrame,networkFrameDefaults,"SparkNetworkFrame");var ORFrame=OrdinalFrame;var ResponsiveORFrame=ResponsiveOrdinalFrame;var index$2={AnnotationLayer:AnnotationLayer,DividedLine:DividedLine,XYFrame:XYFrame,MinimapXYFrame:MinimapXYFrame,MinimapNetworkFrame:MinimapNetworkFrame,MiniMap:MiniMap,Brush:Brush,Axis:Axis,InteractionLayer:InteractionLayer,VisualizationLayer:VisualizationLayer,OrdinalFrame:OrdinalFrame,ORFrame:ORFrame,Annotation:SemioticAnnotation,NetworkFrame:NetworkFrame,ResponsiveMinimapXYFrame:ResponsiveMinimapXYFrame,ResponsiveOrdinalFrame:ResponsiveOrdinalFrame,ResponsiveORFrame:ResponsiveORFrame,ResponsiveNetworkFrame:ResponsiveNetworkFrame,ResponsiveXYFrame:ResponsiveXYFrame,SparkOrdinalFrame:SparkOrdinalFrame,SparkNetworkFrame:SparkNetworkFrame,SparkXYFrame:SparkXYFrame,Legend:Legend,Mark:lib_2,FacetController:FacetController,funnelize:funnelize,calculateDataExtent:calculateDataExtent,chuckCloseCanvasTransform:chuckCloseCanvasTransform,hexbinning:hexbinning,heatmapping:heatmapping,nodesEdgesFromHierarchy:nodesEdgesFromHierarchy};exports.Annotation=SemioticAnnotation;exports.AnnotationLayer=AnnotationLayer;exports.Axis=Axis;exports.Brush=Brush;exports.DividedLine=DividedLine;exports.FacetController=FacetController;exports.InteractionLayer=InteractionLayer;exports.Legend=Legend;exports.Mark=lib_2;exports.MiniMap=MiniMap;exports.MinimapNetworkFrame=MinimapNetworkFrame;exports.MinimapXYFrame=MinimapXYFrame;exports.NetworkFrame=NetworkFrame;exports.ORFrame=ORFrame;exports.OrdinalFrame=OrdinalFrame;exports.ResponsiveMinimapXYFrame=ResponsiveMinimapXYFrame;exports.ResponsiveNetworkFrame=ResponsiveNetworkFrame;exports.ResponsiveORFrame=ResponsiveORFrame;exports.ResponsiveOrdinalFrame=ResponsiveOrdinalFrame;exports.ResponsiveXYFrame=ResponsiveXYFrame;exports.SparkNetworkFrame=SparkNetworkFrame;exports.SparkOrdinalFrame=SparkOrdinalFrame;exports.SparkXYFrame=SparkXYFrame;exports.VisualizationLayer=VisualizationLayer;exports.XYFrame=XYFrame;exports.calculateDataExtent=calculateDataExtent;exports.chuckCloseCanvasTransform=chuckCloseCanvasTransform;exports.default=index$2;exports.funnelize=funnelize;exports.heatmapping=heatmapping;exports.hexbinning=hexbinning;exports.nodesEdgesFromHierarchy=nodesEdgesFromHierarchy;Object.defineProperty(exports,"__esModule",{value:true})});